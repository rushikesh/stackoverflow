[{"t":"How can I prevent SQL-injection in PHP?","l":"http://stackoverflow.com/questions/60174/how-can-i-prevent-sql-injection-in-php","q":"\n\n<p>If user input is inserted without modification into an SQL query, then the application becomes vulnerable to <a href=\"http://stackoverflow.com/a/332367/\">SQL injection</a>, like in the following example:</p>\n\n<pre class=\"lang-php prettyprint-override\"><code>$unsafe_variable = $_POST['user_input']; \n\nmysql_query(\"INSERT INTO `table` (`column`) VALUES ('$unsafe_variable')\");\n</code></pre>\n\n<p>That's because the user can input something like <code>value'); DROP TABLE table;--</code>, and the query becomes:</p>\n\n<pre><code>INSERT INTO `table` (`column`) VALUES('value'); DROP TABLE table;--')\n</code></pre>\n\n<p>What can be done to prevent this from happening?</p>\n    ","a":"\n<p><strong>Use prepared statements and parameterized queries.</strong> These are SQL statements that are sent to and parsed by the database server separately from any parameters. This way it is impossible for an attacker to inject malicious SQL.</p>\n\n<p>You basically have two options to achieve this:</p>\n\n<ol>\n<li><p>Using <a href=\"http://php.net/manual/en/book.pdo.php\">PDO</a> (for any supported database driver):</p>\n\n<pre class=\"lang-php prettyprint-override\"><code>$stmt = $pdo-&gt;prepare('SELECT * FROM employees WHERE name = :name');\n\n$stmt-&gt;execute(array('name' =&gt; $name));\n\nforeach ($stmt as $row) {\n    // do something with $row\n}\n</code></pre></li>\n<li><p>Using <a href=\"http://php.net/manual/en/book.mysqli.php\">MySQLi</a> (for MySQL):</p>\n\n<pre class=\"lang-php prettyprint-override\"><code>$stmt = $dbConnection-&gt;prepare('SELECT * FROM employees WHERE name = ?');\n$stmt-&gt;bind_param('s', $name);\n\n$stmt-&gt;execute();\n\n$result = $stmt-&gt;get_result();\nwhile ($row = $result-&gt;fetch_assoc()) {\n    // do something with $row\n}\n</code></pre></li>\n</ol>\n\n<p>If you're connecting to a database other than MySQL, there is a driver-specific second option that you can refer to (e.g. <code>pg_prepare()</code> and <code>pg_execute()</code> for PostgreSQL). PDO is the universal option.</p>\n\n<h2>Correctly setting up the connection</h2>\n\n<p>Note that when using <code>PDO</code> to access a MySQL database <em>real</em> prepared statements are <strong>not used by default</strong>. To fix this you have to disable the emulation of prepared statements. An example of creating a connection using PDO is:</p>\n\n<pre class=\"lang-php prettyprint-override\"><code>$dbConnection = new PDO('mysql:dbname=dbtest;host=127.0.0.1;charset=utf8', 'user', 'pass');\n\n$dbConnection-&gt;setAttribute(PDO::ATTR_EMULATE_PREPARES, false);\n$dbConnection-&gt;setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);\n</code></pre>\n\n<p>In the above example the error mode isn't strictly necessary, <strong>but it is advised to add it</strong>. This way the script will not stop with a <code>Fatal Error</code> when something goes wrong. And it gives the developer the chance to <code>catch</code> any error(s) which are <code>throw</code>n as <code>PDOException</code>s.</p>\n\n<p>What is <strong>mandatory</strong> however is the first <code>setAttribute()</code> line, which tells PDO to disable emulated prepared statements and use <em>real</em> prepared statements. This makes sure the statement and the values aren't parsed by PHP before sending it to the MySQL server (giving a possible attacker no chance to inject malicious SQL).</p>\n\n<p>Although you can set the <code>charset</code> in the options of the constructor, it's important to note that 'older' versions of PHP (&lt; 5.3.6) <a href=\"http://php.net/manual/en/ref.pdo-mysql.connection.php\">silently ignored the charset parameter</a> in the DSN.</p>\n\n<h2>Explanation</h2>\n\n<p>What happens is that the SQL statement you pass to <code>prepare</code> is parsed and compiled by the database server. By specifying parameters (either a <code>?</code> or a named parameter like <code>:name</code> in the example above) you tell the database engine where you want to filter on. Then when you call <code>execute</code>, the prepared statement is combined with the parameter values you specify. </p>\n\n<p>The important thing here is that the parameter values are combined with the compiled statement, not an SQL string. SQL injection works by tricking the script into including malicious strings when it creates SQL to send to the database. So by sending the actual SQL separately from the parameters, you limit the risk of ending up with something you didn't intend. Any parameters you send when using a prepared statement will just be treated as strings (although the database engine may do some optimization so parameters may end up as numbers too, of course). In the example above, if the <code>$name</code> variable contains <code>'Sarah'; DELETE FROM employees</code> the result would simply be a search for the string <code>\"'Sarah'; DELETE FROM employees\"</code>, and you will not end up with <a href=\"http://xkcd.com/327/\">an empty table</a>.</p>\n\n<p>Another benefit with using prepared statements is that if you execute the same statement many times in the same session it will only be parsed and compiled once, giving you some speed gains.</p>\n\n<p>Oh, and since you asked about how to do it for an insert, here's an example (using PDO):</p>\n\n<pre class=\"lang-php prettyprint-override\"><code>$preparedStatement = $db-&gt;prepare('INSERT INTO table (column) VALUES (:column)');\n\n$preparedStatement-&gt;execute(array('column' =&gt; $unsafeValue));\n</code></pre>\n\n<h2>Can Prepared Statements Be Used For Dynamic Queries?</h2>\n\n<p>While you can still use prepared statements for the query parameters, the structure of the dynamic query itself cannot be parametrized and certain query features (e.g. <code>LIMIT $start, $number</code>) cannot be parametrized.</p>\n\n<p>For example, this will <strong>not work</strong>:</p>\n\n<pre><code>$stmt = $pdo-&gt;prepare('SELECT * FROM employees ORDER BY name ASC LIMIT ?, ?'); // Bad query\n$stmt-&gt;execute(array(0, 30));\n</code></pre>\n\n<p>For these specific scenarios, the best thing to do is use a whitelist filter that restricts the possible values or the possible characters.</p>\n\n<pre><code>// Value whitelist\n  // $dir can only be 'DESC' or 'ASC'\n$dir = !empty($direction) ? 'DESC' : 'ASC';\n\n// Character set whitelist\n  // $offset will never contain a non-numeric character\n$offset = preg_replace('/[^0-9]+/', '', $offset);\nif (empty($offset)) {\n    $offset = 0;\n}\n\n// Explicit data types\n  // $number will always be an integer. We use a binary AND operation\n  // ($number &amp; PHP_INT_MAX) to prevent integer overflows from creating\n  // invalid characters from alternative notation.\n$number = (int) ($number &lt; 0 ? 1 : ($number &amp; PHP_INT_MAX));\n\n$stmt = $pdo-&gt;prepare(\n    'SELECT * FROM employees ORDER BY name '.$dir.' LIMIT '.$offset.', '.$number\n);\n</code></pre>\n    "},{"t":"Difference between INNER and OUTER joins","l":"http://stackoverflow.com/questions/38549/difference-between-inner-and-outer-joins","q":"\n\n<p>What is the difference between <code>INNER JOIN</code> and <code>OUTER JOIN</code>?</p>\n\n<p>How do <code>LEFT JOIN</code>, <code>RIGHT JOIN</code>, and <code>FULL JOIN</code> fit in?</p>\n    ","a":"\n<p>Assuming you're joining on columns with no duplicates, which is a very common case:</p>\n\n<ul>\n<li><p>An inner join of A and B gives the result of A intersect B, i.e. the inner part of a venn diagram intersection.</p></li>\n<li><p>An outer join of A and B gives the results of A union B, i.e. the outer parts of a <a href=\"http://en.wikipedia.org/wiki/Venn_diagram\">Venn diagram</a> union.</p></li>\n</ul>\n\n<p><strong>Examples</strong></p>\n\n<p>Suppose you have two tables, with a single column each, and data as follows:</p>\n\n<pre><code>A    B\n-    -\n1    3\n2    4\n3    5\n4    6\n</code></pre>\n\n<p>Note that (1,2) are unique to A, (3,4) are common, and (5,6) are unique to B.</p>\n\n<p><strong>Inner join</strong></p>\n\n<p>An inner join using either of the equivalent queries gives the intersection of the two tables, i.e. the two rows they have in common.</p>\n\n<pre><code>select * from a INNER JOIN b on a.a = b.b;\nselect a.*,b.*  from a,b where a.a = b.b;\n\na | b\n--+--\n3 | 3\n4 | 4\n</code></pre>\n\n<p><strong>Left outer join</strong></p>\n\n<p>A left outer join will give all rows in A, plus any common rows in B.</p>\n\n<pre><code>select * from a LEFT OUTER JOIN b on a.a = b.b;\nselect a.*,b.*  from a,b where a.a = b.b(+);\n\na |  b\n--+-----\n1 | null\n2 | null\n3 |    3\n4 |    4\n</code></pre>\n\n<p><strong>Full outer join</strong></p>\n\n<p>A full outer join will give you the union of A and B, i.e. all the rows in A and all the rows in B. If something in A doesn't have a corresponding datum in B, then the B portion is null, and vice versa.</p>\n\n<pre><code>select * from a FULL OUTER JOIN b on a.a = b.b;\n\n a   |  b\n-----+-----\n   1 | null\n   2 | null\n   3 |    3\n   4 |    4\nnull |    6\nnull |    5\n</code></pre>\n    "},{"t":"UPDATE from SELECT using SQL Server","l":"http://stackoverflow.com/questions/2334712/update-from-select-using-sql-server","q":"\n\n<p>In SQL Server, it's possible to <em>insert</em> into a table using a <code>SELECT</code> statement:</p>\n\n<pre><code>INSERT INTO Table (col, col2, col3)\n    SELECT col, col2, col3 FROM other_table WHERE sql = 'cool'\n</code></pre>\n\n<p>Is it also possible to <em>update</em> via a <code>SELECT</code>? I have a temporary table containing the values, and would like to update another table using those values. Perhaps something like this:</p>\n\n<pre><code>UPDATE Table SET col1, col2\n    SELECT col1, col2 FROM other_table WHERE sql = 'cool'\n    WHERE Table.id = other_table.id\n</code></pre>\n    ","a":"\n<pre><code>UPDATE\n    T\nSET\n    T.col1 = OT.col1,\n    T.col2 = OT.col2\nFROM\n    Some_Table T\nINNER JOIN\n    Other_Table OT\nON\n    T.id = OT.id\nWHERE\n    T.col3 = 'cool'\n</code></pre>\n    "},{"t":"Add a column, with a default value, to an existing table in SQL Server","l":"http://stackoverflow.com/questions/92082/add-a-column-with-a-default-value-to-an-existing-table-in-sql-server","q":"\n\n<p>How can a column with a default value be added to an existing table in <a href=\"http://en.wikipedia.org/wiki/Microsoft_SQL_Server#Genesis\">SQL Server 2000</a> / <a href=\"http://en.wikipedia.org/wiki/Microsoft_SQL_Server#SQL_Server_2005\">SQL Server 2005</a>?</p>\n    ","a":"\n<pre><code>ALTER TABLE {TABLENAME} \nADD {COLUMNNAME} {TYPE} {NULL|NOT NULL} \nCONSTRAINT {CONSTRAINT_NAME} DEFAULT {DEFAULT_VALUE}\n[WITH VALUES]\n</code></pre>\n    "},{"t":"Insert results of a Stored Procedure into a Temporary Table","l":"http://stackoverflow.com/questions/653714/insert-results-of-a-stored-procedure-into-a-temporary-table","q":"\n\n<p>How do I do a <code>SELECT * INTO [temp table] FROM [stored procedure]</code>? Not <code>FROM [Table]</code> and without defining <code>[temp table]</code>?</p>\n\n<p>Select all data from <em>BusinessLine</em> into <em>tmpBusLine</em> works fine.</p>\n\n<pre><code>select * \ninto tmpBusLine\nfrom BusinessLine\n</code></pre>\n\n<p>Trying the same, but using a stored procedure that returns data, is not quite the same.</p>\n\n<pre><code>select * \ninto tmpBusLine \nfrom\nexec getBusinessLineHistory '16 Mar 2009'\n</code></pre>\n\n<p>Output message:</p>\n\n<blockquote>\n  <p>Msg 156, Level 15, State 1, Line 2\n  Incorrect syntax near the keyword\n  'exec'.</p>\n</blockquote>\n\n<p>I have read several examples of creating a temporary table with the same structure as the output stored procedure, which works fine, but it would be nice to not supply any columns.</p>\n    ","a":"\n<p>You can use <a href=\"http://msdn.microsoft.com/en-us/library/ms190312%28v=sql.100%29.aspx\">OPENROWSET</a> for this.  Have a look.  I've also included the sp_configure code to enable Ad Hoc Distributed Queries, in case it isn't already enabled.</p>\n\n<pre><code>CREATE PROC getBusinessLineHistory\nAS\nBEGIN\n    SELECT * FROM sys.databases\nEND\nGO\n\nsp_configure 'Show Advanced Options', 1\nGO\nRECONFIGURE\nGO\nsp_configure 'Ad Hoc Distributed Queries', 1\nGO\nRECONFIGURE\nGO\n\nSELECT * INTO #MyTempTable FROM OPENROWSET('SQLNCLI', 'Server=(local)\\SQL2008;Trusted_Connection=yes;',\n     'EXEC getBusinessLineHistory')\n\nSELECT * FROM #MyTempTable\n</code></pre>\n    "},{"t":"Concatenate many rows into a single text string?","l":"http://stackoverflow.com/questions/194852/concatenate-many-rows-into-a-single-text-string","q":"\n\n<p>Consider a database table holding names, with three rows:</p>\n\n<pre><code>Peter\nPaul\nMary\n</code></pre>\n\n<p>Is there an easy way to turn this into a single string of <code>Peter, Paul, Mary</code>?</p>\n    ","a":"\n<p>I had a similar issue when I was trying to join two tables with one-to-many relationships. In SQL 2005 I found that XML PATH method can handle the concatenation of the rows very easily.</p>\n\n<p>If there is a table called STUDENTS</p>\n\n<pre><code>SubjectID       StudentName\n----------      -------------\n1               Mary\n1               John\n1               Sam\n2               Alaina\n2               Edward\n</code></pre>\n\n<p>Result I expected was:</p>\n\n<pre><code>SubjectID       StudentName\n----------      -------------\n1               Mary, John, Sam\n2               Alaina, Edward\n</code></pre>\n\n<p>I used the following T-SQL:</p>\n\n<pre><code>Select Main.SubjectID,\n       Left(Main.Students,Len(Main.Students)-1) As \"Students\"\nFrom\n    (\n        Select distinct ST2.SubjectID, \n            (\n                Select ST1.StudentName + ',' AS [text()]\n                From dbo.Students ST1\n                Where ST1.SubjectID = ST2.SubjectID\n                ORDER BY ST1.SubjectID\n                For XML PATH ('')\n            ) [Students]\n        From dbo.Students ST2\n    ) [Main]\n</code></pre>\n\n<p>You can do the same thing in a more compact way if you can concat the commas at the beginning and use substring to skip the first one so you don't need to do a subquery:</p>\n\n<pre><code>Select distinct ST2.SubjectID, \n    substring(\n        (\n            Select ','+ST1.StudentName  AS [text()]\n            From dbo.Students ST1\n            Where ST1.SubjectID = ST2.SubjectID\n            ORDER BY ST1.SubjectID\n            For XML PATH ('')\n        ), 2, 1000) [Students]\nFrom dbo.Students ST2\n</code></pre>\n    "},{"t":"Parameterize an SQL IN clause","l":"http://stackoverflow.com/questions/337704/parameterize-an-sql-in-clause","q":"\n\n<p>How do I parameterize a query containing an <code>IN</code> clause with a variable number of arguments, like this one?</p>\n\n<pre><code>select * from Tags \nwhere Name in ('ruby','rails','scruffy','rubyonrails')\norder by Count desc\n</code></pre>\n\n<p>In this query, the number of arguments could be anywhere from 1 to 5.</p>\n\n<p>I would prefer not to use a dedicated stored procedure for this (or XML), but if there is some elegant way specific to <a href=\"http://en.wikipedia.org/wiki/Microsoft_SQL_Server#SQL_Server_2008\">SQL Server 2008</a>, I am open to that.</p>\n    ","a":"\n<p>Here's a quick-and-dirty technique I have used:</p>\n\n<pre><code>SELECT * \nFROM Tags\nWHERE '|ruby|rails|scruffy|rubyonrails|'\n   LIKE '%|' + Name + '|%'\n</code></pre>\n\n<p>So here's the C# code:</p>\n\n<pre><code>string[] tags = new string[] { \"ruby\", \"rails\", \"scruffy\", \"rubyonrails\" };\nconst string cmdText = \"select * from tags where '|' + @tags + '|' like '%|' + Name + '|%'\";\n\nusing (SqlCommand cmd = new SqlCommand(cmdText)) {\n   cmd.Parameters.AddWithValue(\"@tags\", string.Join(\"|\", tags);\n}\n</code></pre>\n\n<p>Two caveats:</p>\n\n<ul>\n<li>The performance is terrible. <code>like \"%...%\"</code> queries are not indexed.</li>\n<li>Make sure you don't have any <code>|</code>, blank, or null tags or this won't work</li>\n</ul>\n\n<p>There are other ways to accomplish this that some people may consider cleaner, so please keep reading.</p>\n    "},{"t":"SQL Insert into … values ( SELECT … FROM … )","l":"http://stackoverflow.com/questions/25969/sql-insert-into-values-select-from","q":"\n\n<p>I am trying to insert into a table using the input from another table. Although this is entirely feasible for many database engines, I always seem to struggle to remember the correct syntax for the SQL engine of the day (<a href=\"http://en.wikipedia.org/wiki/MySQL\">MySQL</a>, <a href=\"http://en.wikipedia.org/wiki/Oracle_Database\">Oracle</a>, <a href=\"http://en.wikipedia.org/wiki/Microsoft_SQL_Server\">SQL Server</a>, <a href=\"http://en.wikipedia.org/wiki/IBM_Informix\">Informix</a>, and <a href=\"http://en.wikipedia.org/wiki/IBM_DB2\">DB2</a>).</p>\n\n<p>Is there a silver-bullet syntax coming from an SQL standard (for example, <a href=\"http://en.wikipedia.org/wiki/SQL-92\">SQL-92</a>) that would allow me to insert the values without worrying about the underlying database?</p>\n    ","a":"\n<p>Try:</p>\n\n<pre><code>INSERT INTO table1 ( column1 )\nSELECT  col1\nFROM    table2  \n</code></pre>\n\n<p>This works for:</p>\n\n<pre><code>Oracle  \nMS SQL Server  \nMySQL  \nPostgres  \nSQLite v3  \nTeraData  \nDB2  \nSyBase\n</code></pre>\n    "},{"t":"How do I list the tables in a SQLite database file","l":"http://stackoverflow.com/questions/82875/how-do-i-list-the-tables-in-a-sqlite-database-file","q":"\n\n<p>What SQL can be used to list the tables, and the rows within those tables in a SQLite database file - once I have attached it with the ATTACH command on the SQLite3 command line tool?</p>\n    ","a":"\n<p>The <code>.tables</code>, and <code>.schema</code> \"helper\" functions don't look into ATTACHed databases: they just query the <code>SQLITE_MASTER</code> table for the \"main\" database. Consequently, if you used</p>\n\n<pre><code>ATTACH some_file.db AS my_db;\n</code></pre>\n\n<p>then you need to do</p>\n\n<pre><code>SELECT name FROM my_db.sqlite_master WHERE type='table';\n</code></pre>\n\n<p>Note that temporary tables don't show up with <code>.tables</code> either: you have to list <code>sqlite_temp_master</code> for that:</p>\n\n<pre><code>SELECT name FROM sqlite_temp_master WHERE type='table';\n</code></pre>\n    "},{"t":"How can I remove duplicate rows?","l":"http://stackoverflow.com/questions/18932/how-can-i-remove-duplicate-rows","q":"\n\n<p>What is the best way to remove duplicate rows from a fairly large table (i.e. 300,000+ rows)?</p>\n\n<p>The rows of course will not be perfect duplicates because of the existence of the RowID identity field.</p>\n\n<pre><code>MyTable\n-----------\nRowID int not null identity(1,1) primary key,\nCol1 varchar(20) not null,\nCol2 varchar(2048) not null,\nCol3 tinyint not null\n</code></pre>\n    ","a":"\n<p>Assuming no nulls, you GROUP BY the unique columns, and SELECT the MIN (or MAX) RowId as the row to keep. Then, just delete everything that didn't have a row id:</p>\n\n<pre><code>DELETE MyTable \nFROM MyTable\nLEFT OUTER JOIN (\n   SELECT MIN(RowId) as RowId, Col1, Col2, Col3 \n   FROM MyTable \n   GROUP BY Col1, Col2, Col3\n) as KeepRows ON\n   MyTable.RowId = KeepRows.RowId\nWHERE\n   KeepRows.RowId IS NULL\n</code></pre>\n\n<p>Use </p>\n\n<pre><code>CONVERT(uniqueidentifier, MIN(CONVERT(char(36), MyGuidColumn))) \n</code></pre>\n\n<p>instead of MIN(RowId) if you have a GUID instead of an integer</p>\n    "},{"t":"Table Naming Dilemma: Singular vs. Plural Names [closed]","l":"http://stackoverflow.com/questions/338156/table-naming-dilemma-singular-vs-plural-names","q":"\n\n<p>Convention has it that table names should be the singular of the entity that they store attributes of.  </p>\n\n<p>I dislike any T-SQL that requires square brackets around names, but I have renamed a <code>Users</code> table to the singular, forever sentencing those using the table to sometimes have to use brackets.  </p>\n\n<p>My gut feel is that it is more correct to stay with the singular, but my gut feel is also that brackets indicate undesirables like column names with spaces in them etc.</p>\n\n<p>Should I stay, or should I go?</p>\n    ","a":"\n<p>Others have given pretty good answers as far as \"standards\" go, but I just wanted to add this... Is it possible that \"User\" (or \"Users\") is not actually a full description of the data held in the table? Not that you should get too crazy with table names and specificity, but perhaps something like \"Widget_Users\" (where \"Widget\" is the name of your application or website) would be more appropriate.</p>\n    "},{"t":"Inserting multiple rows in a single SQL query? [duplicate]","l":"http://stackoverflow.com/questions/452859/inserting-multiple-rows-in-a-single-sql-query","q":"\n\n<div class=\"question-status question-originals-of-duplicate\">\n    <p>This question already has an answer here:</p>\n    <ul>\n        <li>\n            <a href=\"/questions/2624713/how-do-i-insert-multiple-rows-without-repeating-the-insert-into-dbo-blah-part\" dir=\"ltr\">How do I insert multiple rows WITHOUT repeating the “INSERT INTO dbo.Blah” part of the statement?</a>\n                <span class=\"question-originals-answer-count\">\n                    12 answers\n                </span>\n        </li>\n    </ul>\n</div>\n<p>I have multiple set of data to insert at once, say 4 rows. My table has three columns: <code>Person</code>, <code>Id</code> and <code>Office</code>.</p>\n\n<pre><code>INSERT INTO MyTable VALUES (\"John\", 123, \"Lloyds Office\");\nINSERT INTO MyTable VALUES (\"Jane\", 124, \"Lloyds Office\");\nINSERT INTO MyTable VALUES (\"Billy\", 125, \"London Office\");\nINSERT INTO MyTable VALUES (\"Miranda\", 126, \"Bristol Office\");\n</code></pre>\n\n<p>Can I insert all 4 rows in a single SQL statement?</p>\n    ","a":"\n<p>In SQL Server 2008 you can insert multiple rows using a single SQL INSERT statement.</p>\n\n<pre><code>INSERT INTO Table ( Column1, Column2 ) VALUES\n( Value1, Value2 ), ( Value1, Value2 )\n</code></pre>\n\n<p>For reference to this have a look at MOC Course 2778A - Writing SQL Queries in SQL Server 2008.</p>\n    "},{"t":"How to return the date part only from a SQL Server datetime datatype","l":"http://stackoverflow.com/questions/113045/how-to-return-the-date-part-only-from-a-sql-server-datetime-datatype","q":"\n\n<pre><code>SELECT GETDATE()\n</code></pre>\n\n<p>Returns: <code>2008-09-22 15:24:13.790</code></p>\n\n<p>I want that date part without the time part: <code>2008-09-22 00:00:00.000</code></p>\n    ","a":"\n<p>On SQL Server 2008 and higher, you should convert to date:</p>\n\n<pre><code>SELECT CONVERT(date, getdate())\n</code></pre>\n\n<p>On older versions, you can do the following:</p>\n\n<pre><code>SELECT DATEADD(dd, 0, DATEDIFF(dd, 0, @your_date))\n</code></pre>\n\n<p>for example</p>\n\n<pre><code>SELECT DATEADD(dd, 0, DATEDIFF(dd, 0, GETDATE()))\n</code></pre>\n\n<p>gives me   </p>\n\n<pre><code>2008-09-22 00:00:00.000\n</code></pre>\n\n<p>Pros: </p>\n\n<ul>\n<li>No varchar&lt;-&gt;datetime conversions required</li>\n<li>No need to think about locale</li>\n</ul>\n    "},{"t":"How to perform an IF…THEN in an SQL SELECT?","l":"http://stackoverflow.com/questions/63447/how-to-perform-an-if-then-in-an-sql-select","q":"\n\n<p>How do I perform an IF...THEN in an SQL SELECT statement?</p>\n\n<p>For example:</p>\n\n<pre><code>SELECT IF(Obsolete = 'N' OR InStock = 'Y' ? 1 : 0) AS Saleable, * FROM Product\n</code></pre>\n    ","a":"\n<p>The CASE statement is the closest to IF in SQL and is supported on all versions of SQL Server</p>\n\n<pre><code>SELECT CAST(\n             CASE \n                  WHEN Obsolete = 'N' or InStock = 'Y' \n                     THEN 1 \n                  ELSE 0 \n             END AS bit) as Salable, * \nFROM Product\n</code></pre>\n\n<p>You only need to do the <code>CAST</code> if you want the result as a boolean value, if you are happy with an <code>int</code>, this works: </p>\n\n<pre><code>SELECT CASE \n            WHEN Obsolete = 'N' or InStock = 'Y' \n               THEN 1 \n               ELSE 0 \n       END as Salable, * \nFROM Product\n</code></pre>\n\n<p><code>CASE</code> statements can be embedded in other <code>CASE</code> statements and even included in aggregates. </p>\n\n<p>SQL Server Denali (SQL Server 2012) adds the <a href=\"http://msdn.microsoft.com/en-us/library/hh213574%28v=sql.110%29.aspx\">IIF</a> statement which is also available in <a href=\"http://www.techonthenet.com/access/functions/advanced/iif.php\">access</a>: (pointed out by <a href=\"http://stackoverflow.com/questions/63447/how-do-you-perform-an-if-then-in-an-sql-select/6769805#6769805\">Martin Smith</a>)</p>\n\n<pre><code>SELECT IIF(Obsolete = 'N' or InStock = 'Y', 1, 0) as Selable, * from Product\n</code></pre>\n    "},{"t":"Get list of all tables in Oracle?","l":"http://stackoverflow.com/questions/205736/get-list-of-all-tables-in-oracle","q":"\n\n<p>How do I query an Oracle database to display the names of all tables in it?</p>\n    ","a":"\n<pre><code>SELECT owner, table_name\n  FROM dba_tables\n</code></pre>\n\n<p>assuming that you have access to the <code>DBA_TABLES</code> data dictionary view.  If you do not have those privileges but need them, you can request that the DBA explicitly grants you privileges on that table or that the DBA grants you the <code>SELECT ANY DICTIONARY</code> privilege or the <code>SELECT_CATALOG_ROLE</code> role either of which would allow you to query any data dictionary table.  Of course, you may want to exclude certain schemas like <code>SYS</code> and <code>SYSTEM</code> which have large numbers of tables that you probably don't care about because those are all delivered by Oracle.</p>\n\n<p>Alternatively, if you do not have access to <code>DBA_TABLES</code>, you can see all the tables that your account has access to through the <code>ALL_TABLES</code> view</p>\n\n<pre><code>SELECT owner, table_name\n  FROM all_tables\n</code></pre>\n\n<p>although that may be a subset of the tables available in the database (<code>ALL_TABLES</code> shows you the information for all the tables that your user has been granted access to).  </p>\n\n<p>If you are only concerned with the tables that you own, not those that you have access to, you could use <code>USER_TABLES</code></p>\n\n<pre><code>SELECT table_name\n  FROM user_tables\n</code></pre>\n\n<p>Since <code>USER_TABLES</code> only has information about the tables that you own, it does not have an <code>OWNER</code> column-- the owner, by definition, is you.</p>\n\n<p>Oracle also has a number of legacy data dictionary views-- <code>TAB</code>, <code>DICT</code>, <code>TABS</code>, and <code>CAT</code> for example-- that could be used.  In general, I would not suggest using these legacy views unless you absolutely need to backport your scripts to Oracle 6.  Oracle has not changed these views in a long time so they often have problems with newer types of objects.  For example, the <code>TAB</code> and <code>CAT</code> views both show information about tables that are in the user's recycle bin while the <code>[DBA|ALL|USER]_TABLES</code> views all filter those out.  <code>CAT</code> also shows information about materialized view logs with a <code>TABLE_TYPE</code> of \"TABLE\" which is unlikely to be what you really want.  <code>DICT</code> combines tables and synonyms and doesn't tell you who owns the object.</p>\n    "},{"t":"Left join and Left outer join in SQL Server","l":"http://stackoverflow.com/questions/406294/left-join-and-left-outer-join-in-sql-server","q":"\n\n<p>What is the difference between left join and left outer join?</p>\n    ","a":"\n<p>As per the documentation: <a href=\"http://msdn.microsoft.com/en-us/library/ms177634%28SQL.90%29.aspx\">FROM (Transact-SQL)</a>:</p>\n\n<pre><code>&lt;join_type&gt; ::= \n    [ { INNER | { { LEFT | RIGHT | FULL } [ OUTER ] } } [ &lt;join_hint&gt; ] ]\n    JOIN\n</code></pre>\n\n<p>The keyword <code>OUTER</code> is marked as optional (enclosed in square brackets), and what this means in this case is that whether you specify it or not makes no difference. Note that while the other elements of the join clause is also marked as optional, leaving <em>them</em> out will of course make a difference.</p>\n\n<p>For instance, the entire type-part of the <code>JOIN</code> clause is optional, in which case the default is <code>INNER</code> if you just specify <code>JOIN</code>. In other words, this is legal:</p>\n\n<pre><code>SELECT *\nFROM A JOIN B ON A.X = B.Y\n</code></pre>\n\n<p>Here's a list of equivalent syntaxes:</p>\n\n<pre><code>A LEFT JOIN B            A LEFT OUTER JOIN B\nA RIGHT JOIN B           A RIGHT OUTER JOIN B\nA FULL JOIN B            A FULL OUTER JOIN B\nA INNER JOIN B           A JOIN B\n</code></pre>\n\n<p>Also take a look at the answer I left on this other SO question: <a href=\"http://stackoverflow.com/a/894659/267\">SQL left join vs multiple tables on FROM line?</a>.</p>\n\n<p><img src=\"http://i.stack.imgur.com/qje6o.png\" alt=\"enter image description here\"></p>\n    "},{"t":"What are the Options for Storing Hierarchical Data in a Relational Database?","l":"http://stackoverflow.com/questions/4048151/what-are-the-options-for-storing-hierarchical-data-in-a-relational-database","q":"\n\n<p><strong>Good Overviews</strong></p>\n\n<p>Generally speaking you're making a decision between fast read times (e.g. nested set) or fast write times (adjacency list). Usually you end up with a combination of the options below that best fit your needs. The following provides some in depth reading: </p>\n\n<ul>\n<li><a href=\"http://vadimtropashko.wordpress.com/2008/08/09/one-more-nested-intervals-vs-adjacency-list-comparison/\">One more Nested Intervals vs. Adjacency List comparison</a>: <em>the best comparison</em> of Adjacency List, Materialized Path, Nested Set and Nested Interval I've found. </li>\n<li><a href=\"http://www.slideshare.net/billkarwin/models-for-hierarchical-data\">Models for hierarchical data</a>: slides with good explanations of tradeoffs and example usage</li>\n<li><a href=\"http://mikehillyer.com/articles/managing-hierarchical-data-in-mysql/\">Representing hierarchies in MySQL</a>: very good overview of Nested Set in particular</li>\n<li><a href=\"http://troels.arvin.dk/db/rdbms/links/#hierarchical\">Hierarchical data in RDBMSs</a>: most comprehensive and well organized set of links I've seen, but not much in the way on explanation </li>\n</ul>\n\n<p><strong>Options</strong></p>\n\n<p>Ones I am aware of and general features:  </p>\n\n<ol>\n<li><a href=\"http://en.wikipedia.org/wiki/Adjacency_list\">Adjacency List</a>: \n<ul>\n<li>Columns: ID, ParentID</li>\n<li>Easy to implement. </li>\n<li>Cheap node moves, inserts, and deletes. </li>\n<li>Expensive to find level (can store as a computed column), ancestry &amp; descendants (Bridge Table combined with level column can solve), path (Lineage Column can solve).      </li>\n<li>Use <a href=\"http://en.wikipedia.org/wiki/Common_table_expressions\">Common Table Expressions</a> in those databases that support them to traverse. </li>\n</ul></li>\n<li><a href=\"http://en.wikipedia.org/wiki/Nested_set_model\">Nested Set</a> (a.k.a Modified Preorder Tree Traversal)\n<ul>\n<li>Popularized by Joe Celko in numerous articles and his book <a href=\"http://rads.stackoverflow.com/amzn/click/0123877334\">Trees and Hierarchies in SQL for Smarties</a> </li>\n<li>Columns: Left, Right</li>\n<li>Cheap level, ancestry, descendants</li>\n<li>Compared to Adjacency List, moves, inserts, deletes more expensive. </li>\n<li>Requires a specific sort order (e.g. created). So sorting all descendants in a different order requires additional work. </li>\n</ul></li>\n<li><a href=\"http://communities.bmc.com/communities/docs/DOC-9902\">Nested Intervals</a>\n<ul>\n<li>Combination of Nested Sets and Materialized Path where left/right columns are floating point decimals instead of integers and encode the path information. In the later development of this idea nested intervals gave rise to <a href=\"http://vadimtropashko.files.wordpress.com/2011/07/ch5.pdf\">matrix encoding</a>.</li>\n</ul></li>\n<li><a href=\"http://intelligent-enterprise.informationweek.com/showArticle.jhtml;jsessionid=MRBJR2LLRV1ANQE1GHPSKH4ATMY32JVN?articleID=219400252\">Bridge Table</a> (a.k.a. <a href=\"http://dirtsimple.org/2010/11/simplest-way-to-do-tree-based-queries.html\">Closure Table</a>: some good ideas about how to use triggers for maintaining this approach)\n<ul>\n<li>Columns: ancestor, descendant</li>\n<li>Stands apart from table it describes.</li>\n<li>Can include some nodes in more than one hierarchy.</li>\n<li>Cheap ancestry and descendants (albeit not in what order)</li>\n<li>For complete knowledge of a hierarchy needs to be combined with another option.</li>\n</ul></li>\n<li><a href=\"http://evolt.org/node/4047/\">Flat Table</a>\n<ul>\n<li>A modification of the Adjacency List that adds a Level and Rank (e.g. ordering) column to each record. </li>\n<li>Expensive move and delete</li>\n<li>Cheap ancestry and descendants </li>\n<li>Good Use: threaded discussion - forums / blog comments</li>\n</ul></li>\n<li><a href=\"http://www.ferdychristant.com/blog//articles/DOMM-7QJPM7\">Lineage Column</a> (a.k.a. <a href=\"http://communities.bmc.com/communities/docs/DOC-9902\">Materialized Path</a>, Path Enumeration)\n<ul>\n<li>Column: lineage (e.g. /parent/child/grandchild/etc...)</li>\n<li>Limit to how deep the hierarchy can be. </li>\n<li>Descendants cheap (e.g. <code>LEFT(lineage, #) = '/enumerated/path'</code>)</li>\n<li>Ancestry tricky (database specific queries) </li>\n</ul></li>\n<li><a href=\"http://stackoverflow.com/a/6802687/684229\">Multiple lineage columns</a>\n<ul>\n<li>Columns: one for each lineage level, refers to all the parents up to the root, levels down from the items level are set to NULL</li>\n<li>Limit to how deep the hierarchy can be</li>\n<li>Cheap ancestors, descendants, level</li>\n<li>Cheap insert, delete, move of the leaves</li>\n<li>Expensive insert, delete, move of the internal nodes</li>\n</ul></li>\n</ol>\n\n<p><strong>Database Specific Notes</strong> </p>\n\n<p><em>MySQL</em></p>\n\n<ul>\n<li><a href=\"http://explainextended.com/2009/09/29/adjacency-list-vs-nested-sets-mysql/\">Use session variables for Adjacency List</a> </li>\n</ul>\n\n<p><em>Oracle</em></p>\n\n<ul>\n<li>Use <a href=\"http://www.ypl.com/oracle/sql/hierarchical_queries/html_deep/index.html\">CONNECT BY</a> to traverse Adjacency Lists</li>\n</ul>\n\n<p><em>PostgreSQL</em></p>\n\n<ul>\n<li><a href=\"http://www.postgresql.org/docs/current/static/ltree.html\">ltree datatype</a> for Materialized Path </li>\n</ul>\n\n<p><em>SQL Server</em></p>\n\n<ul>\n<li><a href=\"http://msdn.microsoft.com/en-us/magazine/cc794278.aspx\">General summary</a></li>\n<li>2008 offers <a href=\"http://msdn.microsoft.com/en-us/library/bb677290.aspx\">HierarchyId</a> data type appears to help with Lineage Column approach and expand the depth that can be represented. </li>\n</ul>\n    ","a":"\n<p>This is kind of a question that is still interesting even after all big 3 vendors implemented Recursive <code>WITH</code> clause. I'd suggest that different readers would be pleased with different answers.</p>\n\n<ol>\n<li><a href=\"http://troels.arvin.dk/db/rdbms/links/#hierarchical\">Comprehensive list of references</a> by Troels Arvin.</li>\n<li>For the lack of competition, introductory textbook by Joe Celko \"Trees and Hierarchies in SQL for Smarties\" can indeed be considered a classics.</li>\n<li>Review of various tree encodings with emphasis to <a href=\"http://vadimtropashko.files.wordpress.com/2011/07/ch5.pdf\">nested intervals</a>. </li>\n</ol>\n    "},{"t":"What is the difference between UNION and UNION ALL?","l":"http://stackoverflow.com/questions/49925/what-is-the-difference-between-union-and-union-all","q":"\n\n<p>What is the difference between UNION and UNION ALL.</p>\n    ","a":"\n<p>UNION removes duplicate records (where all columns in the results are the same), UNION ALL does not.</p>\n\n<p>There is a performance hit when using UNION vs UNION ALL, since the database server must do additional work to remove the duplicate rows, but usually you do not want the duplicates (especially when developing reports).</p>\n\n<h1>UNION Example:</h1>\n\n<pre><code>SELECT 'foo' AS bar UNION SELECT 'foo' AS bar\n</code></pre>\n\n<p><strong>Result:</strong> </p>\n\n<pre><code>+-----+\n| bar |\n+-----+\n| foo |\n+-----+\n1 row in set (0.00 sec)\n</code></pre>\n\n<h1>UNION ALL example:</h1>\n\n<pre><code>SELECT 'foo' AS bar UNION ALL SELECT 'foo' AS bar\n</code></pre>\n\n<p><strong>Result:</strong></p>\n\n<pre><code>+-----+\n| bar |\n+-----+\n| foo |\n| foo |\n+-----+\n2 rows in set (0.00 sec)\n</code></pre>\n    "},{"t":"How do I limit the number of rows returned by an Oracle query after ordering?","l":"http://stackoverflow.com/questions/470542/how-do-i-limit-the-number-of-rows-returned-by-an-oracle-query-after-ordering","q":"\n\n<p>Is there a way to make an Oracle query behave like it contains a MySQL <code>limit</code> clause?</p>\n\n<p>In MySQL, I can do this:</p>\n\n<pre><code>select * \nfrom sometable\norder by name\nlimit 20,10\n</code></pre>\n\n<p>to get the 21st to the 30th rows (skip the first 20, give the next 10). The rows are selected after the <code>order by</code>, so it really starts on the 20th name alphabetically.</p>\n\n<p>In Oracle, the only thing people mention is the <code>rownum</code> pseudo-column, but it is evaluated <em>before</em> <code>order by</code>, which means this:</p>\n\n<pre><code>select * \nfrom sometable\nwhere rownum &lt;= 10\norder by name\n</code></pre>\n\n<p>will return a random set of ten rows ordered by name, which is not usually what I want. It also doesn't allow for specifying an offset.</p>\n    ","a":"\n<p>You can use a subquery for this like</p>\n\n<pre><code>select *\nfrom  \n( select * \n  from emp \n  order by sal desc ) \nwhere ROWNUM &lt;= 5;\n</code></pre>\n\n<p>Have also a look at the topic <a href=\"http://www.oracle.com/technetwork/issue-archive/2006/06-sep/o56asktom-086197.html\">On ROWNUM and limiting results</a> at Oracle/AskTom for more information.</p>\n\n<p><strong>Update</strong>:\nTo limit the result with both lower and upper bounds things get a bit more bloated with</p>\n\n<pre><code>select * from \n( select a.*, ROWNUM rnum from \n  ( &lt;your_query_goes_here, with order by&gt; ) a \n  where ROWNUM &lt;= :MAX_ROW_TO_FETCH )\nwhere rnum  &gt;= :MIN_ROW_TO_FETCH;\n</code></pre>\n\n<p>(Copied from specified AskTom-article)</p>\n\n<p><strong>Update 2</strong>:\nStarting with Oracle 12c (12.1) there is a syntax available to limit rows or start at offsets.</p>\n\n<pre><code>SELECT * \nFROM   sometable\nORDER BY name\nOFFSET 20 ROWS FETCH NEXT 10 ROWS ONLY;\n</code></pre>\n\n<p>See <a href=\"https://stackoverflow.com/a/26051830/57601\">this answer</a> for more examples. Thanks to Krumia for the hint.</p>\n    "},{"t":"Can I concatenate multiple MySQL rows into one field?","l":"http://stackoverflow.com/questions/276927/can-i-concatenate-multiple-mysql-rows-into-one-field","q":"\n\n<p>Using <code>MySQL</code>, I can do something like:</p>\n\n<pre><code>SELECT hobbies FROM peoples_hobbies WHERE person_id = 5;\n</code></pre>\n\n<p>and get:</p>\n\n<pre><code>shopping\nfishing\ncoding\n</code></pre>\n\n<p>but instead I just want 1 row, 1 col:</p>\n\n<pre><code>shopping, fishing, coding\n</code></pre>\n\n<p>The reason is that I'm selecting multiple values from multiple tables, and after all the joins I've got a lot more rows than I'd like.</p>\n\n<p>I've looked for a function on <a href=\"http://dev.mysql.com/doc/refman/5.0/en/string-functions.html#function_concat-ws\">MySQL Doc</a> and it doesn't look like the <code>CONCAT</code> or <code>CONCAT_WS</code> functions accept result sets, so does anyone here know how to do this?</p>\n    ","a":"\n<p>You can use <a href=\"http://dev.mysql.com/doc/refman/5.0/en/group-by-functions.html#function_group-concat\">GROUP_CONCAT</a>.</p>\n\n<p>As in:</p>\n\n<pre><code>SELECT person_id, GROUP_CONCAT(hobbies SEPARATOR ', ')\nFROM peoples_hobbies GROUP BY person_id\n</code></pre>\n\n<p><strong><a href=\"http://stackoverflow.com/users/440546/death\">Death</a></strong>:\nAs Dag stated in his comment, there is a 1024 byte limit on result. To solve this, run this query before your query:</p>\n\n<pre><code>SET group_concat_max_len = 2048\n</code></pre>\n\n<p>Of course, you can change <code>2048</code>  according to your needs.</p>\n    "},{"t":"Best way to get identity of inserted row?","l":"http://stackoverflow.com/questions/42648/best-way-to-get-identity-of-inserted-row","q":"\n\n<p>What is the best way to get identity of inserted row?</p>\n\n<p>I know about <code>@@IDENTITY</code> and <code>IDENT_CURRENT</code> and <code>SCOPE_IDENTITY</code> but don't understand the pros and cons attached to each.</p>\n\n<p>Can someone please explain the differences and when I should be using each?</p>\n    ","a":"\n<ul>\n<li><p><a href=\"http://msdn.microsoft.com/en-us/library/ms187342.aspx\"><code>@@IDENTITY</code></a> returns the last identity value generated for any table in the current session, across all scopes.  <strong>You need to be careful here</strong>, since it's across scopes.  You could get a value from a trigger, instead of your current statement.</p></li>\n<li><p><a href=\"http://msdn.microsoft.com/en-us/library/ms190315.aspx\"><code>SCOPE_IDENTITY</code></a> returns the last identity value generated for any table in the current session and the current scope.  <strong>Generally what you want to use</strong>.</p></li>\n<li><p><a href=\"http://msdn.microsoft.com/en-us/library/ms175098.aspx\"><code>IDENT_CURRENT</code></a> returns the last identity value generated for a specific table in any session and any scope.  This lets you specify which table you want the value from, in case the two above aren't quite what you need (<strong>very rare</strong>).  Also, as @<a href=\"http://stackoverflow.com/questions/42648/best-way-to-get-identity-of-inserted-row#42665\">Guy Starbuck</a> mentioned, \"You could use this if you want to get the current IDENTITY value for a table that you have not inserted a record into.\"</p></li>\n<li><p>The <a href=\"http://msdn.microsoft.com/en-us/library/ms177564.aspx\"><code>OUTPUT</code> clause</a> of the <code>INSERT</code> statement will let you access every row that was inserted via that statement.  Since it's scoped to the specific statement, it's <strong>more straightforward</strong> than the other functions above.  However, it's a little <strong>more verbose</strong> (you'll need to insert into a table variable/temp table and then query that) and it gives results even in an error scenario where the statement is rolled back.  That said, if your query uses a parallel execution plan, this is the <strong>only guaranteed method</strong> for getting the identity (short of turning off parallelism). However, it is executed <em>before</em> triggers and cannot be used to return trigger-generated values.</p></li>\n</ul>\n    "},{"t":"When should I use Cross Apply over Inner Join?","l":"http://stackoverflow.com/questions/1139160/when-should-i-use-cross-apply-over-inner-join","q":"\n\n<p>What is the main purpose of using <a href=\"http://technet.microsoft.com/en-us/library/ms175156.aspx\">CROSS APPLY</a>?</p>\n\n<p>I have read (vaguely, through posts on the Internet) that <code>cross apply</code> can be more efficient when selecting over large data sets if you are partitioning. (Paging comes to mind)</p>\n\n<p>I also know that <code>CROSS APPLY</code> <a href=\"http://www.eggheadcafe.com/conversation.aspx?messageid=34684493&amp;threadid=34673936\">doesn't require a UDF as the right-table.</a></p>\n\n<p>In most <code>INNER JOIN</code> queries (one-to-many relationships), I could rewrite them to use <code>CROSS APPLY</code>, but they always give me equivalent execution plans. </p>\n\n<p>Can anyone give me a good example of when <code>CROSS APPLY</code> makes a difference in those cases where <code>INNER JOIN</code> will work as well?</p>\n\n<hr>\n\n<p><strong>Edit:</strong></p>\n\n<p>Here's a trivial example, where the execution plans are exactly the same.  (Show me one where they differ and where <code>cross apply</code> is faster/more efficient)</p>\n\n<pre><code>create table Company (\n    companyId int identity(1,1)\n,   companyName varchar(100)\n,   zipcode varchar(10) \n,   constraint PK_Company primary key (companyId)\n)\nGO\n\ncreate table Person (\n    personId int identity(1,1)\n,   personName varchar(100)\n,   companyId int\n,   constraint FK_Person_CompanyId foreign key (companyId) references dbo.Company(companyId)\n,   constraint PK_Person primary key (personId)\n)\nGO\n\ninsert Company\nselect 'ABC Company', '19808' union\nselect 'XYZ Company', '08534' union\nselect '123 Company', '10016'\n\n\ninsert Person\nselect 'Alan', 1 union\nselect 'Bobby', 1 union\nselect 'Chris', 1 union\nselect 'Xavier', 2 union\nselect 'Yoshi', 2 union\nselect 'Zambrano', 2 union\nselect 'Player 1', 3 union\nselect 'Player 2', 3 union\nselect 'Player 3', 3 \n\n\n/* using CROSS APPLY */\nselect *\nfrom Person p\ncross apply (\n    select *\n    from Company c\n    where p.companyid = c.companyId\n) Czip\n\n/* the equivalent query using INNER JOIN */\nselect *\nfrom Person p\ninner join Company c on p.companyid = c.companyId\n</code></pre>\n    ","a":"\n<blockquote>\n  <p>Can anyone give me a good example of when CROSS APPLY makes a difference in those cases where INNER JOIN will work as well?</p>\n</blockquote>\n\n<p>See the article in my blog for detailed performance comparison:</p>\n\n<ul>\n<li><a href=\"http://explainextended.com/2009/07/16/inner-join-vs-cross-apply/\"><strong><code>INNER JOIN</code> vs. <code>CROSS APPLY</code></strong></a></li>\n</ul>\n\n<p><code>CROSS APPLY</code> works better on things that have no simple <code>JOIN</code> condition.</p>\n\n<p>This one selects <code>3</code> last records from <code>t2</code> for each record from <code>t1</code>:</p>\n\n<pre><code>SELECT  t1.*, t2o.*\nFROM    t1\nCROSS APPLY\n        (\n        SELECT  TOP 3 *\n        FROM    t2\n        WHERE   t2.t1_id = t1.id\n        ORDER BY\n                t2.rank DESC\n        ) t2o\n</code></pre>\n\n<p>It cannot be easily formulated with an <code>INNER JOIN</code> condition.</p>\n\n<p>You could probably do something like that using <code>CTE</code>'s and window function:</p>\n\n<pre><code>WITH    t2o AS\n        (\n        SELECT  t2.*, ROW_NUMBER() OVER (PARTITION BY t1_id ORDER BY rank) AS rn\n        FROM    t2\n        )\nSELECT  t1.*, t2o.*\nFROM    t1\nINNER JOIN\n        t2o\nON      t2o.t1_id = t1.id\n        AND t2o.rn &lt;= 3\n</code></pre>\n\n<p>, but this is less readable and probably less efficient.</p>\n\n<p><strong>Update:</strong></p>\n\n<p>Just checked.</p>\n\n<p><code>master</code> is a table of about <code>20,000,000</code> records with a <code>PRIMARY KEY</code> on <code>id</code>.</p>\n\n<p>This query:</p>\n\n<pre><code>WITH    q AS\n        (\n        SELECT  *, ROW_NUMBER() OVER (ORDER BY id) AS rn\n        FROM    master\n        ),\n        t AS \n        (\n        SELECT  1 AS id\n        UNION ALL\n        SELECT  2\n        )\nSELECT  *\nFROM    t\nJOIN    q\nON      q.rn &lt;= t.id\n</code></pre>\n\n<p>runs for almost <code>30</code> seconds, while this one:</p>\n\n<pre><code>WITH    t AS \n        (\n        SELECT  1 AS id\n        UNION ALL\n        SELECT  2\n        )\nSELECT  *\nFROM    t\nCROSS APPLY\n        (\n        SELECT  TOP (t.id) m.*\n        FROM    master m\n        ORDER BY\n                id\n        ) q\n</code></pre>\n\n<p>is instant.</p>\n    "},{"t":"How can I do an UPDATE statement with JOIN in SQL?","l":"http://stackoverflow.com/questions/1293330/how-can-i-do-an-update-statement-with-join-in-sql","q":"\n\n<p>I need to update this table in SQL Server 2005 with data from its 'parent' table, see below:</p>\n\n<p><strong>sale</strong></p>\n\n<pre><code>id (int)\nudid (int)\nassid (int)\n</code></pre>\n\n<p><strong>ud</strong></p>\n\n<pre><code>id  (int)\nassid  (int)\n</code></pre>\n\n<p><code>sale.assid</code> contains the correct value to update <code>ud.assid</code>. What query will do this? I'm thinking a join but I'm not sure if it's possible.</p>\n    ","a":"\n<p>It very much depends on which database you're using. Here are the ways to do it in ANSI (aka should work on any database), MySQL, SQL Server, and Oracle. Be advised that the ANSI method will be much slower than the other two methods, but if you're not using MySQL, SQL Server, or Oracle, it's the only way to go.</p>\n\n<p>ANSI:</p>\n\n<pre><code>update ud \n  set assid = (\n               select sale.assid \n                 from sale \n                where sale.udid = ud.udid\n              )\n where exists (\n               select * \n                 from sale \n                where sale.udid = ud.udid\n              );\n</code></pre>\n\n<p>MySQL:</p>\n\n<pre><code>update ud u\ninner join sale s on\n    u.id = s.udid\nset u.assid = s.assid\n</code></pre>\n\n<p>SQL Server:</p>\n\n<pre><code>update u\nset u.assid = s.assid\nfrom ud u\n    inner join sale s on\n        u.id = s.udid\n</code></pre>\n\n<p>Oracle:</p>\n\n<pre><code>update\n    (select\n        u.assid as new_assid,\n        s.assid as old_assid\n    from ud u\n        inner join sale s on\n            u.id = s.udid) up\nset up.new_assid = up.old_assid\n</code></pre>\n    "},{"t":"Should I use != or <> for not equal in TSQL?","l":"http://stackoverflow.com/questions/723195/should-i-use-or-for-not-equal-in-tsql","q":"\n\n<p>I have seen SQL that uses both <code>!=</code> and <code>&lt;&gt;</code> for <em>not equal</em>. What is the preferred syntax and why?</p>\n\n<p>I like <code>!=</code> because <code>&lt;&gt;</code> reminds me of Visual Basic.</p>\n    ","a":"\n<p>Technically they function the same if you’re using MS SQL aka T-SQL.  If you're using it in stored procedures there is no performance reason to use one over the other.  It then comes down to personal preference. I prefer to use &lt;&gt; as it is ANSI compliant.</p>\n\n<p>You can find links to the various ANSI standards at...</p>\n\n<p><a href=\"http://en.wikipedia.org/wiki/SQL\">http://en.wikipedia.org/wiki/SQL</a></p>\n    "},{"t":"What's the difference between INNER JOIN, LEFT JOIN, RIGHT JOIN and FULL JOIN? [duplicate]","l":"http://stackoverflow.com/questions/5706437/whats-the-difference-between-inner-join-left-join-right-join-and-full-join","q":"\n\n<div class=\"question-status question-originals-of-duplicate\">\n    <p>This question already has an answer here:</p>\n    <ul>\n        <li>\n            <a href=\"/questions/38549/difference-between-inner-and-outer-joins\" dir=\"ltr\">Difference between INNER and OUTER joins</a>\n                <span class=\"question-originals-answer-count\">\n                    18 answers\n                </span>\n        </li>\n    </ul>\n</div>\n<p>What's the difference between <code>INNER JOIN</code>, <code>LEFT JOIN</code>, <code>RIGHT JOIN</code> and <code>FULL JOIN</code> \nin MySQL?</p>\n    ","a":"\n<p>Reading this original article on <strong>The Code Project</strong> will help you a lot: <a href=\"http://www.codeproject.com/KB/database/Visual_SQL_Joins.aspx\">Visual Representation of SQL Joins</a>.</p>\n\n<p><img src=\"http://i.stack.imgur.com/VQ5XP.png\" alt=\"alt text\"></p>\n\n<p>Also check this post: <a href=\"http://blog.sqlauthority.com/2008/04/22/sql-server-better-performance-left-join-or-not-in/\">SQL SERVER – Better Performance – LEFT JOIN or NOT IN?</a>.</p>\n\n<p>Find original one at: <a href=\"http://stackoverflow.com/questions/3308122/how-do-i-decide-when-to-use-right-joins-left-joins-or-inner-joins-or-how-to-dete/3308153#3308153\">Difference between JOIN and OUTER JOIN in MySQL</a>.</p>\n    "},{"t":"mysql_fetch_array() expects parameter 1 to be resource (or mysqli_result), boolean given","l":"http://stackoverflow.com/questions/2973202/mysql-fetch-array-expects-parameter-1-to-be-resource-or-mysqli-result-boole","q":"\n\n<p>I am trying to select data from a MySQL table, but I get one of the following error messages:</p>\n\n<blockquote>\n  <p>mysql_fetch_array() expects parameter 1 to be resource, boolean given</p>\n</blockquote>\n\n<p>or</p>\n\n<blockquote>\n  <p>mysqli_fetch_array() expects parameter 1 to be mysqli_result, boolean given</p>\n</blockquote>\n\n<p>This is my code:</p>\n\n<pre><code>$username = $_POST['username'];\n$password = $_POST['password'];\n$result = mysql_query('SELECT * FROM Users WHERE UserName LIKE $username');\n\nwhile($row = mysql_fetch_array($result))\n{\n    echo $row['FirstName'];\n}\n</code></pre>\n    ","a":"\n<blockquote>\n  <p><strong>NOTE</strong> This answer is old and uses the <a href=\"http://stackoverflow.com/questions/12859942/why-shouldnt-i-use-mysql-functions-in-php\">deprecated mysql_ functions</a>. The answer is still largely valid for most uses of the <code>mysqli_</code> function set (which is designed to be very similar), although the syntax may vary somewhat from this answer. Please consult the <a href=\"http://php.net/manual/en/book.mysqli.php\">PHP mysqli manual</a> to learn more about the <code>mysqli_</code> functions.</p>\n</blockquote>\n\n<p>Check <code>$result</code> before passing it to <code>mysql_fetch_array</code>. You'll find that it's <code>false</code> because the query failed. See the <a href=\"http://php.net/manual/en/function.mysql-query.php\"><code>mysql_query</code></a> documentation for possible return values and suggestions for how to deal with them.</p>\n\n<pre><code>$username = mysql_real_escape_string($_POST['username']);\n$password = $_POST['password'];\n$result = mysql_query(\"SELECT * FROM Users WHERE UserName LIKE '$username'\");\n\nif($result === FALSE) { \n    die(mysql_error()); // TODO: better error handling\n}\n\nwhile($row = mysql_fetch_array($result))\n{\n    echo $row['FirstName'];\n}\n</code></pre>\n\n<p>This example is only to illustrate what should be done (error handling), not how to do it. Production code shouldn't use <a href=\"http://www.phpfreaks.com/blog/or-die-must-die\"><code>or die</code></a> when outputting HTML, else it will (at the very least) generate invalid HTML. Also, database error messages shouldn't be displayed to non-admin users, as it <a href=\"http://msdn.microsoft.com/en-us/library/ms995351.aspx#securityerrormessages_topic2\">discloses too much information</a>.</p>\n    "},{"t":"SQL update from one Table to another based on a ID match","l":"http://stackoverflow.com/questions/224732/sql-update-from-one-table-to-another-based-on-a-id-match","q":"\n\n<p>I have a database with account numbers and card numbers. I match these to a file to update any card numbers to the account number, so that I am only working with account numbers. </p>\n\n<p>I created a view linking the table to the account/card database to return the Table ID and the related account number, and now I need to update those records where the ID matches with the Account Number.</p>\n\n<p>This is the <code>Sales_Import</code> table, where the account number field needs to be updated:</p>\n\n<pre><code>LeadID  AccountNumber\n147         5807811235\n150         5807811326\n185         7006100100007267039\n</code></pre>\n\n<p>And this is the <code>RetrieveAccountNumber</code> table, where I need to update from:</p>\n\n<pre><code>LeadID  AccountNumber\n147         7006100100007266957\n150         7006100100007267039\n</code></pre>\n\n<p>I tried the below, but no luck so far:</p>\n\n<pre><code>UPDATE [Sales_Lead].[dbo].[Sales_Import] \nSET    [AccountNumber] = (SELECT RetrieveAccountNumber.AccountNumber \n                          FROM   RetrieveAccountNumber \n                          WHERE  [Sales_Lead].[dbo].[Sales_Import]. LeadID = \n                                                RetrieveAccountNumber.LeadID) \n</code></pre>\n\n<p>It updates the card numbers to account numbers, but the account numbers gets replaced by NULL</p>\n    ","a":"\n<p>I believe an <code>UPDATE FROM</code> with a <code>JOIN</code> will help:</p>\n\n<pre><code>UPDATE\n    Sales_Import\nSET\n    Sales_Import.AccountNumber = RAN.AccountNumber\nFROM\n    Sales_Import SI\nINNER JOIN\n    RetrieveAccountNumber RAN\nON \n    SI.LeadID = RAN.LeadID\n</code></pre>\n    "},{"t":"INNER JOIN ON vs WHERE clause","l":"http://stackoverflow.com/questions/1018822/inner-join-on-vs-where-clause","q":"\n\n<p>For simplicity, assume all relevant fields are NOT NULL.</p>\n\n<p>You can do:</p>\n\n<pre><code>SELECT\n    table1.this, table2.that, table2.somethingelse\nFROM\n    table1, table2\nWHERE\n    table1.foreignkey = table2.primarykey\n    AND (some other conditions)\n</code></pre>\n\n<p>Or else:</p>\n\n<pre><code>SELECT\n    table1.this, table2.that, table2.somethingelse\nFROM\n    table1 INNER JOIN table2\n    ON table1.foreignkey = table2.primarykey\nWHERE\n    (some other conditions)\n</code></pre>\n\n<p>Are those two worked on the same way by MySQL?</p>\n    ","a":"\n<p><code>INNER JOIN</code> is <code>ANSI</code> syntax which you should use.</p>\n\n<p>It is generally considered more readable, especially when you join lots of tables.</p>\n\n<p>It can also be easily replaced with an <code>OUTER JOIN</code> whenever a need arises.</p>\n\n<p>The <code>WHERE</code> syntax is more relational model oriented.</p>\n\n<p>A result of two tables <code>JOIN</code>'ed is a cartesian product of the tables to which a filter is applied which selects only those rows with joining columns matching.</p>\n\n<p>It's easier to see this with the <code>WHERE</code> syntax.</p>\n\n<p>As for your example, in <code>MySQL</code> (and in <code>SQL</code> generally) these two queries are synonyms.</p>\n\n<p>Also note that <code>MySQL</code> also has a <code>STRAIGHT_JOIN</code> clause.</p>\n\n<p>Using this clause, you can control the <code>JOIN</code> order: which table is scanned in the outer loop and which one is in the inner loop.</p>\n\n<p>You cannot control this in <code>MySQL</code> using <code>WHERE</code> syntax.</p>\n    "},{"t":"How to 'insert if not exists' in MySQL?","l":"http://stackoverflow.com/questions/1361340/how-to-insert-if-not-exists-in-mysql","q":"\n\n<p>I started by googling, and found this <a href=\"http://www.xaprb.com/blog/2005/09/25/insert-if-not-exists-queries-in-mysql/\">article</a> which talks about mutex tables.</p>\n\n<p>I have a table with ~14 million records. If I want to add more data in the same format, is there a way to ensure the record I want to insert does not already exist without using a pair of queries (ie, one query to check and one to insert is the result set is empty)?</p>\n\n<p>Does a <code>unique</code> constraint on a field guarantee the <code>insert</code> will fail if it's already there?</p>\n\n<p>It seems that with <em>merely</em> a constraint, when I issue the insert via php, the script croaks.</p>\n    ","a":"\n<p>use <code>INSERT IGNORE INTO table</code></p>\n\n<p>see <a href=\"http://bogdan.org.ua/2007/10/18/mysql-insert-if-not-exists-syntax.html\" rel=\"nofollow\">http://bogdan.org.ua/2007/10/18/mysql-insert-if-not-exists-syntax.html</a></p>\n\n<p>there's also <code>INSERT … ON DUPLICATE KEY UPDATE</code> syntax, you can find explanations on <a href=\"http://dev.mysql.com/doc/refman/5.1/en/insert-on-duplicate.html\" rel=\"nofollow\">dev.mysql.com</a></p>\n\n<hr>\n\n<p><strong>Post from bogdan.org.ua according to <a href=\"http://webcache.googleusercontent.com/search?q=cache:bogdan.org.ua/2007/10/18/mysql-insert-if-not-exists-syntax.html\" rel=\"nofollow\">Google's webcache</a>:</strong></p>\n\n<blockquote>\n  <p>18th October 2007</p>\n  \n  <p>To start: as of the latest MySQL, syntax presented in the title is not\n  possible. But there are several very easy ways to accomplish what is\n  expected using existing functionality.</p>\n  \n  <p>There are 3 possible solutions: using INSERT IGNORE, REPLACE, or\n  INSERT … ON DUPLICATE KEY UPDATE.</p>\n  \n  <p>Imagine we have a table:</p>\n\n<pre><code>CREATE TABLE `transcripts` (\n`ensembl_transcript_id` varchar(20) NOT NULL,\n`transcript_chrom_start` int(10) unsigned NOT NULL,\n`transcript_chrom_end` int(10) unsigned NOT NULL,\nPRIMARY KEY (`ensembl_transcript_id`)\n) ENGINE=InnoDB DEFAULT CHARSET=latin1;\n</code></pre>\n  \n  <p>Now imagine that we have an automatic pipeline importing transcripts\n  meta-data from Ensembl, and that due to various reasons the pipeline\n  might be broken at any step of execution. Thus, we need to ensure two\n  things: 1) repeated executions of the pipeline will not destroy our\n  database, and 2) repeated executions will not die due to ‘duplicate\n  primary key’ errors.</p>\n  \n  <p>Method 1: using REPLACE</p>\n  \n  <p>It’s very simple:</p>\n\n<pre><code>REPLACE INTO `transcripts`\nSET `ensembl_transcript_id` = ‘ENSORGT00000000001′,\n`transcript_chrom_start` = 12345,\n`transcript_chrom_end` = 12678;\n</code></pre>\n  \n  <p>If the record exists, it will be overwritten; if it does not yet\n  exist, it will be created. However, using this method isn’t efficient\n  for our case: we do not need to overwrite existing records, it’s fine\n  just to skip them.</p>\n  \n  <p>Method 2: using INSERT IGNORE Also very simple:</p>\n\n<pre><code>INSERT IGNORE INTO `transcripts`\nSET `ensembl_transcript_id` = ‘ENSORGT00000000001′,\n`transcript_chrom_start` = 12345,\n`transcript_chrom_end` = 12678;\n</code></pre>\n  \n  <p>Here, if the ‘ensembl_transcript_id’ is already present in the\n  database, it will be silently skipped (ignored). (To be more precise,\n  here’s a quote from MySQL reference manual: “If you use the IGNORE\n  keyword, errors that occur while executing the INSERT statement are\n  treated as warnings instead. For example, without IGNORE, a row that\n  duplicates an existing UNIQUE index or PRIMARY KEY value in the table\n  causes a duplicate-key error and the statement is aborted.”.) If the\n  record doesn’t yet exist, it will be created.</p>\n  \n  <p>This second method has several potential weaknesses, including\n  non-abortion of the query in case any other problem occurs (see the\n  manual). Thus it should be used if previously tested without the\n  IGNORE keyword.</p>\n  \n  <p>There is one more option: to use INSERT … ON DUPLICATE KEY UPDATE\n  syntax, and in the UPDATE part just do nothing do some meaningless\n  (empty) operation, like calculating 0+0 (Geoffray suggests doing the\n  id=id assignment for the MySQL optimization engine to ignore this\n  operation). Advantage of this method is that it only ignores duplicate\n  key events, and still aborts on other errors.</p>\n  \n  <p>As a final notice: this post was inspired by Xaprb. I’d also advise to\n  consult his other post on writing flexible SQL queries.</p>\n</blockquote>\n    "},{"t":"How to reset AUTO_INCREMENT in MySQL?","l":"http://stackoverflow.com/questions/8923114/how-to-reset-auto-increment-in-mysql","q":"\n\n<p>How can I reset the auto-increment of a field? I want it to start counting from 1 again.</p>\n    ","a":"\n<p>You can reset the counter with:</p>\n\n<pre><code>ALTER TABLE tablename AUTO_INCREMENT = 1\n</code></pre>\n\n<p>For InnoDB you cannot set the <code>auto_increment</code> value lower or equal to the highest current index. (quote from <a href=\"http://viralpatel.net/blogs/reseting-mysql-autoincrement-column/\">ViralPatel</a>):</p>\n\n<blockquote>\n  <p>Note that you cannot reset the counter to a value less than or equal\n  to any that have already been used. For MyISAM, if the value is less\n  than or equal to the maximum value currently in the AUTO_INCREMENT\n  column, the value is reset to the current maximum plus one. For\n  InnoDB, if the value is less than the current maximum value in the\n  column, no error occurs and the current sequence value is not changed.</p>\n</blockquote>\n\n<p>See <em><a href=\"http://stackoverflow.com/q/2410689/367456\">How to Reset an MySQL AutoIncrement using a MAX value from another table?</a></em> on how to dynamically get an acceptable value.</p>\n    "},{"t":"Finding duplicate values in a SQL table","l":"http://stackoverflow.com/questions/2594829/finding-duplicate-values-in-a-sql-table","q":"\n\n<p>It's easy to find duplicates with one field:</p>\n\n<pre><code>SELECT name, COUNT(email) \nFROM users\nGROUP BY email\nHAVING ( COUNT(email) &gt; 1 )\n</code></pre>\n\n<p>So if we have a table</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>ID   NAME   EMAIL\n1    John   asd@asd.com\n2    Sam    asd@asd.com\n3    Tom    asd@asd.com\n4    Bob    bob@asd.com\n5    Tom    asd@asd.com\n</code></pre>\n\n<p>This query will give us John, Sam, Tom, Tom because they all have the same <code>email</code>.</p>\n\n<p>However, what I want is to get duplicates with the same <code>email</code> <strong>and</strong> <code>name</code>.</p>\n\n<p>That is, I want to get \"Tom\", \"Tom\".</p>\n\n<p>The reason I need this: I made a mistake, and allowed to insert duplicate <code>name</code> and <code>email</code> values. Now I need to remove/change the duplicates, so I need to <em>find</em> them first.</p>\n    ","a":"\n<pre><code>SELECT\n    name, email, COUNT(*)\nFROM\n    users\nGROUP BY\n    name, email\nHAVING \n    COUNT(*) &gt; 1\n</code></pre>\n\n<p>Simply group on the both columns</p>\n\n<p>Note: the ANSI standard is to have all non aggregated columns in the GROUP BY.</p>\n\n<p>MySQL allows you to avoid this, but results are unpredictable:</p>\n\n<ul>\n<li><a href=\"http://stackoverflow.com/q/10894820/27535\">GROUP BY lname ORDER BY showing wrong results</a></li>\n<li><a href=\"http://stackoverflow.com/questions/6060241/which-is-the-least-expensive-aggregate-function-in-the-absence-of-any/6060414#6060414\">Which is the least expensive aggregate function in the absence of ANY()</a> (see comments in accepted answer)</li>\n</ul>\n    "},{"t":"Count(*) vs Count(1)","l":"http://stackoverflow.com/questions/1221559/count-vs-count1","q":"\n\n<p>Just wondering if any of you guys use <code>Count(1)</code> over <code>Count(*)</code> and if there is a noticeable difference in performance or if this is just a legacy habit that has been brought forward from days gone past?</p>\n\n<p>(The specific database is SQL Server 2005.)</p>\n    ","a":"\n<p>There is no difference.</p>\n\n<p>Reason:</p>\n\n<blockquote>\n  <p><a href=\"http://msdn.microsoft.com/en-us/library/ms175997.aspx\">Books on-line</a> says \"<code>COUNT ( { [ [ ALL | DISTINCT ] expression ] | * } )</code>\"</p>\n</blockquote>\n\n<p>\"1\" is a non-null expression: so it's the same as <code>COUNT(*)</code>.\nThe optimizer recognizes it for what it is: trivial.</p>\n\n<p>The same as <code>EXISTS (SELECT * ...</code> or <code>EXISTS (SELECT 1 ...</code></p>\n\n<p>Example:</p>\n\n<pre><code>SELECT COUNT(1) FROM dbo.tab800krows\nSELECT COUNT(1),FKID FROM dbo.tab800krows GROUP BY FKID\n\nSELECT COUNT(*) FROM dbo.tab800krows\nSELECT COUNT(*),FKID FROM dbo.tab800krows GROUP BY FKID\n</code></pre>\n\n<p>Same IO, same plan, the works</p>\n\n<p>Edit, Aug 2011</p>\n\n<p><a href=\"http://dba.stackexchange.com/questions/2511/what-is-the-difference-between-select-count-and-select-countany-non-null-col/2512#2512\">Similar question on DBA.SE</a>.</p>\n\n<p>Edit, Dec 2011</p>\n\n<p><code>COUNT(*)</code> is mentioned specifically in <a href=\"http://msdn.microsoft.com/en-us/library/ms175997.aspx\">ANSI-92</a> (look for \"<code>Scalar expressions 125</code>\")</p>\n\n<blockquote>\n  <p>Case:</p>\n  \n  <p>a) If COUNT(*) is specified, then the result is the cardinality of T.</p>\n</blockquote>\n\n<p>That is, the ANSI standard recognizes it as bleeding obvious what you mean. <code>COUNT(1)</code> has been optimized out by RDBMS vendors <em>because</em> of this superstition. Otherwise it would be evaluated as per ANSI</p>\n\n<blockquote>\n  <p>b) Otherwise, let TX be the single-column table that is the\n                result of applying the &lt;value expression&gt; to each row of T\n                and eliminating null values. If one or more null values are\n                eliminated, then a completion condition is raised: warning-</p>\n</blockquote>\n    "},{"t":"Fetch the row which has the Max value for a column","l":"http://stackoverflow.com/questions/121387/fetch-the-row-which-has-the-max-value-for-a-column","q":"\n\n<p>Table: UserId, Value, Date.</p>\n\n<p>I want to get the UserId, Value for the max(Date) for each UserId. That is, the Value for each UserId that has the latest date. Is there a way to do this simply in SQL? (Preferably Oracle)</p>\n\n<p><strong>Update:</strong> Apologies for any ambiguity: I need to get ALL the UserIds. But for each UserId, only that row where that user has the latest date.</p>\n    ","a":"\n<p>This will retrieve all rows for which the my_date column value is equal to the maximum value of my_date for that userid. This may retrieve multiple rows for the userid where the maximum date is on multiple rows.</p>\n\n<pre><code>select userid,\n       my_date,\n       ...\nfrom\n(\nselect userid,\n       my_Date,\n       ...\n       max(my_date) over (partition by userid) max_my_date\nfrom   users\n)\nwhere my_date = max_my_date\n</code></pre>\n\n<p>\"Analytic functions rock\"</p>\n\n<p>Edit: With regard to the first comment ...</p>\n\n<p>\"using analytic queries and a self-join defeats the purpose of analytic queries\"</p>\n\n<p>There is no self-join in this code. There is instead a predicate placed on the result of the inline view that contains the analytic function -- a very different matter, and completely standard practice.</p>\n\n<p>\"The default window in Oracle is from the first row in the partition to the current one\"</p>\n\n<p>The windowing clause is only applicable in the presence of the order by clause. With no order by clause, no windowing clause is applied by default and none can be explicitly specified.</p>\n\n<p>The code works.</p>\n    "},{"t":"Difference between JOIN and INNER JOIN","l":"http://stackoverflow.com/questions/565620/difference-between-join-and-inner-join","q":"\n\n<p>Both these joins will give me the same results:</p>\n\n<pre><code>SELECT * FROM table JOIN otherTable ON table.ID = otherTable.FK\n</code></pre>\n\n<p>vs</p>\n\n<pre><code>SELECT * FROM table INNER JOIN otherTable ON table.ID = otherTable.FK\n</code></pre>\n\n<p>Is there any difference between the statements in performance or otherwise? </p>\n\n<p>Does it differ between different SQL implementations? </p>\n    ","a":"\n<p>They are functionally equivalent, but <code>INNER JOIN</code> can be a bit clearer to read, especially if the query has other join types (i.e. <code>LEFT</code> or <code>RIGHT</code> or <code>CROSS</code>) included in it.</p>\n    "},{"t":"Save PL/pgSQL output from PostgreSQL to a CSV file","l":"http://stackoverflow.com/questions/1517635/save-pl-pgsql-output-from-postgresql-to-a-csv-file","q":"\n\n<p>What is the easiest way to save PL/pgSQL output from a PostgreSQL database to a CSV file? </p>\n\n<p>I'm using PostgreSQL 8.4 with pgAdmin III and PSQL plugin where I run queries from.</p>\n    ","a":"\n<p>If you want something easy to re-use or automate, you can use Postgresql's built in <a href=\"http://www.postgresql.org/docs/current/interactive/sql-copy.html\">COPY</a> command. e.g.</p>\n\n<pre><code>Copy (Select * From foo) To '/tmp/test.csv' With CSV;\n</code></pre>\n\n<p><strong>This approach runs entirely on the remote server</strong> - it can't write to your local PC. It also needs to be run as a Postgres \"superuser\" (normally called \"root\") because Postgres can't stop it doing nasty things with that machine's local filesystem.</p>\n\n<p>That doesn't actually mean you have to be connected as a superuser (automating that would be a security risk of a different kind), because you can use <a href=\"http://www.postgresql.org/docs/current/interactive/sql-createfunction.html\">the <code>SECURITY DEFINER</code> option to <code>CREATE FUNCTION</code></a> to make a function which <em>runs as though you were a superuser</em>. </p>\n\n<p>The crucial part is that your function is there to perform additional checks, not just by-pass the security - so you could write a function which exports the exact data you need, or you could write something which can accept various options as long as they meet a strict whitelist. You need to check two things:</p>\n\n<ol>\n<li>Which <strong>files</strong> should the user be allowed to read/write on disk? This might be a particular directory, for instance, and the filename might have to have a suitable prefix or extension.</li>\n<li>Which <strong>tables</strong> should the user be able to read/write in the database? This would normally be defined by <code>GRANT</code>s in the database, but the function is now running as a superuser, so tables which would normally be \"out of bounds\" will be fully accessible. You probably don’t want to let someone invoke your function and add rows on the end of your “users” table…</li>\n</ol>\n\n<p>I've written <a href=\"http://rwec.co.uk/q/pg-copy\">a blog post expanding on this approach</a>, including some examples of functions that export (or import) files and tables meeting strict conditions.</p>\n\n<hr>\n\n<p>The other approach is to <strong>do the file handling on the client side</strong>, i.e. in your application or script. The Postgres server doesn't need to know what file you're copying to, it just spits out the data and the client puts it somewhere.</p>\n\n<p>The underlying syntax for this is the <code>COPY TO STDOUT</code> command, and graphical tools like pgAdmin will wrap it for you in a nice dialog.</p>\n\n<p>The <strong><code>psql</code> command-line client</strong> has a special \"meta-command\" called <strong><code>\\copy</code></strong>, which takes all the same options as the \"real\" <code>COPY</code>, but is run inside the client:</p>\n\n<pre><code>\\copy (Select * From foo) To '/tmp/test.csv' With CSV\n</code></pre>\n\n<p>Note that there is no terminating <code>;</code>, because meta-commands are terminated by newline, unlike SQL commands.</p>\n\n<p>From <a href=\"http://www.postgresql.org/docs/current/interactive/app-psql.html#APP-PSQL-META-COMMANDS-COPY\">the docs</a>:</p>\n\n<blockquote>\n  <p>Do not confuse COPY with the psql instruction \\copy. \\copy invokes COPY FROM STDIN or COPY TO STDOUT, and then fetches/stores the data in a file accessible to the psql client. Thus, file accessibility and access rights depend on the client rather than the server when \\copy is used.</p>\n</blockquote>\n\n<p>Your application programming language <em>may</em> also have support for pushing or fetching the data, but you cannot generally use <code>COPY FROM STDIN</code>/<code>TO STDOUT</code> within a standard SQL statement, because there is no way of connecting the input/output stream. PHP's PostgreSQL handler (<em>not</em> PDO) includes very basic <a href=\"http://www.php.net/manual/en/function.pg-copy-from.php\"><code>pg_copy_from</code></a> and <a href=\"http://www.php.net/manual/en/function.pg-copy-to.php\"><code>pg_copy_to</code></a> functions which copy to/from a PHP array, which may not be efficient for large data sets.</p>\n    "},{"t":"How can I SELECT rows with MAX(Column value), DISTINCT by another column in SQL?","l":"http://stackoverflow.com/questions/612231/how-can-i-select-rows-with-maxcolumn-value-distinct-by-another-column-in-sql","q":"\n\n<h3>My table is:</h3>\n\n<pre><code>id  home  datetime     player   resource\n---|-----|------------|--------|---------\n1  | 10  | 04/03/2009 | john   | 399 \n2  | 11  | 04/03/2009 | juliet | 244\n5  | 12  | 04/03/2009 | borat  | 555\n3  | 10  | 03/03/2009 | john   | 300\n4  | 11  | 03/03/2009 | juliet | 200\n6  | 12  | 03/03/2009 | borat  | 500\n7  | 13  | 24/12/2008 | borat  | 600\n8  | 13  | 01/01/2009 | borat  | 700\n</code></pre>\n\n<p>I need to select each distinct <code>home</code> holding the maximum value of <code>datetime</code>. </p>\n\n<h3>Result would be:</h3>\n\n<pre><code>id  home  datetime     player   resource \n---|-----|------------|--------|---------\n1  | 10  | 04/03/2009 | john   | 399\n2  | 11  | 04/03/2009 | juliet | 244\n5  | 12  | 04/03/2009 | borat  | 555\n8  | 13  | 01/01/2009 | borat  | 700\n</code></pre>\n\n<p>I have tried:</p>\n\n<pre><code>-- 1 ..by the MySQL manual: \n\nSELECT DISTINCT home, id, datetime as dt, player, resource\n    FROM topten t1\n    WHERE datetime = (SELECT MAX(t2.datetime) FROM topten t2\n        GROUP BY home )\nGROUP BY datetime\nORDER BY datetime DESC\n</code></pre>\n\n<p>Doesn't work. Result-set has 130 rows although database holds 187. \nResult includes some duplicates of <code>home</code>.</p>\n\n<pre><code>-- 2 ..join\n\nSELECT s1.id, s1.home, s1.datetime, s1.player, s1.resource\nFROM topten s1 JOIN\n(SELECT id, MAX(datetime) AS dt\n  FROM topten\n  GROUP BY id) AS s2\n  ON s1.id = s2.id\n  ORDER BY datetime \n</code></pre>\n\n<p>Nope. Gives all the records.</p>\n\n<pre><code>-- 3 ..something exotic: \n</code></pre>\n\n<p>With various results.</p>\n    ","a":"\n<p>You are so close!  All you need to do is select BOTH the home and it's max date time, then join back to the topten table on BOTH fields:</p>\n\n<pre><code>SELECT tt.*\nFROM topten tt\nINNER JOIN\n    (SELECT home, MAX(datetime) AS MaxDateTime\n    FROM topten\n    GROUP BY home) groupedtt \nON tt.home = groupedtt.home \nAND tt.datetime = groupedtt.MaxDateTime\n</code></pre>\n    "},{"t":"Select first row in each GROUP BY group?","l":"http://stackoverflow.com/questions/3800551/select-first-row-in-each-group-by-group","q":"\n\n\n\n<p>As the title suggests, I'd like to select the first row of each set of rows grouped with a <code>GROUP BY</code>.</p>\n\n<p>Specifically, if I've got a <code>purchases</code> table that looks like this:</p>\n\n<pre class=\"lang-sql prettyprint-override\"><code>SELECT * FROM purchases;\n</code></pre>\n\n<pre>id | customer | total\n---+----------+------\n 1 | Joe      | 5\n 2 | Sally    | 3\n 3 | Joe      | 2\n 4 | Sally    | 1\n</pre>\n\n<p>I'd like to query for the <code>id</code> of the largest purchase (<code>total</code>) made by each <code>customer</code>. Something like this:</p>\n\n<pre class=\"lang-sql prettyprint-override\"><code>SELECT FIRST(id), customer, FIRST(total)\nFROM  purchases\nGROUP BY customer\nORDER BY total DESC;\n</code></pre>\n\n<pre>FIRST(id) | customer | FIRST(total)\n----------+----------+-------------\n        1 | Joe      | 5\n        2 | Sally    | 3\n</pre>\n    ","a":"\n<h2>On Oracle 8i+, SQL Server 2005+, PostgreSQL 8.4+, DB2, Firebird 2.1+, Teradata, Sybase, Vertica:</h2>\n\n<pre><code>WITH summary AS (\n    SELECT p.id, \n           p.customer, \n           p.total, \n           ROW_NUMBER() OVER(PARTITION BY p.customer \n                                 ORDER BY p.total DESC) AS rk\n      FROM PURCHASES p)\nSELECT s.*\n  FROM summary s\n WHERE s.rk = 1\n</code></pre>\n\n<h2>Supported by any database:</h2>\n\n<p>But you need to add logic to break ties:</p>\n\n<pre><code>  SELECT MIN(x.id),  -- change to MAX if you want the highest\n         x.customer, \n         x.total\n    FROM PURCHASES x\n    JOIN (SELECT p.customer,\n                 MAX(total) AS max_total\n            FROM PURCHASES p\n        GROUP BY p.customer) y ON y.customer = x.customer\n                              AND y.max_total = x.total\nGROUP BY x.customer, x.total\n</code></pre>\n    "},{"t":"What is the difference between Left, Right, Outer and Inner Joins?","l":"http://stackoverflow.com/questions/448023/what-is-the-difference-between-left-right-outer-and-inner-joins","q":"\n\n<p>I am wondering how to differentiate all these different joins ...</p>\n    ","a":"\n<p><strong>Simple Example</strong>: Lets say you have a <code>Students</code> table, and a <code>Lockers</code> table.</p>\n\n<p>Each student can be assigned to a locker, so there is a <code>LockerNumber</code> column in the <code>Student</code> table. More than one student could potentially be in a single locker, but especially at the beginning of the school year, you may have some incoming students without lockers and some lockers that have no students assigned.</p>\n\n<p>For the sake of this example, lets say you have <strong>100 students</strong>, 70 of which have lockers. You have a total of <strong>50 lockers</strong>, 40 of which have at least 1 student and 10 lockers have no student.</p>\n\n<p><strong>INNER JOIN</strong> is equivalent to \"<em>show me all students with lockers</em>\".<br>\nAny students without lockers, or any lockers without students are missing.<br>\n<strong>Returns 70 rows</strong></p>\n\n<p><strong>LEFT OUTER JOIN</strong> would be \"<em>show me all students, with their corresponding locker if they have one</em>\". <br>\nThis might be a general student list, or could be used to identify students with no locker. <br><strong>Returns 100 rows</strong></p>\n\n<p><strong>RIGHT OUTER JOIN</strong> would be \"<em>show me all lockers, and the students assigned to them if there are any</em>\". <br>\nThis could be used to identify lockers that have no students assigned, or lockers that have too many students. <br><strong>Returns 80 rows</strong> (list of 70 students in the 40 lockers, plus the 10 lockers with no student)</p>\n\n<p><strong>FULL OUTER JOIN</strong> would be silly and probably not much use. <br>\nSomething like \"<em>show me all students and all lockers, and match them up where you can</em>\" <br><strong>Returns 110 rows</strong> (all 100 students, including those without lockers. Plus the 10 lockers with no student)</p>\n\n<p><strong>CROSS JOIN</strong> is also fairly silly in this scenario.<br> It doesn't use the linked <code>lockernumber</code> field in the students table, so you basically end up with a big giant list of every possible student-to-locker pairing, whether or not it actually exists.<br>\n<strong>Returns 5000 rows</strong> (100 students x 50 lockers). Could be useful (with filtering) as a starting point to match up the new students with the empty lockers.</p>\n    "},{"t":"Function vs. Stored Procedure in SQL Server","l":"http://stackoverflow.com/questions/1179758/function-vs-stored-procedure-in-sql-server","q":"\n\n<p>I've been learning Functions and Stored Procedure for quite a while but I don't know why and when I should use a function or a stored procedure. They look same to me, maybe because I am kinda newbie about that.</p>\n\n<p>Can some one tell me why?</p>\n    ","a":"\n<p>Functions are computed values and cannot perform permanent environmental changes to SQL Server (i.e. no INSERT or UPDATE statements allowed).</p>\n\n<p>A Function can be used inline in SQL Statements if it returns a scalar value or can be joined upon if it returns a result set.</p>\n    "},{"t":"MySQL Query GROUP BY day / month / year","l":"http://stackoverflow.com/questions/508791/mysql-query-group-by-day-month-year","q":"\n\n<p>Is it possible I make a simple query to count how many records I have in a determined period of time like a Year, month or day, having a <code>TIMESTAMP</code> field, like: </p>\n\n<pre><code>SELECT COUNT(id)\nFROM stats\nWHERE record_date.YEAR = 2009\nGROUP BY record_date.YEAR\n</code></pre>\n\n<p>Or even:</p>\n\n<pre><code>SELECT COUNT(id)\nFROM stats\nGROUP BY record_date.YEAR, record_date.MONTH\n</code></pre>\n\n<p>To have a monthly statistic. </p>\n\n<p>Thanks!</p>\n    ","a":"\n<pre><code>GROUP BY YEAR(record_date), MONTH(record_date)\n</code></pre>\n\n<p>Check out the <a href=\"http://dev.mysql.com/doc/refman/5.1/en/date-and-time-functions.html#function_month\">date and time functions</a> in MySQL.</p>\n    "},{"t":"What is the most efficient/elegant way to parse a flat table into a tree?","l":"http://stackoverflow.com/questions/192220/what-is-the-most-efficient-elegant-way-to-parse-a-flat-table-into-a-tree","q":"\n\n<p>Assume you have a flat table that stores an ordered tree hierarchy:</p>\n\n<pre><code>Id   Name         ParentId   Order\n 1   'Node 1'            0      10\n 2   'Node 1.1'          1      10\n 3   'Node 2'            0      20\n 4   'Node 1.1.1'        2      10\n 5   'Node 2.1'          3      10\n 6   'Node 1.2'          1      20\n</code></pre>\n\n<p>Here's a diagram, where we have <code>[id] Name</code>.  Root node 0 is fictional.</p>\n\n<pre>                       [0] ROOT\n                          /    \\ \n              [1] Node 1          [3] Node 2\n              /       \\                   \\\n    [2] Node 1.1     [6] Node 1.2      [5] Node 2.1\n          /          \n [4] Node 1.1.1\n</pre>\n\n<p>What minimalistic approach would you use to output that to HTML (or text, for that matter) as a correctly ordered, correctly indented tree? </p>\n\n<p>Assume further you only have basic data structures (arrays and hashmaps), no fancy objects with parent/children references, no ORM, no framework, just your two hands. The table is represented as a result set, which can be accessed randomly. </p>\n\n<p>Pseudo code or plain English is okay, this is purely a conceptional question.</p>\n\n<p>Bonus question: Is there a fundamentally better way to store a tree structure like this in a RDBMS?</p>\n\n<hr>\n\n<p><strong>EDITS AND ADDITIONS</strong></p>\n\n<p>To answer one commenter's (<a href=\"http://stackoverflow.com/users/17826/mark-bessey\">Mark Bessey</a>'s) question: A root node is not necessary, because it is never going to be displayed anyway. ParentId = 0 is the convention to express \"these are top level\". The Order column defines how nodes with the same parent are going to be sorted.</p>\n\n<p>The \"result set\" I spoke of can be pictured as an array of hashmaps (to stay in that terminology). For my example was meant to be already there. Some answers go the extra mile and construct it first, but thats okay.</p>\n\n<p>The tree can be arbitrarily deep. Each node can have N children. I did not exactly have a \"millions of entries\" tree in mind, though.</p>\n\n<p>Don't mistake my choice of node naming ('Node 1.1.1') for something to rely on. The nodes could equally well be called 'Frank' or 'Bob', no naming structure is implied, this was merely to make it readable.</p>\n\n<p><em>I have posted my own solution so you guys can pull it to pieces.</em></p>\n    ","a":"\n<p>There are several ways to store tree-structured data in a relational database.  What you show in your example uses two methods:  </p>\n\n<ul>\n<li><strong>Adjacency List</strong> (the \"parent\" column) and </li>\n<li><strong>Path Enumeration</strong> (the dotted-numbers in your name column).  </li>\n</ul>\n\n<p>Another solution is called <strong>Nested Sets</strong>, and it can be stored in the same table too.  Read \"<a href=\"http://rads.stackoverflow.com/amzn/click/1558609202\">Trees and Hierarchies in SQL for Smarties</a>\" by Joe Celko for a lot more information on these designs.</p>\n\n<p>I usually prefer a design called <strong>Closure Table</strong> (aka \"Adjacency Relation\") for storing tree-structured data.  It requires another table, but then querying trees is pretty easy.</p>\n\n<p>I cover Closure Table in my presentation <a href=\"http://www.slideshare.net/billkarwin/models-for-hierarchical-data\">Models for Hierarchical Data with SQL and PHP</a> and in my book <a href=\"http://pragprog.com/book/bksqla/sql-antipatterns\">SQL Antipatterns: Avoiding the Pitfalls of Database Programming</a>.</p>\n\n<pre><code>CREATE TABLE ClosureTable (\n  ancestor_id   INT NOT NULL REFERENCES FlatTable(id),\n  descendant_id INT NOT NULL REFERENCES FlatTable(id),\n  PRIMARY KEY (ancestor_id, descendant_id)\n);\n</code></pre>\n\n<p>Store all paths in the Closure Table, where there is a direct ancestry from one node to another.  Include a row for each node to reference itself.  For example, using the data set you showed in your question:</p>\n\n<pre><code>INSERT INTO ClosureTable (ancestor_id, descendant_id) VALUES\n  (1,1), (1,2), (1,4), (1,6),\n  (2,2), (2,4),\n  (3,3), (3,5),\n  (4,4),\n  (5,5),\n  (6,6);\n</code></pre>\n\n<p>Now you can get a tree starting at node 1 like this:</p>\n\n<pre><code>SELECT f.* \nFROM FlatTable f \n  JOIN ClosureTable a ON (f.id = a.descendant_id)\nWHERE a.ancestor_id = 1;\n</code></pre>\n\n<p>The output (in MySQL client) looks like the following:</p>\n\n<pre><code>+----+\n| id |\n+----+\n|  1 | \n|  2 | \n|  4 | \n|  6 | \n+----+\n</code></pre>\n\n<p>In other words, nodes 3 and 5 are excluded, because they're part of a separate hierarchy, not descending from node 1.</p>\n\n<hr>\n\n<p>Re: comment from e-satis about immediate children (or immediate parent).  You can add a \"<code>path_length</code>\" column to the <code>ClosureTable</code> to make it easier to query specifically for an immediate child or parent (or any other distance).</p>\n\n<pre><code>INSERT INTO ClosureTable (ancestor_id, descendant_id, path_length) VALUES\n  (1,1,0), (1,2,1), (1,4,2), (1,6,1),\n  (2,2,0), (2,4,1),\n  (3,3,0), (3,5,1),\n  (4,4,0),\n  (5,5,0),\n  (6,6,0);\n</code></pre>\n\n<p>Then you can add a term in your search for querying the immediate children of a given node.  These are descendants whose <code>path_length</code> is 1.</p>\n\n<pre><code>SELECT f.* \nFROM FlatTable f \n  JOIN ClosureTable a ON (f.id = a.descendant_id)\nWHERE a.ancestor_id = 1\n  AND path_length = 1;\n\n+----+\n| id |\n+----+\n|  2 | \n|  6 | \n+----+\n</code></pre>\n\n<hr>\n\n<p>Re comment from @ashraf: \"How about sorting the whole tree [by name]?\"</p>\n\n<p>Here's an example query to return all nodes that are descendants of node 1, join them to the FlatTable that contains other node attributes such as <code>name</code>, and sort by the name.</p>\n\n<pre><code>SELECT f.name\nFROM FlatTable f \nJOIN ClosureTable a ON (f.id = a.descendant_id)\nWHERE a.ancestor_id = 1\nORDER BY f.name;\n</code></pre>\n\n<hr>\n\n<p>Re comment from @Nate:</p>\n\n<pre><code>SELECT f.name, GROUP_CONCAT(b.ancestor_id order by b.path_length desc) AS breadcrumbs\nFROM FlatTable f \nJOIN ClosureTable a ON (f.id = a.descendant_id) \nJOIN ClosureTable b ON (b.descendant_id = a.descendant_id) \nWHERE a.ancestor_id = 1 \nGROUP BY a.descendant_id \nORDER BY f.name\n\n+------------+-------------+\n| name       | breadcrumbs |\n+------------+-------------+\n| Node 1     | 1           |\n| Node 1.1   | 1,2         |\n| Node 1.1.1 | 1,2,4       |\n| Node 1.2   | 1,6         |\n+------------+-------------+\n</code></pre>\n\n<hr>\n\n<p>A user suggested an edit today. SO moderators approved the edit, but I am reversing it.</p>\n\n<p>The edit suggested that the ORDER BY in the last query above should be <code>ORDER BY b.path_length, f.name</code>, presumably to make sure the ordering matches the hierarchy. But this doesn't work, because it would order \"Node 1.1.1\" after \"Node 1.2\".</p>\n\n<p>If you want the ordering to match the hierarchy in a sensible way, that is possible, but not simply by ordering by the path length. For example, see my answer to <a href=\"http://stackoverflow.com/questions/8252323/mysql-closure-table-hierarchical-database-how-to-pull-information-out-in-the-c\">MySQL Closure Table hierarchical database - How to pull information out in the correct order</a>.</p>\n    "},{"t":"Solutions for INSERT OR UPDATE on SQL Server","l":"http://stackoverflow.com/questions/108403/solutions-for-insert-or-update-on-sql-server","q":"\n\n<p>Assume a table structure of <code>MyTable(KEY, datafield1, datafield2...)</code>.</p>\n\n<p>Often I want to either update an existing record, or insert a new record if it doesn't exist.</p>\n\n<p>Essentially:</p>\n\n<pre><code>IF (key exists)\n  run update command\nELSE\n  run insert command\n</code></pre>\n\n<p>What's the best performing way to write this?</p>\n    ","a":"\n<p>don't forget about transactions. Performance is good, but simple (IF EXISTS..) approach is very dangerous.<br>\nWhen multiple threads will try to perform Insert-or-update you can easily \nget primary key violation.</p>\n\n<p>Solutions provided by @Beau Crawford &amp; @Esteban show general idea but error-prone.</p>\n\n<p>To avoid deadlocks and PK violations you can use something like this:  </p>\n\n<pre><code>begin tran\nif exists (select * from table with (updlock,serializable) where key = @key)\nbegin\n   update table set ...\n   where key = @key\nend\nelse\nbegin\n   insert table (key, ...)\n   values (@key, ...)\nend\ncommit tran\n</code></pre>\n\n<p>or</p>\n\n<pre><code>begin tran\n   update table with (serializable) set ...\n   where key = @key\n\n   if @@rowcount = 0\n   begin\n      insert table (key, ...) values (@key,..)\n   end\ncommit tran\n</code></pre>\n    "},{"t":"Insert, on duplicate update in PostgreSQL?","l":"http://stackoverflow.com/questions/1109061/insert-on-duplicate-update-in-postgresql","q":"\n\n<p>Several months ago I learned from an answer on Stack Overflow how to perform multiple updates at once in MySQL using the following syntax:</p>\n\n<pre><code>INSERT INTO table (id, field, field2) VALUES (1, A, X), (2, B, Y), (3, C, Z)\nON DUPLICATE KEY UPDATE field=VALUES(Col1), field2=VALUES(Col2);\n</code></pre>\n\n<p>I've now switched over to PostgreSQL and apparently this is not correct. It's referring to all the correct tables so I assume it's a matter of different keywords being used but I'm not sure where in the PostgreSQL documentation this is covered.</p>\n\n<p>To clarify, I want to insert several things and if they already exist to update them.</p>\n    ","a":"\n<p>PostgreSQL starting from version 9.5 will have <a href=\"http://www.postgresql.org/docs/devel/static/sql-insert.html\" rel=\"nofollow\">UPSERT</a> syntax. </p>\n\n<hr>\n\n<p>Searching postgresql's email group archives for \"upsert\" leads to finding <a href=\"http://www.postgresql.org/docs/current/static/plpgsql-control-structures.html#PLPGSQL-UPSERT-EXAMPLE\" rel=\"nofollow\">an example of doing what you possibly want to do, in the manual</a>:</p>\n\n<blockquote>\n  <p><strong>Example 38-2. Exceptions with UPDATE/INSERT</strong></p>\n  \n  <p>This example uses exception handling to perform either UPDATE or INSERT, as appropriate:</p>\n</blockquote>\n\n<pre><code>CREATE TABLE db (a INT PRIMARY KEY, b TEXT);\n\nCREATE FUNCTION merge_db(key INT, data TEXT) RETURNS VOID AS\n$$\nBEGIN\n    LOOP\n        -- first try to update the key\n        UPDATE db SET b = data WHERE a = key;\n        IF found THEN\n            RETURN;\n        END IF;\n        -- not there, so try to insert the key\n        -- if someone else inserts the same key concurrently,\n        -- we could get a unique-key failure\n        BEGIN\n            INSERT INTO db(a,b) VALUES (key, data);\n            RETURN;\n        EXCEPTION WHEN unique_violation THEN\n            -- do nothing, and loop to try the UPDATE again\n        END;\n    END LOOP;\nEND;\n$$\nLANGUAGE plpgsql;\n\nSELECT merge_db(1, 'david');\nSELECT merge_db(1, 'dennis');\n</code></pre>\n\n<hr>\n\n<p>There's possibly an example of how to do this in bulk, using CTEs in 9.1 and above, in the <a href=\"http://archives.postgresql.org/pgsql-hackers/2011-06/msg01826.php\" rel=\"nofollow\">hackers mailing list</a>:</p>\n\n<pre><code>WITH foos AS (SELECT (UNNEST(%foo[])).*)\nupdated as (UPDATE foo SET foo.a = foos.a ... RETURNING foo.id)\nINSERT INTO foo SELECT foos.* FROM foos LEFT JOIN updated USING(id)\nWHERE updated.id IS NULL;\n</code></pre>\n\n<p>See <a href=\"http://stackoverflow.com/a/8702291/642706\">a_horse_with_no_name's answer</a> for a clearer example.</p>\n    "},{"t":"Retrieving the last record in each group","l":"http://stackoverflow.com/questions/1313120/retrieving-the-last-record-in-each-group","q":"\n\n<p>There is a table <code>messages</code> that contains data as shown below:</p>\n\n<pre><code>Id   Name   Other_Columns\n-------------------------\n1    A       A_data_1\n2    A       A_data_2\n3    A       A_data_3\n4    B       B_data_1\n5    B       B_data_2\n6    C       C_data_1\n</code></pre>\n\n<p>If I run a query <code>select * from messages group by name</code>, I will get the result as:</p>\n\n<pre><code>1    A       A_data_1\n4    B       B_data_1\n6    C       C_data_1\n</code></pre>\n\n<p>What query will return the following result?</p>\n\n<pre><code>3    A       A_data_3\n5    B       B_data_2\n6    C       C_data_1\n</code></pre>\n\n<p>That is, the last record in each group should be returned.</p>\n\n<p>At present, this is the query that I use:</p>\n\n<pre><code>select * from (select * from messages ORDER BY id DESC) AS x GROUP BY name\n</code></pre>\n\n<p>But this looks highly inefficient. Any other ways to achieve the same result?</p>\n    ","a":"\n<p>I write the solution this way:</p>\n\n<pre><code>SELECT m1.*\nFROM messages m1 LEFT JOIN messages m2\n ON (m1.name = m2.name AND m1.id &lt; m2.id)\nWHERE m2.id IS NULL;\n</code></pre>\n\n<hr>\n\n<p>Regarding performance, one solution or the other can be better, depending on the nature of your data. So you should test both queries and use the one that is better at performance given your database.</p>\n\n<p>For example, I have a copy of the StackOverflow August data dump.  I'll use that for benchmarking.  There are 1,114,357 rows in the <code>Posts</code> table.  This is running on MySQL 5.0.75 on my Macbook Pro 2.40GHz.</p>\n\n<p>I'll write a query to find the most recent post for a given user ID (mine).</p>\n\n<p><strong>First using the technique <a href=\"http://stackoverflow.com/questions/1313120/sql-retrieving-the-last-record-in-each-group/1313140#1313140\">shown</a> by @Eric with the <code>GROUP BY</code> in a subquery:</strong></p>\n\n<pre><code>SELECT p1.postid\nFROM Posts p1\nINNER JOIN (SELECT pi.owneruserid, MAX(pi.postid) AS maxpostid\n            FROM Posts pi GROUP BY pi.owneruserid) p2\n  ON (p1.postid = p2.maxpostid)\nWHERE p1.owneruserid = 20860;\n\n1 row in set (1 min 17.89 sec)\n</code></pre>\n\n<p>Even the <code>EXPLAIN</code> analysis takes over 16 seconds:</p>\n\n<pre><code>+----+-------------+------------+--------+----------------------------+-------------+---------+--------------+---------+-------------+\n| id | select_type | table      | type   | possible_keys              | key         | key_len | ref          | rows    | Extra       |\n+----+-------------+------------+--------+----------------------------+-------------+---------+--------------+---------+-------------+\n|  1 | PRIMARY     | &lt;derived2&gt; | ALL    | NULL                       | NULL        | NULL    | NULL         |   76756 |             | \n|  1 | PRIMARY     | p1         | eq_ref | PRIMARY,PostId,OwnerUserId | PRIMARY     | 8       | p2.maxpostid |       1 | Using where | \n|  2 | DERIVED     | pi         | index  | NULL                       | OwnerUserId | 8       | NULL         | 1151268 | Using index | \n+----+-------------+------------+--------+----------------------------+-------------+---------+--------------+---------+-------------+\n3 rows in set (16.09 sec)\n</code></pre>\n\n<p><strong>Now produce the same query result using my technique with <code>LEFT JOIN</code>:</strong></p>\n\n<pre><code>SELECT p1.postid\nFROM Posts p1 LEFT JOIN posts p2\n  ON (p1.owneruserid = p2.owneruserid AND p1.postid &lt; p2.postid)\nWHERE p2.postid IS NULL AND p1.owneruserid = 20860;\n\n1 row in set (0.28 sec)\n</code></pre>\n\n<p>The <code>EXPLAIN</code> analysis shows that both tables are able to use their indexes:</p>\n\n<pre><code>+----+-------------+-------+------+----------------------------+-------------+---------+-------+------+--------------------------------------+\n| id | select_type | table | type | possible_keys              | key         | key_len | ref   | rows | Extra                                |\n+----+-------------+-------+------+----------------------------+-------------+---------+-------+------+--------------------------------------+\n|  1 | SIMPLE      | p1    | ref  | OwnerUserId                | OwnerUserId | 8       | const | 1384 | Using index                          | \n|  1 | SIMPLE      | p2    | ref  | PRIMARY,PostId,OwnerUserId | OwnerUserId | 8       | const | 1384 | Using where; Using index; Not exists | \n+----+-------------+-------+------+----------------------------+-------------+---------+-------+------+--------------------------------------+\n2 rows in set (0.00 sec)\n</code></pre>\n\n<hr>\n\n<p>Here's the DDL for my <code>Posts</code> table:</p>\n\n<pre><code>CREATE TABLE `posts` (\n  `PostId` bigint(20) unsigned NOT NULL auto_increment,\n  `PostTypeId` bigint(20) unsigned NOT NULL,\n  `AcceptedAnswerId` bigint(20) unsigned default NULL,\n  `ParentId` bigint(20) unsigned default NULL,\n  `CreationDate` datetime NOT NULL,\n  `Score` int(11) NOT NULL default '0',\n  `ViewCount` int(11) NOT NULL default '0',\n  `Body` text NOT NULL,\n  `OwnerUserId` bigint(20) unsigned NOT NULL,\n  `OwnerDisplayName` varchar(40) default NULL,\n  `LastEditorUserId` bigint(20) unsigned default NULL,\n  `LastEditDate` datetime default NULL,\n  `LastActivityDate` datetime default NULL,\n  `Title` varchar(250) NOT NULL default '',\n  `Tags` varchar(150) NOT NULL default '',\n  `AnswerCount` int(11) NOT NULL default '0',\n  `CommentCount` int(11) NOT NULL default '0',\n  `FavoriteCount` int(11) NOT NULL default '0',\n  `ClosedDate` datetime default NULL,\n  PRIMARY KEY  (`PostId`),\n  UNIQUE KEY `PostId` (`PostId`),\n  KEY `PostTypeId` (`PostTypeId`),\n  KEY `AcceptedAnswerId` (`AcceptedAnswerId`),\n  KEY `OwnerUserId` (`OwnerUserId`),\n  KEY `LastEditorUserId` (`LastEditorUserId`),\n  KEY `ParentId` (`ParentId`),\n  CONSTRAINT `posts_ibfk_1` FOREIGN KEY (`PostTypeId`) REFERENCES `posttypes` (`PostTypeId`)\n) ENGINE=InnoDB;\n</code></pre>\n    "},{"t":"SQL Select only rows with Max Value on a Column","l":"http://stackoverflow.com/questions/7745609/sql-select-only-rows-with-max-value-on-a-column","q":"\n\n<p>I have this table for documents (simplified version here):</p>\n\n<pre><code>+------+-------+--------------------------------------+\n| id   | rev   | content                              |\n+------+-------+--------------------------------------+\n| 1    | 1     | ...                                  |\n| 2    | 1     | ...                                  |\n| 1    | 2     | ...                                  |\n| 1    | 3     | ...                                  |\n+------+-------+--------------------------------------+\n</code></pre>\n\n<p>How do I select one row per id and only the greatest rev?<br>\nWith the above data, the result should contain two rows: <code>[1, 3, ...]</code> and <code>[2, 1, ..]</code>. I'm using <strong>MySQL</strong>.</p>\n\n<p>Currently I use checks in the <code>while</code> loop to detect and over-write old revs from the resultset. But is this the only method to achieve the result? Isn't there a <strong>SQL</strong> solution?</p>\n\n<p><strong>Update</strong><br>\nAs the answers suggest, there <em>is</em> a SQL solution, and <a href=\"http://sqlfiddle.com/#!2/e4ffd/2/0\">here a sqlfiddle demo</a>. </p>\n\n<p><strong>Update 2</strong><br>\nI noticed after adding the above sqlfiddle, the rate at which the question is upvoted has surpassed the upvote rate of the answers. That has not been the intention! The fiddle <em>is</em> based on the answers, especially the accepted answer.</p>\n    ","a":"\n<h2>At first glance...</h2>\n\n<p>All you need is a <code>GROUP BY</code> clause with the <code>MAX</code> aggregate function:</p>\n\n<pre><code>select id, max(rev)\nfrom YourTable\ngroup by id\n</code></pre>\n\n<h2>It's never that simple, is it?</h2>\n\n<p>I just noticed you need the <code>content</code> column as well.</p>\n\n<p>This is a very common question in SQL: find the whole data for the row with some max value in a column per some group identifier. I heard that a lot during my career. Actually, it was one the questions I answered in my current job's technical interview. </p>\n\n<p>It is, actually, so common that StackOverflow community has created a single tag just to deal with questions like that: <a href=\"/questions/tagged/greatest-n-per-group\" class=\"post-tag\" title=\"show questions tagged 'greatest-n-per-group'\" rel=\"tag\">greatest-n-per-group</a>.</p>\n\n<p>Basically, you have two approaches to solve that problem:</p>\n\n<h2>Joining with simple <code>group-identifier, max-value-in-group</code> Sub-query</h2>\n\n<p>In this approach, you first find the <code>group-identifier, max-value-in-group</code> (already solved above) in a sub-query. Then you join your table to the sub-query with equality on both <code>group-identifier</code> and <code>max-value-in-group</code>:</p>\n\n<pre><code>select yt.id, yt.rev, yt.contents\nfrom YourTable yt\ninner join(\n    select id, max(rev) rev\n    from YourTable\n    group by id\n) ss on yt.id = ss.id and yt.rev = ss.rev\n</code></pre>\n\n<h2>Left Joining with self, tweaking join conditions and filters</h2>\n\n<p>In this approach, you left join the table with itself. Equality, of course, goes in the <code>group-identifier</code>. Then, 2 smart moves: </p>\n\n<ol>\n<li>The second join condition is having left side value less than right value</li>\n<li>When you do step 1, the row(s) that actually have the max value will have <code>NULL</code> in the right side (it's a <code>LEFT JOIN</code>, remember?). Then, we filter the joined result, showing only the rows where the right side is <code>NULL</code>.</li>\n</ol>\n\n<p>So you end up with:</p>\n\n<pre><code>select yt1.*\nfrom yourtable yt1\nleft outer join yourtable yt2\non (yt1.id = yt2.id and yt1.rev &lt; yt2.rev)\nwhere yt2.id is null;\n</code></pre>\n\n<h2>Conclusion</h2>\n\n<p>Both approaches bring the exact same result. </p>\n\n<p>If you have two rows with <code>max-value-in-group</code> for <code>group-identifier</code>, both rows will be in the result in both approaches.</p>\n\n<p>Both approaches are SQL ANSI compatible, thus, will work with your favorite RDBMS, regardless of its \"flavor\".</p>\n\n<p>Both approaches are also performance friendly, however your mileage may vary (RDBMS, DB Structure, Indexes, etc.). So when you pick one approach over the other, <em>benchmark</em>. And make sure you pick the one which make most of sense to you.</p>\n    "},{"t":"Is it possible to insert multiple rows at a time in an SQLite database?","l":"http://stackoverflow.com/questions/1609637/is-it-possible-to-insert-multiple-rows-at-a-time-in-an-sqlite-database","q":"\n\n<p>In MySQL you can insert multiple rows like this:</p>\n\n<pre><code>INSERT INTO 'tablename' ('column1', 'column2') VALUES\n    ('data1', 'data2'),\n    ('data1', 'data2'),\n    ('data1', 'data2'),\n    ('data1', 'data2');\n</code></pre>\n\n<p>However, I am getting an error when I try to do something like this. Is it possible to insert multiple rows at a time in an SQLite database? What is the syntax to do that?</p>\n    ","a":"\n<h2>update</h2>\n\n<p>As <a href=\"http://stackoverflow.com/a/1609688/558639\">BrianCampbell points out here</a>, <strong>SQLite 3.7.11 and above now supports the simpler syntax of the original post</strong>.  However, the approach shown is still appropriate if you want maximum compatibility across legacy databases.</p>\n\n<h2>original answer</h2>\n\n<p>If I had privileges, I would bump <a href=\"http://stackoverflow.com/a/1734067/356895\">andy's reply</a>: You <strong>can</strong> insert multiple rows in SQLite, you just need <strong>different syntax</strong>.  To make it perfectly clear, the OPs MySQL example:</p>\n\n<pre><code>INSERT INTO 'tablename' ('column1', 'column2') VALUES\n  ('data1', 'data2'),\n  ('data3', 'data4'),\n  ('data5', 'data6'),\n  ('data7', 'data8');\n</code></pre>\n\n<p>This can be recast into SQLite as:</p>\n\n<pre><code> INSERT INTO 'tablename'\n      SELECT 'data1' AS 'column1', 'data2' AS 'column2'\nUNION SELECT 'data3', 'data4'\nUNION SELECT 'data5', 'data6'\nUNION SELECT 'data7', 'data8'\n</code></pre>\n\n<p>I've been using this to \"broadside\" large datasets from RoR and it's a big performance win.<br>\nP.S.: Please +1 <a href=\"http://stackoverflow.com/a/1734067/356895\">andy's reply</a>, not mine!  He presented the solution first.</p>\n    "},{"t":"Join vs. sub-query","l":"http://stackoverflow.com/questions/2577174/join-vs-sub-query","q":"\n\n<p>I am an old-school MySQL user and have always preferred <code>JOIN</code> over sub-query. But nowadays everyone uses sub-query and I hate it, I don't know why.   </p>\n\n<p>I lack the theoretical knowledge to judge for myself if there is any difference.\nIs a sub-query as good as a <code>JOIN</code> and therefore there is nothing to worry about?</p>\n    ","a":"\n<p>In most cases <code>JOIN</code>s are faster than sub-queries and it is very rare for a sub-query to be faster.</p>\n\n<p>In <code>JOIN</code>s RDBMS can create an execution plan that is better for your query and can predict what data should be loaded to be processed and save time, unlike the sub-query where it will run all the queries and load all their data to do the processing.</p>\n\n<p>The good thing in sub-queries is that they are more readable than <code>JOIN</code>s: that's why most new SQL people prefer them; it is the easy way; but when it comes to performance, JOINS are better in most cases even though they are not hard to read too.</p>\n    "},{"t":"How do I split a string so I can access item x","l":"http://stackoverflow.com/questions/2647/how-do-i-split-a-string-so-i-can-access-item-x","q":"\n\n<p>Using SQL Server 2005, how do I split a string so I can access item x?</p>\n\n<p>For example, take the string \"Hello John Smith\". How can I split the string by a space and access the item at index 1 which should return \"John\"?</p>\n    ","a":"\n<p>You may find the solution in <em><a href=\"http://www.codeproject.com/KB/database/SQL_UDF_to_Parse_a_String.aspx\">SQL User Defined Function to Parse a Delimited String</a></em> helpful (from <a href=\"http://en.wikipedia.org/wiki/The_Code_Project\">The Code Project</a>).</p>\n\n<p>U can use this simple logic - </p>\n\n<pre><code>Declare @products varchar(200) = '1|20|3|343|44|6|8765'\nDeclare @individual varchar(20) = null\n\nWHILE LEN(@products) &gt; 0\nBEGIN\n    IF PATINDEX('%|%',@products) &gt; 0\n    BEGIN\n        SET @individual = SUBSTRING(@products, 0, PATINDEX('%|%',@products))\n        SELECT @individual\n\n        SET @products = SUBSTRING(@products, LEN(@individual + '|') + 1,\n                                                     LEN(@products))\n    END\n    ELSE\n    BEGIN\n        SET @individual = @products\n        SET @products = NULL\n        SELECT @individual\n    END\nEND\n</code></pre>\n    "},{"t":"'IF' in 'SELECT' statement - choose output value based on column values","l":"http://stackoverflow.com/questions/5951157/if-in-select-statement-choose-output-value-based-on-column-values","q":"\n\n<pre><code>SELECT id, amount from report\n</code></pre>\n\n<p>I need <code>amount</code> to be <code>amount</code> if <code>report.type='P'</code> and <code>-amount</code> if <code>report.type='N'</code>. How do I add this to the above query?</p>\n    ","a":"\n<pre><code>SELECT \n        id\n        , IF(type = 'P', amount, amount * -1) as amount\nFROM    report\n</code></pre>\n\n<p>See <a href=\"http://dev.mysql.com/doc/refman/5.0/en/control-flow-functions.html\">http://dev.mysql.com/doc/refman/5.0/en/control-flow-functions.html</a>.</p>\n\n<p>Additionally, you could handle when the condition is null. In the case of a null amount:</p>\n\n<pre><code>SELECT \n        id\n        , IF(type = 'P', IFNULL(amount,0), IFNULL(amount,0) * -1) as amount\nFROM    report\n</code></pre>\n\n<p>The part <code>IFNULL(amount,0)</code> means <em>when amount is not null return amount else return 0</em>.</p>\n    "},{"t":"MySQL: @variable vs. variable. Whats the difference?","l":"http://stackoverflow.com/questions/1009954/mysql-variable-vs-variable-whats-the-difference","q":"\n\n<p>In another question I posted someone told me that there is a difference between:</p>\n\n<pre><code>@variable\n</code></pre>\n\n<p>and:</p>\n\n<pre><code>variable\n</code></pre>\n\n<p>in MySQL. He also mentioned how MSSQL has batch scope and MySQL has session scope. Can someone elaborate on this for me?</p>\n    ","a":"\n<p><code>MySQL</code> has the concept of <em><a href=\"http://dev.mysql.com/doc/refman/5.0/en/user-variables.html\" rel=\"nofollow\">user-defined variables</a></em>.</p>\n\n<p>They are loosely typed variables that may be initialized somewhere in a session and keep their value until the session ends.</p>\n\n<p>They are prepended with an <code>@</code> sign, like this: <code>@var</code></p>\n\n<p>You can initialize this variable with a <code>SET</code> statement or inside in a query:</p>\n\n<pre><code>SET @var = 1\n\nSELECT @var2 := 2\n</code></pre>\n\n<p>When you develop a stored procedure in <code>MySQL</code>, you can pass the input parameters and declare the local variables:</p>\n\n<pre><code>DELIMITER //\n\nCREATE PROCEDURE prc_test (var INT)\nBEGIN\n    DECLARE  var2 INT;\n    SET var2 = 1;\n    SELECT  var2;\nEND;\n//\n\nDELIMITER ;\n</code></pre>\n\n<p>These variables are not prepended with any prefixes.</p>\n\n<p>The difference between a procedure variable and a session-specific user-defined variable is that procedure variable is reinitialized to <code>NULL</code> each time the procedure is called, while the session-specific variable is not:</p>\n\n<pre><code>CREATE PROCEDURE prc_test ()\nBEGIN\n    DECLARE var2 INT DEFAULT 1;\n    SET var2 := var2 + 1;\n    SET @var2 := @var2 + 1;\n    SELECT  var2, @var2;\nEND;\n\nSET @var2 = 1;\n\nCALL prc_test();\n\nvar2  @var2\n---   ---\n2     2\n\n\nCALL prc_test();\n\nvar2  @var2\n---   ---\n2     3\n\n\nCALL prc_test();\n\nvar2  @var2\n---   ---\n2     4\n</code></pre>\n\n<p>As you can see, <code>var2</code> (procedure variable) is reinitialized each time the procedure is called, while <code>@var2</code> (session-specific variable) is not.</p>\n\n<p>(In addition to user-defined variables, MySQL <em>also</em> has some predefined \"system variables\", which may be \"global variables\" such as <code>@@global.port</code> or \"session variables\" such as <code>@@session.sql_mode</code>; these \"session variables\" are unrelated to session-specific user-defined variables.)</p>\n    "},{"t":"Best approach to remove time part of datetime in SQL Server","l":"http://stackoverflow.com/questions/1177449/best-approach-to-remove-time-part-of-datetime-in-sql-server","q":"\n\n<p>Which method provides the best performance when removing the time portion from a datetime field in SQL Server?</p>\n\n<pre><code>a) select DATEADD(dd, DATEDIFF(dd, 0, getdate()), 0)\n</code></pre>\n\n<p>or</p>\n\n<pre><code>b) select cast(convert(char(11), getdate(), 113) as datetime)\n</code></pre>\n\n<p>The second method does send a few more bytes either way but that might not be as important as the speed of the conversion.</p>\n\n<p>Both also appear to be very fast, but there might be a difference in speed when dealing with hundreds-of-thousands or more rows?</p>\n\n<p>Also, is it possible that there are even better methods to get rid of the time portion of a datetime in SQL?</p>\n    ","a":"\n<p>Strictly, method <code>a</code> is the least resource intensive:</p>\n\n<pre><code>a) select DATEADD(dd, DATEDIFF(dd, 0, getdate()), 0)\n</code></pre>\n\n<p>Proven less CPU intensive for same total duration a million rows by some one with way too much time on their hands: <a href=\"http://stackoverflow.com/questions/133081/most-efficient-way-in-sql-server-to-get-date-from-datetime\">Most efficient way in SQL Server to get date from date+time?</a></p>\n\n<p>I saw a similar test elsewhere with similar results too.</p>\n\n<p>I prefer the DATEADD/DATEDIFF because:</p>\n\n<ul>\n<li>varchar is subject to language/dateformat issues<br>\nExample: <a href=\"http://stackoverflow.com/q/3596663/27535\">Why is my CASE expression non-deterministic?</a></li>\n<li>float relies on internal storage</li>\n<li>it extends to work out first day of month, tomorrow etc by changing \"0\" base</li>\n</ul>\n\n<p><strong>Edit, Oct 2011</strong></p>\n\n<p>For SQL Server 2008+, you can CAST to <code>date</code>. Or just use <code>date</code> so no time to remove.</p>\n\n<p><strong>Edit, Jan 2012</strong></p>\n\n<p>A worked example of how flexible this is: <a href=\"http://stackoverflow.com/questions/8722022/need-to-calculate-by-rounded-time-or-date-figure-in-sql-server/8723311#8723311\">Need to calculate by rounded time or date figure in sql server</a></p>\n\n<p><strong>Edit, May 2012</strong></p>\n\n<p>Do not use this in WHERE clauses and the like without thinking: adding a function or CAST to a column invalidates index usage. See number 2 here: <a href=\"http://www.simple-talk.com/sql/t-sql-programming/ten-common-sql-programming-mistakes/\">http://www.simple-talk.com/sql/t-sql-programming/ten-common-sql-programming-mistakes/</a></p>\n\n<p>Now, this does have an example of later SQL Server optimiser versions managing CAST to date correctly, but <em>generally</em> it will be a bad idea ...</p>\n    "},{"t":"Skip certain tables with mysqldump","l":"http://stackoverflow.com/questions/425158/skip-certain-tables-with-mysqldump","q":"\n\n<p>Is there a way to restrict certain tables from the mysqldump command?</p>\n\n<p>For example, I'd use the following syntax to dump <em>only</em> table1 and table2:</p>\n\n<pre><code>mysqldump -u username -p database table1 table2 &gt; database.sql\n</code></pre>\n\n<p>But is there a similar way to dump all the tables <em>except</em> table1 and table2? I haven't found anything in the mysqldump documentation, so is brute-force (specifying all the table names) the only way to go?</p>\n    ","a":"\n<p>You can use the <a href=\"http://dev.mysql.com/doc/refman/5.1/en/mysqldump.html#option_mysqldump_ignore-table\">--ignore-table</a> option.  So you could do</p>\n\n<pre><code>mysqldump -u username -p database --ignore-table=database.table1 &gt; database.sql\n</code></pre>\n\n<p>If you want to ignore multiple tables you can use a simple script like this</p>\n\n<pre><code>#!/bin/bash\nPASSWORD=XXXXXX\nHOST=XXXXXX\nUSER=XXXXXX\nDATABASE=databasename\nDB_FILE=dump.sql\nEXCLUDED_TABLES=(\ntable1\ntable2\ntable3\ntable4\ntableN   \n)\n\nIGNORED_TABLES_STRING=''\nfor TABLE in \"${EXCLUDED_TABLES[@]}\"\ndo :\n   IGNORED_TABLES_STRING+=\" --ignore-table=${DATABASE}.${TABLE}\"\ndone\n\necho \"Dump structure\"\nmysqldump --host=${HOST} --user=${USER} --password=${PASSWORD} --single-transaction --no-data ${DATABASE} &gt; ${DB_FILE}\n\necho \"Dump content\"\nmysqldump --host=${HOST} --user=${USER} --password=${PASSWORD} ${DATABASE} ${IGNORED_TABLES_STRING} &gt;&gt; ${DB_FILE}\n</code></pre>\n    "},{"t":"SQLite - UPSERT *not* INSERT or REPLACE","l":"http://stackoverflow.com/questions/418898/sqlite-upsert-not-insert-or-replace","q":"\n\n<p><a href=\"http://en.wikipedia.org/wiki/Upsert\">http://en.wikipedia.org/wiki/Upsert</a></p>\n\n<p><a href=\"http://stackoverflow.com/questions/13540/insert-update-stored-proc-on-sql-server\">Insert Update stored proc on SQL Server</a></p>\n\n<p>Is there some clever way to do this in SQLite that I have not thought of?</p>\n\n<p>Basically I want to update three out of four columns if the record exists, \nIf it does not exists I want to INSERT the record with the default (NUL) value for the fourth column.</p>\n\n<p>The ID is a primary key so there will only ever be one record to UPSERT.</p>\n\n<p>(I am trying to avoid the overhead of SELECT in order to determin if I need to UPDATE or INSERT obviously)</p>\n\n<p>Suggestions?</p>\n    ","a":"\n<p>Assuming 3 columns in the table.. ID, NAME, ROLE</p>\n\n<hr>\n\n<p><strong>BAD:</strong> This will insert or replace all columns with new values for ID=1:</p>\n\n<pre><code>INSERT OR REPLACE INTO Employee (id, name, role) \n  VALUES (1, 'John Foo', 'CEO');\n</code></pre>\n\n<hr>\n\n<p><strong>BAD:</strong> This will insert or replace 2 of the columns... the NAME column will be set to NULL or the default value:</p>\n\n<pre><code>INSERT OR REPLACE INTO Employee (id, role) \n  VALUES (1, 'code monkey');\n</code></pre>\n\n<hr>\n\n<p><strong>GOOD:</strong> This will update 2 of the columns.\nWhen ID=1 exists, the NAME will be unaffected.\nWhen ID=1 does not exist, the name will be default (NULL).</p>\n\n<pre><code>INSERT OR REPLACE INTO Employee (id, role, name) \n  VALUES (  1, \n            'code monkey',\n            (SELECT name FROM Employee WHERE id = 1)\n          );\n</code></pre>\n\n<p>This will update 2 of the columns.\nWhen ID=1 exists, the ROLE will be unaffected.\nWhen ID=1 does not exist, the role will be set to 'Benchwarmer' instead of the default value.</p>\n\n<pre><code>INSERT OR REPLACE INTO Employee (id, name, role) \n  VALUES (  1, \n            'Susan Bar',\n            COALESCE((SELECT role FROM Employee WHERE id = 1), 'Benchwarmer')\n          );\n</code></pre>\n    "},{"t":"find all tables containing column with specified name","l":"http://stackoverflow.com/questions/4849652/find-all-tables-containing-column-with-specified-name","q":"\n\n<p>Is it possible that I can query for names of all tables which contain column with name</p>\n\n<pre><code>Like %myName%\n</code></pre>\n    ","a":"\n<pre><code>SELECT c.name AS ColName, t.name AS TableName\nFROM sys.columns c\n    JOIN sys.tables t ON c.object_id = t.object_id\nWHERE c.name LIKE '%MyName%'\n</code></pre>\n\n<p>Or...</p>\n\n<pre><code>SELECT COLUMN_NAME, TABLE_NAME \nFROM INFORMATION_SCHEMA.COLUMNS \nWHERE COLUMN_NAME LIKE '%MyName%'\n</code></pre>\n    "},{"t":"SQL Server: How to Join to first row","l":"http://stackoverflow.com/questions/2043259/sql-server-how-to-join-to-first-row","q":"\n\n<p>I'll use a concrete, but hypothetical, example.</p>\n\n<p>Each <strong>Order</strong> normally has only one <strong>line item</strong>:</p>\n\n<p><strong>Orders:</strong></p>\n\n<pre><code>OrderGUID   OrderNumber\n=========   ============\n{FFB2...}   STL-7442-1      \n{3EC6...}   MPT-9931-8A\n</code></pre>\n\n<p><strong>LineItems:</strong></p>\n\n<pre><code>LineItemGUID   Order ID Quantity   Description\n============   ======== ========   =================================\n{098FBE3...}   1        7          prefabulated amulite\n{1609B09...}   2        32         spurving bearing\n</code></pre>\n\n<p>But occasionally there will be an order with two line items:</p>\n\n<pre><code>LineItemID   Order ID    Quantity   Description\n==========   ========    ========   =================================\n{A58A1...}   6,784,329   5          pentametric fan\n{0E9BC...}   6,784,329   5          differential girdlespring \n</code></pre>\n\n<p>Normally when showing the orders to the user:</p>\n\n<pre><code>SELECT Orders.OrderNumber, LineItems.Quantity, LineItems.Description\nFROM Orders\n    INNER JOIN LineItems \n    ON Orders.OrderID = LineItems.OrderID\n</code></pre>\n\n<p>I want to show the single item on the order. But with this occasional order containing two (or more) items, the orders would <em>appear</em> be <strong>duplicated</strong>:</p>\n\n<pre><code>OrderNumber   Quantity   Description\n===========   ========   ====================\nSTL-7442-1    7          prefabulated amulite\nMPT-9931-8A   32         differential girdlespring\nKSG-0619-81   5          panametric fan\nKSG-0619-81   5          differential girdlespring\n</code></pre>\n\n<p>What I really want is to have SQL Server <em>just pick one</em>, as it will be <em>good enough</em>:</p>\n\n<pre><code>OrderNumber   Quantity   Description\n===========   ========   ====================\nSTL-7442-1    7          prefabulated amulite\nMPT-9931-8A   32         differential girdlespring\nKSG-0619-81   5          panametric fan\n</code></pre>\n\n<p>If I get adventurous, I might show the user, an ellipsis to indicate that there's more than one:</p>\n\n<pre><code>OrderNumber   Quantity   Description\n===========   ========   ====================\nSTL-7442-1    7          prefabulated amulite\nMPT-9931-8A   32         differential girdlespring\nKSG-0619-81   5          panametric fan, ...\n</code></pre>\n\n<p>So the question is how to either</p>\n\n<ul>\n<li>eliminate \"duplicate\" rows</li>\n<li>only join to one of the rows, to avoid duplication</li>\n</ul>\n\n<h2>First attempt</h2>\n\n<p>My first naive attempt was to only join to the \"<strong>TOP 1</strong>\" line items:</p>\n\n<pre><code>SELECT Orders.OrderNumber, LineItems.Quantity, LineItems.Description\nFROM Orders\n    INNER JOIN (\n       SELECT TOP 1 LineItems.Quantity, LineItems.Description\n       FROM LineItems\n       WHERE LineItems.OrderID = Orders.OrderID) LineItems2\n    ON 1=1\n</code></pre>\n\n<p>But that gives the error:</p>\n\n<blockquote>\n  <p>The column or prefix 'Orders' does not\n  match with a table name or alias name\n  used in the query.</p>\n</blockquote>\n\n<p>Presumably because the inner select doesn't see the outer table.</p>\n    ","a":"\n<pre><code>SELECT   Orders.OrderNumber, LineItems.Quantity, LineItems.Description\nFROM     Orders\nJOIN     LineItems\nON       LineItems.LineItemGUID =\n         (\n         SELECT  TOP 1 LineItemGUID \n         FROM    LineItems\n         WHERE   OrderID = Orders.OrderID\n         )\n</code></pre>\n\n<p>In <code>SQL Server 2005</code> and above, you could just replace <code>INNER JOIN</code> with <code>CROSS APPLY</code>:</p>\n\n<pre><code>SELECT  Orders.OrderNumber, LineItems2.Quantity, LineItems2.Description\nFROM    Orders\nCROSS APPLY\n        (\n        SELECT  TOP 1 LineItems.Quantity, LineItems.Description\n        FROM    LineItems\n        WHERE   LineItems.OrderID = Orders.OrderID\n        ) LineItems2\n</code></pre>\n    "},{"t":"SQL exclude a column using SELECT * [except columnA] FROM tableA?","l":"http://stackoverflow.com/questions/729197/sql-exclude-a-column-using-select-except-columna-from-tablea","q":"\n\n<p>We all know that to select all columns from a table, we can use</p>\n\n<pre><code>SELECT * FROM tableA\n</code></pre>\n\n<p>Is there a way to exclude column(s) from a table without specifying all the columns?</p>\n\n<pre><code>SELECT * [except columnA] FROM tableA\n</code></pre>\n\n<p>The only way that I know is to manually specify all the columns and exclude the unwanted column. This is really time consuming so I'm looking for ways to save time and effort on this, as well as future maintenance should the table has more/less columns.</p>\n\n<p>thanks!</p>\n    ","a":"\n<p>I agree with everyone... but if I was going to do something like this I might do it this way:</p>\n\n<pre><code>/* Get the data into a temp table */\nSELECT * INTO #TempTable\nFROM YourTable\n/* Drop the cloumns that are not needed */\nALTER TABLE #TempTable\nDROP COLUMN ColumnToDrop\n/* Get results and drop temp table */\nSELECT * FROM #TempTable\nDROP TABLE #TempTable\n</code></pre>\n    "},{"t":"java.util.Date vs java.sql.Date","l":"http://stackoverflow.com/questions/2305973/java-util-date-vs-java-sql-date","q":"\n\n<p><code>java.util.Date</code> vs <code>java.sql.Date</code>: when to use which and why?</p>\n    ","a":"\n<p>Congratulations, you've hit my favorite pet peeve with JDBC: Date class handling.</p>\n\n<p>Basically databases usually support at least <strong>three</strong> forms of datetime fields which are date, time and timestamp. Each of these have a corresponding class in JDBC and <strong>each of them extend <a href=\"http://docs.oracle.com/javase/8/docs/api/index.html?java/util/Date.html\"><code>java.util.Date</code></a></strong>. Quick semantics of each of these three are the following:</p>\n\n<ul>\n<li><a href=\"http://docs.oracle.com/javase/8/docs/api/index.html?java/sql/Date.html\"><code>java.sql.Date</code></a> corresponds to SQL DATE which means it stores <em>years, months and days</em> while <em>hour, minute, second and millisecond</em> are ignored. Additionally <code>sql.Date</code> isn't tied to timezones.</li>\n<li><a href=\"http://docs.oracle.com/javase/8/docs/api/index.html?java/sql/Time.html\"><code>java.sql.Time</code></a> corresponds to SQL TIME and as should be obvious, only contains information about <em>hour, minutes, seconds and milliseconds</em>.</li>\n<li><a href=\"http://docs.oracle.com/javase/8/docs/api/index.html?java/sql/Timestamp.html\"><code>java.sql.Timestamp</code></a> corresponds to SQL TIMESTAMP which is exact date to the nanosecond (<em>note that <code>util.Date</code> only supports milliseconds!</em>) with customizable precision.</li>\n</ul>\n\n<p><strong>One of the most common bugs when using JDBC drivers in relation to these three types is that the types are handled incorrectly.</strong> This means that <code>sql.Date</code> is timezone specific, <code>sql.Time</code> contains current year, month and day et cetera et cetera.</p>\n\n<h2>Finally: Which one to use?</h2>\n\n<p>Depends on the SQL type of the field, really. <code>PreparedStatement</code> has setters for all three values, <code>#setDate()</code> being the one for <code>sql.Date</code>, <code>#setTime()</code> for <code>sql.Time</code> and <code>#setTimestamp()</code> for <code>sql.Timestamp</code>.</p>\n\n<p>Do note that if you use <code>ps.setObject(fieldIndex, utilDateObject);</code> you can actually give a normal <code>util.Date</code> to most JDBC drivers which will happily devour it as if it was of the correct type but when you request the data afterwards, you may notice that you're actually missing stuff.</p>\n\n<h2>I'm really saying that none of the Dates should be used at all.</h2>\n\n<p>What I am saying that save the milliseconds/nanoseconds as plain longs and convert them to whatever objects you are using (<em><a href=\"http://www.joda.org/joda-time/\">obligatory joda-time plug</a></em>). One hacky way which can be done is to store the date component as one long and time component as another, for example right now would be 20100221 and 154536123. These magic numbers can be used in SQL queries and will be portable from database to another and will let you avoid this part of JDBC/Java Date API:s entirely.</p>\n    "},{"t":"How to Delete using INNER JOIN with SQL Server?","l":"http://stackoverflow.com/questions/16481379/how-to-delete-using-inner-join-with-sql-server","q":"\n\n<p>I want to delete using <code>INNER JOIN</code> in SQL Server 2008.</p>\n\n<p>But I get this error,</p>\n\n<blockquote>\n  <p>Msg 156, Level 15, State 1, Line 15 Incorrect syntax near the keyword\n  'INNER'.</p>\n</blockquote>\n\n<p>My code,</p>\n\n<pre><code>DELETE FROM WorkRecord2 INNER JOIN Employee ON EmployeeRun=EmployeeNo\nWhere Company = '1' AND Date = '2013-05-06'\n</code></pre>\n    ","a":"\n<p>You need to specify what table you are deleting from, here is a version with an alias:</p>\n\n<pre><code>DELETE w\nFROM WorkRecord2 w\nINNER JOIN Employee e\n  ON EmployeeRun=EmployeeNo\nWhere Company = '1' AND Date = '2013-05-06'\n</code></pre>\n    "},{"t":"How to request a random row in SQL?","l":"http://stackoverflow.com/questions/19412/how-to-request-a-random-row-in-sql","q":"\n\n<p>How can I request a random row (or as close to truly random as is possible) in pure SQL?</p>\n    ","a":"\n<p>See this post: <a href=\"http://www.petefreitag.com/item/466.cfm\">SQL to Select a random row from a database table</a>. It goes through methods for doing this in MySQL, PostgreSQL, Microsoft SQL Server, IBM DB2 and Oracle (the following is copied from that link):</p>\n\n<p>Select a random row with MySQL:</p>\n\n<pre><code>SELECT column FROM table\nORDER BY RAND()\nLIMIT 1\n</code></pre>\n\n<p>Select a random row with PostgreSQL:</p>\n\n<pre><code>SELECT column FROM table\nORDER BY RANDOM()\nLIMIT 1\n</code></pre>\n\n<p>Select a random row with Microsoft SQL Server:</p>\n\n<pre><code>SELECT TOP 1 column FROM table\nORDER BY NEWID()\n</code></pre>\n\n<p>Select a random row with IBM DB2</p>\n\n<pre><code>SELECT column, RAND() as IDX \nFROM table \nORDER BY IDX FETCH FIRST 1 ROWS ONLY\n</code></pre>\n\n<p>Select a random record with Oracle:</p>\n\n<pre><code>SELECT column FROM\n( SELECT column FROM table\nORDER BY dbms_random.value )\nWHERE rownum = 1\n</code></pre>\n    "},{"t":"Fastest Way of Inserting in Entity Framework","l":"http://stackoverflow.com/questions/5940225/fastest-way-of-inserting-in-entity-framework","q":"\n\n<p>I'm looking for the fastest way of inserting into Entity Framework, I'm asking this because of the scenario where you have an active TransactionScope and the insertion is huge (4000+). It can potentially last more than 10 minutes (default timeout of transactions), and this will lead to an incomplete transaction.</p>\n\n<p>Regards.</p>\n    ","a":"\n<p>To your remark in the comments to your question:</p>\n\n<blockquote>\n  <p>\"...SavingChanges (<strong>for each\n  record</strong>)...\"</p>\n</blockquote>\n\n<p>That's the worst thing you can do! Calling <code>SaveChanges()</code> for each record slows bulk inserts extremely down. I would do a few simple tests which will very likely improve the performance:</p>\n\n<ul>\n<li>Call <code>SaveChanges()</code> once after ALL records.</li>\n<li>Call <code>SaveChanges()</code> after for example 100 records.</li>\n<li>Call <code>SaveChanges()</code> after for example 100 records and dispose the context and create a new one.</li>\n<li>Disable change detection</li>\n</ul>\n\n<p>For bulk inserts I am working and experimenting with a pattern like this:</p>\n\n<pre><code>using (TransactionScope scope = new TransactionScope())\n{\n    MyDbContext context = null;\n    try\n    {\n        context = new MyDbContext();\n        context.Configuration.AutoDetectChangesEnabled = false;\n\n        int count = 0;            \n        foreach (var entityToInsert in someCollectionOfEntitiesToInsert)\n        {\n            ++count;\n            context = AddToContext(context, entityToInsert, count, 100, true);\n        }\n\n        context.SaveChanges();\n    }\n    finally\n    {\n        if (context != null)\n            context.Dispose();\n    }\n\n    scope.Complete();\n}\n\nprivate MyDbContext AddToContext(MyDbContext context,\n    Entity entity, int count, int commitCount, bool recreateContext)\n{\n    context.Set&lt;Entity&gt;().Add(entity);\n\n    if (count % commitCount == 0)\n    {\n        context.SaveChanges();\n        if (recreateContext)\n        {\n            context.Dispose();\n            context = new MyDbContext();\n            context.Configuration.AutoDetectChangesEnabled = false;\n        }\n    }\n\n    return context;\n}\n</code></pre>\n\n<p>I have a test program which inserts 560.000 entities (9 scalar properties, no navigation properties) into the DB. With this code it works in less than 3 minutes.</p>\n\n<p>For the performance it is important to call <code>SaveChanges()</code> after \"many\" records (\"many\" around 100 or 1000). It also improves the performance to dispose the context after SaveChanges and create a new one. This clears the context from all entites, <code>SaveChanges</code> doesn't do that, the entities are still attached to the context in state <code>Unchanged</code>. It is the growing size of attached entities in the context what slows down the insertion step by step. So, it is helpful to clear it after some time.</p>\n\n<p>Here are a few measurements for my 560.000 entities:</p>\n\n<ul>\n<li>commitCount = 1,       recreateContext = false: <strong>many hours</strong> (That's your current procedure)</li>\n<li>commitCount = 100,     recreateContext = false: <strong>more than 20 minutes</strong></li>\n<li>commitCount = 1000,    recreateContext = false: <strong>242 sec</strong></li>\n<li>commitCount = 10000,   recreateContext = false: <strong>202 sec</strong></li>\n<li>commitCount = 100000,  recreateContext = false: <strong>199 sec</strong></li>\n<li>commitCount = 1000000, recreateContext = false: <strong>out of memory exception</strong></li>\n<li>commitCount = 1,       recreateContext = true:  <strong>more than 10 minutes</strong></li>\n<li>commitCount = 10,      recreateContext = true:  <strong>241 sec</strong></li>\n<li>commitCount = 100,     recreateContext = true:  <strong>164 sec</strong></li>\n<li>commitCount = 1000,    recreateContext = true:  <strong>191 sec</strong></li>\n</ul>\n\n<p>The behaviour in the first test above is that the performance is very non-linear and decreases extremely over time. (\"Many hours\" is an estimation, I never finished this test, I stopped at 50.000 entities after 20 minutes.) This non-linear behaviour is not so significant in all other tests.</p>\n    "},{"t":"Select statement to find duplicates on certain fields","l":"http://stackoverflow.com/questions/4434118/select-statement-to-find-duplicates-on-certain-fields","q":"\n\n<p>Can you help me with SQL statements to find duplicates on multiple fields?</p>\n\n<p>For example, in pseudo code:</p>\n\n<pre><code>select count(field1,field2,field3) \nfrom table \nwhere the combination of field1, field2, field3 occurs multiple times\n</code></pre>\n\n<p>and from the above statement <em>if there are multiple occurrences</em> I would like to select <em>every record except the first one</em>.</p>\n    ","a":"\n<p>To get the list of fields for which there are multiple records, you can use..</p>\n\n<pre><code>select field1,field2,field3, count(*)\n  from table_name\n  group by field1,field2,field3\n  having count(*) &gt; 1\n</code></pre>\n\n<p>Check this link for more information on how to delete the rows.</p>\n\n<p><a href=\"http://support.microsoft.com/kb/139444\">http://support.microsoft.com/kb/139444</a></p>\n\n<p>Edit : As the other users mentioned, there should be a criterion for deciding how you define \"first rows\" before you use the approach in the link above. Based on that you'll need to use an order by clause and a sub query if needed. If you can post some sample data, it would really help.</p>\n    "},{"t":"Is there a Max function in SQL Server that takes two values like Math.Max in .NET?","l":"http://stackoverflow.com/questions/124417/is-there-a-max-function-in-sql-server-that-takes-two-values-like-math-max-in-ne","q":"\n\n<p>I want to write a query like this:</p>\n\n<pre><code>SELECT o.OrderId, MAX(o.NegotiatedPrice, o.SuggestedPrice)\nFROM Order o\n</code></pre>\n\n<p>But this isn't how the <code>MAX</code> function works, right?  It is an aggregate function so it expects a single parameter and then returns the MAX of all rows.   </p>\n\n<p>Does anyone know how to do it my way?</p>\n    ","a":"\n<p>You'd need to make a <code>User-Defined Function</code> if you wanted to have syntax similar to your example, but could you do what you want to do, inline, fairly easily with a <code>CASE</code> statement, as the others have said.</p>\n\n<p>The <code>UDF</code> could be something like this:</p>\n\n<pre><code>create function dbo.InlineMax(@val1 int, @val2 int)\nreturns int\nas\nbegin\n  if @val1 &gt; @val2\n    return @val1\n  return isnull(@val2,@val1)\nend\n</code></pre>\n\n<p>... and you would call it like so ...</p>\n\n<pre><code>SELECT o.OrderId, dbo.InlineMax(o.NegotiatedPrice, o.SuggestedPrice) \nFROM Order o\n</code></pre>\n    "},{"t":"Using group by on multiple columns","l":"http://stackoverflow.com/questions/2421388/using-group-by-on-multiple-columns","q":"\n\n<p>I understand the point of <code>group by x</code> </p>\n\n<p>But how does <code>group by x, y</code> work and what does it mean?</p>\n    ","a":"\n<p><code>Group By X</code> means <strong>put all those with the same value for X in the one group</strong>.</p>\n\n<p><code>Group By X, Y</code> means <strong>put all those with the same values for both X and Y in the one group</strong>.</p>\n\n<p>To illustrate using an example, let's say we have the following table, to do with who is attending what subject at a university:</p>\n\n<pre><code>Table: Subject_Selection\n\nSubject   Semester   Attendee\n---------------------------------\nITB001    1          John\nITB001    1          Bob\nITB001    1          Mickey\nITB001    2          Jenny\nITB001    2          James\nMKB114    1          John\nMKB114    1          Erica\n</code></pre>\n\n<p>When you use a <code>group by</code> on the subject column only; say:</p>\n\n<pre><code>select Subject, Count(*)\nfrom Subject_Selection\ngroup by Subject\n</code></pre>\n\n<p>You will get something like:</p>\n\n<pre><code>Subject    Count\n------------------------------\nITB001     5\nMKB114     2\n</code></pre>\n\n<p>...because there are 5 entries for ITB001, and 2 for MKB114</p>\n\n<p>If we were to <code>group by</code> two columns:</p>\n\n<pre><code>select Subject, Semester, Count(*)\nfrom Subject_Selection\ngroup by Subject, Semester\n</code></pre>\n\n<p>we would get this:</p>\n\n<pre><code>Subject    Semester   Count\n------------------------------\nITB001     1          3\nITB001     2          2\nMKB114     1          2\n</code></pre>\n\n<p>This is because, when we group by two columns, it is saying <strong>\"Group them so that all of those with the same Subject and Semester are in the same group, and then calculate all the aggregate functions</strong> (Count, Sum, Average, etc.) <strong>for each of those groups\"</strong>. In this example, this is demonstrated by the fact that, when we count them, there are <strong>three</strong> people doing ITB001 in semester 1, and <strong>two</strong> doing it in semester 2. Both of the people doing MKB114 are in semester 1, so there is no row for semester 2 (no data fits into the group \"MKB114, Semester 2\")</p>\n\n<p>Hopefully that makes sense.</p>\n    "},{"t":"How can I list all foreign keys referencing a given table in SQL Server?","l":"http://stackoverflow.com/questions/483193/how-can-i-list-all-foreign-keys-referencing-a-given-table-in-sql-server","q":"\n\n<p>I need to remove a highly referenced table in a SQL Server database.  How can I get a list of all the foreign key constraints I will need to remove in order to drop the table?</p>\n\n<p>(SQL answers preferable over clicking about in the GUI of the management studio.)</p>\n    ","a":"\n<p>Not sure why no one suggested but I use sp_fkeys to query foreign keys for a given table:</p>\n\n<pre><code>EXEC sp_fkeys 'TableName'\n</code></pre>\n    "},{"t":"Entity Framework VS LINQ to SQL VS ADO.NET with stored procedures? [closed]","l":"http://stackoverflow.com/questions/2698151/entity-framework-vs-linq-to-sql-vs-ado-net-with-stored-procedures","q":"\n\n<p>How would you rate each of them in terms of:</p>\n\n<ol>\n<li>Performance</li>\n<li>Speed of development</li>\n<li>Neat, intuitive, maintainable code</li>\n<li>Flexibility</li>\n<li>Overall</li>\n</ol>\n\n<p>I like my SQL and so have always been a die-hard fan of ADO.NET and stored procedures but I recently had a play with Linq to SQL and was blown away by how quickly I was writing out my DataAccess layer and have decided to spend some time really understanding either Linq to SQL or EF... or neither?</p>\n\n<p>I just want to check, that there isn't a great flaw in any of these technologies that would render my research time useless. E.g. performance is terrible, it's cool for simple apps but can only take you so far.</p>\n\n<p><strong>Update:</strong>\nCan you concentrate on EF VS L2S VS SPs rather than ORM VS SPs. I'm mainly interested by EF VS L2S. But am keen to have them compared against stored procs too since plain SQl is something I know a lot about.</p>\n    ","a":"\n<p>First off, if you're starting a new project, go with Entity Framework (\"EF\") - it now generates much better SQL (more like Linq to SQL does) and is easier to maintain and more powerful than Linq to SQL (\"L2S\").  As of the release of .NET 4.0, I consider Linq to SQL to be an obsolete technology.  MS has been very open about not continuing L2S development further.</p>\n\n<p><strong>1) Performance</strong></p>\n\n<p>This is tricky to answer.  For most single-entity operations (<a href=\"http://en.wikipedia.org/wiki/Create,_read,_update_and_delete\">CRUD</a>) you will find just about equivalent performance with all three technologies.  You do have to know how EF and Linq to SQL work in order to use them to their fullest.  For high-volume operations like polling queries, you may want to have EF/L2S \"compile\" your entity query such that the framework doesn't have to constantly regenerate the SQL, or you can run into scalability issues.  (see edits)</p>\n\n<p>For bulk updates where you're updating massive amounts of data, raw SQL or a stored procedure will always perform better than an ORM solution because you don't have to marshal the data over the wire to the ORM to perform updates.  </p>\n\n<p><strong>2) Speed of Development</strong></p>\n\n<p>In most scenarios, EF will blow away naked SQL/stored procs when it comes to speed of development.  The EF designer can update your model from your database as it changes (upon request), so you don't run into synchronization issues between your object code and your database code.  The only time I would not consider using an ORM is when you're doing a reporting/dashboard type application where you aren't doing any updating, or when you're creating an application just to do raw data maintenance operations on a database.  </p>\n\n<p><strong>3) Neat/Maintainable code</strong></p>\n\n<p>Hands down, EF beats SQL/sprocs.  Because your relationships are modeled, joins in your code are relatively infrequent.  The relationships of the entities are almost self-evident to the reader for most queries.  Nothing is worse than having to go from tier to tier debugging or through multiple SQL/middle tier in order to understand what's actually happening to your data.  EF brings your data model into your code in a very powerful way.   </p>\n\n<p><strong>4) Flexibility</strong></p>\n\n<p>Stored procs and raw SQL are more \"flexible\".  You can leverage sprocs and SQL to generate faster queries for the odd specific case, and you can leverage native DB functionality easier than you can with and ORM.  </p>\n\n<p><strong>5) Overall</strong> </p>\n\n<p><strong>Don't get caught up in the <a href=\"http://www.nbc.com/saturday-night-live/video/shimmer-floor-wax/1056743/\">false dichotomy</a> of choosing an ORM vs using stored procedures.</strong>  You can use both in the same application, and you probably should.  Big bulk operations should go in stored procedures or SQL (which can actually be called by the EF), and EF should be used for your CRUD operations and most of your middle-tier's needs.  Perhaps you'd choose to use SQL for writing your reports.  I guess the moral of the story is the same as it's always been.  Use the right tool for the job.  But the skinny of it is, EF is very good nowadays (as of .NET 4.0).  Spend some real time reading and understanding it in depth and you can create some amazing, high-performance apps with ease.</p>\n\n<p><strong>EDIT</strong>: EF 5 simplifies this part a bit with <a href=\"http://blogs.msdn.com/b/efdesign/archive/2011/06/30/auto-compiled-linq-queries-entity-framework-june-2011-ctp.aspx\">auto-compiled LINQ Queries</a>, but for real high volume stuff, you'll definitely need to test and analyze what fits best for you in the real world.</p>\n    "},{"t":"How do I see what character set a database / table / column is in MySQL?","l":"http://stackoverflow.com/questions/1049728/how-do-i-see-what-character-set-a-database-table-column-is-in-mysql","q":"\n\n<p>How do I see what the character set that a MySQL database, table and column are in? Is there something like</p>\n\n<pre><code>SHOW CHARACTER SET FOR mydatabase;\n</code></pre>\n\n<p>and</p>\n\n<pre><code>SHOW CHARACTER SET FOR mydatabase.mytable;\n</code></pre>\n\n<p>and</p>\n\n<pre><code>SHOW CHARACTER SET FOR mydatabase.mytable.mycolumn;\n</code></pre>\n    ","a":"\n<p>Here's how I'd do it -</p>\n\n<p>For Schemas:</p>\n\n<pre><code>SELECT default_character_set_name FROM information_schema.SCHEMATA S\nWHERE schema_name = \"schemaname\";\n</code></pre>\n\n<p>For Tables:</p>\n\n<pre><code>SELECT CCSA.character_set_name FROM information_schema.`TABLES` T,\n       information_schema.`COLLATION_CHARACTER_SET_APPLICABILITY` CCSA\nWHERE CCSA.collation_name = T.table_collation\n  AND T.table_schema = \"schemaname\"\n  AND T.table_name = \"tablename\";\n</code></pre>\n\n<p>For Columns:</p>\n\n<pre><code>SELECT character_set_name FROM information_schema.`COLUMNS` C\nWHERE table_schema = \"schemaname\"\n  AND table_name = \"tablename\"\n  AND column_name = \"columnname\";\n</code></pre>\n    "},{"t":"SQL update query using joins","l":"http://stackoverflow.com/questions/982919/sql-update-query-using-joins","q":"\n\n<p>I have to update a field with a value which is returned by a join of 3 tables.</p>\n\n<p>Example: </p>\n\n<pre><code>select\n    im.itemid\n    ,im.sku as iSku\n    ,gm.SKU as GSKU\n    ,mm.ManufacturerId as ManuId\n    ,mm.ManufacturerName\n    ,im.mf_item_number\n    ,mm.ManufacturerID\nfrom \n    item_master im, group_master gm, Manufacturer_Master mm \nwhere\n    im.mf_item_number like 'STA%'\n    and im.sku=gm.sku\n    and gm.ManufacturerID = mm.ManufacturerID\n    and gm.manufacturerID=34\n</code></pre>\n\n<p>I want to update the <code>mf_item_number</code> field values of table <code>item_master</code> with some other value which is joined in the above condition.</p>\n\n<p>How can I do this in MS SQL Server?</p>\n    ","a":"\n<p>Edit: changed to ANSI joins</p>\n\n<pre><code>UPDATE\n    im\nSET\n    mf_item_number = gm.SKU --etc\nFROM\n    item_master im\n    JOIN\n    group_master gm ON im.sku=gm.sku \n    JOIN\n    Manufacturer_Master mm ON gm.ManufacturerID=mm.ManufacturerID\nWHERE\n    im.mf_item_number like 'STA%'\n    AND\n    gm.manufacturerID=34\n</code></pre>\n\n<p>Edit, Nov 2011</p>\n\n<p>To make it clear... The UPDATE clause can refer to an table alias specified in the FROM clause. So <code>im</code> in this case is valid</p>\n\n<p>Edit, Aug 2012</p>\n\n<p>Generic example</p>\n\n<pre><code>UPDATE\n    A\nSET\n    foo = B.bar\nFROM\n    TableA A\n    JOIN\n    TableB B ON A.col1 = B.colx\nWHERE\n    ...\n</code></pre>\n    "},{"t":"How to convert java.util.date to java.sql.date?","l":"http://stackoverflow.com/questions/530012/how-to-convert-java-util-date-to-java-sql-date","q":"\n\n<p>I am trying to use java.util.Date as input and then creating a query with it - so I need java.sql.Date.  </p>\n\n<p>I was surprised to find that it couldn't do the conversion implicitly or explicitly - but I don't even know how I would do this, as the Java API is still fairly new to me.  Any suggestions?  It seems like this should be an easy feat to accomplish.</p>\n    ","a":"\n<p>Nevermind....</p>\n\n<pre><code>public class MainClass {\n\n  public static void main(String[] args) {\n    java.util.Date utilDate = new java.util.Date();\n    java.sql.Date sqlDate = new java.sql.Date(utilDate.getTime());\n    System.out.println(\"utilDate:\" + utilDate);\n    System.out.println(\"sqlDate:\" + sqlDate);\n\n  }\n\n}\n</code></pre>\n\n<p>explains it.  The link is <a href=\"http://www.java2s.com/Tutorial/Java/0040__Data-Type/ConvertfromajavautilDateObjecttoajavasqlDateObject.htm\">http://www.java2s.com/Tutorial/Java/0040__Data-Type/ConvertfromajavautilDateObjecttoajavasqlDateObject.htm</a></p>\n    "},{"t":"Search Text in Stored Procedure in SQL Server","l":"http://stackoverflow.com/questions/14704105/search-text-in-stored-procedure-in-sql-server","q":"\n\n<p>I want to search a text from my all database stored procedures. I use the below SQL: </p>\n\n<pre><code>SELECT DISTINCT \n       o.name AS Object_Name,\n       o.type_desc\n  FROM sys.sql_modules m \n       INNER JOIN \n       sys.objects o \n         ON m.object_id = o.object_id\n WHERE m.definition Like '%[ABD]%';\n</code></pre>\n\n<p>I want to search for <code>[ABD]</code> in all stored procedures including square brackets but its not giving proper result. Please tell me how I can change my query to achieve this.</p>\n    ","a":"\n<p>Escape the square brackets:</p>\n\n<pre><code>...\nWHERE m.definition Like '%\\[ABD\\]%' ESCAPE '\\'\n</code></pre>\n\n<p>Then the square brackets will be treated as a string literals not as wild cards.</p>\n    "},{"t":"SQL join: where clause vs. on clause","l":"http://stackoverflow.com/questions/354070/sql-join-where-clause-vs-on-clause","q":"\n\n<p>After reading it, this is <em>not</em> a duplicate of <a href=\"http://stackoverflow.com/questions/44917/explicit-vs-implicit-sql-joins\">Explicit vs Implicit SQL Joins</a>.\nThe answer may be related (or even the same) but the <strong>question</strong> is different.</p>\n\n<p></p><hr><p></p>\n\n<p>What is the difference and what should go in each?</p>\n\n<p>If I understand the theory correctly, the query optimizer should be able to use both interchangeably.</p>\n    ","a":"\n<p>They are not the same thing.</p>\n\n<p>Consider these queries:</p>\n\n<pre><code>SELECT *\nFROM Orders\nLEFT JOIN OrderLines ON OrderLines.OrderID=Orders.ID\nWHERE Orders.ID = 12345\n</code></pre>\n\n<p>and</p>\n\n<pre><code>SELECT *\nFROM Orders\nLEFT JOIN OrderLines ON OrderLines.OrderID=Orders.ID \nAND Orders.ID = 12345\n</code></pre>\n\n<p>The first will return an order and its lines, if any, for order number <code>12345</code>.  The second will return all orders, but only order <code>12345</code> will have any lines associated with it.</p>\n\n<p>With an <code>INNER JOIN</code>, the clauses are <em>effectively</em> equivalent. However, just because they are functionally the same, in that they produce the same results, does not mean the two kinds of clauses have the same semantic meaning.</p>\n    "},{"t":"What is the syntax for an inner join in linq to sql?","l":"http://stackoverflow.com/questions/37324/what-is-the-syntax-for-an-inner-join-in-linq-to-sql","q":"\n\n<p>I'm writing a linq to sql statement &amp; I'm just after the standard syntax for a normal inner join with an 'on' clause in C#.</p>\n\n<p>ie how do you represent this in LINQ to SQL?:</p>\n\n<pre><code>select * from table1 \ninner join table2 on table1.field = table2.field\n</code></pre>\n\n<p><strong>EDIT:</strong> Real query to get all contacts for a dealer:</p>\n\n<pre><code>select DealerContact.*\nfrom Dealer \n    inner join DealerContact on Dealer.DealerID = DealerContact.DealerID\n</code></pre>\n    ","a":"\n<p>It goes something like:</p>\n\n<pre><code>from t1 in db.Table1\njoin t2 in db.Table2 on t1.field equals t2.field\nselect new { t1.field2, t2.field3}\n</code></pre>\n\n<p>It would be nice to have sensible names and fields for your tables for a better example. :)</p>\n\n<p><strong>Update</strong></p>\n\n<p>I think for your query this might be more appropriate:</p>\n\n<pre><code>var dealercontacts = from contact in DealerContact\n                     join dealer in Dealer on contact.DealerId equals dealer.ID\n                     select contact;\n</code></pre>\n\n<p>Since you are looking for the contacts, not the dealers.</p>\n    "},{"t":"postgres: upgrade a user to be a superuser?","l":"http://stackoverflow.com/questions/10757431/postgres-upgrade-a-user-to-be-a-superuser","q":"\n\n<p>In postgres, how do I change an existing user to be a superuser? I don't want to delete the existing user, for various reasons. </p>\n\n<pre><code># alter user myuser ...?\n</code></pre>\n\n<p>Thanks for your help. </p>\n    ","a":"\n<pre><code>ALTER USER myuser WITH SUPERUSER;\n</code></pre>\n\n<p><a href=\"http://www.postgresql.org/docs/current/static/sql-alteruser.html\">Docs.</a></p>\n    "},{"t":"Difference between EXISTS and IN in SQL?","l":"http://stackoverflow.com/questions/24929/difference-between-exists-and-in-in-sql","q":"\n\n<p>What is the difference between the <code>EXISTS</code> and <code>IN</code> clause in SQL?</p>\n\n<p>When should we use <code>EXISTS</code>, and when should we use <code>IN</code>?</p>\n    ","a":"\n<p>The <code>exists</code> keyword can be used in that way, but really it's intended as a way to avoid counting:</p>\n\n\n\n<pre class=\"lang-sql prettyprint-override\"><code>--this statement needs to check the entire table\nselect count(*) from [table] where ...\n\n--this statement is true as soon as one match is found\nexists ( select * from [table] where ... )\n</code></pre>\n\n<p>This is most useful where you have <code>if</code> conditional statements, as <code>exists</code> can be a lot quicker than <code>count</code>.</p>\n\n<p>The <code>in</code> is best used where you have a static list to pass:</p>\n\n<pre class=\"lang-sql prettyprint-override\"><code> select * from [table]\n where [field] in (1, 2, 3)\n</code></pre>\n\n<p>When you have a table in an <code>in</code> statement it makes more sense to use a <code>join</code>, but it doesn't really matter. The query optimiser will return the same plan either way.</p>\n    "},{"t":"How to import an SQL file using the command line in MySQL?","l":"http://stackoverflow.com/questions/17666249/how-to-import-an-sql-file-using-the-command-line-in-mysql","q":"\n\n<p>I have a .sql file with an export from phpMyAdmin. I want to import it into a different server using the command line.</p>\n\n<p>I have a <a href=\"http://en.wikipedia.org/wiki/Windows_Server_2008\">Windows Server 2008</a> R2 installation. I placed the .sql file on the C drive, and I tried this command</p>\n\n<pre><code>database_name &lt; file.sql\n</code></pre>\n\n<p>It is not working I get syntax errors.</p>\n\n<p>How can I import this file without a problem?</p>\n\n<p>Do I need to create a database first?</p>\n    ","a":"\n<p>Try:</p>\n\n<pre><code>mysql -u username -p database_name &lt; file.sql\n</code></pre>\n\n<p>Check <a href=\"http://dev.mysql.com/doc/refman/5.0/en/mysql-command-options.html\">MySQL Options</a>.</p>\n\n<p>Note: It is better to use the full path of the SQL file <code>file.sql</code>.</p>\n    "},{"t":"Are there any disadvantages to always using nvarchar(MAX)?","l":"http://stackoverflow.com/questions/148398/are-there-any-disadvantages-to-always-using-nvarcharmax","q":"\n\n<p>In SQL Server 2005, are there any disadvantages to making all character fields nvarchar(MAX) rather than specifying a length explicitly, e.g. nvarchar(255)? (Apart from the obvious one that you aren't able to limit the field length at the database level)</p>\n\n<p><strong>Update:</strong></p>\n\n<p>Based on the link provided in the accepted answer it appears that:</p>\n\n<ol>\n<li><p>100 characters stored in an <code>nvarchar(MAX)</code> field will be stored no different to 100 characters in an <code>nvarchar(100)</code> field - the data will be stored inline and you will not have the overhead of reading and writing data 'out of row'. So no worries there. </p></li>\n<li><p>If the size is greater than 4000 the data would be stored 'out of row' automatically, which is what you would want. So no worries there either. </p></li>\n</ol>\n\n<p>However...</p>\n\n<ol start=\"3\">\n<li>You cannot create an index on an <code>nvarchar(MAX)</code> column. You can use full-text indexing, but you cannot create an index on the column to improve query performance. For me, this seals the deal...it is a definite disadvantage to always use nvarchar(MAX).</li>\n</ol>\n    ","a":"\n<p>Same question was asked on MSDN Forums:</p>\n\n<ul>\n<li><a href=\"http://social.msdn.microsoft.com/Forums/en-US/sqlgetstarted/thread/4d9c6504-496e-45ba-a7a3-ed5bed731fcc\">Varchar(max) vs Varchar(255)</a></li>\n</ul>\n\n<p>From the original post (much more information there):</p>\n\n<blockquote>\n  <p>When you store data to a VARCHAR(N) column, the values are physically stored in the same way. But when you store it to a VARCHAR(MAX) column, behind the screen the data is handled as a TEXT value. So there is some additional processing needed when dealing with a VARCHAR(MAX) value. (only if the size exceeds 8000)</p>\n  \n  <p>VARCHAR(MAX) or NVARCHAR(MAX) is considered as a 'large value type'. Large value types are usually stored 'out of  row'. It means that the data row will have a pointer to another location where the 'large value' is stored...</p>\n</blockquote>\n    "},{"t":"Insert into a MySQL table or update if exists","l":"http://stackoverflow.com/questions/4205181/insert-into-a-mysql-table-or-update-if-exists","q":"\n\n<p>I want to add a row to a database table, but a row exists with the same unique key I want to update the row.</p>\n\n<p>For example,</p>\n\n<pre><code>insert into table (id, name, age) values(1, \"A\", 19)\n</code></pre>\n\n<p>Let’s say the unique key is <code>id</code> and in my database there is a row with <code>id = 1</code>. In that case, I want to update that row with these values. Normally this gives an error. If I use <code>insert IGNORE</code> it will ignore the error but still won’t update.</p>\n    ","a":"\n<p>Use <a href=\"http://dev.mysql.com/doc/refman/5.1/en/insert-on-duplicate.html\"><code>INSERT ... ON DUPLICATE KEY UPDATE</code></a></p>\n\n<p><strong>QUERY:</strong></p>\n\n<pre><code>INSERT INTO table (id, name, age) VALUES(1, \"A\", 19) ON DUPLICATE KEY UPDATE    \nname=VALUES(name), age=VALUES(age)\n</code></pre>\n    "},{"t":"Copy tables from one database to another in SQL Server","l":"http://stackoverflow.com/questions/187770/copy-tables-from-one-database-to-another-in-sql-server","q":"\n\n<p>I have a database called foo and a database called bar. I have a table in foo called tblFoobar that I want to move (data and all) to database bar from database foo. What is the SQL statement to do this?</p>\n    ","a":"\n<p>On SQL Server? and on the same database server? Use three part naming.</p>\n\n<pre><code>INSERT INTO bar..tblFoobar( *fieldlist* )\nSELECT *fieldlist* FROM foo..tblFoobar\n</code></pre>\n\n<p>This just moves the data.  If you want to move the table definition (and other attributes such as permissions and indexes), you'll have to do something else.</p>\n    "},{"t":"Full Outer Join in MySQL","l":"http://stackoverflow.com/questions/4796872/full-outer-join-in-mysql","q":"\n\n<p>I want to do a Full Outer Join in MySQL. Is this possible? Is a Full Outer Join supported by MySQL?</p>\n    ","a":"\n<p>You don't have FULL JOINS on MySQL, but you can sure <a href=\"http://dev.mysql.com/doc/refman/5.0/en/outer-join-simplification.html\">emulate them</a>.</p>\n\n<p>For a code SAMPLE transcribed from <a href=\"http://stackoverflow.com/questions/2384298/mysql-full-outer-join-syntax-error\">this SO question</a> you have:</p>\n\n<p>with two tables t1, t2:</p>\n\n<pre><code>SELECT * FROM t1\nLEFT JOIN t2 ON t1.id = t2.id\nUNION\nSELECT * FROM t1\nRIGHT JOIN t2 ON t1.id = t2.id\n</code></pre>\n    "},{"t":"SQL injection that gets around mysql_real_escape_string()","l":"http://stackoverflow.com/questions/5741187/sql-injection-that-gets-around-mysql-real-escape-string","q":"\n\n<p>Is there an SQL injection possibility even when using mysql_real_escape_string() function?</p>\n\n<p>Consider this sample situation. SQL is constructed in PHP like this:</p>\n\n<pre><code>$login = mysql_real_escape_string(GetFromPost('login'));\n$password = mysql_real_escape_string(GetFromPost('password'));\n\n$sql = \"SELECT * FROM table WHERE login='$login' AND password='$password'\";\n</code></pre>\n\n<p>I have heard numerous people say to me that a code like that is still dangerous and possible to hack even with mysql_real_escape_string() function used. But I cannot think of any possible exploit?</p>\n\n<p>Classic injections like this:</p>\n\n<pre><code>aaa' OR 1=1 --\n</code></pre>\n\n<p>do not work.</p>\n\n<p>Do you know of any possible injection that would get through the PHP code above?</p>\n    ","a":"\n<p>Consider the following query:</p>\n\n<pre><code>$iId = mysql_real_escape_string(\"1 OR 1=1\");    \n$sSql = \"SELECT * FROM table WHERE id = $iId\";\n</code></pre>\n\n<p><code>mysql_real_escape_string()</code> will not protect you against this.\nThe fact that you use single quotes (<code>' '</code>) around your variables inside your query is what protects you against this. The following is also an option:</p>\n\n<pre><code>$iId = (int) mysql_real_escape_string(\"1 OR 1=1\");\n$sSql = \"SELECT * FROM table WHERE id = $iId\";\n</code></pre>\n    "},{"t":"MySQL select 10 random rows from 600K rows fast","l":"http://stackoverflow.com/questions/4329396/mysql-select-10-random-rows-from-600k-rows-fast","q":"\n\n<p>How can I best write a query that selects 10 rows randomly from a total of 600k?</p>\n    ","a":"\n<p>A great post handling several cases, from simple, to gaps, to non-uniform with gaps.</p>\n\n<p><a href=\"http://jan.kneschke.de/projects/mysql/order-by-rand/\">http://jan.kneschke.de/projects/mysql/order-by-rand/</a></p>\n\n<p>For most general case, here is how you do it:</p>\n\n<pre><code>SELECT name\n  FROM random AS r1 JOIN\n       (SELECT CEIL(RAND() *\n                     (SELECT MAX(id)\n                        FROM random)) AS id)\n        AS r2\n WHERE r1.id &gt;= r2.id\n ORDER BY r1.id ASC\n LIMIT 1\n</code></pre>\n\n<p>This supposes that the distribution of ids is equal, and that there can be gaps in the id list. See the article for more advanced examples</p>\n    "},{"t":"How can an SQL query return data from multiple tables","l":"http://stackoverflow.com/questions/12475850/how-can-an-sql-query-return-data-from-multiple-tables","q":"\n\n<p>I would like to know the following:</p>\n\n<ul>\n<li>how to get data from multiple tables in my database?</li>\n<li>what types of methods are there to do this?</li>\n<li>what are joins and unions and how are they different from one another? </li>\n<li>When should I use each one compared to the others?</li>\n</ul>\n\n<p>I am planning to use this in my (for example - PHP) application, but don't want to run multiple queries against the database, what options do I have to get data from multiple tables in a single query?</p>\n\n<p>Note: I am writing this as I would like to be able to link to a well written guide on the numerous questions that I constantly come across in the PHP queue, so I can link to this for further detail when I post an answer.</p>\n\n<p>The answers cover off the following:</p>\n\n<ol>\n<li><a href=\"http://stackoverflow.com/questions/12475850/how-can-an-sql-query-return-data-from-multiple-tables/12475851#12475851\">Part 1 - Joins and Unions</a></li>\n<li><a href=\"http://stackoverflow.com/questions/12475850/how-can-an-sql-query-return-data-from-multiple-tables/12492267#12492267\">Part 2 - Subqueries</a></li>\n<li><a href=\"http://stackoverflow.com/questions/12475850/how-can-an-sql-query-return-data-from-multiple-tables/12508381#12508381\">Part 3 - Tricks and Efficient Code</a></li>\n<li><a href=\"http://stackoverflow.com/a/12542115/1450077\">Part 4 - Subqueries in the From Clause</a></li>\n<li><a href=\"http://stackoverflow.com/a/12586263/1450077\">Part 5 - Mixed Bag of John's Tricks</a></li>\n</ol>\n    ","a":"\n<h1>Part 1 - Joins and Unions</h1>\n\n<p>This answer covers:</p>\n\n<ol>\n<li>Part 1\n<ul>\n<li>Joining two or more tables using an inner join (See the <a href=\"http://en.wikipedia.org/wiki/Join_%28SQL%29\">wikipedia entry</a> for additional info)</li>\n<li>How to use a union query</li>\n<li>Left and Right Outer Joins (this <a href=\"http://stackoverflow.com/a/4715847/1450077\">stackOverflow answer</a> is excellent to describe types of joins)</li>\n<li>Intersect queries (and how to reproduce them if your database doesn't support them) - this is a function of SQL-Server (<a href=\"http://stackoverflow.com/questions/148795/what-is-the-standard-sql-query-to-retrieve-the-intersection-of-tables\">see info</a>) and part of the <a href=\"http://stackoverflow.com/questions/12443904/creating-query-that-returns-id-if-condition-is-matched-in-rows-from-two-tables/12455505#12455505\">reason I wrote this whole thing</a> in the first place.</li>\n</ul></li>\n<li>Part 2\n<ul>\n<li>Subqueries - what they are, where they can be used and what to watch out for</li>\n<li>Cartesian joins AKA - Oh, the misery!</li>\n</ul></li>\n</ol>\n\n<p>There are a number of ways to retrieve data from multiple tables in a database. In this answer, I will be using ANSI-92 join syntax. This may be different to a number of other tutorials out there which use the older ANSI-89 syntax (and if you are used to 89, may seem much less intuitive - but all I can say is to try it) as it is <em>much</em> easier to understand when the queries start getting more complex. Why use it? Is there a performance gain? The <a href=\"http://stackoverflow.com/questions/334201/why-isnt-sql-ansi-92-standard-better-adopted-over-ansi-89\">short answer</a> is no, but it <em>is</em> easier to read once you get used to it. It is easier to read queries written by other folks using this syntax.</p>\n\n<p>I am also going to use the concept of a small caryard which has a database to keep track of what cars it has available. The owner has hired you as his IT Computer guy and expects you to be able to drop him the data that he asks for at the drop of a hat.</p>\n\n<p>I have made a number of lookup tables that will be used by the final table. This will give us a reasonable model to work from. To start off, I will be running my queries against an example database that has the following structure. I will try to think of common mistakes that are made when starting out and explain what goes wrong with them - as well as of course showing how to correct them.</p>\n\n<p>The first table is simply a color listing so that we know what colors we have in the car yard.</p>\n\n<pre><code>mysql&gt; create table colors(id int(3) not null auto_increment primary key, \n    -&gt; color varchar(15), paint varchar(10));\nQuery OK, 0 rows affected (0.01 sec)\n\nmysql&gt; show columns from colors;\n+-------+-------------+------+-----+---------+----------------+\n| Field | Type        | Null | Key | Default | Extra          |\n+-------+-------------+------+-----+---------+----------------+\n| id    | int(3)      | NO   | PRI | NULL    | auto_increment |\n| color | varchar(15) | YES  |     | NULL    |                |\n| paint | varchar(10) | YES  |     | NULL    |                |\n+-------+-------------+------+-----+---------+----------------+\n3 rows in set (0.01 sec)\n\nmysql&gt; insert into colors (color, paint) values ('Red', 'Metallic'), \n    -&gt; ('Green', 'Gloss'), ('Blue', 'Metallic'), \n    -&gt; ('White' 'Gloss'), ('Black' 'Gloss');\nQuery OK, 5 rows affected (0.00 sec)\nRecords: 5  Duplicates: 0  Warnings: 0\n\nmysql&gt; select * from colors;\n+----+-------+----------+\n| id | color | paint    |\n+----+-------+----------+\n|  1 | Red   | Metallic |\n|  2 | Green | Gloss    |\n|  3 | Blue  | Metallic |\n|  4 | White | Gloss    |\n|  5 | Black | Gloss    |\n+----+-------+----------+\n5 rows in set (0.00 sec)\n</code></pre>\n\n<p>The brands table identifies the different brands of the cars out caryard could possibly sell.</p>\n\n<pre><code>mysql&gt; create table brands (id int(3) not null auto_increment primary key, \n    -&gt; brand varchar(15));\nQuery OK, 0 rows affected (0.01 sec)\n\nmysql&gt; show columns from brands;\n+-------+-------------+------+-----+---------+----------------+\n| Field | Type        | Null | Key | Default | Extra          |\n+-------+-------------+------+-----+---------+----------------+\n| id    | int(3)      | NO   | PRI | NULL    | auto_increment |\n| brand | varchar(15) | YES  |     | NULL    |                |\n+-------+-------------+------+-----+---------+----------------+\n2 rows in set (0.01 sec)\n\nmysql&gt; insert into brands (brand) values ('Ford'), ('Toyota'), \n    -&gt; ('Nissan'), ('Smart'), ('BMW');\nQuery OK, 5 rows affected (0.00 sec)\nRecords: 5  Duplicates: 0  Warnings: 0\n\nmysql&gt; select * from brands;\n+----+--------+\n| id | brand  |\n+----+--------+\n|  1 | Ford   |\n|  2 | Toyota |\n|  3 | Nissan |\n|  4 | Smart  |\n|  5 | BMW    |\n+----+--------+\n5 rows in set (0.00 sec)\n</code></pre>\n\n<p>The model table will cover off different types of cars, it is going to be simpler for this to use different car types rather than actual car models.</p>\n\n<pre><code>mysql&gt; create table models (id int(3) not null auto_increment primary key, \n    -&gt; model varchar(15));\nQuery OK, 0 rows affected (0.01 sec)\n\nmysql&gt; show columns from models;\n+-------+-------------+------+-----+---------+----------------+\n| Field | Type        | Null | Key | Default | Extra          |\n+-------+-------------+------+-----+---------+----------------+\n| id    | int(3)      | NO   | PRI | NULL    | auto_increment |\n| model | varchar(15) | YES  |     | NULL    |                |\n+-------+-------------+------+-----+---------+----------------+\n2 rows in set (0.00 sec)\n\nmysql&gt; insert into models (model) values ('Sports'), ('Sedan'), ('4WD'), ('Luxury');\nQuery OK, 4 rows affected (0.00 sec)\nRecords: 4  Duplicates: 0  Warnings: 0\n\nmysql&gt; select * from models;\n+----+--------+\n| id | model  |\n+----+--------+\n|  1 | Sports |\n|  2 | Sedan  |\n|  3 | 4WD    |\n|  4 | Luxury |\n+----+--------+\n4 rows in set (0.00 sec)\n</code></pre>\n\n<p>And finally, to tie up all these other tables, the table that ties everything together. The ID field is actually the unique lot number used to identify cars.</p>\n\n<pre><code>mysql&gt; create table cars (id int(3) not null auto_increment primary key, \n    -&gt; color int(3), brand int(3), model int(3));\nQuery OK, 0 rows affected (0.01 sec)\n\nmysql&gt; show columns from cars;\n+-------+--------+------+-----+---------+----------------+\n| Field | Type   | Null | Key | Default | Extra          |\n+-------+--------+------+-----+---------+----------------+\n| id    | int(3) | NO   | PRI | NULL    | auto_increment |\n| color | int(3) | YES  |     | NULL    |                |\n| brand | int(3) | YES  |     | NULL    |                |\n| model | int(3) | YES  |     | NULL    |                |\n+-------+--------+------+-----+---------+----------------+\n4 rows in set (0.00 sec)\n\nmysql&gt; insert into cars (color, brand, model) values (1,2,1), (3,1,2), (5,3,1), \n    -&gt; (4,4,2), (2,2,3), (3,5,4), (4,1,3), (2,2,1), (5,2,3), (4,5,1);\nQuery OK, 10 rows affected (0.00 sec)\nRecords: 10  Duplicates: 0  Warnings: 0\n\nmysql&gt; select * from cars;\n+----+-------+-------+-------+\n| id | color | brand | model |\n+----+-------+-------+-------+\n|  1 |     1 |     2 |     1 |\n|  2 |     3 |     1 |     2 |\n|  3 |     5 |     3 |     1 |\n|  4 |     4 |     4 |     2 |\n|  5 |     2 |     2 |     3 |\n|  6 |     3 |     5 |     4 |\n|  7 |     4 |     1 |     3 |\n|  8 |     2 |     2 |     1 |\n|  9 |     5 |     2 |     3 |\n| 10 |     4 |     5 |     1 |\n+----+-------+-------+-------+\n10 rows in set (0.00 sec)\n</code></pre>\n\n<p>This will give us enough data (I hope) to cover off the examples below of different types of joins and also give enough data to make them worthwhile.</p>\n\n<p>So getting into the grit of it, the boss wants to know <em>The IDs of all the sports cars he has</em>.</p>\n\n<p>This is a simple two table join. We have a table that identifies the model and the table with the available stock in it. As you can see, the data in the <code>model</code> column of the <code>cars</code> table relates to the <code>models</code> column of the <code>cars</code> table we have. Now, we know that the models table has an ID of <code>1</code> for <code>Sports</code> so lets write the join.</p>\n\n<pre><code>select\n    ID,\n    model\nfrom\n    cars\n        join models\n            on model=ID\n</code></pre>\n\n<p>So this query looks good right? We have identified the two tables and contain the information we need and use a join that correctly identifies what columns to join on.</p>\n\n<pre><code>ERROR 1052 (23000): Column 'ID' in field list is ambiguous\n</code></pre>\n\n<p>Oh noes! An error in our first query! Yes, and it is a plum. You see, the query has indeed got the right columns, but some of them exist in both tables, so the database gets confused about what actual column we mean and where. There are two solutions to solve this. The first is nice and simple, we can use <code>tableName.columnName</code> to tell the database exactly what we mean, like this:</p>\n\n<pre><code>select\n    cars.ID,\n    models.model\nfrom\n    cars\n        join models\n            on cars.model=models.ID\n\n+----+--------+\n| ID | model  |\n+----+--------+\n|  1 | Sports |\n|  3 | Sports |\n|  8 | Sports |\n| 10 | Sports |\n|  2 | Sedan  |\n|  4 | Sedan  |\n|  5 | 4WD    |\n|  7 | 4WD    |\n|  9 | 4WD    |\n|  6 | Luxury |\n+----+--------+\n10 rows in set (0.00 sec)\n</code></pre>\n\n<p>The other is probably more often used and is called table aliasing. The tables in this example have nice and short simple names, but typing out something like <code>KPI_DAILY_SALES_BY_DEPARTMENT</code> would probably get old quickly, so a simple way is to nickname the table like this:</p>\n\n<pre><code>select\n    a.ID,\n    b.model\nfrom\n    cars a\n        join models b\n            on a.model=b.ID\n</code></pre>\n\n<p>Now, back to the request. As you can see we have the information we need, but we also have information that wasn't asked for, so we need to include a where clause in the statement to only get the Sports cars as was asked. As I prefer the table alias method rather than using the table names over and over, I will stick to it from this point onwards.</p>\n\n<p>Clearly, we need to add a where clause to our query. We can identify Sports cars either by <code>ID=1</code> or <code>model='Sports'</code>. As the ID is indexed and the primary key (and it happens to be less typing), lets use that in our query.</p>\n\n<pre><code>select\n    a.ID,\n    b.model\nfrom\n    cars a\n        join models b\n            on a.model=b.ID\nwhere\n    b.ID=1\n\n+----+--------+\n| ID | model  |\n+----+--------+\n|  1 | Sports |\n|  3 | Sports |\n|  8 | Sports |\n| 10 | Sports |\n+----+--------+\n4 rows in set (0.00 sec)\n</code></pre>\n\n<p>Bingo! The boss is happy. Of course, being a boss and never being happy with what he asked for, he looks at the information, then says <em>I want the colors as well</em>.</p>\n\n<p>Okay, so we have a good part of our query already written, but we need to use a third table which is colors. Now, our main information table <code>cars</code> stores the car color ID and this links back to the colors ID column. So, in a similar manner to the original, we can join a third table:</p>\n\n<pre><code>select\n    a.ID,\n    b.model\nfrom\n    cars a\n        join models b\n            on a.model=b.ID\n        join colors c\n            on a.color=c.ID\nwhere\n    b.ID=1\n\n+----+--------+\n| ID | model  |\n+----+--------+\n|  1 | Sports |\n|  3 | Sports |\n|  8 | Sports |\n| 10 | Sports |\n+----+--------+\n4 rows in set (0.00 sec)\n</code></pre>\n\n<p>Damn, although the table was correctly joined and the related columns were linked, we forgot to pull in the actual <em>information</em> from the new table that we just linked.</p>\n\n<pre><code>select\n    a.ID,\n    b.model,\n    c.color\nfrom\n    cars a\n        join models b\n            on a.model=b.ID\n        join colors c\n            on a.color=c.ID\nwhere\n    b.ID=1\n\n+----+--------+-------+\n| ID | model  | color |\n+----+--------+-------+\n|  1 | Sports | Red   |\n|  8 | Sports | Green |\n| 10 | Sports | White |\n|  3 | Sports | Black |\n+----+--------+-------+\n4 rows in set (0.00 sec)\n</code></pre>\n\n<p>Right, that's the boss off our back for a moment. Now, to explain some of this in a little more detail. As you can see, the <code>from</code> clause in our statement links our main table (I often use a table that contains information rather than a lookup or dimension table. The query would work just as well with the tables all switched around, but make less sense when we come back to this query to read it in a few months time, so it is often best to try to write a query that will be nice and easy to understand - lay it out intuitively, use nice indenting so that everything is as clear as it can be. If you go on to teach others, try to instill these characteristics in their queries - especially if you will be troubleshooting them.</p>\n\n<p>It is entirely possible to keep linking more and more tables in this manner.</p>\n\n<pre><code>select\n    a.ID,\n    b.model,\n    c.color\nfrom\n    cars a\n        join models b\n            on a.model=b.ID\n        join colors c\n            on a.color=c.ID\n        join brands d\n            on a.brand=d.ID\nwhere\n    b.ID=1\n</code></pre>\n\n<p>While I forgot to include a table where we might want to join more than one column in the <code>join</code> statement, here is an example. If the <code>models</code> table had brand-specific models and therefore also had a column called <code>brand</code> which linked back to the <code>brands</code> table on the <code>ID</code> field, it could be done as this:</p>\n\n<pre><code>select\n    a.ID,\n    b.model,\n    c.color\nfrom\n    cars a\n        join models b\n            on a.model=b.ID\n        join colors c\n            on a.color=c.ID\n        join brands d\n            on a.brand=d.ID\n            and b.brand=d.ID\nwhere\n    b.ID=1\n</code></pre>\n\n<p>You can see, the query above not only links the joined tables to the main <code>cars</code> table, but also specifies joins between the already joined tables. If this wasn't done, the result is called a cartesian join - which is dba speak for bad. A cartesian join is one where rows are returned because the information doesn't tell the database how to limit the results, so the query returns <em>all</em> the rows that fit the criteria.</p>\n\n<p>So, to give an example of a cartesian join, lets run the following query:</p>\n\n<pre><code>select\n    a.ID,\n    b.model\nfrom\n    cars a\n        join models b\n\n+----+--------+\n| ID | model  |\n+----+--------+\n|  1 | Sports |\n|  1 | Sedan  |\n|  1 | 4WD    |\n|  1 | Luxury |\n|  2 | Sports |\n|  2 | Sedan  |\n|  2 | 4WD    |\n|  2 | Luxury |\n|  3 | Sports |\n|  3 | Sedan  |\n|  3 | 4WD    |\n|  3 | Luxury |\n|  4 | Sports |\n|  4 | Sedan  |\n|  4 | 4WD    |\n|  4 | Luxury |\n|  5 | Sports |\n|  5 | Sedan  |\n|  5 | 4WD    |\n|  5 | Luxury |\n|  6 | Sports |\n|  6 | Sedan  |\n|  6 | 4WD    |\n|  6 | Luxury |\n|  7 | Sports |\n|  7 | Sedan  |\n|  7 | 4WD    |\n|  7 | Luxury |\n|  8 | Sports |\n|  8 | Sedan  |\n|  8 | 4WD    |\n|  8 | Luxury |\n|  9 | Sports |\n|  9 | Sedan  |\n|  9 | 4WD    |\n|  9 | Luxury |\n| 10 | Sports |\n| 10 | Sedan  |\n| 10 | 4WD    |\n| 10 | Luxury |\n+----+--------+\n40 rows in set (0.00 sec)\n</code></pre>\n\n<p>Good god, that's ugly. However, as far as the database is concerned, it is <em>exactly</em> what was asked for. In the query, we asked for for the <code>ID</code> from <code>cars</code> and the <code>model</code> from <code>models</code>. However, because we didn't specify <em>how</em> to join the tables, the database has matched <em>every</em> row from the first table with <em>every</em> row from the second table.</p>\n\n<p>Okay, so the boss is back, and he wants more information again. <em>I want the same list, but also include 4WDs in it</em>.</p>\n\n<p>This however, gives us a great excuse to look at two different ways to accomplish this. We could add another condition to the where clause like this:</p>\n\n<pre><code>select\n    a.ID,\n    b.model,\n    c.color\nfrom\n    cars a\n        join models b\n            on a.model=b.ID\n        join colors c\n            on a.color=c.ID\n        join brands d\n            on a.brand=d.ID\nwhere\n    b.ID=1\n    or b.ID=3\n</code></pre>\n\n<p>While the above will work perfectly well, lets look at it differently, this is a great excuse to show how a <code>union</code> query will work.</p>\n\n<p>We know that the following will return all the Sports cars:</p>\n\n<pre><code>select\n    a.ID,\n    b.model,\n    c.color\nfrom\n    cars a\n        join models b\n            on a.model=b.ID\n        join colors c\n            on a.color=c.ID\n        join brands d\n            on a.brand=d.ID\nwhere\n    b.ID=1\n</code></pre>\n\n<p>And the following would return all the 4WDs:</p>\n\n<pre><code>select\n    a.ID,\n    b.model,\n    c.color\nfrom\n    cars a\n        join models b\n            on a.model=b.ID\n        join colors c\n            on a.color=c.ID\n        join brands d\n            on a.brand=d.ID\nwhere\n    b.ID=3\n</code></pre>\n\n<p>So by adding a <code>union all</code> clause between them, the results of the second query will be appended to the results of the first query.</p>\n\n<pre><code>select\n    a.ID,\n    b.model,\n    c.color\nfrom\n    cars a\n        join models b\n            on a.model=b.ID\n        join colors c\n            on a.color=c.ID\n        join brands d\n            on a.brand=d.ID\nwhere\n    b.ID=1\nunion all\nselect\n    a.ID,\n    b.model,\n    c.color\nfrom\n    cars a\n        join models b\n            on a.model=b.ID\n        join colors c\n            on a.color=c.ID\n        join brands d\n            on a.brand=d.ID\nwhere\n    b.ID=3\n\n+----+--------+-------+\n| ID | model  | color |\n+----+--------+-------+\n|  1 | Sports | Red   |\n|  8 | Sports | Green |\n| 10 | Sports | White |\n|  3 | Sports | Black |\n|  5 | 4WD    | Green |\n|  7 | 4WD    | White |\n|  9 | 4WD    | Black |\n+----+--------+-------+\n7 rows in set (0.00 sec)\n</code></pre>\n\n<p>As you can see, the results of the first query are returned first, followed by the results of the second query.</p>\n\n<p>In this example, it would of course have been much easier to simply use the first query, but <code>union</code> queries can be great for specific cases. They are a great way to return specific results from tables from tables that aren't easily joined together - or for that matter <em>completely</em> unrelated tables. There are a few rules to follow however.</p>\n\n<ul>\n<li>The column types from the first query must match the column types from every other query below.</li>\n<li>The names of the columns from the first query will be used to identify the entire set of results.</li>\n<li>The number of columns in each query must be the same.</li>\n</ul>\n\n<p>Now, you might <a href=\"http://stackoverflow.com/questions/49925/what-is-the-difference-between-union-and-union-all\">be wondering what the</a> difference is between using <code>union</code> and <code>union all</code>. A <code>union</code> query will remove duplicates, while a <code>union all</code> will not. This does mean that there is a small performance hit when using <code>union</code> over <code>union all</code> but the results may be worth it - I won't speculate on that sort of thing in this though.</p>\n\n<p>On this note, it might be worth noting some additional notes here.</p>\n\n<ul>\n<li>If we wanted to order the results, we can use an <code>order by</code> but you can't use the alias anymore. In the query above, appending an <code>order by a.ID</code> would result in an error - as far as the results are concerned, the column is called <code>ID</code> rather than <code>a.ID</code> - even though the same alias has been used in both queries.</li>\n<li>We can only have one <code>order by</code> statement, and it must be as the last statement.</li>\n</ul>\n\n<p>For the next examples, I am adding a few extra rows to our tables.</p>\n\n<p>I have added <code>Holden</code> to the brands table.\nI have also added a row into <code>cars</code> that has the <code>color</code> value of <code>12</code> - which has no reference in the colors table.</p>\n\n<p>Okay, the boss is back again, barking requests out - *I want a count of each brand we carry and the number of cars in it!` - Typical, we just get to an interesting section of our discussion and the boss wants more work.</p>\n\n<p>Rightyo, so the first thing we need to do is get a complete listing of possible brands.</p>\n\n<pre><code>select\n    a.brand\nfrom\n    brands a\n\n+--------+\n| brand  |\n+--------+\n| Ford   |\n| Toyota |\n| Nissan |\n| Smart  |\n| BMW    |\n| Holden |\n+--------+\n6 rows in set (0.00 sec)\n</code></pre>\n\n<p>Now, when we join this to our cars table we get the following result:</p>\n\n<pre><code>select\n    a.brand\nfrom\n    brands a\n        join cars b\n            on a.ID=b.brand\ngroup by\n    a.brand\n\n+--------+\n| brand  |\n+--------+\n| BMW    |\n| Ford   |\n| Nissan |\n| Smart  |\n| Toyota |\n+--------+\n5 rows in set (0.00 sec)\n</code></pre>\n\n<p>Which is of course a problem - we aren't seeing any mention of the lovely <code>Holden</code> brand I added.</p>\n\n<p>This is because a join looks for matching rows in <em>both</em> tables. As there is no data in cars that is of type <code>Holden</code> it isn't returned. This is where we can use an <code>outer</code> join. This will return <em>all</em> the results from one table whether they are matched in the other table or not:</p>\n\n<pre><code>select\n    a.brand\nfrom\n    brands a\n        left outer join cars b\n            on a.ID=b.brand\ngroup by\n    a.brand\n\n+--------+\n| brand  |\n+--------+\n| BMW    |\n| Ford   |\n| Holden |\n| Nissan |\n| Smart  |\n| Toyota |\n+--------+\n6 rows in set (0.00 sec)\n</code></pre>\n\n<p>Now that we have that, we can add a lovely aggregate function to get a count and get the boss off our backs for a moment.</p>\n\n<pre><code>select\n    a.brand,\n    count(b.id) as countOfBrand\nfrom\n    brands a\n        left outer join cars b\n            on a.ID=b.brand\ngroup by\n    a.brand\n\n+--------+--------------+\n| brand  | countOfBrand |\n+--------+--------------+\n| BMW    |            2 |\n| Ford   |            2 |\n| Holden |            0 |\n| Nissan |            1 |\n| Smart  |            1 |\n| Toyota |            5 |\n+--------+--------------+\n6 rows in set (0.00 sec)\n</code></pre>\n\n<p>And with that, away the boss skulks.</p>\n\n<p>Now, to explain this in some more detail, outer joins can be of the <code>left</code> or <code>right</code> type. The Left or Right defines which table is <em>fully</em> included. A <code>left outer join</code> will include all the rows from the table on the left, while (you guessed it) a <code>right outer join</code> brings all the results from the table on the right into the results.</p>\n\n<p>Some databases will allow a <code>full outer join</code> which will bring back results (whether matched or not) from <em>both</em> tables, but this isn't supported in all databases.</p>\n\n<p>Now, I probably figure at this point in time, you are wondering whether or not you can merge join types in a query - and the answer is yes, you absolutely can.</p>\n\n<pre><code>select\n    b.brand,\n    c.color,\n    count(a.id) as countOfBrand\nfrom\n    cars a\n        right outer join brands b\n            on b.ID=a.brand\n        join colors c\n            on a.color=c.ID\ngroup by\n    a.brand,\n    c.color\n\n+--------+-------+--------------+\n| brand  | color | countOfBrand |\n+--------+-------+--------------+\n| Ford   | Blue  |            1 |\n| Ford   | White |            1 |\n| Toyota | Black |            1 |\n| Toyota | Green |            2 |\n| Toyota | Red   |            1 |\n| Nissan | Black |            1 |\n| Smart  | White |            1 |\n| BMW    | Blue  |            1 |\n| BMW    | White |            1 |\n+--------+-------+--------------+\n9 rows in set (0.00 sec)\n</code></pre>\n\n<p>So, why is that not the results that were expected? It is because although we have selected the outer join from cars to brands, it wasn't specified in the join to colors - so that particular join will only bring back results that match in both tables.</p>\n\n<p>Here is the query that would work to get the results that we expected:</p>\n\n<pre><code>select\n    a.brand,\n    c.color,\n    count(b.id) as countOfBrand\nfrom\n    brands a\n        left outer join cars b\n            on a.ID=b.brand\n        left outer join colors c\n            on b.color=c.ID\ngroup by\n    a.brand,\n    c.color\n\n+--------+-------+--------------+\n| brand  | color | countOfBrand |\n+--------+-------+--------------+\n| BMW    | Blue  |            1 |\n| BMW    | White |            1 |\n| Ford   | Blue  |            1 |\n| Ford   | White |            1 |\n| Holden | NULL  |            0 |\n| Nissan | Black |            1 |\n| Smart  | White |            1 |\n| Toyota | NULL  |            1 |\n| Toyota | Black |            1 |\n| Toyota | Green |            2 |\n| Toyota | Red   |            1 |\n+--------+-------+--------------+\n11 rows in set (0.00 sec)\n</code></pre>\n\n<p>As we can see, we have two outer joins in the query and the results are coming through as expected.</p>\n\n<p>Now, how about those other types of joins you ask? What about Intersections?</p>\n\n<p>Well, not all databases support the <code>intersection</code> but pretty much all databases will allow you to create an intersection through a join (or a well structured where statement at the least).</p>\n\n<p>An Intersection is a type of join somewhat similar to a <code>union</code> as described above - but the difference is that it <em>only</em> returns rows of data that are identical (and I do mean identical) between the various individual queries joined by the union. Only rows that are identical in every regard will be returned.</p>\n\n<p>A simple example would be as such:</p>\n\n<pre><code>select\n    *\nfrom\n    colors\nwhere\n    ID&gt;2\nintersect\nselect\n    *\nfrom\n    colors\nwhere\n    id&lt;4\n</code></pre>\n\n<p>While a normal <code>union</code> query would return all the rows of the table (the first query returning anything over <code>ID&gt;2</code> and the second anything having <code>ID&lt;4</code>) which would result in a full set, an intersect query would only return the row matching <code>id=3</code> as it meets both criteria.</p>\n\n<p>Now, if your database doesn't support an <code>intersect</code> query, the above can be easily accomlished with the following query:</p>\n\n<pre><code>select\n    a.ID,\n    a.color,\n    a.paint\nfrom\n    colors a\n        join colors b\n            on a.ID=b.ID\nwhere\n    a.ID&gt;2\n    and b.ID&lt;4\n\n+----+-------+----------+\n| ID | color | paint    |\n+----+-------+----------+\n|  3 | Blue  | Metallic |\n+----+-------+----------+\n1 row in set (0.00 sec)\n</code></pre>\n\n<p>If you wish to perform an intersection across two different tables using a database that doesn't inherently support an intersection query, you will need to create a join on <em>every column</em> of the tables.</p>\n    "},{"t":"Hibernate show real SQL [duplicate]","l":"http://stackoverflow.com/questions/2536829/hibernate-show-real-sql","q":"\n\n<div class=\"question-status question-originals-of-duplicate\">\n    <p>This question already has an answer here:</p>\n    <ul>\n        <li>\n            <a href=\"/questions/1710476/print-query-string-in-hibernate-with-parameter-values\" dir=\"ltr\">Print query string in hibernate with parameter values</a>\n                <span class=\"question-originals-answer-count\">\n                    15 answers\n                </span>\n        </li>\n    </ul>\n</div>\n<p>if I set</p>\n\n<pre><code>&lt;property name=\"show_sql\"&gt;true&lt;/property&gt;\n</code></pre>\n\n<p>in my <strong>hibernate.cfg.xml</strong> configuration file in the console I can see the SQL.</p>\n\n<p>But it's not <em>real</em> SQL... Can I see the SQL code that will be passed directly to database?</p>\n\n<p>Example:</p>\n\n<p>I see </p>\n\n<pre><code>select this_.code from true.employee this_ where this_.code=?\n</code></pre>\n\n<p>Can I see</p>\n\n<pre><code>select employee.code from employee where employee.code=12\n</code></pre>\n\n<p>the <em>real</em> SQL?</p>\n    ","a":"\n<p><strong>log4j.properties</strong></p>\n\n<pre><code>log4j.logger.org.hibernate=INFO, hb\nlog4j.logger.org.hibernate.SQL=DEBUG\nlog4j.logger.org.hibernate.type=TRACE\nlog4j.logger.org.hibernate.hql.ast.AST=info\nlog4j.logger.org.hibernate.tool.hbm2ddl=warn\nlog4j.logger.org.hibernate.hql=debug\nlog4j.logger.org.hibernate.cache=info\nlog4j.logger.org.hibernate.jdbc=debug\n\nlog4j.appender.hb=org.apache.log4j.ConsoleAppender\nlog4j.appender.hb.layout=org.apache.log4j.PatternLayout\nlog4j.appender.hb.layout.ConversionPattern=HibernateLog --&gt; %d{HH:mm:ss} %-5p %c - %m%n\nlog4j.appender.hb.Threshold=TRACE\n</code></pre>\n\n<p><strong>hibernate.cfg.xml</strong></p>\n\n<pre><code>&lt;property name=\"show_sql\"&gt;true&lt;/property&gt;\n&lt;property name=\"format_sql\"&gt;true&lt;/property&gt;\n&lt;property name=\"use_sql_comments\"&gt;true&lt;/property&gt;\n</code></pre>\n    "},{"t":"SQL multiple column ordering","l":"http://stackoverflow.com/questions/2051162/sql-multiple-column-ordering","q":"\n\n<p>I am trying to sort by multiple columns in SQL, and in different directions. <code>column1</code> would be sorted descending, and <code>column2</code> ascending.</p>\n\n<p>How can I do this?</p>\n    ","a":"\n<pre><code>ORDER BY column1 DESC, column2\n</code></pre>\n    "},{"t":"Joins are for lazy people?","l":"http://stackoverflow.com/questions/5595418/joins-are-for-lazy-people","q":"\n\n<p>I recently had a discussion with another developer who claimed to me that JOINs (SQL) are useless. This is technically true but he added that using joins is less efficient than making several requests and link tables in the code (C# or Java). </p>\n\n<p>For him joins are for lazy people that don't care about performance. Is this true? Should we avoid using joins?</p>\n    ","a":"\n<p>No, we should avoid developers who hold such incredibly wrong opinions.</p>\n\n<p>In many cases, a database join is several orders of magnitude faster than anything done via the client, because it avoids DB roundtrips, and the DB can use indexes to perform the join.</p>\n\n<p><s>Off the top of my head, I can't even imagine a single scenario where a correctly used join would be slower than the equivalent client-side operation.</s></p>\n\n<p><strong>Edit:</strong> There are some rare cases where custom client code can do things more efficiently than a straightforward DB join (see comment by meriton). But this is very much the exception.</p>\n    "},{"t":"What is the best way to paginate results in SQL Server","l":"http://stackoverflow.com/questions/109232/what-is-the-best-way-to-paginate-results-in-sql-server","q":"\n\n<p>What is the best way (performance wise) to paginate results in SQL Server 2000, 2005, 2008, 2012 if you also want to get the total number of results (before paginating)?</p>\n    ","a":"\n<p>Getting the total number of results and paginating are two different operations. For the sake of this example, let's assume that the query you're dealing with is</p>\n\n<pre><code>SELECT * FROM Orders WHERE OrderDate &gt;= '1980-01-01' ORDER BY OrderDate\n</code></pre>\n\n<p>In this case, you would determine the total number of results using:</p>\n\n<pre><code>SELECT COUNT(*) FROM Orders WHERE OrderDate &gt;= '1980-01-01'\n</code></pre>\n\n<p>...which may seem inefficient, but is actually pretty performant, assuming all indexes etc. are properly set up.</p>\n\n<p>Next, to get actual results back in a paged fashion, the following query would be most efficient:</p>\n\n<pre><code>SELECT  *\nFROM    ( SELECT    ROW_NUMBER() OVER ( ORDER BY OrderDate ) AS RowNum, *\n          FROM      Orders\n          WHERE     OrderDate &gt;= '1980-01-01'\n        ) AS RowConstrainedResult\nWHERE   RowNum &gt;= 1\n    AND RowNum &lt; 20\nORDER BY RowNum\n</code></pre>\n\n<p>This will return rows 1-19 of the original query. The cool thing here, especially for web apps, is that you don't have to keep any state, except the row numbers to be returned.</p>\n    "},{"t":"Print query string in hibernate with parameter values","l":"http://stackoverflow.com/questions/1710476/print-query-string-in-hibernate-with-parameter-values","q":"\n\n<p>Is it possible in hibernate to print generated sql queries with real values instead of question marks?</p>\n\n<p>How would you suggest to print queries with real values if its not possible with hibernate api?</p>\n    ","a":"\n<p>You need to enable <a href=\"http://docs.jboss.org/hibernate/core/3.3/reference/en/html/session-configuration.html#configuration-logging\">logging</a> for the the following categories at <code>debug</code> and <code>trace</code> levels respectively:</p>\n\n<ul>\n<li><code>org.hibernate.SQL</code> &nbsp;&nbsp;- Log all SQL DML statements as they are executed</li>\n<li><code>org.hibernate.type</code> - Log all JDBC parameters</li>\n</ul>\n\n<p>So a log4j configuration could look like:</p>\n\n<pre><code># logs the SQL statements\nlog4j.logger.org.hibernate.SQL=debug \n\n# Logs the JDBC parameters passed to a query\nlog4j.logger.org.hibernate.type=trace \n</code></pre>\n\n<p>The first is equivalent to <code>hibernate.show_sql=true</code> legacy <a href=\"http://docs.jboss.org/hibernate/core/3.3/reference/en/html/session-configuration.html#configuration-optional\">property</a>, the second <strong>prints the bound parameters among other things.</strong></p>\n\n<p>Another solution (non hibernate based) would be to use a JDBC proxy driver like <a href=\"https://github.com/p6spy/p6spy\">P6Spy</a>.</p>\n    "},{"t":"How do I escape a single quote in SQL Server?","l":"http://stackoverflow.com/questions/1586560/how-do-i-escape-a-single-quote-in-sql-server","q":"\n\n<p>I'm trying to insert some text data into a table in SQL Server 9.</p>\n\n<p>The text includes a single quote.</p>\n\n<p>How do I escape that?</p>\n\n<p>I tried using two single quotes, but it threw me some errors.</p>\n\n<p>eg. <code>insert into my_table values('hi, my name''s tim.');</code></p>\n    ","a":"\n<p><strong>Single quotes are escaped by doubling them up</strong>, just as you've shown us in your example. The following SQL illustrates this functionality. I tested it on SQL Server 2008:</p>\n\n<pre><code>DECLARE @my_table TABLE (\n    [value] VARCHAR(200)\n)\n\nINSERT INTO @my_table VALUES ('hi, my name''s tim.')\n\nSELECT * FROM @my_table\n</code></pre>\n\n<h3>Results</h3>\n\n<pre><code>value\n==================\nhi, my name's tim.\n</code></pre>\n    "},{"t":"How to replace a string in a SQL Server Table Column","l":"http://stackoverflow.com/questions/814548/how-to-replace-a-string-in-a-sql-server-table-column","q":"\n\n<p>I have a table (SQL Sever) which references paths (UNC or otherwise), but now the path is going to change. In the path column, I have many records and I need to change just a portion of the path, but not the entire path. And I need to change the same string to the new one, in every record.</p>\n\n<p>How can I do this with a simple update?</p>\n    ","a":"\n<p>It's this easy:</p>\n\n<pre><code>update my_table\nset path = replace(path, 'oldstring', 'newstring')\n</code></pre>\n    "},{"t":"How to use GROUP BY to concatenate strings in MySQL?","l":"http://stackoverflow.com/questions/149772/how-to-use-group-by-to-concatenate-strings-in-mysql","q":"\n\n<p>Basically the question is how to get from this:</p>\n\n<pre>id    string\n1          A\n1          B\n2          C\n</pre>\n\n<p>to this:</p>\n\n<pre>id    string\n1          A B\n2          C\n</pre>\n    ","a":"\n<pre><code>SELECT id, GROUP_CONCAT(string SEPARATOR ' ') FROM table GROUP BY id;\n</code></pre>\n\n<p><a href=\"http://dev.mysql.com/doc/refman/5.0/en/group-by-functions.html#function_group-concat\">http://dev.mysql.com/doc/refman/5.0/en/group-by-functions.html#function_group-concat</a></p>\n    "},{"t":"How can I create a copy of an Oracle table without copying the data?","l":"http://stackoverflow.com/questions/233870/how-can-i-create-a-copy-of-an-oracle-table-without-copying-the-data","q":"\n\n<p>I know the statement:</p>\n\n<pre><code>create table xyz_new as select * from xyz;\n</code></pre>\n\n<p>Which copies the structure and the data, but what if I just want the structure?</p>\n    ","a":"\n<p>Just use a where clause that won't select any rows:</p>\n\n<pre><code>create table xyz_new as select * from xyz where 1=0;\n</code></pre>\n    "},{"t":"MySQL error: key specification without a key length","l":"http://stackoverflow.com/questions/1827063/mysql-error-key-specification-without-a-key-length","q":"\n\n<p>I have a table with a primary key that is a varchar(255). Some cases have arisen where 255 characters isn't enough. I tried changing the field to a text, but I get the following error:</p>\n\n<pre><code>BLOB/TEXT column 'message_id' used in key specification without a key length\n</code></pre>\n\n<p>how can I fix this?</p>\n\n<p>edit: I should also point out this table has a composite primary key with multiple columns.</p>\n    ","a":"\n<p>The error happens because MySQL can index only the first N chars of a BLOB or TEXT column. So The error mainly happen when there is a field/column type of TEXT or BLOB or those belongs to TEXT or BLOB types such as TINYBLOB, MEDIUMBLOB, LONGBLOB, TINYTEXT, MEDIUMTEXT, and LONGTEXT that you try to make as primary key or index. With full BLOB or TEXT without the length value, MySQL is unable to guarantee the uniqueness of the column as it’s of variable and dynamic size. So, when using BLOB or TEXT types as index, the value of N must be supplied so that MySQL can determine the key length. However, MySQL doesn’t support a key length limit on TEXT or BLOB. TEXT(88) simply won’t work.</p>\n\n<p>The error will also pop up when you try to convert a table column from non-TEXT and non-BLOB type such as VARCHAR and ENUM into TEXT or BLOB type, with the column already been defined as unique constraints or index. The Alter Table SQL command will fail.</p>\n\n<p>The solution to the problem is to remove the TEXT or BLOB column from the index or unique constraint, or set another field as primary key. If you can’t do that, and wanting to place a limit on the TEXT or BLOB column, try to use VARCHAR type and place a limit of length on it. By default, VARCHAR is limited to a maximum of 255 characters and its limit must be specified implicitly within a bracket right after its declaration, i.e VARCHAR(200) will limit it to 200 characters long only.</p>\n\n<p>Sometimes, even though you don’t use TEXT or BLOB related type in your table, the Error 1170 may also appear. It happens in situation such as when you specify VARCHAR column as primary key, but wrongly set its length or characters size. VARCHAR can only accepts up to 256 characters, so anything such as VARCHAR(512) will force MySQL to auto-convert the VARCHAR(512) to a SMALLTEXT datatype, which subsequently fail with error 1170 on key length if the column is used as primary key or unique or non-unique index. To solve this problem, specify a figure less than 256 as the size for VARCHAR field.</p>\n\n<p>Reference: <a href=\"http://www.mydigitallife.info/2007/07/09/mysql-error-1170-42000-blobtext-column-used-in-key-specification-without-a-key-length/\">MySQL Error 1170 (42000): BLOB/TEXT Column Used in Key Specification Without a Key Length</a></p>\n    "},{"t":"Selecting data from two different servers in SQL Server","l":"http://stackoverflow.com/questions/1144051/selecting-data-from-two-different-servers-in-sql-server","q":"\n\n<p>How can I select data in the same query from two different databases that are on two different servers in SQL Server?</p>\n    ","a":"\n<p>Yes you can.</p>\n\n<p>I think you're asking how, so I'll answer that.</p>\n\n<p>What you are looking for are Linked Servers. You can get to them in SSMS under </p>\n\n<p><code>Server Objects--&gt;Linked Servers</code></p>\n\n<p>or you can use <a href=\"http://msdn.microsoft.com/en-us/library/ms190479.aspx\">sp_addlinkedserver</a>.</p>\n\n<p>You only have to set up one. Once you have that, you can call a table on the other server like so:</p>\n\n<pre><code>select\n    *\nfrom\n    LocalTable,\n    [OtherServerName].[OtherDB].[dbo].[OtherTable]\n</code></pre>\n\n<p>Note that the owner isn't always <code>dbo</code>, so make sure to replace it with whatever schema you use.</p>\n    "},{"t":"Dynamic SELECT TOP @var In SQL Server","l":"http://stackoverflow.com/questions/175962/dynamic-select-top-var-in-sql-server","q":"\n\n<p>How can I have a dynamic variable setting the amount of rows to return in SQL Server? Below is not valid syntax in SQL Server 2005+:</p>\n\n<pre><code>DECLARE @count int\nSET @count = 20\n\nSELECT TOP @count * FROM SomeTable\n</code></pre>\n    ","a":"\n<pre><code>SELECT TOP (@count) * FROM SomeTable\n</code></pre>\n\n<p>This will only work with SQL 2005+</p>\n    "},{"t":"NOT IN clause and NULL values","l":"http://stackoverflow.com/questions/129077/not-in-clause-and-null-values","q":"\n\n<p>This issue came up when I got different records counts for what I thought were identical queries one using a <code>not in</code> <code>where</code> constraint and the other a <code>left join</code>. The table in the <code>not in</code> constraint had one null value (bad data) which caused that query to return a count of 0 records. I sort of understand why but I could use some help fully grasping the concept.</p>\n\n<p>To state it simply, why does query A return a result but B doesn't?</p>\n\n<pre><code>A: select 'true' where 3 in (1, 2, 3, null)\nB: select 'true' where 3 not in (1, 2, null)\n</code></pre>\n\n<p>This was on SQL Server 2005. I also found that calling <code>set ansi_nulls off</code> causes B to return a result.</p>\n    ","a":"\n<p>Query A is the same as:</p>\n\n<pre><code>select 'true' where 3 = 1 or 3 = 2 or 3 = 3 or 3 = null\n</code></pre>\n\n<p>Since <code>3 = 3</code> is true, you get a result.</p>\n\n<p>Query B is the same as:</p>\n\n<pre><code>select 'true' where 3 &lt;&gt; 1 and 3 &lt;&gt; 2 and 3 &lt;&gt; null\n</code></pre>\n\n<p>When <code>ansi_nulls</code> is on, <code>3 &lt;&gt; null</code> is UNKNOWN, so the predicate evaluates to UNKNOWN, and you don't get any rows.</p>\n\n<p>When <code>ansi_nulls</code> is off, <code>3 &lt;&gt; null</code> is true, so the predicate evaluates to true, and you get a row.</p>\n    "},{"t":"Difference between numeric,float and decimal in sql server","l":"http://stackoverflow.com/questions/1056323/difference-between-numeric-float-and-decimal-in-sql-server","q":"\n\n<p>I searched in google and also visited the</p>\n\n<p><a href=\"http://msdn.microsoft.com/en-us/library/aa258832%28SQL.80%29.aspx\">decimal and numeric</a>  and \n<a href=\"http://www.sql-server-helper.com/faq/data-types-p01.aspx\">SQL Server Helper</a></p>\n\n<p>to glean the difference between numeric , float and decimal datatypes and also to find out which one should be used in which situation.</p>\n\n<p>For any kind of financial transaction, which one is prefered and why? e.g. for salary field</p>\n    ","a":"\n<blockquote>\n  <p>use the <em>float</em> or <em>real</em> data types <strong>only if</strong> the precision provided by <em>decimal</em> (up to 38 digits) is insufficient</p>\n</blockquote>\n\n<ul>\n<li><p>Approximate numeric data types do not store the exact values specified <strong>for many</strong> numbers; they store <strong>an extremely close</strong> approximation of the value.(<a href=\"https://technet.microsoft.com/en-us/library/ms187912(v=sql.105).aspx\">Technet</a>)</p></li>\n<li><p>Avoid using float or real columns in WHERE clause search conditions, especially the = and &lt;&gt; operators (<a href=\"https://technet.microsoft.com/en-us/library/ms187912(v=sql.105).aspx\">Technet</a>)</p></li>\n</ul>\n\n<p>so generally because the <em>precision provided by decimal</em> is [10E38 ~ 38 digits] if your number can fit in it, and smaller storage space (and maybe speed) of Float is not important and dealing with abnormal behaviors and issues of approximate numeric types are not acceptable, <strong>use Decimal generally</strong>.</p>\n\n<p>more useful information </p>\n\n<ul>\n<li>numeric = decimal (5 to 17 bytes) (<strong>Exact</strong> Numeric Data Type)\n<ul>\n<li>will map to Decimal in .NET </li>\n<li>both have (18, 0) as default (precision,scale) parameters in SQL server</li>\n<li>scale = maximum number of decimal digits that can be stored to the right of the decimal point.</li>\n<li>kindly note that money(8 byte) and smallmoney(4 byte) are also exact and map to Decimal In .NET and have 4 decimal points(<a href=\"http://technet.microsoft.com/en-us/library/ms179882.aspx\">MSDN</a>)</li>\n<li><a href=\"http://msdn.microsoft.com/en-US/library/ms187746%28v=sql.105%29.aspx\">decimal and numeric (Transact-SQL) - MSDN</a></li>\n</ul></li>\n<li>real (4 byte) (<strong>Approximate</strong>  Numeric Data Type)\n<ul>\n<li>will map to Single in .NET</li>\n<li>The ISO synonym for real is float(24)</li>\n<li><a href=\"http://msdn.microsoft.com/en-US/library/ms173773%28v=sql.105%29.aspx\">float and real (Transact-SQL) - MSDN</a></li>\n</ul></li>\n<li>float (8 byte) (<strong>Approximate</strong>  Numeric Data Type)\n<ul>\n<li>will map to Double in .NET</li>\n</ul></li>\n<li>All <strong>exact</strong> numeric types always produce the same result, regardless of which kind\nof processor architecture is being used <strong>or the magnitude of the numbers</strong></li>\n<li>The parameter supplied to the float data type defines the number of bits that are\nused to store the <strong><a href=\"http://en.wikipedia.org/wiki/Significand\">mantissa</a> of the floating point number</strong>.</li>\n<li>Approximate Numeric Data Type usually uses less storage and have better speed (up to 20x) and you should also consider when they got converted in .NET \n<ul>\n<li><a href=\"http://stackoverflow.com/a/618543/184572\">What is the difference between Decimal, Float and Double in C#</a> </li>\n<li><a href=\"http://stackoverflow.com/a/329618/184572\">Decimal vs Double Speed</a></li>\n<li><a href=\"http://msdn.microsoft.com/en-us/library/cc716729.aspx\">SQL Server - .NET Data Type Mappings (From MSDN)</a></li>\n</ul></li>\n</ul>\n\n<p><img src=\"http://i.stack.imgur.com/HGYoK.png\" alt=\"Exact Numeric Data Types\">\n<img src=\"http://i.stack.imgur.com/O6ahT.png\" alt=\"Approximate Numeric Data Types\"></p>\n\n<p><strong>main source</strong> :  <a href=\"http://oreilly.com/catalog/9780735626393?cmp=ex-orm-books-msp-9780735626393\">MCTS Self-Paced Training Kit (Exam 70-433): Microsoft® SQL Server® 2008 Database Development</a>  - Chapter 3 - Tables , Data Types , and Declarative Data Integrity Lesson 1 - Choosing Data Types (Guidelines) - Page 93 </p>\n    "},{"t":"how to see active SQL Server connections?","l":"http://stackoverflow.com/questions/1248423/how-to-see-active-sql-server-connections","q":"\n\n<p>I am using SQL Server 2008 Enterprise. I want to see any active SQL Server connections, and the related information of all the connections, like from which IP address, connect to which DB or something.</p>\n\n<p>Any existing tools to solve this issue?</p>\n    ","a":"\n<p>You can use <a href=\"http://msdn.microsoft.com/en-us/library/ms174313.aspx\"><code>sp_who</code></a> stored procedure. </p>\n\n<blockquote>\n  <p>Provides information about current users, sessions, and processes in an instance of the Microsoft SQL Server Database Engine. The information can be filtered to return only those processes that are not idle, that belong to a specific user, or that belong to a specific session.</p>\n</blockquote>\n    "},{"t":"MySQL dump by query","l":"http://stackoverflow.com/questions/935556/mysql-dump-by-query","q":"\n\n<p>Is it possible to do <code>mysqldump</code> by single <code>SQL query</code>?</p>\n\n<p>I mean to dump the <strong>whole</strong> database, like <code>phpmyadmin</code> does when you do export to <code>SQL</code></p>\n    ","a":"\n<p>not mysqldump, but mysql cli...</p>\n\n<pre><code>mysql -e \"select * from myTable\" -u myuser -pxxxxxxxxx mydatabase\n</code></pre>\n\n<p>you can redirect it out to a file if you want :</p>\n\n<pre><code>mysql -e \"select * from myTable\" -u myuser -pxxxxxxxx mydatabase &gt; mydumpfile.txt\n</code></pre>\n\n<p>Update: \nOriginal post asked if he could dump from the database by query. What he asked and what he meant were different. He really wanted to just mysqldump all tables.</p>\n\n<pre><code>mysqldump --tables myTable --where=\"id &lt; 1000\"\n</code></pre>\n    "},{"t":"How to store decimal values in SQL Server?","l":"http://stackoverflow.com/questions/813287/how-to-store-decimal-values-in-sql-server","q":"\n\n<p>I'm trying to figure out decimal data type of a column in the SQL Server. I need to be able to store values like 15.5, 26.9, 24.7, 9.8, etc</p>\n\n<p>I assigned <code>decimal(18, 0)</code> to the column data type but this not allowing me to store these values. </p>\n\n<p>What is the right way to do this?</p>\n    ","a":"\n<p><code>DECIMAL(18,0)</code> will allow 0 digits after the decimal point.</p>\n\n<p>Use something like <code>DECIMAL(18,4)</code> instead that should do just fine!</p>\n\n<p>That gives you a <strong>total of 18 digits</strong>, 4 of which after the decimal point (and 14 before the decimal point). </p>\n    "},{"t":"SET versus SELECT when assigning variables?","l":"http://stackoverflow.com/questions/3945361/set-versus-select-when-assigning-variables","q":"\n\n<p>What are the differences between the <code>SET</code> and <code>SELECT</code> statements when assigning variables in T-SQL?</p>\n    ","a":"\n<p><a href=\"http://ryanfarley.com/blog/archive/2004/03/01/390.aspx\">Quote</a>, which summarizes from <a href=\"http://vyaskn.tripod.com/differences_between_set_and_select.htm\">this article</a>:</p>\n\n<blockquote>\n  <ol>\n  <li>SET is the ANSI standard for variable assignment, SELECT is not.</li>\n  <li>SET can only assign one variable at a time, SELECT can make multiple assignments at once.</li>\n  <li>If assigning from a query, SET can only assign a scalar value. If the query returns multiple values/rows then SET will raise an error. SELECT will assign one of the values to the variable and hide the fact that multiple values were returned (so you'd likely never know why something was going wrong elsewhere - have fun troubleshooting that one)</li>\n  <li>When assigning from a query if there is no value returned then SET will assign NULL, where SELECT will not make the assignment at all (so the variable will not be changed from it's previous value)</li>\n  <li>As far as speed differences - there are no direct differences between SET and SELECT. However SELECT's ability to make multiple assignments in one shot does give it a slight speed advantage over SET.</li>\n  </ol>\n</blockquote>\n    "},{"t":"Best way to select random rows PostgreSQL","l":"http://stackoverflow.com/questions/8674718/best-way-to-select-random-rows-postgresql","q":"\n\n<p>I want a random selection of rows in PostgreSQL, I tried this:</p>\n\n<pre><code>select * from table where random() &lt; 0.01;\n</code></pre>\n\n<p>But some other recommend this:</p>\n\n<pre><code>select * from table order by random() limit 1000;\n</code></pre>\n\n<p>I have a very large table with 500 Million rows, I want it to be fast.</p>\n\n<p>Which approach is better?  What are the differences?  What is the best way to select random rows?</p>\n    ","a":"\n<p>Given your specifications (plus additional info in the comments),</p>\n\n<ul>\n<li>You have a numeric <code>id</code> column with only few gaps.</li>\n<li>Obviously no or few write operations.</li>\n<li>Your <code>id</code> column has to be indexed! A primary key serves nicely.</li>\n</ul>\n\n<p>The query below is <em>much faster</em>. It does not need a sequential scan of the big table, only an index scan.</p>\n\n<p>First, get estimates for the main query:</p>\n\n<pre><code>SELECT count(*) AS ct              -- optional\n     , min(id)  AS min_id\n     , max(id)  AS max_id\n     , max(id) - min(id) AS id_span\nFROM   bigtbl;\n</code></pre>\n\n<p>The only moderately expensive part is the <code>count(*)</code>. Given above specifications, you don't need it. An estimate will do just fine, available at almost no cost (<a href=\"http://stackoverflow.com/questions/7943233/fast-way-to-discover-the-row-count-of-a-table/7945274#7945274\">detailed explanation here</a>):</p>\n\n<pre><code>SELECT reltuples AS ct FROM pg_class WHERE oid = 'schema_name.bigtbl'::regclass;\n</code></pre>\n\n<p>As long as <code>ct</code> is not smaller than <code>id_span</code> by orders of magnitude, the query will outperform other approaches.    </p>\n\n<pre><code>WITH params AS (\n    SELECT 1       AS min_id           -- minimum id &lt;= current min id\n         , 5100000 AS id_span          -- rounded up. (max_id - min_id + buffer)\n    )\nSELECT *\nFROM  (\n    SELECT p.min_id + trunc(random() * p.id_span)::integer AS id\n    FROM   params p\n          ,generate_series(1, 1100) g  -- 1000 + buffer\n    GROUP  BY 1                        -- trim duplicates\n    ) r\nJOIN   bigtbl USING (id)\nLIMIT  1000;                           -- trim surplus\n</code></pre>\n\n<ul>\n<li><p>Generate random numbers in the <code>id</code> space. You have \"few gaps\", so add 10 % (enough to easily cover the blanks) to the number of rows to retrieve.</p></li>\n<li><p>Each <code>id</code> can be picked multiple times by chance (though very unlikely with a big id space), so group the generated numbers (or use <code>DISTINCT</code>).</p></li>\n<li><p>Join the <code>id</code>s to the big table. This should be very fast with the index in place.</p></li>\n<li><p>Finally trim surplus <code>id</code>s that have not been eaten by dupes and gaps. Every row has a <strong>completely equal chance</strong> to be picked.</p></li>\n</ul>\n\n<h3>Short version</h3>\n\n<p>You can <strong>simplify</strong> this query. The CTE in the query above is just for educational purposes:</p>\n\n<pre><code>SELECT *\nFROM  (\n    SELECT DISTINCT 1 + trunc(random() * 5100000)::integer AS id\n    FROM   generate_series(1, 1100) g\n    ) r\nJOIN   bigtbl USING (id)\nLIMIT  1000;\n</code></pre>\n\n<h3>Possible alternative</h3>\n\n<p>IF your requirements allow <strong>identical sets for repeated</strong> calls (and we are talking about repeated calls) I would consider a <strong>materialized view</strong>. Execute above query once and write the result to a table. Users get a quasi random selection at lightening speed. Refresh your random pick at intervals or events of your choosing.</p>\n    "},{"t":"Select count(*) from multiple tables","l":"http://stackoverflow.com/questions/606234/select-count-from-multiple-tables","q":"\n\n<p>How can I select count(*) from two different tables (call them tab1 and tab2) having as result:</p>\n\n<pre><code>Count_1   Count_2\n123       456\n</code></pre>\n\n<p>? </p>\n\n<p>I've tried this:</p>\n\n<pre><code>select count(*) Count_1 from schema.tab1 union all select count(*) Count_2 from schema.tab2\n</code></pre>\n\n<p>But all I have is:</p>\n\n<pre><code>Count_1\n123\n456\n</code></pre>\n    ","a":"\n<pre><code>SELECT  (\n        SELECT COUNT(*)\n        FROM   tab1\n        ) AS count1,\n        (\n        SELECT COUNT(*)\n        FROM   tab2\n        ) AS count2\nFROM    dual\n</code></pre>\n    "},{"t":"What's the difference between HAVING and WHERE?","l":"http://stackoverflow.com/questions/287474/whats-the-difference-between-having-and-where","q":"\n\n<p>I must be googling in the wrong way or I'm having a stupid moment in time.</p>\n\n<p>What's the difference between <code>HAVING</code> and <code>WHERE</code> in an <code>SQL SELECT</code> statement?</p>\n\n<p>EDIT: I've marked Steven's answer as the correct one as it contained the key bit of information on the link:</p>\n\n<blockquote>\n  <p>When <code>GROUP BY</code> is not used, <code>HAVING</code> behaves like a <code>WHERE</code> clause</p>\n</blockquote>\n\n<p>The situation I had seen the <code>WHERE</code> in did not have <code>GROUP BY</code> and is where my confusion started. Of course, until you know this you can't specify it in the question.</p>\n\n<p>Many thanks for all the answers which were very enlightening.</p>\n    ","a":"\n<blockquote>\n  <p>HAVING specifies a search condition for a\n  group or an aggregate function used in SELECT statement.</p>\n</blockquote>\n\n<p><a href=\"http://blog.sqlauthority.com/2007/07/04/sql-server-definition-comparison-and-difference-between-having-and-where-clause/\">Source</a></p>\n    "},{"t":"import sql file from mysql console","l":"http://stackoverflow.com/questions/5152921/import-sql-file-from-mysql-console","q":"\n\n<p>I have a database `nitm`. I haven't created any tables there. But I have an sql file which contains all the necessary data for the database. The file is `nitm.sql` which is in `C:\\ drive`. This file has size of about 103M. I am using wamp server.</p>\n\n<p>I have used the following syntax in mysql console to import the file.</p>\n\n<pre><code>mysql&gt;c:/nitm.sql;\n</code></pre>\n\n<p>But this didn't work.</p>\n\n<p>Please help me with this.</p>\n    ","a":"\n<p>Finally, i solved the problem. I placed the `nitm.sql` file in `bin` file of the `mysql` folder and used the following syntax.</p>\n\n<pre><code>C:\\wamp\\bin\\mysql\\mysql5.0.51b\\bin&gt;mysql -u root nitm &lt; nitm.sql\n</code></pre>\n\n<p>And this worked.</p>\n    "},{"t":"Lightweight SQL editor for Eclipse [closed]","l":"http://stackoverflow.com/questions/3193850/lightweight-sql-editor-for-eclipse","q":"\n\n<p>Is there any simple SQL editor plugin for Eclipse?</p>\n\n<p>By simple I mean, the editor does <strong>NOT</strong> connect to any DB, does syntax highlighting and preferably formatting sql is a bonus.</p>\n    ","a":"\n<p>for reference to add sql syntax highlighting / coloring to eclipse\nyou can install <code>Data tools platform extender sdk</code> from \"install new software\", under <code>Database Development</code></p>\n\n<p>or enter site location directly\n<a href=\"http://download.eclipse.org/datatools/updates\">http://download.eclipse.org/datatools/updates</a></p>\n    "},{"t":"How to temporarily disable a foreign key constraint in MySQL?","l":"http://stackoverflow.com/questions/15501673/how-to-temporarily-disable-a-foreign-key-constraint-in-mysql","q":"\n\n<p>Is it possible to temporarily disable constraints in MySQL?</p>\n\n<p>I have two Django models, each with a ForeignKey to the other one. Deleting instances of a model returns an error because of the ForeignKey constraint:</p>\n\n<pre><code>cursor.execute(\"DELETE FROM myapp_item WHERE n = %s\", n)\ntransaction.commit_unless_managed()  #a foreign key constraint fails here\n\ncursor.execute(\"DELETE FROM myapp_style WHERE n = %s\", n)\ntransaction.commit_unless_managed()\n</code></pre>\n\n<p>Is it possible to temporarily disable constraints and delete anyway?</p>\n    ","a":"\n<p>Try <code>DISABLE KEYS</code> or    </p>\n\n<pre><code>SET FOREIGN_KEY_CHECKS=0;\n</code></pre>\n\n<p>make sure to</p>\n\n<pre><code>SET FOREIGN_KEY_CHECKS=1;\n</code></pre>\n\n<p>after.</p>\n    "},{"t":"How to do top 1 in Oracle?","l":"http://stackoverflow.com/questions/3451534/how-to-do-top-1-in-oracle","q":"\n\n<p>How to do this: </p>\n\n<pre><code>select top 1 Fname from MyTbl\n</code></pre>\n\n<p>In Oracle 11g?</p>\n    ","a":"\n<p>If you want just a first selected row you can:</p>\n\n<pre><code>select fname from MyTbl where rownum = 1\n</code></pre>\n\n<p>you can also use analytic functions to order and take the top x</p>\n\n<pre><code>select max(fname) over (rank() order by some_factor) from MyTbl\n</code></pre>\n    "},{"t":"SQL server query to get the list of columns in a table along with Data types, NOT NULL, and PRIMARY KEY constraints","l":"http://stackoverflow.com/questions/2418527/sql-server-query-to-get-the-list-of-columns-in-a-table-along-with-data-types-no","q":"\n\n<p>I need to write a query on SQL server to get the list of columns in a particular table, its associated data types and their length and if they are not null. I have managed to do this much. But now i also need to get in the same table against a column - TRUE if it is a primary key. How do i do this ? </p>\n\n<p>This is how the output should be:</p>\n\n<p><code>Columns_name----Data type----Length----isnull----Pk</code></p>\n\n<p>please help me!</p>\n    ","a":"\n<p>To avoid duplicate rows for some columns, use user_type_id instead of system_type_id.</p>\n\n<pre><code>SELECT \n    c.name 'Column Name',\n    t.Name 'Data type',\n    c.max_length 'Max Length',\n    c.precision ,\n    c.scale ,\n    c.is_nullable,\n    ISNULL(i.is_primary_key, 0) 'Primary Key'\nFROM    \n    sys.columns c\nINNER JOIN \n    sys.types t ON c.user_type_id = t.user_type_id\nLEFT OUTER JOIN \n    sys.index_columns ic ON ic.object_id = c.object_id AND ic.column_id = c.column_id\nLEFT OUTER JOIN \n    sys.indexes i ON ic.object_id = i.object_id AND ic.index_id = i.index_id\nWHERE\n    c.object_id = OBJECT_ID('YourTableName')\n</code></pre>\n\n<p>Just replace <code>YourTableName</code> with your actual table name - works for SQL Server 2005 and up.</p>\n    "},{"t":"ALTER DATABASE failed because a lock could not be placed on database","l":"http://stackoverflow.com/questions/4673065/alter-database-failed-because-a-lock-could-not-be-placed-on-database","q":"\n\n<p>I need to restart a database because some processes are not working. My plan is to take it offline and back online again.</p>\n\n<p>I am trying to do this in Sql Server Management Studio 2008:</p>\n\n<pre><code>use master;\ngo\nalter database qcvalues\nset single_user\nwith rollback immediate;\nalter database qcvalues\nset multi_user;\ngo\n</code></pre>\n\n<p>I am getting these errors:</p>\n\n<pre><code>Msg 5061, Level 16, State 1, Line 1\nALTER DATABASE failed because a lock could not be placed on database 'qcvalues'. Try again later.\nMsg 5069, Level 16, State 1, Line 1\nALTER DATABASE statement failed.\nMsg 5061, Level 16, State 1, Line 4\nALTER DATABASE failed because a lock could not be placed on database 'qcvalues'. Try again later.\nMsg 5069, Level 16, State 1, Line 4\nALTER DATABASE statement failed.\n</code></pre>\n\n<p>What am I doing wrong?</p>\n    ","a":"\n<p>After you get the error, run</p>\n\n<pre><code>EXEC sp_who2\n</code></pre>\n\n<p>Look for the database in the list.  It's possible that a connection was not terminated. If you find any connections to the database, run</p>\n\n<pre><code>KILL &lt;SPID&gt;\n</code></pre>\n\n<p>where <code>&lt;SPID&gt;</code> is the SPID for the sessions that are connected to the database.</p>\n\n<p>Try your script after all connections to the database are removed.</p>\n\n<p>Unfortunately, I don't have a reason why you're seeing the problem, but here is a link that shows that the problem has occurred elsewhere.</p>\n\n<p><a href=\"http://www.geakeit.co.uk/2010/12/11/sql-take-offline-fails-alter-database-failed-because-a-lock-could-not-error-5061/\">http://www.geakeit.co.uk/2010/12/11/sql-take-offline-fails-alter-database-failed-because-a-lock-could-not-error-5061/</a></p>\n    "},{"t":"How to see the values of a table variable at debug time in T-SQL?","l":"http://stackoverflow.com/questions/1900857/how-to-see-the-values-of-a-table-variable-at-debug-time-in-t-sql","q":"\n\n<p>Can we see the values (rows and cells) in a table valued variable in SQL Server Management Studio (SSMS) during debug time? If yes, how?</p>\n\n<p><img src=\"http://i.stack.imgur.com/7Ognh.png\" alt=\"enter image description here\"></p>\n    ","a":"\n<p>That's not yet implemented according this Microsoft Connect link:\n<a href=\"http://connect.microsoft.com/VisualStudio/feedback/details/334684/sql-debugging-all-about-tables-table-variables-temp-global-temp-source-input-and-output-tables\">Microsoft Connect</a></p>\n    "},{"t":"How to check if a stored procedure exists before creating it","l":"http://stackoverflow.com/questions/2072086/how-to-check-if-a-stored-procedure-exists-before-creating-it","q":"\n\n<p>I have a SQL script that has to be run every time a client executes the \"database management\" functionality. The script includes creating stored procedures on the client database.  Some of these clients might already have the stored procedure upon running the script, and some may not. I need to have the missing stored procedures added to the client database, but it doesn't matter how much I try to bend T-SQL syntax, I get</p>\n\n<blockquote>\n  <p><em>CREATE/ALTER PROCEDURE' must be the first statement in a query batch</em></p>\n</blockquote>\n\n<p>I've read that dropping before creating works, but I don't like doing it that way.</p>\n\n<pre><code>IF EXISTS (SELECT * FROM sys.objects WHERE type = 'P' AND name = 'MyProc')\nDROP PROCEDURE MyProc\nGO\n\nCREATE PROCEDURE MyProc\n...\n</code></pre>\n\n<p>How can I add check for the existence of a stored procedure and create it if it doesn't exist but alter it if it does exist?</p>\n    ","a":"\n<p>You can run procedural code anywhere you are able to run a query.</p>\n\n<p>Just copy everything after <code>AS</code>:</p>\n\n<pre><code>BEGIN\n    DECLARE @myvar INT\n    SELECT  *\n    FROM    mytable\n    WHERE   @myvar ...\nEND\n</code></pre>\n\n<p>This code does exactly same things a stored proc would do, but is not stored on the database side.</p>\n\n<p>That's much like what is called anonymous procedure in <code>PL/SQL</code>.</p>\n\n<p><strong>Update:</strong></p>\n\n<p>Your question title is a little bit confusing.</p>\n\n<p>If you only need to create a procedure if it not exists, then your code is just fine.</p>\n\n<p>Here's what <code>SSMS</code> outputs in the create script:</p>\n\n<pre><code>IF EXISTS ( SELECT  *\n            FROM    sys.objects\n            WHERE   object_id = OBJECT_ID(N'myproc')\n                    AND type IN ( N'P', N'PC' ) ) \nDROP …\nCREATE …\n</code></pre>\n    "},{"t":"Remove Primary Key in MySQL","l":"http://stackoverflow.com/questions/2111291/remove-primary-key-in-mysql","q":"\n\n<p>I have the following table schema which maps user_customers to permissions on a live MySQL database:</p>\n\n<pre><code>mysql&gt; describe user_customer_permission;\n+------------------+---------+------+-----+---------+----------------+\n| Field            | Type    | Null | Key | Default | Extra          |\n+------------------+---------+------+-----+---------+----------------+\n| id               | int(11) | NO   | PRI | NULL    | auto_increment |\n| user_customer_id | int(11) | NO   | PRI | NULL    |                |\n| permission_id    | int(11) | NO   | PRI | NULL    |                |\n+------------------+---------+------+-----+---------+----------------+\n3 rows in set (0.00 sec)\n</code></pre>\n\n<p>I would like to remove the primary keys for user_customer_id and permission_id and retain the primary key for id.</p>\n\n<p>When I run the command:</p>\n\n<pre><code>alter table user_customer_permission drop primary key;\n</code></pre>\n\n<p>I get the following error:</p>\n\n<pre><code>ERROR 1075 (42000): Incorrect table definition; there can be only one auto column and it must be defined as a key\n</code></pre>\n\n<p>How can I drop a column's primary key?</p>\n    ","a":"\n<p>Without an index, maintaining an autoincrement column becomes too expensive, that's why <code>MySQL</code> requires an autoincrement column to be a leftmost part of an index.</p>\n\n<p>You should remove the autoincrement property before dropping the key:</p>\n\n<pre><code>ALTER TABLE user_customer_permission MODIFY id INT NOT NULL;\nALTER TABLE user_customer_permission DROP PRIMARY KEY;\n</code></pre>\n\n<p>Note that you have a composite <code>PRIMARY KEY</code> which covers all three columns and <code>id</code> is not guaranteed to be unique.</p>\n\n<p>If it happens to be unique, you can make it to be a <code>PRIMARY KEY</code> and <code>AUTO_INCREMENT</code> again:</p>\n\n<pre><code>ALTER TABLE user_customer_permission MODIFY id INT NOT NULL PRIMARY KEY AUTO_INCREMENT;\n</code></pre>\n    "},{"t":"How to quickly edit values in table in SQL Server Management Studio?","l":"http://stackoverflow.com/questions/1535469/how-to-quickly-edit-values-in-table-in-sql-server-management-studio","q":"\n\n<p>Aside from context menu -&gt; \"Edit Top 200 Rows\" from Object Explorer, is there a quick way to open a table in Edit mode where I can just quickly modify the value of a cell?  </p>\n\n<p>I need to be able to page past the first 200 rows. And I dont want to write \"insert\" script for every minor tweak I need to do... I don't understand why SMS doesn't offer quick access to a paged table editor (like Navicat).</p>\n    ","a":"\n<p>In Mgmt Studio, when you are editing the top 200, you can view the SQL pane - either by right clicking in the grid and choosing Pane-&gt;SQL or by the button in the upper left.  This will allow you to write a custom query to drill down to the row(s) you want to edit.</p>\n\n<p>But ultimately mgmt studio isn't a data entry/update tool which is why this is a little cumbersome.</p>\n    "},{"t":"Changing the size of a column in SQL Server","l":"http://stackoverflow.com/questions/1320152/changing-the-size-of-a-column-in-sql-server","q":"\n\n<p>I'm trying to change the size of a column in sql server using:</p>\n\n<pre><code>ALTER TABLE [dbo].[Address]\nALTER COLUMN [Addr1] [nvarchar](80) NULL\n</code></pre>\n\n<p>where the length of Addr1 was originally 40. It failed, raising this error:</p>\n\n<pre><code>The object 'Address_e' is dependent on column 'Addr1'.\nALTER TABLE ALTER COLUMN Addr1 failed because one or more objects access \nthis column.\n</code></pre>\n\n<p>I've tried to read up on it and it seems that because some views are referencing this column and it seems that SQL Server is actually trying to drop the column that raised the error.</p>\n\n<p>Is there any other way I can change the size of the column?</p>\n    ","a":"\n<p>The views are probably created using the WITH SCHEMABINDING option and this means they are explicitly wired up to prevent such changes. Looks like the schemabinding worked and prevented you from breaking those views, lucky day, heh? Contact your database administrator and ask him to do the change, after it asserts the impact on the database.</p>\n\n<p>From <a href=\"http://msdn.microsoft.com/en-us/library/ms187956.aspx\">MSDN</a>:</p>\n\n<blockquote>\n  <p><strong>SCHEMABINDING</strong></p>\n  \n  <p>Binds the view to the schema of the underlying table or tables. When\n  SCHEMABINDING is specified, the base\n  table or tables cannot be modified in\n  a way that would affect the view\n  definition. <strong>The view definition itself\n  must first be modified or dropped</strong> to\n  remove dependencies on the table that\n  is to be modified.</p>\n</blockquote>\n    "},{"t":"Storing sex (gender) in database","l":"http://stackoverflow.com/questions/4175878/storing-sex-gender-in-database","q":"\n\n<p>I want to store a users gender in a database with as little (size/performance) cost as possible.</p>\n\n<p>So far, 3 scenarios come to mind</p>\n\n<ol>\n<li><strong>Int</strong> - <em>aligned with Enum in code (1 = Male, 2 = Female, 3 = Hopefully no need for this?)</em></li>\n<li><strong>char(1)</strong> - <em>Store <strong>m</strong> or <strong>f</strong></em></li>\n<li><strong>Bit</strong> <em>(boolean)</em> - <em>and call the column isMale (sorry ladies :p)?</em></li>\n</ol>\n\n<p><em>No sexist offense intended with option 3</em> :-)</p>\n\n<p><strong>The reason I ask</strong> is because of this <a href=\"http://stackoverflow.com/questions/204256/why-use-boolean-instead-of-char/204261#204261\">answer</a> which mentions that <strong>chars</strong> are <em>smaller</em> than <strong>booleans</strong>.</p>\n\n<p><strong>Edit</strong><br>\nI should clarify that I'm using MS SQL 2008, which <strong>DOES</strong> in fact have the bit datatype.</p>\n\n<p><strong>Edit #2</strong><br>\nA few funny answers around more than 2 genders and using the isMale column. I hope I don't get flagged for writing this but in our current (modern) society, I guess the most appropriate name for a boolean (gender) column would be <code>hasPenis</code>.</p>\n\n<p><strong>Edit #3</strong><br>\nTurns out this question is quite subjective since people have suggested all 3 options in their answers below. I'll let the community upvote what they think is the best solution, because I don't know which answer to accept yet.</p>\n\n<p><strong>Edit #4</strong><br>\nI'm starting to lean towards <strong>@OMG Ponies answer</strong>, mainly because he has higher Rep and a gold badge for the sql-server tag - it looks like he knows what he's talking about.<br>\nCome on people, <strong>vote</strong>! :)</p>\n    ","a":"\n<p>I'd call the column \"gender\".</p>\n\n<pre><code>Data Type   Bytes Taken          Number/Range of Values\n------------------------------------------------\nTinyINT     1                    255 (zero to 255)\nINT         4            -       2,147,483,648 to 2,147,483,647\nBIT         1 (2 if 9+ columns)  2 (0 and 1)\nCHAR(1)     1                    26 if case insensitive, 52 otherwise\n</code></pre>\n\n<p>If there's a need to support more than two genders, the <a href=\"http://msdn.microsoft.com/en-us/library/ms177603.aspx\">BIT</a> data type can be ruled out for the sake it can't support them.  While <a href=\"http://msdn.microsoft.com/en-us/library/ms187745.aspx\">INT</a> supports more than two options, it takes 4 bytes -- performance will be better with a smaller/more narrow data type.  </p>\n\n<p><code>CHAR(1)</code> has the edge over <a href=\"http://msdn.microsoft.com/en-us/library/ms187745.aspx\">TinyINT</a> - both take the same number of bytes, but CHAR provides a more narrow number of values.  Using <code>CHAR(1)</code> would make using \"m\", \"f\",etc natural keys, vs the use of numeric data which are referred to as surrogate/artificial keys.  <code>CHAR(1)</code> is also supported on any database, should there be a need to port.</p>\n\n<h2>Conclusion</h2>\n\n<p>I would use Option 2: CHAR(1).</p>\n\n<h2>Addendum</h2>\n\n<p>An index on the gender column likely would <strong><em>not</em></strong> help because there's no value in an index on a low cardinality column. Meaning, there's not enough variety in the values for the index to provide any value.</p>\n    "},{"t":"How to move columns in a MySQL table?","l":"http://stackoverflow.com/questions/6805426/how-to-move-columns-in-a-mysql-table","q":"\n\n<p>Currently I am having the following MySQL table: <code>Employees (empID, empName, department);</code></p>\n\n<p>I want to change the table to the following: <code>Employees (empID, department, empName);</code></p>\n\n<p>How can this be done using <code>ALTER</code> statements?</p>\n\n<p>Note: I want to change only column positions. </p>\n    ","a":"\n<p>If empName is a VARCHAR(50) column:</p>\n\n<pre><code>ALTER TABLE Employees MODIFY COLUMN empName VARCHAR(50) AFTER department;\n</code></pre>\n\n<p><strong>EDIT</strong></p>\n\n<p>Per the comments, you can also do this:</p>\n\n<pre><code>ALTER TABLE Employees CHANGE COLUMN empName empName VARCHAR(50) AFTER department;\n</code></pre>\n\n<p>Note that the repetition of <code>empName</code> is deliberate. You have to tell MySQL that you want to keep the same column name.</p>\n\n<p>You should be aware that both syntax versions are specific to MySQL. They won't work, for example, in PostgreSQL or many other DBMSs.</p>\n    "},{"t":"Efficiently convert rows to columns in sql server","l":"http://stackoverflow.com/questions/15745042/efficiently-convert-rows-to-columns-in-sql-server","q":"\n\n<p>I'm looking for an efficient way to convert rows to columns in SQL server, I heard that PIVOT is not very fast, and I need to deal with lot of records.</p>\n\n<p>This is my example:</p>\n\n<pre><code>Id  Value   ColumnName\n1   John    FirstName\n2   2.4     Amount\n3   ZH1E4A  PostalCode\n4   Fork    LastName\n5   857685  AccountNumber\n</code></pre>\n\n<p>This is my result:</p>\n\n<pre><code>FirstName   Amount  PostalCode      LastName    AccountNumber\nJohn        2.4     ZH1E4A          Fork        857685\n</code></pre>\n\n<p>How can I build the result?</p>\n    ","a":"\n<p>There are several ways that you can transform data from multiple rows into columns.  In SQL Server you can use the <code>PIVOT</code> function to transform the data from rows to columns:</p>\n\n<pre><code>select Firstname, Amount, PostalCode, LastName, AccountNumber\nfrom\n(\n  select value, columnname\n  from yourtable\n) d\npivot\n(\n  max(value)\n  for columnname in (Firstname, Amount, PostalCode, LastName, AccountNumber)\n) piv;\n</code></pre>\n\n<p>See <a href=\"http://sqlfiddle.com/#!3/c2312/1\">SQL Fiddle with Demo</a>.</p>\n\n<p>If you have an unknown number of <code>columnnames</code> that you want to transpose, then you can use dynamic SQL:</p>\n\n<pre><code>DECLARE @cols AS NVARCHAR(MAX),\n    @query  AS NVARCHAR(MAX)\n\nselect @cols = STUFF((SELECT ',' + QUOTENAME(ColumnName) \n                    from yourtable\n                    group by ColumnName, id\n                    order by id\n            FOR XML PATH(''), TYPE\n            ).value('.', 'NVARCHAR(MAX)') \n        ,1,1,'')\n\nset @query = N'SELECT ' + @cols + N' from \n             (\n                select value, ColumnName\n                from yourtable\n            ) x\n            pivot \n            (\n                max(value)\n                for ColumnName in (' + @cols + N')\n            ) p '\n\nexec sp_executesql @query;\n</code></pre>\n\n<p>See <a href=\"http://sqlfiddle.com/#!3/c2312/1039/0\">SQL Fiddle with Demo</a>.</p>\n\n<p>If you do not want to use the <code>PIVOT</code> function, then you can use an aggregate function with a <code>CASE</code> expression:</p>\n\n<pre><code>select\n  max(case when columnname = 'FirstName' then value end) Firstname,\n  max(case when columnname = 'Amount' then value end) Amount,\n  max(case when columnname = 'PostalCode' then value end) PostalCode,\n  max(case when columnname = 'LastName' then value end) LastName,\n  max(case when columnname = 'AccountNumber' then value end) AccountNumber\nfrom yourtable\n</code></pre>\n\n<p>See <a href=\"http://sqlfiddle.com/#!3/c2312/4\">SQL Fiddle with Demo</a>.</p>\n\n<p>This could also be completed using multiple joins, but you will need some column to associate each of the rows which you do not have in your sample data. But the basic syntax would be:</p>\n\n<pre><code>select fn.value as FirstName,\n  a.value as Amount,\n  pc.value as PostalCode,\n  ln.value as LastName,\n  an.value as AccountNumber\nfrom yourtable fn\nleft join yourtable a\n  on fn.somecol = a.somecol\n  and a.columnname = 'Amount'\nleft join yourtable pc\n  on fn.somecol = pc.somecol\n  and pc.columnname = 'PostalCode'\nleft join yourtable ln\n  on fn.somecol = ln.somecol\n  and ln.columnname = 'LastName'\nleft join yourtable an\n  on fn.somecol = an.somecol\n  and an.columnname = 'AccountNumber'\nwhere fn.columnname = 'Firstname'\n</code></pre>\n    "},{"t":"How to get first character of a string in SQL?","l":"http://stackoverflow.com/questions/792294/how-to-get-first-character-of-a-string-in-sql","q":"\n\n<p>I have a SQL column with length of 6. Now want to take only first char of that column. Is the any string function in SQL to do this?</p>\n    ","a":"\n<p><code>LEFT(colName, 1)</code> will also do this, also.  It's equivalent to <code>SUBSTRING(colName, 1, 1)</code>.  </p>\n\n<p>I like <code>LEFT</code>, since I find it a bit cleaner, but really, there's no difference either way.</p>\n    "},{"t":"How do I query for all dates greater than a certain date in SQL Server?","l":"http://stackoverflow.com/questions/10643379/how-do-i-query-for-all-dates-greater-than-a-certain-date-in-sql-server","q":"\n\n<p>I'm trying: </p>\n\n<pre><code>SELECT * \nFROM dbo.March2010 A\nWHERE A.Date &gt;= 2010-04-01;\n</code></pre>\n\n<p><code>A.Date</code> looks like: <code>2010-03-04 00:00:00.000</code></p>\n\n<p>However, this is not working. Can anyone provide a reference for why?</p>\n    ","a":"\n<pre><code>select *  \nfrom dbo.March2010 A \nwhere A.Date &gt;= Convert(datetime, '2010-04-01' )\n</code></pre>\n\n<p>In your query, <code>2010-4-01</code> is treated as a mathematical expression, so in essence it read </p>\n\n<pre><code>select *  \nfrom dbo.March2010 A \nwhere A.Date &gt;= 2005; \n</code></pre>\n\n<p>(<code>2010 minus 4 minus 1 is 2005</code>\nConverting it to a proper <code>datetime</code>, and using single quotes will fix this issue.)</p>\n\n<p>Technically, the parser might allow you to get away with</p>\n\n<pre><code>select *  \nfrom dbo.March2010 A \nwhere A.Date &gt;= '2010-04-01'\n</code></pre>\n\n<p>it will do the conversion for you, but in my opinion it is less readable than explicitly converting to a <code>DateTime</code> for the maintenance programmer that will come after you.</p>\n    "},{"t":"How do I spool to a CSV formatted file using SQLPLUS?","l":"http://stackoverflow.com/questions/643137/how-do-i-spool-to-a-csv-formatted-file-using-sqlplus","q":"\n\n<p>I want to extract some queries to a CSV output format. Unfortunately, I can't use any fancy SQL client or any language to do it. I must use SQLPLUS.</p>\n\n<p>How do I do it?</p>\n    ","a":"\n<p>You could also use the following, although it does introduce spaces between fields.</p>\n\n<pre><code>set colsep ,     -- separate columns with a comma\nset pagesize 0   -- No header rows\nset trimspool on -- remove trailing blanks\nset headsep off  -- this may or may not be useful...depends on your headings.\nset linesize X   -- X should be the sum of the column widths\nset numw X       -- X should be the length you want for numbers (avoid scientific notation on IDs)\n\nspool myfile.csv\n\nselect table_name, tablespace_name \n  from all_tables\n where owner = 'SYS'\n   and tablespace_name is not null;\n</code></pre>\n\n<p>Output will be like:</p>\n\n<pre><code>    TABLE_PRIVILEGE_MAP           ,SYSTEM                        \n    SYSTEM_PRIVILEGE_MAP          ,SYSTEM                        \n    STMT_AUDIT_OPTION_MAP         ,SYSTEM                        \n    DUAL                          ,SYSTEM \n...\n</code></pre>\n\n<p>This would be a lot less tedious than typing out all of the fields and concatenating them with the commas.  You could follow up with a simple sed script to remove whitespace that appears before a comma, if you wanted.</p>\n\n<p>Something like this might work...(my sed skills are very rusty, so this will likely need work)</p>\n\n<pre><code>sed 's/\\s+,/,/' myfile.csv \n</code></pre>\n    "},{"t":"What is the simplest SQL Query to find the second largest value?","l":"http://stackoverflow.com/questions/32100/what-is-the-simplest-sql-query-to-find-the-second-largest-value","q":"\n\n<p>What is the simplest SQL query to find the second largest integer value in a specific column? Of course there may be duplicate values in the column.</p>\n    ","a":"\n<pre><code>SELECT MAX( col )\n  FROM table\n WHERE col &lt; ( SELECT MAX( col )\n                 FROM table )\n</code></pre>\n    "},{"t":"What is the string concatenation operator in Oracle?","l":"http://stackoverflow.com/questions/278189/what-is-the-string-concatenation-operator-in-oracle","q":"\n\n<p>What is the string concatenation operator in Oracle SQL?  </p>\n\n<p>Are there any \"interesting\" features I should be careful of?  </p>\n\n<p>(This seems obvious, but I couldn't find a previous question asking it).  </p>\n    ","a":"\n<p>It is <code>||</code>, for example:</p>\n\n<pre><code>select 'Mr ' || ename from emp;\n</code></pre>\n\n<p>The only \"interesting\" feature I can think of is that <code>'x' || null</code> returns <code>'x'</code>, not <code>null</code> as you might perhaps expect.</p>\n    "},{"t":"'^M' character at end of lines","l":"http://stackoverflow.com/questions/64749/m-character-at-end-of-lines","q":"\n\n<p>When I run a particular SQL script in Unix environments, I'm am seeing a '^M' character at the end of each line of the SQL script as it is echoed to the command-line.  I don't know on which OS the SQL script was originally created.</p>\n\n<p>What is causing this and how do I fix it?</p>\n    ","a":"\n<p>It's caused by the DOS/Windows line-ending characters. Like Andy Whitfield said, the Unix command dos2unix will help fix the problem. If you want more information, you can read the man pages for that command.</p>\n    "},{"t":"How to use count and group by at the same select statement","l":"http://stackoverflow.com/questions/2722408/how-to-use-count-and-group-by-at-the-same-select-statement","q":"\n\n<p>I have an sql select query that has a group by. \nI want to count all the records after the group by statement. \nIs there a way for this directly from sql?\nFor example, having a table with users I want to select the different towns and the <b>total</b> number of users</p>\n\n<pre><code>select town, count(*) from user\ngroup by town\n</code></pre>\n\n<p>I want to have a column with all the towns and another with the number of users in all rows.</p>\n\n<p>An example of the result for having 3 towns and 58 users in total is :</p>\n\n<pre><code>Town         Count\nCopenhagen   58\nNewYork      58\nAthens       58\n</code></pre>\n    ","a":"\n<p>This will do what you want (list of towns, with the number of users in each):</p>\n\n<pre><code>select town, count(town) \nfrom user\ngroup by town\n</code></pre>\n\n<p>You can use most <a href=\"http://databases.about.com/od/sql/l/aaaggregate1.htm\">aggregate functions</a> when using <code>GROUP BY</code>.</p>\n\n<p><strong>Update</strong> (following change to question and comments)</p>\n\n<p>You can declare a variable for the number of users and set it to the number of users then select with that.</p>\n\n<pre><code>DECLARE @numOfUsers INT\nSET @numOfUsers = SELECT COUNT(*) FROM user\n\nSELECT DISTINCT town, @numOfUsers\nFROM user\n</code></pre>\n    "},{"t":"is of a type that is invalid for use as a key column in an index","l":"http://stackoverflow.com/questions/2863993/is-of-a-type-that-is-invalid-for-use-as-a-key-column-in-an-index","q":"\n\n<p>I have an error at</p>\n\n<pre><code>Column 'key' in table 'misc_info' is of a type that is invalid for use as a key column in an index.\n</code></pre>\n\n<p>where key is a nvarchar(max). A quick google <a href=\"http://www.kodyaz.com/forums/thread/3487.aspx\">found this</a>. It however doesnt explain  what a solution is. How do i create something like Dictionary where the key and value are both strings and obviously the key must be unique and is single. My sql statement was</p>\n\n<pre><code>create table [misc_info] (\n[id] INTEGER PRIMARY KEY IDENTITY NOT NULL,\n[key] nvarchar(max) UNIQUE NOT NULL,\n[value] nvarchar(max) NOT NULL);\n</code></pre>\n    ","a":"\n<p>A unique constraint can't be over 8000 bytes per row and will only use the first 900 bytes even then so the safest maximum size for your keys would be:</p>\n\n<pre><code>create table [misc_info]\n( \n    [id] INTEGER PRIMARY KEY IDENTITY NOT NULL, \n    [key] nvarchar(450) UNIQUE NOT NULL, \n    [value] nvarchar(max) NOT NULL\n)\n</code></pre>\n\n<p>i.e. the key can't be over 450 characters.  If can switch to varchar instead of nvarchar (e.g. if you don't need to store characters from more than one codepage) then that could increase to 900 characters.</p>\n    "},{"t":"Reason for Column is invalid in the select list because it is not contained in either an aggregate function or the GROUP BY clause [duplicate]","l":"http://stackoverflow.com/questions/13999817/reason-for-column-is-invalid-in-the-select-list-because-it-is-not-contained-in-e","q":"\n\n<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/4611897/group-by-aggregate-function-confusion-in-sql\">GROUP BY / aggregate function confusion in SQL</a>  </p>\n</blockquote>\n\n\n\n<p>I got an error - \nColumn 'Employee.EmpID' is invalid in the select list because it is not contained in either an aggregate function or the GROUP BY clause.</p>\n\n<hr>\n\n<pre><code>select loc.LocationID, emp.EmpID\nfrom Employee as emp full join Location as loc \non emp.LocationID = loc.LocationID\ngroup by loc.LocationID \n</code></pre>\n\n<p>This situation fits into the answer given by Bill Karwin.</p>\n\n<p>correction for above, fits into answer by ExactaBox - </p>\n\n<pre><code>select loc.LocationID, count(emp.EmpID) -- not count(*), don't want to count nulls\nfrom Employee as emp full join Location as loc \non emp.LocationID = loc.LocationID\ngroup by loc.LocationID \n</code></pre>\n\n<hr>\n\n<p>ORIGINAL QUESTION -</p>\n\n<p>For the SQL query -</p>\n\n<pre><code>select *\nfrom Employee as emp full join Location as loc \non emp.LocationID = loc.LocationID\ngroup by (loc.LocationID)\n</code></pre>\n\n<p>I don't understand why I get this error. All I want to do is join the tables and then group all the employees in a particular location together. </p>\n\n<p><strong>I think I have a partial explanation for my own question. Tell me if its ok -</strong> </p>\n\n<p>To group all employees that work in the same location we have to first mention the LocationID. </p>\n\n<p>Then, we cannot/do not mention each employee ID next to it. Rather, we mention the total number of employees in that location, ie we should SUM() the employees working in that location. Why do we do it the latter way, i am not sure. \nSo, this explains the \"it is not contained in either an aggregate function\" part of the error.</p>\n\n<p>What is the explanation for the \"GROUP BY clause\" part of the error ?</p>\n    ","a":"\n<p>Suppose I have the following table <code>T</code>:</p>\n\n<pre><code>a   b\n--------\n1   abc\n1   def\n1   ghi\n2   jkl\n2   mno\n2   pqr\n</code></pre>\n\n<p>And I do the following query:</p>\n\n<pre><code>SELECT a, b\nFROM T\nGROUP BY a\n</code></pre>\n\n<p>The output should have two rows, one row where a=1 and a second row where a=2.</p>\n\n<p>But what should the value of <em>b</em> show on each of these two rows?  There are three possibilities in each case, and nothing in the query makes it clear which value to choose for b in each group.  It's ambiguous.</p>\n\n<p>This demonstrates the <em>single-value rule</em>, which prohibits the undefined results you get when you run a GROUP BY query, and you include any columns in the select-list that are neither part of the grouping criteria, nor appear in aggregate functions (SUM, MIN, MAX, etc.).</p>\n\n<p>Fixing it might look like this:</p>\n\n<pre><code>SELECT a, MAX(b) AS x\nFROM T\nGROUP BY a\n</code></pre>\n\n<p>Now it's clear that you want the following result:</p>\n\n<pre><code>a   x\n--------\n1   ghi\n2   pqr\n</code></pre>\n    "},{"t":"altering a column to be nullable","l":"http://stackoverflow.com/questions/3556890/altering-a-column-to-be-nullable","q":"\n\n<p>I want to alter a table column to be nullable. I have used: </p>\n\n<pre><code>ALTER TABLE Merchant_Pending_Functions Modify NumberOfLocations NULL\n</code></pre>\n\n<p>This gives an error at <code>Modify</code>. Can someone tell me why? Please!! </p>\n    ","a":"\n<p>Assuming <code>SQL Server</code> (based on your previous questions):</p>\n\n<pre><code>ALTER TABLE Merchant_Pending_Functions ALTER COLUMN NumberOfLocations INT NULL\n</code></pre>\n\n<p>Replace <code>INT</code> with your actual datatype.</p>\n    "},{"t":"MySQL “between” clause not inclusive?","l":"http://stackoverflow.com/questions/5080824/mysql-between-clause-not-inclusive","q":"\n\n<p>If I run a query with a <code>between</code> clause, it seems to exclude the ending value.<br>\nFor example:</p>\n\n<pre><code>select * from person where dob between '2011-01-01' and '2011-01-31'\n</code></pre>\n\n<p>This gets all results with <code>dob</code> from '2011-01-01' till '2011-01-30'; skipping records where <code>dob</code> is '2011-01-31'. Can anyone explain why this query behaves this way, and how I could modify it to include records where <code>dob</code> is '2011-01-31'? (without adding 1 to the ending date because its been selected by the users.) Thanks in advance for any help.</p>\n    ","a":"\n<p>The field <code>dob</code> probably has a time component.</p>\n\n<p>To truncate it out:</p>\n\n<pre><code>select * from person \nwhere CAST(dob AS DATE) between '2011-01-01' and '2011-01-31'\n</code></pre>\n    "},{"t":"Entity Framework. Delete all rows in table","l":"http://stackoverflow.com/questions/15220411/entity-framework-delete-all-rows-in-table","q":"\n\n<p>How I can quickly remove all rows in table using Entity Framework?</p>\n\n<p>I am currently using:</p>\n\n<pre><code>var rows = from o in dataDb.Table\n           select o;\nforeach (var row in rows)\n{\n    dataDb.Table.Remove(row);\n}\ndataDb.SaveChanges();\n</code></pre>\n\n<p>However, it takes a long time to execute.</p>\n\n<p>Are there any alternatives?</p>\n    ","a":"\n<p>For those that are googling this and ended up here like me, this is how you currently do it in EF5 and EF6:</p>\n\n<pre><code>context.Database.ExecuteSqlCommand(\"TRUNCATE TABLE [TableName]\");\n</code></pre>\n\n<p>Assuming context is a <code>System.Data.Entity.DbContext</code></p>\n    "},{"t":"SQL Server indexes - ascending or descending, what difference does it make?","l":"http://stackoverflow.com/questions/743858/sql-server-indexes-ascending-or-descending-what-difference-does-it-make","q":"\n\n<p>When you create an index on a column or number of columns in MS SQL Server (I'm using version 2005), you can specify that the index on each column be either ascending or descending. I'm having a hard time understanding why this choice is even here. Using binary sort techniques, wouldn't a lookup be just as fast either way? What difference does it make which order I choose?</p>\n    ","a":"\n<p>This primarily matters when used with composite indexes:</p>\n\n<pre><code>CREATE INDEX ix_index ON mytable (col1, col2 DESC);\n</code></pre>\n\n<p>can be used for either:</p>\n\n<pre><code>SELECT  *\nFROM    mytable\nORDER BY\n        col1, col2 DESC\n</code></pre>\n\n<p>or:</p>\n\n<pre><code>SELECT  *\nFROM    mytable\nORDER BY\n        col1 DESC, col2\n</code></pre>\n\n<p>, but not for:</p>\n\n<pre><code>SELECT  *\nFROM    mytable\nORDER BY\n        col1, col2\n</code></pre>\n\n<p>An index on a single column can be efficiently used for sorting in both ways.</p>\n\n<p>See the article in my blog for details:</p>\n\n<ul>\n<li><a href=\"http://explainextended.com/2009/04/27/descending-indexes/\"><strong>Descending indexes</strong></a></li>\n</ul>\n\n<p><strong>Update:</strong></p>\n\n<p>In fact, this can matter even for a single column index, though it's not so obvious.</p>\n\n<p>Imagine an index on a column of a clustered table:</p>\n\n<pre><code>CREATE TABLE mytable (\n       pk INT NOT NULL PRIMARY KEY,\n       col1 INT NOT NULL\n)\nCREATE INDEX ix_mytable_col1 ON mytable (col1)\n</code></pre>\n\n<p>The index on <code>col1</code> keeps ordered values of <code>col1</code> along with the references to rows.</p>\n\n<p>Since the table is clustered, the references to rows are actually the values of the <code>pk</code>. They are also ordered within each value of <code>col1</code>.</p>\n\n<p>This means that that leaves of the index are actually ordered on <code>(col1, pk)</code>, and this query:</p>\n\n<pre><code>SELECT  col1, pk\nFROM    mytable\nORDER BY\n        col1, pk\n</code></pre>\n\n<p>needs no sorting.</p>\n\n<p>If we create the index as following:</p>\n\n<pre><code>CREATE INDEX ix_mytable_col1_desc ON mytable (col1 DESC)\n</code></pre>\n\n<p>, then the values of <code>col1</code> will be sorted descending, but the values of <code>pk</code> within each value of <code>col1</code> will be sorted ascending.</p>\n\n<p>This means that the following query:</p>\n\n<pre><code>SELECT  col1, pk\nFROM    mytable\nORDER BY\n        col1, pk DESC\n</code></pre>\n\n<p>can be served by <code>ix_mytable_col1_desc</code> but not by <code>ix_mytable_col1</code>.</p>\n\n<p>In other words, the columns that constitute a <code>CLUSTERED INDEX</code> on any table are always the trailing columns of any other index on that table.</p>\n    "},{"t":"MySQL 'create schema' and 'create database' - Is there any difference","l":"http://stackoverflow.com/questions/1219711/mysql-create-schema-and-create-database-is-there-any-difference","q":"\n\n<p>Taking a peak into the 'information_schema' database and peaking at the metadata for one of my pet projects, I'm having a hard time understanding what (if any) differences there are between the 'create schema' command and the 'create database' command for MySQL.</p>\n\n<p>Are there any differences? If not, is this a rather typical pattern of behavior for relational databases (I've heard that for other databases, such as Oracle, a schema exists in a database, rather than being on the same level as a database).</p>\n\n<p>Thanks!</p>\n    ","a":"\n<p>The <a href=\"http://dev.mysql.com/doc/refman/5.0/en/create-database.html\">documentation of MySQL says</a> : </p>\n\n<blockquote>\n  <p>CREATE DATABASE creates a database\n  with the given name. To use this\n  statement, you need the CREATE\n  privilege for the database. CREATE\n  SCHEMA is a synonym for CREATE\n  DATABASE as of MySQL 5.0.2.</p>\n</blockquote>\n\n<p>So, it would seem normal that those two instruction do the same.</p>\n    "},{"t":"I want to copy table contained from one database and insert onto another database table","l":"http://stackoverflow.com/questions/8754607/i-want-to-copy-table-contained-from-one-database-and-insert-onto-another-databas","q":"\n\n<p>I want to copy a table's schema as well as the data within that table to another database table in another database on a live server.  How could I do this?</p>\n    ","a":"\n<p>If you want to copy a table from one Database to another database , You can simply do as below.   </p>\n\n<pre><code>CREATE TABLE db2.table LIKE db1.table;\nINSERT INTO db2.table SELECT * FROM db1.table;\n</code></pre>\n    "},{"t":"SQL (MySQL) vs NoSQL (CouchDB)","l":"http://stackoverflow.com/questions/2559411/sql-mysql-vs-nosql-couchdb","q":"\n\n<p>I am in the middle of designing a highly-scalable application which must store a lot of data. Just for example it will store lots about users and then things like a lot of their messages, comments etc. I have always used MySQL before but now I am minded to try something new like couchdb or similar which is not SQL.</p>\n\n<p>Does anyone have any thoughts or guidance on this?</p>\n    ","a":"\n<p>Here's a quote from a recent <a href=\"http://www.25hoursaday.com/weblog/2010/03/29/TheNoSQLDebateAutomaticVsManualTransmission.aspx\">blog post from Dare Obasanjo</a>.</p>\n\n<blockquote>\n  <p>SQL databases are like automatic\n  transmission and NoSQL databases are\n  like manual transmission. Once you\n  switch to NoSQL, you become\n  responsible for a lot of work that the\n  system takes care of automatically in\n  a relational database system. Similar\n  to what happens when you pick manual\n  over automatic transmission. Secondly,\n  NoSQL allows you to eke more\n  performance out of the system by\n  eliminating a lot of integrity checks\n  done by relational databases from the\n  database tier. Again, this is similar\n  to how you can get more performance\n  out of your car by driving a manual\n  transmission versus an automatic\n  transmission vehicle.</p>\n  \n  <p>However the most notable similarity is\n  that just like most of us can’t really\n  take advantage of the benefits of a\n  manual transmission vehicle because\n  the majority of our driving is sitting\n  in traffic on the way to and from\n  work, there is a similar harsh reality\n  in that most sites aren’t at Google or\n  Facebook’s scale and thus have no need\n  for a Bigtable or Cassandra.</p>\n</blockquote>\n\n<p>To which I can add only that switching from MySQL, where you have at least some experience, to CouchDB, where you have no experience, means you will have to deal with a whole new set of problems and learn different concepts and best practices. While by itself this is wonderful (I am playing at home with MongoDB and like it a lot), it will be a cost that you need to calculate when estimating the work for that project, and brings unknown risks while promising unknown benefits. It will be very hard to judge if you can do the project on time and with the quality you want/need to be successful, if it's based on a technology you don't know.</p>\n\n<p>Now, if you have on the team an expert in the NoSQL field, then by all means take a good look at it. But without any expertise on the team, don't jump on NoSQL for a new commercial project.</p>\n\n<p><strong>Update</strong>: Just to throw some gasoline in the open fire you started, here are two interesting articles from people on the SQL camp. :-)</p>\n\n<p><a href=\"http://teddziuba.com/2010/03/i-cant-wait-for-nosql-to-die.html\">I Can't Wait for NoSQL to Die</a> (original article is gone, here's a <a href=\"http://www.memonic.com/user/dorian/folder/internet-tidbits/id/1HiG\">copy</a>)<br> \n<a href=\"http://www.yafla.com/dforbes/The_Impact_of_SSDs_on_Database_Performance_and_the_Performance_Paradox_of_Data_Explodification\">Fighting The NoSQL Mindset, Though This Isn't an anti-NoSQL Piece</a><br>\n<strong>Update</strong>: Well here is an interesting article about NoSQL<br>\n<a href=\"http://hebrayeem.blogspot.com/2014/01/making-sense-of-nosql.html\">Making Sense of NoSQL</a></p>\n    "},{"t":"How to put an 'if clause' in a SQL string?","l":"http://stackoverflow.com/questions/13991817/how-to-put-an-if-clause-in-a-sql-string","q":"\n\n<p>So here's what I want to do on my <em>MySQL</em> Database using <em>C#.NET</em>.</p>\n\n<p>I would like to:</p>\n\n<pre><code>SELECT * \n    FROM itemsOrdered\n    WHERE purchaseOrder_ID = '@purchaseOrdered_ID'\n        AND status = 'PENDING'\n</code></pre>\n\n<p>If that would not return any rows, which is possible through <code>if(dr.HasRows == false)</code>, I would now create an <code>UPDATE</code> the <code>purchaseOrder</code> database:</p>\n\n<pre><code>UPDATE purchaseOrder \n    SET purchaseOrder_status = 'COMPLETED'\n    WHERE purchaseOrder_ID = '@purchaseOrder_ID'\n</code></pre>\n\n<p>Any ideas how I would be able to make this process a little shorter?</p>\n    ","a":"\n<p>For your specific query, you can do:</p>\n\n<pre><code>UPDATE purchaseOrder\n    SET purchaseOrder_status = 'COMPLETED'\n    WHERE purchaseOrder_ID = '@purchaseOrder_ID' and\n          not exists (SELECT *\n                      FROM itemsOrdered WHERE purchaseOrder_ID = '@purchaseOrdered_ID' AND status = 'PENDING'\n                     )\n</code></pre>\n\n<p>However, I might guess that you are looping at a higher level.  To set all such values, try this:</p>\n\n<pre><code>UPDATE purchaseOrder\n    SET purchaseOrder_status = 'COMPLETED'\n    WHERE not exists (SELECT 1\n                      FROM itemsOrdered\n                      WHERE itemsOrdered.purchaseOrder_ID = purchaseOrder.purchaseOrdered_ID AND\n                            status = 'PENDING'\n                      limit 1\n                     )\n</code></pre>\n    "},{"t":"Difference between read commit and repeatable read","l":"http://stackoverflow.com/questions/4034976/difference-between-read-commit-and-repeatable-read","q":"\n\n<p>I think the above isolation levels are so alike. Could someone please describe with some nice examples what the main difference is ? </p>\n    ","a":"\n<p>Read committed is an isolation level that guarantees that any data read was <em>committed</em> at the moment is read. It simply restricts the reader from seeing any intermediate, uncommitted, 'dirty' read. IT makes no promise whatsoever that if the transaction re-issues the read, will find the <em>Same</em> data, data is free to change after it was read.</p>\n\n<p>Repeatable read is a higher isolation level, that in addition to the guarantees of the read committed level, it also guarantees that any data read <em>cannot change</em>, if the transaction reads the same data again, it will find the previously read data in place, unchanged, and available to read.</p>\n\n<p>The next isolation level, serializable, makes an even stronger guarantee: in addition to everything repeatable read guarantees, it also guarantees that <em>no <strong>new</strong> data</em> can be seen by a subsequent read.</p>\n\n<p>Say you have a table T with a column C with one row in it, say it has the value '1'. And consider you have a simple task like following:</p>\n\n<pre><code>BEGIN TRANSACTION;\nSELECT * FROM T;\nWAITFOR DELAY '00:01:00'\nSELECT * FROM T;\nCOMMIT;\n</code></pre>\n\n<p>That is  a simple task that issue two reads from table T, with a delay of 1 minute between them. </p>\n\n<ul>\n<li>under READ COMITTED, the second SELECT may return <em>any</em> data. A concurrent transaction may update the record, delete it, insert new records. The second select will always see the <em>new</em> data.</li>\n<li>under REPEATABLE READ the second SELECT is guaranteed to see the rows that has seen at first select <em>unchanged</em>. New rows may be added by a concurrent transaction in that one minute, but the existing rows cannot be deleted nor changed.</li>\n<li>under SERIALIZABLE reads the second select is guaranteed to see <em>exactly</em> the same rows as the first. No row can change, nor deleted, nor new rows could be inserted by a concurrent transaction.</li>\n</ul>\n\n<p>If you follow the logic above you can quickly realize that SERIALIZABLE transactions, while they may make life easy for you, are always <em>completely blocking</em> every possible concurrent operation, since they require than nobody can modify, delete nor insert any row. The default transaction isolationlevel of the .Net <code>System.Transactions</code> scope is serializable, and this usually explains the abysmal performance that results.</p>\n\n<p>And finally, there is also the SNAPSHOT isolation level. SNAPSHOT isolation level makes the same guarantees as serializable, but not by requiring that no concurrent transaction can modify the data, but by making every reader see it's own version of the world (it's own 'snapshot'). This makes it very easy to program against, very scalable as it does not block concurrent updates, but of course it has a price, and the price is extra server resource consumption. </p>\n\n<p>Supplemental reads:</p>\n\n<ul>\n<li><a href=\"http://msdn.microsoft.com/en-us/library/ms189122.aspx\">Isolation Levels in the Database Engine</a></li>\n<li><a href=\"http://msdn.microsoft.com/en-us/library/ms190805.aspx\">Concurrency Effects</a></li>\n<li><a href=\"http://msdn.microsoft.com/en-us/library/ms188277.aspx\">Choosing Row Versioning-based Isolation Levels</a></li>\n</ul>\n    "},{"t":"ALTER TABLE without locking the table?","l":"http://stackoverflow.com/questions/463677/alter-table-without-locking-the-table","q":"\n\n<p>When doing an ALTER TABLE statement in MySQL, the whole table is read-locked for the duration of the statement. If it's a big table, that means insert or update statements could be locked for a looooong time. Is there a way to do a \"hot alter\", like adding a column in such a way that the table is still updatable throughout the process?</p>\n\n<p>Mostly I'm interested in a solution for MySQL but I'd be interested in other RDBMS if MySQL can't do it.</p>\n\n<p>To clarify, my purpose is simply to avoid downtime when a new feature that requires an extra table column is pushed to production. Any database schema <em>will</em> change over time, that's just a fact of life. I don't see why we should accept that these changes must inevitably result in downtime; that's just weak.</p>\n    ","a":"\n<p>The only other option is to do manually what many RDBMS systems do anyway...<br>\n- Create a new table  </p>\n\n<p>You can then copy the contents of the old table over a chunk at a time.  Whilst always being cautious of any INSERT/UPDATE/DELETE on the source table.  (Could be managed by a trigger.  Although this would cause a slow down, it's not a lock...)</p>\n\n<p>Once finished, change the name of the source table, then change the name of the new table.  Preferably in a transaction.</p>\n\n<p>Once finished, recompile any stored procedures, etc that use that table.  The execution plans will likely no longer be valid.</p>\n\n<p><strong>EDIT:</strong></p>\n\n<p>Some comments have been made about this limitation being a bit poor.  So I thought I'd put a new perspective on it to show why it's how it is...</p>\n\n<ul>\n<li>Adding a new field is like changing one field on every row.  </li>\n<li>Field Locks would be much harder than Row locks, never mind table locks.<br>\n<br></li>\n<li>You're actually changing the physical structure on the disk, every record moves.  </li>\n<li>This really is like an UPDATE on the Whole table, but with more impact...  </li>\n</ul>\n    "},{"t":"postgreSQL group by different from mysql?","l":"http://stackoverflow.com/questions/1769361/postgresql-group-by-different-from-mysql","q":"\n\n<p>I've been migrating some of my mySQL queries to postgreSQL to use Heroku... most of my queries work fine, but I keep having a similar recurring error when I use group by:</p>\n\n<pre>ERROR:  column \"XYZ\" must appear in the GROUP BY clause or be used in an aggregate function\n</pre>\n\n<p>Could someone could tell me what I'm doing wrong?</p>\n\n<p>MySQL which works 100%:</p>\n\n<pre><code>SELECT `availables`.* FROM `availables` INNER JOIN `rooms` ON `rooms`.id = `availables`.room_id WHERE (rooms.hotel_id = 5056 AND availables.bookdate BETWEEN '2009-11-22' AND '2009-11-24') GROUP BY availables.bookdate ORDER BY availables.updated_at\n</code></pre>\n\n<p>PostgreSQL error:</p>\n\n<pre>ActiveRecord::StatementInvalid: PGError: ERROR:  column \"availables.id\" must appear in the GROUP BY clause or be used in an aggregate function\n: SELECT \"availables\".* FROM \"availables\"   INNER JOIN \"rooms\" ON \"rooms\".id = \"availables\".room_id  WHERE (rooms.hotel_id = 5056 AND availables.bookdate BETWEEN E'2009-10-21' AND E'2009-10-23')  GROUP BY availables.bookdate ORDER BY availables.updated_at\n</pre>\n\n<p>Ruby code generating the SQL:</p>\n\n<pre><code>expiration = Available.find(:all,\n    :joins =&gt; [ :room ],\n    :conditions =&gt; [ \"rooms.hotel_id = ? AND availables.bookdate BETWEEN ? AND ?\", hostel_id, date.to_s, (date+days-1).to_s ],\n    :group =&gt; 'availables.bookdate',\n    :order =&gt; 'availables.updated_at')  \n</code></pre>\n\n<p>Expected Output (from working mySQL query):</p>\n\n<pre>+-----+-------+-------+------------+---------+---------------+---------------+\n| id  | price | spots | bookdate   | room_id | created_at    | updated_at    |\n+-----+-------+-------+------------+---------+---------------+---------------+\n| 414 | 38.0  | 1     | 2009-11-22 | 1762    | 2009-11-20... | 2009-11-20... |\n| 415 | 38.0  | 1     | 2009-11-23 | 1762    | 2009-11-20... | 2009-11-20... |\n| 416 | 38.0  | 2     | 2009-11-24 | 1762    | 2009-11-20... | 2009-11-20... |\n+-----+-------+-------+------------+---------+---------------+---------------+\n3 rows in set\n</pre>\n    ","a":"\n<p>MySQL's totally non standards compliant GROUP BY can be emulated by Postgres' DISTINCT ON. Consider this :</p>\n\n<p>mysql : </p>\n\n<pre><code>SELECT a,b,c,d,e FROM table GROUP BY a\n</code></pre>\n\n<p>This delivers 1 row per value of a (which one, you don't really know). Well actually you can guess, because MySQL doesn't know about hash aggregates, so it will probably use a sort... but it will only sort on a, so the order of the rows could be random. Unless it uses a multicolumn index instead of sorting. Well, anyway, it's not specified by the query.</p>\n\n<p>postgres :</p>\n\n<pre><code>SELECT DISTINCT ON (a) a,b,c,d,e FROM table ORDER BY a,b,c\n</code></pre>\n\n<p>This delivers 1 row per value of a, this row will be the first one in the sort according to the ORDER BY specified by the query. Simple.</p>\n\n<p>Note that here, it's not an aggregate I'm computing. So GROUP BY actually makes no sense. DISTINCT ON makes a lot more sense.</p>\n\n<p>Rails is married to MySQL, so I'm not surprised that it generates SQL that doesn't work in postgres.</p>\n    "},{"t":"Do I need to create indexes on foreign keys?","l":"http://stackoverflow.com/questions/4127206/do-i-need-to-create-indexes-on-foreign-keys","q":"\n\n<p>I have a table <code>A</code> and a table <code>B</code>.  <code>A</code> has a foreign key to <code>B</code> on <code>B</code>'s primary key, <code>B_ID</code>.</p>\n\n<p>For some reason (I know there are legitimate reasons) it is not using an index when I join these two tables on the key.</p>\n\n<p>Do I need to separately create an index on <code>A.B_ID</code> or should the existence of a foreign key provide that?</p>\n    ","a":"\n<p>The foreign key constraint alone does not provide the index - one must (and should) be created. </p>\n    "},{"t":"Difference between Oracle's plus (+) notation and ansi JOIN notation?","l":"http://stackoverflow.com/questions/1193654/difference-between-oracles-plus-notation-and-ansi-join-notation","q":"\n\n<p>What's the difference between using oracle's plus notation <code>(+)</code> over the ansi standard <code>join</code> notation?</p>\n\n<p>Is there a difference in performance?</p>\n\n<p>Is the plus notation deprecated?</p>\n    ","a":"\n<p>AFAIK, the <code>(+)</code> notation is only present for backwards compatibility because Oracle debuted it before the ANSI standard for joins was put in place. It's specific to Oracle and you should avoid using it in new code when there's an equivalent standards-compliant version available.</p>\n\n<p><strong>Edit:</strong> *<em>It seems there are differences between the two, and the <code>(+)</code> notation has restrictions that the ANSI join syntax does not have. Oracle themselves recommend that you not use the <code>(+)</code> notation. \nFull description here in the <a href=\"http://download.oracle.com/docs/cd/B28359_01/server.111/b28286/queries006.htm\">Oracle® Database SQL Language Reference\n11g Release 1 (11.1)</a>:</em>*</p>\n\n<p>Oracle recommends that you use the <code>FROM</code> clause <code>OUTER JOIN</code> syntax rather than the Oracle join operator. Outer join queries that use the Oracle join operator <code>(+)</code> are subject to the following rules and restrictions, which do not apply to the <code>FROM</code> clause <code>OUTER JOIN</code> syntax:</p>\n\n<ul>\n<li>You cannot specify the <code>(+)</code> operator in a query block that also contains <code>FROM</code> clause join syntax.</li>\n<li>The <code>(+)</code> operator can appear only in the <code>WHERE</code> clause or, in the context of left-correlation (when specifying the <code>TABLE</code> clause) in the <code>FROM</code> clause, and can be applied only to a column of a table or view.</li>\n<li><p>If A and B are joined by multiple join conditions, then you must use the <code>(+)</code> operator in all of these conditions. If you do not, then Oracle Database will return only the rows resulting from a simple join, but without a warning or error to advise you that you do not have the results of an outer join.</p></li>\n<li><p>The <code>(+)</code> operator does not produce an outer join if you specify one table in the outer query and the other table in an inner query.</p></li>\n<li><p>You cannot use the <code>(+)</code> operator to outer-join a table to itself, although self joins are valid.</p></li>\n</ul>\n\n<p>For example, the following statement is not valid:</p>\n\n<pre><code>SELECT employee_id, manager_id\nFROM employees\nWHERE employees.manager_id(+) = employees.employee_id;\n</code></pre>\n\n<p>However, the following self join is valid:</p>\n\n<pre><code>SELECT e1.employee_id, e1.manager_id, e2.employee_id\nFROM employees e1, employees e2\nWHERE e1.manager_id(+) = e2.employee_id;\n</code></pre>\n\n<ul>\n<li><p>The <code>(+)</code> operator can be applied only to a column, not to an arbitrary expression. However, an arbitrary expression can contain one or more columns marked with the <code>(+)</code> operator.</p></li>\n<li><p>A <code>WHERE</code> condition containing the <code>(+)</code> operator cannot be combined with another condition using the <code>OR</code> logical operator.</p></li>\n<li><p>A <code>WHERE</code> condition cannot use the <code>IN</code> comparison condition to compare a column marked with the <code>(+)</code> operator with an expression.</p></li>\n</ul>\n\n<p>If the <code>WHERE</code> clause contains a condition that compares a column from table B with a constant, then the <code>(+)</code> operator must be applied to the column so that Oracle returns the rows from table A for which it has generated nulls for this column. Otherwise Oracle returns only the results of a simple join.</p>\n\n<p>In a query that performs outer joins of more than two pairs of tables, a single table can be the null-generated table for only one other table. For this reason, you cannot apply the <code>(+)</code> operator to columns of B in the join condition for A and B and the join condition for B and C. Refer to <code>SELECT</code> for the syntax for an outer join.</p>\n    "},{"t":"Sqlite: CURRENT_TIMESTAMP is in GMT, not the timezone of the machine","l":"http://stackoverflow.com/questions/381371/sqlite-current-timestamp-is-in-gmt-not-the-timezone-of-the-machine","q":"\n\n<p>I have a sqlite (v3) table with this column definition:</p>\n\n<pre><code>\"timestamp\" DATETIME DEFAULT CURRENT_TIMESTAMP\n</code></pre>\n\n<p>The server that this database lives on is in the CST time zone.  When I insert into my table without including the timestamp column, sqlite automatically populates that field with the current timestamp in GMT, not CST.</p>\n\n<p>Is there a way to modify my insert statement to force the stored timestamp to be in CST?  On the other hand, it is probably better to store it in GMT (in case the database gets moved to a different timezone, for example), so is there a way I can modify my select SQL to convert the stored timestamp to CST when I extract it from the table?</p>\n    ","a":"\n<p>I found on the sqlite wiki (<a href=\"http://www.sqlite.org/cvstrac/wiki?p=DateAndTimeFunctions\">http://www.sqlite.org/cvstrac/wiki?p=DateAndTimeFunctions</a>) this text:</p>\n\n<blockquote>\n  <p>Compute the date and time given a unix\n  timestamp 1092941466, and compensate\n  for your local timezone.</p>\n</blockquote>\n\n<pre><code>SELECT datetime(1092941466, 'unixepoch', 'localtime');\n</code></pre>\n\n<p>That didn't look like it fit my needs, so I tried changing the \"datetime\" function around a bit, and wound up with this:</p>\n\n<pre><code>select datetime(timestamp, 'localtime')\n</code></pre>\n\n<p>That seems to work - is that the correct way to convert for your timezone, or is there a better way to do this?</p>\n    "},{"t":"Left Outer Join using + sign in Oracle 11g","l":"http://stackoverflow.com/questions/6559261/left-outer-join-using-sign-in-oracle-11g","q":"\n\n<p>Can any one tell me whether below 2 queries are an example of Left Outer Join or Right Outer Join??</p>\n\n<pre><code>Table Part:\nName         Null?       Type\nPART_ID      NOT NULL    VARCHAR2(4)\nSUPPLIER_ID              VARCHAR2(4)\n\nPART_ID SUPPLIER_ID\nP1      S1\nP2      S2\nP3  \nP4  \n\nTable Supplier:\nName            Null?     Type\nSUPPLIER_ID NOT NULL      VARCHAR2(4)\nSUPPLIER_NAME   NOT NULL  VARCHAR2(20)\n\nSUPPLIER_ID  SUPPLIER_NAME\nS1           Supplier#1\nS2           Supplier#2\nS3           Supplier#3\n</code></pre>\n\n<p>Display all the parts irrespective of whether any supplier supplies them or not:</p>\n\n<pre>SELECT P.Part_Id, S.Supplier_Name\nFROM Part P, Supplier S\nWHERE P.Supplier_Id = S.Supplier_Id (+)\n\nSELECT P.Part_Id, S.Supplier_Name\nFROM Part P, Supplier S\nWHERE S.Supplier_Id (+) = P.Supplier_Id\n</pre>\n\n<p>Thanks!</p>\n    ","a":"\n<p><code>TableA LEFT OUTER JOIN TableB</code> is equivalent to <code>TableB RIGHT OUTER JOIN Table A</code>.</p>\n\n<p>In Oracle, <code>(+)</code> denotes the \"optional\" table in the JOIN. So in your first query, it's a <code>P LEFT OUTER JOIN S</code>. In your second query, it's <code>S RIGHT OUTER JOIN P</code>. <strong>They're functionally equivalent.</strong></p>\n\n<p>In the terminology, RIGHT or LEFT specify which side of the join always has a record, and the other side might be null. So in a <code>P LEFT OUTER JOIN S</code>, <code>P</code> will always have a record because it's on the <code>LEFT</code>, but <code>S</code> could be null.</p>\n\n<p>See <a href=\"http://www.java2s.com/Tutorial/Oracle/0140__Table-Joins/LeftandRightOuterJoins.htm\">this example from java2s.com</a> for additional explanation.</p>\n\n<hr>\n\n<p>To clarify, I guess I'm saying that terminology doesn't matter, as it's only there to help visualize. What matters is that you understand the concept of how it works.</p>\n\n<hr>\n\n<h3>RIGHT vs LEFT</h3>\n\n<p>I've seen some confusion about what matters in determining RIGHT vs LEFT in implicit join syntax.</p>\n\n<p>LEFT OUTER JOIN</p>\n\n<pre><code>SELECT *\nFROM A, B\nWHERE A.column = B.column(+)\n</code></pre>\n\n<p>RIGHT OUTER JOIN</p>\n\n<pre><code>SELECT *\nFROM A, B\nWHERE B.column(+) = A.column\n</code></pre>\n\n<p>All I did is swap sides of the terms in the WHERE clause, but they're still functionally equivalent. (See higher up in my answer for more info about that.) The placement of the <code>(+)</code> determines RIGHT or LEFT. (Specifically, if the <code>(+)</code> is on the right, it's a LEFT JOIN. If <code>(+)</code> is on the left, it's a RIGHT JOIN.)</p>\n\n<hr>\n\n<h3>Types of JOIN</h3>\n\n<p>The two styles of JOIN are <em>implicit JOINs</em> and <em>explicit JOINs</em>. They are different styles of writing JOINs, but they are functionally equivalent.</p>\n\n<p>See <a href=\"http://stackoverflow.com/questions/44917/explicit-vs-implicit-sql-joins\">this SO question</a>.</p>\n\n<p><em>Implicit JOINs</em> simply list all tables together. The join conditions are specified in a WHERE clause.</p>\n\n<p><em>Implicit JOIN</em></p>\n\n<pre><code>SELECT *\nFROM A, B\nWHERE A.column = B.column(+)\n</code></pre>\n\n<p><em>Explicit JOINs</em> associate join conditions with a specific table's inclusion instead of in a WHERE clause.</p>\n\n<p><em>Explicit JOIN</em></p>\n\n<pre><code>SELECT *\nFROM A\nLEFT OUTER JOIN B ON A.column = B.column\n</code></pre>\n\n<p>These \nImplicit JOINs can be more difficult to read and comprehend, and they also have a few limitations since the join conditions are mixed in other WHERE conditions. As such, implicit JOINs are generally recommended against in favor of explicit syntax.</p>\n    "},{"t":"Primary key or Unique index?","l":"http://stackoverflow.com/questions/487314/primary-key-or-unique-index","q":"\n\n<p>At work we have a big database with unique indexes instead of primary keys and all works fine.</p>\n\n<p>I'm designing new database for a new project and I have a dilemma:</p>\n\n<p>In DB theory, primary key is fundamental element, that's OK, but in REAL projects what are advantages and disadvantages of both?</p>\n\n<p>What do you use in projects?</p>\n\n<p><strong>EDIT:</strong> ...and what about primary keys and replication on MS SQL server?</p>\n    ","a":"\n<p><strong>What is a unique index?</strong></p>\n\n<p>A unique index on a column is an index on that column that also enforces the constraint that you cannot have two equal values in that column in two different rows. Example:</p>\n\n<pre>CREATE TABLE table1 (foo int, bar int);\nCREATE UNIQUE INDEX ux_table1_foo ON table1(foo);  -- Create unique index on foo.\n\nINSERT INTO table1 (foo, bar) VALUES (1, 2); -- OK\nINSERT INTO table1 (foo, bar) VALUES (2, 2); -- OK\nINSERT INTO table1 (foo, bar) VALUES (3, 1); -- OK\nINSERT INTO table1 (foo, bar) VALUES (1, 4); -- Fails!\n\nDuplicate entry '1' for key 'ux_table1_foo'\n</pre>\n\n<p>The last insert fails because it violates the unique index on column <code>foo</code> when it tries to insert the value 1 into this column for a second time.</p>\n\n<p>In MySQL a unique constraint allows multiple NULLs.</p>\n\n<p>It is possible to make a unique index on mutiple columns.</p>\n\n<p><strong>Primary key versus unique index</strong></p>\n\n<p>Things that are the same:</p>\n\n<ul>\n<li>A primary key implies a unique index.</li>\n</ul>\n\n<p>Things that are different:</p>\n\n<ul>\n<li>A primary key also implies NOT NULL, but a unique index can be nullable.</li>\n<li>There can be only one primary key, but there can be multiple unique indexes.</li>\n<li>If there is no clustered index defined then the primary key will be the clustered index.</li>\n</ul>\n    "},{"t":"SQL join multiple tables","l":"http://stackoverflow.com/questions/9853586/sql-join-multiple-tables","q":"\n\n<p>I have 4 different tables that I want to join, here's the general structure:</p>\n\n<pre><code>TableA\naID nameA dID\n\nTableB\nbID nameB cID aID\n\ntableC\ncID nameC date\n\ntableD\ndID nameD\n</code></pre>\n\n<p>I can successfully JOIN tables a and c on b since b has their PK's, but I want to be able to join table TableD on TableA  as well to get its name. How would I do this, below is my sql statement:</p>\n\n<pre><code>SELECT TableA.*, TableB.*, TableC.* FROM (TableB INNER JOIN TableA\nON TableB.aID= TableA.aID)\nINNER JOIN TableC ON(TableB.cID= Tablec.cID)\nWHERE (DATE(TableC.date)=date(now())) \n</code></pre>\n\n<p>Any attempt to add another join with A and D gives me a Unknown table 'TableD':</p>\n\n<pre><code> SELECT TableA.*, TableB.*, TableC.*, TableD.* FROM (TableB INNER JOIN TableA\n    ON TableB.aID= TableA.aID)\n    INNER JOIN TableC ON(TableB.cID= Tablec.cID)\n    INNER JOIN TableA ta ON(ta.dID= TableD.dID)\n    WHERE (DATE(TableC.date)=date(now())) \n</code></pre>\n    ","a":"\n<p>You want something more like this:</p>\n\n<pre><code>SELECT TableA.*, TableB.*, TableC.*, TableD.*\nFROM TableA\n    JOIN TableB\n        ON TableB.aID = TableA.aID\n    JOIN TableC\n        ON TableC.cID = TableB.cID\n    JOIN TableD\n        ON TableD.dID = TableA.dID\nWHERE DATE(TableC.date)=date(now()) \n</code></pre>\n\n<p>In your example, you are not actually including <code>TableD</code>. All you have to do is perform another join just like you have done before. </p>\n\n<p>A note: you will notice that I removed many of your parentheses, as they really are not necessary in most of the cases you had them, and only add confusion when trying to read the code. Proper nesting is the best way to make your code readable and separated out. </p>\n    "},{"t":"How to set variable from a SQL query?","l":"http://stackoverflow.com/questions/3974683/how-to-set-variable-from-a-sql-query","q":"\n\n<p>I'm trying to set a variable from a SQL query:</p>\n\n<pre><code>declare @ModelID uniqueidentifer\n\nSelect @ModelID = select modelid from models\nwhere areaid = 'South Coast'\n</code></pre>\n\n<p>Obviously I'm not doing this right as it doesn't work. Can somebody suggest a solution?</p>\n\n<p>Thanks!</p>\n    ","a":"\n<h2>Using SELECT:</h2>\n\n<pre><code>SELECT @ModelID = m.modelid \n  FROM MODELS m\n WHERE m.areaid = 'South Coast'\n</code></pre>\n\n<h2>Using SET:</h2>\n\n<pre><code>SET @ModelID = (SELECT m.modelid \n                  FROM MODELS m\n                 WHERE m.areaid = 'South Coast')\n</code></pre>\n\n<p><a href=\"http://stackoverflow.com/questions/3945361/tsql-set-vs-select-when-assigning-variables\">See this question for the difference between using SELECT and SET in TSQL</a>.</p>\n\n<h2>Warning</h2>\n\n<p>If this select statement returns <em>multiple values</em> (bad to begin with): </p>\n\n<ul>\n<li>When using <code>SELECT</code>, the variable is assigned the last value that is returned (as womp said), without any error or warning (this may cause logic bugs)</li>\n<li>When using <code>SET</code>, an error will occur</li>\n</ul>\n    "},{"t":"How to properly set up a PDO connection","l":"http://stackoverflow.com/questions/11369360/how-to-properly-set-up-a-pdo-connection","q":"\n\n<p>From time to time I see questions regarding connecting to database.<br>\nMost answers is not the way I do it, or I might just not get the answers correctly. Anyway; I've never thought about it because the way I do it works for me.</p>\n\n<p>But here's a crazy thought; Maybe I'm doing this all wrong, and if that's the case; I would really like to know how to properly connect to a MySQL database using PHP and PDO and make it easy accesable.</p>\n\n<p><strong>Here's how I'm doing it:</strong></p>\n\n<p>First off, here's my filestructure <em>(stripped down)</em>:</p>\n\n<p>public_html/</p>\n\n<ul>\n<li><p>index.php  </p></li>\n<li><p>initialize/<br>\n-- load.initialize.php<br>\n-- configure.php<br>\n-- sessions.php   </p></li>\n</ul>\n\n<p><strong>index.php</strong><br>\nAt the very top, I have <code>require('initialize/load.initialize.php');</code>.  </p>\n\n<p><strong>load.initialize.php</strong>  </p>\n\n<pre><code>#   site configurations\n    require('configure.php');\n#   connect to database\n    require('root/somewhere/connect.php');  //  this file is placed outside of public_html for better security.\n#   include classes\n    foreach (glob('assets/classes/*.class.php') as $class_filename){\n        include($class_filename);\n    }\n#   include functions\n    foreach (glob('assets/functions/*.func.php') as $func_filename){\n        include($func_filename);\n    }\n#   handle sessions\n    require('sessions.php');\n</code></pre>\n\n<p><em>I know there's a better, or more correct, way to include classes, but can't remember what it was. Haven't gotten the time to look into it yet, but I think it was something with <code>autoload</code>. something like that...</em></p>\n\n<p><strong>configure.php</strong><br>\nHere I basically just override some <em>php.ini</em>-properties and do some other global configuration for the site</p>\n\n<p><strong>connect.php</strong><br>\nI've put the connection onto a class so other classes can <em>extends</em> this one...</p>\n\n<pre><code>class connect_pdo\n{\n    protected $dbh;\n\n    public function __construct()\n    {\n        try {\n            $db_host = '  ';  //  hostname\n            $db_name = '  ';  //  databasename\n            $db_user = '  ';  //  username\n            $user_pw = '  ';  //  password\n\n            $con = new PDO('mysql:host='.$db_host.'; dbname='.$db_name, $db_user, $user_pw);  \n            $con-&gt;setAttribute( PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION );\n            $con-&gt;exec(\"SET CHARACTER SET utf8\");  //  return all sql requests as UTF-8  \n        }\n        catch (PDOException $err) {  \n            echo \"harmless error message if the connection fails\";\n            $err-&gt;getMessage() . \"&lt;br/&gt;\";\n            file_put_contents('PDOErrors.txt',$err, FILE_APPEND);  // write some details to an error-log outside public_html  \n            die();  //  terminate connection\n        }\n    }\n\n    public function dbh()\n    {\n        return $this-&gt;dbh;\n    }\n}\n#   put database handler into a var for easier access\n    $con = new connect_pdo();\n    $con = $con-&gt;dbh();\n//\n</code></pre>\n\n<p><em>Here I do believe there's room for massive improvement since I recently started learning OOP, and using PDO instead of mysql.<br>\nSo I've just followed a couple of beginners tutoraials and tried out different stuff...</em></p>\n\n<p><strong>sessions.php</strong><br>\nBeside handeling regular sessions, I also initialize some classes into a session like this:  </p>\n\n<pre><code>if (!isset($_SESSION['sqlQuery'])){\n    session_start();\n    $_SESSION['sqlQuery'] = new sqlQuery();\n}\n</code></pre>\n\n<p>This way this class is avalible all over the place. This might not be good practice(?)...<br>\nAnyway, this is what this approch allows me to do from everywhere:</p>\n\n<pre><code>echo $_SESSION['sqlQuery']-&gt;getAreaName('county',9);  // outputs: Aust-Agder (the county name with that id in the database)\n</code></pre>\n\n<p>Inside my <code>sqlQuery</code>-<em>class</em>, which <code>extends</code> my <code>connect_pdo</code>-<em>class</em>, I have a public function called <code>getAreaName</code> which handles the request to my database.<br>\nPretty neat I think.</p>\n\n<p><strong>Works like a charm</strong><br>\nSo that's basically how I'm doing it.<br>\nAlso, whenever I need to fetch something from my DB from not whitin a class, I just do something similar to this:</p>\n\n<pre><code>$id = 123;\n\n$sql = 'SELECT whatever FROM MyTable WHERE id = :id';\n$qry = $con-&gt;prepare($sql);\n$qry -&gt; bindParam(':id', $id, PDO::PARAM_INT);\n$qry -&gt; execute();\n$get = $qry-&gt;fetch(PDO::FETCH_ASSOC);\n</code></pre>\n\n<p>Sience I put the connection into a variable inside *connect_pdo.php*, I just have refering to it and I'm good to go. It works. I get my expected results...</p>\n\n<p>But regardless of that; I would really appreciate if you guys could tell me if I'm way off here. What I should do instad, areas I could or should change for improvement etc... </p>\n\n<p>I'm eager to learn...</p>\n    ","a":"\n<h3>The goal</h3>\n\n<p>As I see it, your aim in this case is twofold: </p>\n\n<ul>\n<li>create and maintain a single/reusable connection per database</li>\n<li>make sure that the connection has been set up properly</li>\n</ul>\n\n<h3>Solution</h3>\n\n<p>I would recommend to use both anonymous function and factory pattern for dealing with PDO connection. The use of it would looks like this :</p>\n\n<pre><code>$provider = function()\n{\n    $instance = new PDO('mysql:......;charset=utf8', 'username', 'password');\n    $instance-&gt;setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);\n    $instance-&gt;setAttribute(PDO::ATTR_EMULATE_PREPARES, false);\n    return $instance;\n};\n\n$factory = new StructureFactory( $provider );\n</code></pre>\n\n<p>Then in a different file or lower in the same file:</p>\n\n<pre><code>$something = $factory-&gt;create('Something');\n$foobar = $factory-&gt;create('Foobar');\n</code></pre>\n\n<p>The factory itself should look something like this:</p>\n\n<pre><code>class StructureFactory\n{\n    protected $provider = null;\n    protected $connection = null;\n\n    public function __construct( callable $provider )\n    {\n        $this-&gt;provider = $provider;\n    }\n\n    public function create( $name)\n    {\n        if ( $this-&gt;connection === null )\n        {\n            $this-&gt;connection = call_user_func( $this-&gt;provider );\n        }\n        return new $name( $this-&gt;connection );\n    }\n\n}\n</code></pre>\n\n<p>This way would let you have a centralized structure, which makes sure that connection is created only when required. It also would make the process of unit-testing and maintenance much easier.</p>\n\n<p>The provider in this case would be found somewhere at the bootstrap stage. This approach would also give a clear location where to define the configuration, that you use for connecting to the DB.</p>\n\n<p>Keep in mind that this is an <strong>extremely simplified example</strong>. You also might benefit from watching two following videos:</p>\n\n<ul>\n<li><a href=\"http://www.youtube.com/watch?v=-FRm3VPhseI\">Global State and Singletons</a></li>\n<li><a href=\"http://www.youtube.com/watch?v=RlfLCWKxHJ0\">Don't Look For Things!</a></li>\n</ul>\n\n<p>Also, I would strongly recommend reading <a href=\"http://wiki.hashphp.org/PDO_Tutorial_for_MySQL_Developers\">a proper tutorial</a> about use of PDO (there are a log of bad tutorial online).</p>\n    "},{"t":"mySQL Transactions vs Locking Tables","l":"http://stackoverflow.com/questions/4226766/mysql-transactions-vs-locking-tables","q":"\n\n<p>I'm a bit confused with transactions vs locking tables to ensure database integrity and make sure a SELECT and UPDATE remain in sync and no other connection interferes with it.  I need to:</p>\n\n<pre><code>SELECT * FROM table WHERE (...) LIMIT 1\n\nif (condition passes) {\n   // Update row I got from the select \n   UPDATE table SET column = \"value\" WHERE (...)\n\n   ... other logic (including INSERT some data) ...\n}\n</code></pre>\n\n<p>I need to ensure that no other queries will interfere and perform the same <code>SELECT</code> (reading the 'old value' before that connection finishes updating the row. </p>\n\n<p>I know I can default to <code>LOCK TABLES table</code> to just make sure that only 1 connection is doing this at a time, and unlock it when I'm done, but that seems like overkill.  Would wrapping that in a transaction do the same thing (ensuring no other connection attempts the same process while another is still processing)?  Or would a <code>SELECT ... FOR UPDATE</code> or <code>SELECT ... LOCK IN SHARE MODE</code> be better?</p>\n    ","a":"\n<p>Locking tables prevents other DB users from affecting the rows/tables you've locked. But locks, in and of themselves, will NOT ensure that your logic comes out in a consistent state.</p>\n\n<p>Think of a banking system. When you pay a bill online, there's at least two accounts affected by the transaction: Your account, from which the money is taken. And the receiver's account, into which the money is transferred. And the bank's account, into which they'll happily deposit all the service fees charged on the transaction. Given (as everyone knows these days) that banks are extraordinarily stupid, let's say their system works like this:</p>\n\n<pre><code>$balance = \"GET BALANCE FROM your ACCOUNT\";\nif ($balance &lt; $amount_being_paid) {\n    charge_huge_overdraft_fees();\n}\n$balance = $balance - $amount_being paid;\nUPDATE your ACCOUNT SET BALANCE = $balance;\n\n$balance = \"GET BALANCE FROM receiver ACCOUNT\"\ncharge_insane_transaction_fee();\n$balance = $balance + $amount_being_paid\nUPDATE receiver ACCOUNT SET BALANCE = $balance\n</code></pre>\n\n<p>Now, with no locks and no transactions, this system is vulnerable to various race conditions, the biggest of which is multiple payments being performed on your account, or the receiver's account in parallel. While your code has your balance retrieved and is doing the huge_overdraft_fees() and whatnot, it's entirely possible that some other payment will be running the same type of code in parallel. They'll be retrieve your balance (say, $100), do their transactions (take out the $20 you're paying, and the $30 they're screwing you over with), and now both code paths have two different balances: $80 and $70. Depending on which ones finishes last, you'll end up with either of those two balances in your account, instead of the $50 you should have ended up with ($100 - $20 - $30). In this case, \"bank error in your favor\".</p>\n\n<p>Now, let's say you use locks. Your bill payment ($20) hits the pipe first, so it wins and locks your account record. Now you've got exclusive use, and can deduct the $20 from the balance, and write the new balance back in peace... and your account ends up with $80 as is expected. But... uhoh... You try to go update the receiver's account, and it's locked, and locked longer than the code allows, timing out your transaction... We're dealing with stupid banks, so instead of having proper error handling, the code just pulls an <code>exit()</code>, and your $20 vanishes into a puff of electrons. Now you're out $20, and you still owe $20 to the receiver, and your telephone gets repossessed.</p>\n\n<p>So... enter transactions. You start a transaction, you debit your account $20, you try to credit the receiver with $20... and something blows up again. But this time, instead of <code>exit()</code>, the code can just do <code>rollback</code>, and poof, your $20 is magically added back to your account.</p>\n\n<p>In the end, it boils down to this:</p>\n\n<p>Locks keep anyone else from interfering with any database records you're dealing with. Transactions keep any \"later\" errors from interfering with \"earlier\" things you've done. Neither alone can guarantee that things work out ok in the end. But together, they do.</p>\n\n<p>in tomorrow's lesson: The Joy of Deadlocks.</p>\n    "},{"t":"UPDATE and REPLACE part of a string","l":"http://stackoverflow.com/questions/17365222/update-and-replace-part-of-a-string","q":"\n\n<p>I've got a table with two columns, <code>ID</code> and <code>Value</code>. I want to change a part of some strings in the second column.</p>\n\n<p>Example of Table:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>ID            Value\n---------------------------------\n1             c:\\temp\\123\\abc\\111\n2             c:\\temp\\123\\abc\\222\n3             c:\\temp\\123\\abc\\333\n4             c:\\temp\\123\\abc\\444\n</code></pre>\n\n<p>Now the <code>1231</code> in the <code>Value</code> string is not needed. I tried <code>UPDATE</code> and <code>REPLACE</code>:</p>\n\n<pre><code>UPDATE dbo.xxx\nSET Value = REPLACE(Value, '%123%', '')\nWHERE ID &lt;= 4\n</code></pre>\n\n<p>When I execute the script SQL Server does not report an error, but it does not update anything either. Why is that?</p>\n    ","a":"\n<p>You don't need wildcards in the <code>REPLACE</code> - it just finds the string you enter for the second argument, so the following should work:</p>\n\n<pre><code>UPDATE dbo.xxx\nSET Value = REPLACE(Value, '123\\', '')\nWHERE ID &lt;=4\n</code></pre>\n\n<p>(I also added the <code>\\</code> in the replace as I assume you don't need that either)</p>\n    "},{"t":"Is there a boolean type in oracle databases?","l":"http://stackoverflow.com/questions/3726758/is-there-a-boolean-type-in-oracle-databases","q":"\n\n<p>Is there a boolean type in oracle databases, similar to the BIT datatype in MS SQL?</p>\n    ","a":"\n<p>Not only is the boolean datatype missing in Oracle's SQL (not PL/SQL), but they also have no clear recommendation about what to use instead. See <a href=\"http://asktom.oracle.com/pls/asktom/f?p=100:11:0%3a%3a%3a%3aP11_QUESTION_ID:6263249199595#876972400346931526\">this thread</a> on asktom. From recommending CHAR(1) 'Y'/'N' they switch to NUMBER(1) 0/1 when someone points out that 'Y'/'N' depends on the English language, while e.g. German programmers might use 'J'/'N' instead.</p>\n\n<p>The worst thing is that they defend this stupid decision just like they defend the ''=NULL stupidity.</p>\n    "},{"t":"How to print SQL statement in codeigniter model","l":"http://stackoverflow.com/questions/6142099/how-to-print-sql-statement-in-codeigniter-model","q":"\n\n<p>I have a sql statement in my model,</p>\n\n<p>I then say</p>\n\n<pre><code> $query = $this-&gt;db-&gt;query($sql, array(fields, fields1);\n\nif($query){return true:}\nelse{echo \"failed\"; return false;}\n</code></pre>\n\n<p>My query always fails, how do I get php to print the exact sql statement being sent to my database? And display that on my php view, page</p>\n    ","a":"\n<pre><code>print_r($query);\n</code></pre>\n\n<p>You can also use (in view) and you will see the SQL statement:</p>\n\n<pre><code>$this-&gt;output-&gt;enable_profiler(TRUE);\n</code></pre>\n\n<p>Profiling user guide:\n<a href=\"http://ellislab.com/codeigniter/user-guide/general/profiling.html\">http://ellislab.com/codeigniter/user-guide/general/profiling.html</a></p>\n    "},{"t":"The 'System.Web.Security.SqlMembershipProvider' requires a database schema compatible with schema version '1'","l":"http://stackoverflow.com/questions/3292794/the-system-web-security-sqlmembershipprovider-requires-a-database-schema-compa","q":"\n\n<p>I have a SQL Server 2008 DB with many tables filled with data and I used SQL Server Management Studio to generate a SQL dump by using the Script Wizard : Tasks -&gt; Generate Scripts -&gt; Script All objects in the selected database and also selecting the option to Script Data. I made sure to change the value of \"Script for Server Version\" to \"SQL Server 2008\". Then I created a new DB and ran the SQL dump on the new DB to generate an identical copy of the old DB. Then I assigned permissions to my default user to the new DB. Then I changed the connection string on my ASP.NET application to use the new DB. But when I run it, it throws the following exception - </p>\n\n<pre><code>            Server Error in '/myapp' Application.\n            The 'System.Web.Security.SqlMembershipProvider' requires a database schema compatible with schema version '1'.  However, the current database schema is not compatible with this version.  You may need to either install a compatible schema with aspnet_regsql.exe (available in the framework installation directory), or upgrade the provider to a newer version.\n            Description: An unhandled exception occurred during the execution of the current web request. Please review the stack trace for more information about the error and where it originated in the code.\n\n            Exception Details: System.Configuration.Provider.ProviderException: The 'System.Web.Security.SqlMembershipProvider' requires a database schema compatible with schema version '1'.  However, the current database schema is not compatible with this version.  You may need to either install a compatible schema with aspnet_regsql.exe (available in the framework installation directory), or upgrade the provider to a newer version.\n\n            Source Error:\n\n            An unhandled exception was generated during the execution of the current web request. Information regarding the origin and location of the exception can be identified using the exception stack trace below.\n\n            Stack Trace:\n\n            [ProviderException: The 'System.Web.Security.SqlMembershipProvider' requires a database schema compatible with schema version '1'.  However, the current database schema is not compatible with this version.  You may need to either install a compatible schema with aspnet_regsql.exe (available in the framework installation directory), or upgrade the provider to a newer version.]\n               System.Web.Util.SecUtility.CheckSchemaVersion(ProviderBase provider, SqlConnection connection, String[] features, String version, Int32&amp; schemaVersionCheck) +1977772\n               System.Web.Security.SqlMembershipProvider.CheckSchemaVersion(SqlConnection connection) +89\n               System.Web.Security.SqlMembershipProvider.GetPasswordWithFormat(String username, Boolean updateLastLoginActivityDate, Int32&amp; status, String&amp; password, Int32&amp; passwordFormat, String&amp; passwordSalt, Int32&amp; failedPasswordAttemptCount, Int32&amp; failedPasswordAnswerAttemptCount, Boolean&amp; isApproved, DateTime&amp; lastLoginDate, DateTime&amp; lastActivityDate) +815\n               System.Web.Security.SqlMembershipProvider.CheckPassword(String username, String password, Boolean updateLastLoginActivityDate, Boolean failIfNotApproved, String&amp; salt, Int32&amp; passwordFormat) +105\n               System.Web.Security.SqlMembershipProvider.CheckPassword(String username, String password, Boolean updateLastLoginActivityDate, Boolean failIfNotApproved) +42\n               System.Web.Security.SqlMembershipProvider.ValidateUser(String username, String password) +78\n               System.Web.UI.WebControls.Login.AuthenticateUsingMembershipProvider(AuthenticateEventArgs e) +60\n               System.Web.UI.WebControls.Login.OnAuthenticate(AuthenticateEventArgs e) +119\n               System.Web.UI.WebControls.Login.AttemptLogin() +115\n               System.Web.UI.WebControls.Login.OnBubbleEvent(Object source, EventArgs e) +101\n               System.Web.UI.Control.RaiseBubbleEvent(Object source, EventArgs args) +37\n               System.Web.UI.WebControls.Button.OnCommand(CommandEventArgs e) +118\n               System.Web.UI.WebControls.Button.RaisePostBackEvent(String eventArgument) +166\n               System.Web.UI.WebControls.Button.System.Web.UI.IPostBackEventHandler.RaisePostBackEvent(String eventArgument) +10\n               System.Web.UI.Page.RaisePostBackEvent(IPostBackEventHandler sourceControl, String eventArgument) +13\n               System.Web.UI.Page.RaisePostBackEvent(NameValueCollection postData) +36\n               System.Web.UI.Page.ProcessRequestMain(Boolean includeStagesBeforeAsyncPoint, Boolean includeStagesAfterAsyncPoint) +1565\n</code></pre>\n    ","a":"\n<p>If you really haven't forgotten anything (views, SP's, etc. etc. etc.), then googling indicates that 'silly' solutions like closing the project and re-opening, rebuilding, or: </p>\n\n<p><em>The thing that actually did the trick was going through the ASP.NET Configuration utility (Visual Studio - under Website menu), taking the application offline and then back online. This actually just makes a change to web.config (not exactly sure what the change was). So after taking it offline, I had to upload web.config to the hosted solution. Then took the application back online, recopied web.config, etc.</em></p>\n\n<p>May be the answer.</p>\n    "},{"t":"Convert timestamp to date in MySQL query","l":"http://stackoverflow.com/questions/9251561/convert-timestamp-to-date-in-mysql-query","q":"\n\n<p>I want to convert a <code>timestamp</code> in MySQL to a date.  </p>\n\n<p>I would like to format the user.registration field into the text file as a <code>yyyy-mm-dd</code>.</p>\n\n<p>Here is my SQL:</p>\n\n<pre><code>$sql = requestSQL(\"SELECT user.email, \n                   info.name, \n                   FROM_UNIXTIME(user.registration),\n                   info.news\n                   FROM user, info \n                   WHERE user.id = info.id \", \"export members\");\n</code></pre>\n\n<p>I also tried the date conversion with:</p>\n\n<pre><code>DATE_FORMAT(user.registration, '%d/%m/%Y')\nDATE(user.registration)\n</code></pre>\n\n<p>I echo the result before to write the text file and I get :</p>\n\n<blockquote>\n  <p>email1;name1;DATE_FORMAT(user.registration, '%d/%m/%Y');news1</p>\n  \n  <p>email2;name2;news2</p>\n</blockquote>\n\n<p>How can I convert that field to date?</p>\n    ","a":"\n<pre><code>DATE_FORMAT(FROM_UNIXTIME(`user.registration`), '%e %b %Y') AS 'date_formatted'\n</code></pre>\n    "},{"t":"DROP IF EXISTS VS DROP?","l":"http://stackoverflow.com/questions/9565818/drop-if-exists-vs-drop","q":"\n\n<p>Can someone tell me if there is any difference between</p>\n\n<pre><code>DROP IF EXISTS [TABLE_NAME]\n</code></pre>\n\n\n\n<pre><code>DROP [TABLE_NAME]\n</code></pre>\n\n<p>I am asking this because I am using JDBC template in my MVC web application. If I use <code>DROP [TABLE_NAME]</code> the error said that Table exist. And if I use <code>DROP IF EXISTS [TABLE_NAME]</code> it says bad SQL grammar. Can some one help?</p>\n    ","a":"\n<p>Standard SQL syntax is</p>\n\n<pre><code>DROP TABLE table_name;\n</code></pre>\n\n<p><code>IF EXISTS</code> is not standard; different platforms might support it with different syntax, or not support it at all. In PostgreSQL, the syntax is</p>\n\n<pre><code>DROP TABLE IF EXISTS table_name;\n</code></pre>\n\n<p>The first one will throw an error if the table doesn't exist, or if other database objects depend on it.  Most often, the other database objects will be foreign key references, but there may be others, too.  (Views, for example.)  The second will not throw an error if the table doesn't exist, but it will still throw an error if other database objects depend on it. </p>\n\n<p>To drop a table, and all the other objects that depend on it, use one of these.</p>\n\n<pre><code>DROP TABLE table_name CASCADE;\nDROP TABLE IF EXISTS table_name CASCADE;\n</code></pre>\n\n<p>Use CASCADE with great care.</p>\n    "},{"t":"When to use Common table expression (CTE)","l":"http://stackoverflow.com/questions/4740748/when-to-use-common-table-expression-cte","q":"\n\n<p>I have begun reading about Common table expression and cannot think of usecase where I would need to  use it. It would seem to be redundant as the same can be done with derived tables. Is there something I am missing or not understanding well? Can someone give me a simple example of limitations with regular select, derived or temp table queries to make the case of CTE? Any simple examples would be highly appreciated.</p>\n    ","a":"\n<p>One example, if you need to reference/join the same data set multiple times you can do so by defining a CTE. Therefore, it can be a form of code re-use.</p>\n\n<p>An example of self referencing is recursion: <a href=\"http://msdn.microsoft.com/en-us/library/ms186243.aspx\">Recursive Queries Using CTE</a></p>\n\n<p>For exciting Microsoft defintions\n<a href=\"http://msdn.microsoft.com/en-us/library/ms190766.aspx\">Taken from Books Online:</a></p>\n\n<p>A CTE can be used to:</p>\n\n<ul>\n<li><p>Create a recursive query. For more information, see Recursive Queries Using Common Table Expressions.</p></li>\n<li><p>Substitute for a view when the general use of a view is not required; that is, you do not have to store the definition in metadata.</p></li>\n<li><p>Enable grouping by a column that is derived from a scalar subselect, or a function that is either not deterministic or has external access.</p></li>\n<li><p>Reference the resulting table multiple times in the same statement.</p></li>\n</ul>\n    "},{"t":"Display an array in a readable/hierarchical format","l":"http://stackoverflow.com/questions/5393085/display-an-array-in-a-readable-hierarchical-format","q":"\n\n<p>Here is the code for pulling the data for my array</p>\n\n<pre><code>    &lt;?php\n$link = mysqli_connect('localhost', 'root', '', 'mutli_page_form');\n\n    $query = \"SELECT * FROM wills_children WHERE will=73\";\n\n    $result = mysqli_query($link, $query) or die(mysqli_error($link));\n\n    if ($result = mysqli_query($link, $query)) {\n\n    /* fetch associative array */\n    if($row = mysqli_fetch_assoc($result)) {\n        $data = unserialize($row['children']);\n    }\n\n    /* free result set */\n    mysqli_free_result($result);\n    }\n?&gt;\n</code></pre>\n\n<p>When i use print_r($data) it reads as:</p>\n\n<pre><code>Array ( [0] =&gt; Array ( [0] =&gt; Natural Chlid 1 [1] =&gt; Natural Chlid 2 [2] =&gt; Natural Chlid 3 ) ) \n</code></pre>\n\n<p>I would like it to read as:</p>\n\n<p>Natural Child 1<br>\nNatural Child 2<br>\nNatural Child 3<br></p>\n    ","a":"\n<p>Try this:</p>\n\n<pre><code>foreach($data[0] as $child) {\n   echo $child . \"\\n\";\n}\n</code></pre>\n\n<p>in place of <code>print_r($data)</code></p>\n    "},{"t":"How do I force Postgres to use a particular index?","l":"http://stackoverflow.com/questions/309786/how-do-i-force-postgres-to-use-a-particular-index","q":"\n\n<p>How do I force Postgres to use an index when it would otherwise insist on doing a sequential scan?</p>\n    ","a":"\n<p>Assuming you're asking about the common \"index hinting\" feature found in many databases, PostgreSQL doesn't provide such a feature. This was a conscious decision made by the PostgreSQL team. A good overview of why and what you can do instead can be found <a href=\"http://blog.2ndquadrant.com/hinting_at_postgresql/\">here</a>. The reasons are basically that it's a performance hack that tends to cause more problems later down the line as your data changes, whereas PostgreSQL's optimizer can re-evaluate the plan based on the statistics. In other words, what might be a good query plan today probably won't be a good query plan for all time, and index hints force a particular query plan for all time.</p>\n\n<p>As a very blunt hammer, useful for testing, you can use the <code>enable_seqscan</code> and <code>enable_indexscan</code> parameters. See:</p>\n\n<ul>\n<li><a href=\"http://www.postgresql.org/docs/current/static/indexes-examine.html\">Examining index usage</a></li>\n<li><a href=\"http://www.postgresql.org/docs/current/static/runtime-config-query.html\"><code>enable_</code> parameters</a></li>\n</ul>\n\n<p>These are <em>not suitable for ongoing production use</em>. If you have issues with query plan choice, you should see <a href=\"http://www.postgresql.org/docs/current/static/performance-tips.html\">the documentation for tracking down query performance issues</a>. Don't just set <code>enable_</code> params and walk away.</p>\n\n<p>Unless you have a very good reason for using the index, Postgres may be making the correct choice. Why?</p>\n\n<ul>\n<li>For small tables, it's faster to do sequential scans.</li>\n<li>Postgres doesn't use indexes when datatypes don't match properly, you may need to include appropriate casts.</li>\n<li>Your planner settings might be causing problems.</li>\n</ul>\n\n<p>See also <a href=\"http://archives.postgresql.org/pgsql-sql/2006-02/msg00188.php\">this old newsgroup post</a>.</p>\n    "},{"t":"SQL query: Delete all records from the table except latest N?","l":"http://stackoverflow.com/questions/578867/sql-query-delete-all-records-from-the-table-except-latest-n","q":"\n\n<p>Is it possible to build a single mysql query (without variables) to remove all records from the table, except latest N (sorted by id desc)?</p>\n\n<p>Something like this, only it doesn't work :)</p>\n\n<pre><code>delete from table order by id ASC limit ((select count(*) from table ) - N)\n</code></pre>\n\n<p>Thanks.</p>\n    ","a":"\n<p>You cannot delete the records that way, the main issue being that you cannot use a subquery to specify the value of a LIMIT clause.</p>\n\n<p>This works (tested in MySQL 5.0.67):</p>\n\n<pre><code>DELETE FROM `table`\nWHERE id NOT IN (\n  SELECT id\n  FROM (\n    SELECT id\n    FROM `table`\n    ORDER BY id DESC\n    LIMIT 42 -- keep this many records\n  ) foo\n);\n</code></pre>\n\n<p>The intermediate subquery <em>is</em> required. Without it we'd run into two errors:</p>\n\n<ol>\n<li><strong>SQL Error (1093): You can't specify target table 'table' for update in FROM clause</strong> - MySQL doesn't allow you to refer to the table you are deleting from within a direct subquery.</li>\n<li><strong>SQL Error (1235): This version of MySQL doesn't yet support 'LIMIT &amp; IN/ALL/ANY/SOME subquery'</strong> - You can't use the LIMIT clause within a direct subquery of a NOT IN operator.</li>\n</ol>\n\n<p>Fortunately, using an intermediate subquery allows us to bypass both of these limitations.</p>\n\n<hr>\n\n<p>NickC has pointed out this query can be optimised significantly for certain use cases (such as this one). I recommend reading <a href=\"http://stackoverflow.com/a/8303440/69713\">his answer</a> to see if it fits yours.</p>\n    "},{"t":"How can I convert an MDB (Access) file to MySQL (or plain SQL file)?","l":"http://stackoverflow.com/questions/5722544/how-can-i-convert-an-mdb-access-file-to-mysql-or-plain-sql-file","q":"\n\n<p>Is it possible to create a Dump of SQL commands from a Microsoft Access database? I hope to convert this MDB file into a MySQL database for importing so I don't have to go through the CSV step.</p>\n\n<p>I would expect even an MSSQL dump file to still contain workable SQL commands, but I know nothing of MSSQL, please let me know.</p>\n    ","a":"\n<p>You want to convert mdb to mysql?</p>\n\n<p>Try <a href=\"http://www.bullzip.com/products/a2m/info.php\">this</a>.</p>\n    "},{"t":"In Sql server, when should you use GO and when should you use semi-colon ;?","l":"http://stackoverflow.com/questions/3701147/in-sql-server-when-should-you-use-go-and-when-should-you-use-semi-colon","q":"\n\n<p>I've always been confused with when I should use the GO keyword after commands and whether a semi-colon is required at the end of commands.</p>\n\n<p>When I run the Generate-script in sql server management studio, it seems to use GO all over the place, but not the semi-colon.</p>\n\n<p>Please can someone explain to me the differences and why/when i should use them.</p>\n\n<p>thanks</p>\n    ","a":"\n<p><code>GO</code> only relates to SSMS - it isn't actual Transact SQL, it just tells SSMS to send the SQL statements between each <code>GO</code> in individual batches sequentially.</p>\n\n<p>The <code>;</code> is a SQL statement delimiter, but for the most part the engine can interpret where your statements are broken up.</p>\n\n<p>The main exception, and place where the <code>;</code> is used most often is before a Common Table Expression Statement.</p>\n    "},{"t":"Cannot Connect to Server - A network-related or instance-specific error [closed]","l":"http://stackoverflow.com/questions/18060667/cannot-connect-to-server-a-network-related-or-instance-specific-error","q":"\n\n<p>I get the following error when trying to connect to SQL Server:</p>\n\n<blockquote>\n  <p>Cannot connect to 108.163.224.173.</p>\n  \n  <p>A network-related or instance-specific error occurred while establishing a connection to SQL Server. The server was not found or was not accessible. Verify that the instance name is correct and that SQL Server is configured to allow remote connections. (provider: Named Pipes Provider, error: 40 - Could not open a connection to SQL Server) (Microsoft SQL Server, Error: 1326)</p>\n</blockquote>\n\n<p>This Error is thrown when i try to configure my database to gridview in visual studios 2010. Any idea how to fix it?</p>\n    ","a":"\n<p>I got similar error last time. Certain steps didn't work for certain computers, and I have totally no idea why. Regardless, here are some things to check:</p>\n\n<ol>\n<li>Make sure your database engine is <strong>configured to accept remote connections</strong>:\n<ul>\n<li>Start &gt; All Programs &gt; SQL Server 2005 &gt; Configuration Tools &gt; SQL Server Surface Area Configuration</li>\n<li>Click on Surface Area Configuration for Services and Connections</li>\n<li>Select the instance that is having a problem &gt; Database Engine &gt; Remote Connections</li>\n<li>Enable local and remote connections</li>\n<li>Restart instance</li>\n<li>See More At: <a href=\"http://www.sswug.org/articlesection/default.aspx?TargetID=44331\">7 things to check to resolve  \"A network-related or instance-specific error occurred while establishing a connection to SQL Server…\"</a></li>\n</ul></li>\n<li>You may need to <strong>create an exception on the firewall</strong> for the SQL Server instance and port you are using:\n<ul>\n<li>Start &gt; Run &gt; Firewall.cpl</li>\n<li>Click on exceptions tab </li>\n<li>Add sqlservr.exe \n<ul>\n<li>typically located in <code>C:\\Program Files (x86)\\Microsoft SQL Server\\MSSQL.x\\MSSQL\\Bin</code> - check your installs for the actual folder path</li>\n</ul></li>\n<li>Add the port (default is <code>1433</code>)</li>\n<li>Check your connection string as well</li>\n</ul></li>\n<li>Check if your <strong>SQL server services is up and running</strong> properly:\n<ul>\n<li>Go to All Programs &gt; Microsoft SQL Server 2008 &gt; Configuration Tools &gt; SQL Server Configuration Manager &gt; SQL Server Services</li>\n<li>Check to make sure SQL Server service status is <code>Running</code>.</li>\n</ul></li>\n<li>Ensure that your <strong>remote server is in the same network</strong>:\n<ul>\n<li>Open your command prompt and Run <code>sqlcmd -L</code> to ascertain if your server is included in your network list. </li>\n<li>See More At: <a href=\"http://blog.sqlauthority.com/2009/03/18/sql-server-find-all-servers-from-local-network-using-sqlcmd/\">Using sqlcmd – Detect Installed SQL Server on Network</a></li>\n</ul></li>\n<li><strong>Enable TCP/IP</strong> in SQL Server Configuration:\n<ul>\n<li>Go to All Programs &gt; Microsoft SQL Server 2008 &gt; Configuration Tools &gt; SQL Server Configuration Manager &gt; Select TCP/IP.</li>\n<li>Right click and select enable</li>\n</ul></li>\n</ol>\n\n<p>All these did helped me and several of my lab mates whom have trouble connecting to the remote server</p>\n\n<p>In my opinion, if you have problem with your firewall, try disabling it and connect. If it doesn't work, means it could be your SQL configuration / enabling of TCP/IP problem.</p>\n\n<p><strong>References</strong>: </p>\n\n<ul>\n<li><a href=\"http://www.sswug.org/articlesection/default.aspx?TargetID=44331\">7 things to check to resolve  \"A network-related or instance-specific error occurred while establishing a connection to SQL Server…\"</a></li>\n<li><a href=\"http://blog.sqlauthority.com/2009/05/21/sql-server-fix-error-provider-named-pipes-provider-error-40-could-not-open-a-connection-to-sql-server-microsoft-sql-server-error/\">FIX : ERROR : Could not open a connection to SQL Server</a></li>\n<li><a href=\"http://blog.sqlauthority.com/2009/03/18/sql-server-find-all-servers-from-local-network-using-sqlcmd/\">Using sqlcmd – Detect Installed SQL Server on Network</a></li>\n</ul>\n    "},{"t":"Use linq to generate direct update without select","l":"http://stackoverflow.com/questions/445033/use-linq-to-generate-direct-update-without-select","q":"\n\n<p>G'day everyone.</p>\n\n<p>I'm still learning LINQ so forgive me if this is naive.  When you're dealing with SQL directly, you can generate update commands with conditionals, without running a select statement.</p>\n\n<p>When I work with linq I seem to follow the pattern of:</p>\n\n<ol>\n<li>Select entities</li>\n<li>Modify entities</li>\n<li>Submit changes</li>\n</ol>\n\n<p>What I want to do is a direct update using linq and deferred execution.  Is it possible that the actual execution occurs directly at the SQL without any data being transmitted up to the client?</p>\n\n<pre><code>DataContext dc = new DataContext\n\nvar q = from product in dc.Products\n        where product.Type = 1\n        set product.Count = 0\n\ndc.SubmitChanges\n</code></pre>\n\n<p>So in essence LINQ has all the information it needs WITHOUT using a select to generate an update command. It would run the SQL:</p>\n\n<pre><code>Update Products Set Count = 0 Where Type = 1\n</code></pre>\n\n<p>Does a keyword like \"set\" exist in LINQ?</p>\n    ","a":"\n<p>No, neither LINQ nor LINQ to SQL has set-based update capabilities. </p>\n\n<p>In LINQ to SQL, you must query for the object you wish to update, update the fields/properties as necessary, then call SubmitChanges(). For example:</p>\n\n<pre><code>var qry = from product in dc.Products where Product.Name=='Foobar' select product;\nvar item = qry.Single();\nitem.Count = 0;\ndc.SubmitChanges();\n</code></pre>\n\n<p>If you wish to do batching:</p>\n\n<pre><code>var qry = from product in dc.Products where Product.Type==1 select product;\nforeach(var item in qry)\n{\n  item.Count = 0;\n}\ndc.SubmitChanges();\n</code></pre>\n\n<p>Alternatively, you could write the query yourself:</p>\n\n<pre><code>dc.ExecuteCommand(\"update Product set Count=0 where Type=1\", null);\n</code></pre>\n    "},{"t":"Does PostgreSQL support “accent insensitive” collations?","l":"http://stackoverflow.com/questions/11005036/does-postgresql-support-accent-insensitive-collations","q":"\n\n<p>In Microsoft SQL Server, it's possible to specify an \"accent insensitive\" collation (for a database, table or column), which means that it's possible for a query like</p>\n\n<pre><code>SELECT * FROM users WHERE name LIKE 'João'\n</code></pre>\n\n<p>to find a row with a <code>Joao</code> name.</p>\n\n<p>I know that it's possible to strip accents from strings in PostgreSQL using the <a href=\"http://wiki.postgresql.org/wiki/Strip_accents_from_strings,_and_output_in_lowercase\">unaccent_string</a> contrib function, but I'm wondering if PostgreSQL supports these \"accent insensitive\" collations so the <code>SELECT</code> above would work.</p>\n    ","a":"\n<p>I use the <a href=\"http://www.postgresql.org/docs/current/interactive/unaccent.html\"><strong>unaccent module</strong></a> for that - which is something different entirely than what you are linking to.</p>\n\n<blockquote>\n  <p>unaccent is a text search dictionary that removes accents (diacritic\n  signs) from lexemes.</p>\n</blockquote>\n\n<p>Install once per database with:</p>\n\n<pre><code>CREATE EXTENSION unaccent;\n</code></pre>\n\n<p>It also provides the function <code>unaccent()</code> you could use with your example (where <code>LIKE</code> seems not needed).</p>\n\n<pre><code>SELECT *\nFROM   users\nWHERE  unaccent(name) = unaccent('João');\n</code></pre>\n\n<h2>Index</h2>\n\n<p>To use an index for that kind of query, create an <a href=\"http://www.postgresql.org/docs/current/interactive/indexes-expressional.html\">index on the expression</a>. However, Postgres only accepts <code>IMMUTABLE</code> functions for expresion indexes. If a function can return a different result under different circumstances, the index could silently break.</p>\n\n<h3><code>unaccent()</code> only <code>STABLE</code> not <code>IMMUTABLE</code></h3>\n\n<p>Unfortunately, <code>unaccent()</code> is only <code>STABLE</code>, not <code>IMMUTABLE</code>. According to <a href=\"http://www.postgresql.org/message-id/flat/201012021544.oB2FiTn1041521@wwwmaster.postgresql.org#201012021544.oB2FiTn1041521@wwwmaster.postgresql.org\">this thread on pgsql-bugs</a>, this is due to <em>three</em> reasons:</p>\n\n<ol>\n<li>It depends on the behavior of a dictionary.</li>\n<li>There is no hard-wired connection to this dictionary.</li>\n<li>It therefore also depends on the current <code>search_path</code>, which can change easily.</li>\n</ol>\n\n<p><a href=\"https://django-orm.readthedocs.org/en/latest/orm-pg-fulltext.html\">Some tutorials</a> on the web instruct to just alter the function and declare it <code>IMMUTABLE</code>. This is a brute-force method that might break under rare circumstances.</p>\n\n<p>Others suggest a <a href=\"http://www.postgresql.org/message-id/flat/CAANrE7rpWjvZgdKX_hArNp8ynUezZ-Ehp8QEqC7hwfXuNqa91g@mail.gmail.com#CAANrE7rpWjvZgdKX_hArNp8ynUezZ-Ehp8QEqC7hwfXuNqa91g@mail.gmail.com\">simple <code>IMMUTABLE</code> wrapper function</a>, like I did myself in the past.</p>\n\n<p>There is an ongoing debate whether to make the <a href=\"http://www.postgresql.org/docs/current/interactive/unaccent.html#AEN145199\">variant with two parameters</a> <code>IMMUTABLE</code> which declares the used dictionary explicitly. Read <a href=\"http://www.postgresql.org/message-id/flat/20120826134701.GM10814@momjian.us#20120826134701.GM10814@momjian.us\">here</a> or <a href=\"http://www.postgresql.org/message-id/flat/CAFj8pRDi0LRcmgyvd0ttC9J=VwOxe094fVRG2KTR_AQC86y-wg@mail.gmail.com#CAFj8pRDi0LRcmgyvd0ttC9J=VwOxe094fVRG2KTR_AQC86y-wg@mail.gmail.com\">here</a>.</p>\n\n<p>Another alternative would be this module with an <a href=\"https://github.com/metabrainz/musicbrainz-server/tree/master/postgresql-musicbrainz-unaccent\">IMMUTABLE <code>unaccent()</code> function by Musicbrainz</a>, provided on Github. Haven't tested it myself. I think I have come up with a better idea:</p>\n\n<h3>Best for now</h3>\n\n<p>All of this put together I propose this approach that is just <strong>as efficient as other solutions floating around, but safer</strong>:\nCreate a simple wrapper function with the two-parameter variant that hard-codes the <strong>correct dictionary</strong> as well as the <strong>right <code>search_path</code></strong>:</p>\n\n<pre><code>CREATE OR REPLACE FUNCTION f_unaccent(text)\n  RETURNS text AS\n$func$\nSELECT unaccent(<b>'unaccent'</b>, $1)\n$func$  LANGUAGE sql IMMUTABLE <b>SET search_path = public, pg_temp;</b></code></pre>\n\n<p>Set the <code>search_path</code> to the schema where you install your extensions (default is <code>public</code>).<br>\nWhy the dangling <strong><code>pg_temp</code></strong>? To rule out temporary objects coming first. <a href=\"http://www.postgresql.org/docs/current/interactive/sql-createfunction.html#SQL-CREATEFUNCTION-SECURITY\">More in the manual here.</a><br>\nYou can build an expression index using that, since it is declared <code>IMMUTABLE</code>.</p>\n\n<pre><code>CREATE INDEX users_unaccent_name_idx ON users(f_unaccent(name));\n</code></pre>\n\n<p>Adapt your query to use the index:</p>\n\n<pre><code>SELECT *\nFROM   users\nWHERE  f_unaccent(name) = f_unaccent('João');\n</code></pre>\n\n<h3>Pattern matching</h3>\n\n<p>If you want to use it with <strong><code>LIKE</code></strong> (and a pattern that is not left-anchored), you can combine this with the module <a href=\"http://www.postgresql.org/docs/current/interactive/pgtrgm.html\"><strong><code>pg_tgrm</code></strong></a> in PostgreSQL 9.1 or later. Create a GIN or GIST expression index. Example for GIN:</p>\n\n<pre><code>CREATE INDEX users_unaccent_name_trgm_idx ON users\nUSING gin (f_unaccent(name) gin_trgm_ops);\n</code></pre>\n\n<p>Be aware that GIN and GIST indexes are somewhat more expensive to maintain. Would be used in a query like:</p>\n\n<pre><code>SELECT *\nFROM   users\nWHERE  f_unaccent(name) LIKE ('%' || f_unaccent('João') || '%');\n</code></pre>\n\n<p>More details about pattern matching and performance in this recent answer on dba.SE:</p>\n\n<ul>\n<li><a href=\"http://dba.stackexchange.com/a/10696/3684\">Pattern matching with LIKE, SIMILAR TO or regular expressions in PostgreSQL</a></li>\n</ul>\n\n<p><code>pg_tgrm</code> also provides very <a href=\"http://www.postgresql.org/docs/current/interactive/pgtrgm.html#PGTRGM-OP-TABLE\">useful operators for \"similarity\" <code>%</code> and \"distance\" <code>&lt;-&gt;</code></a>.</p>\n\n<p>Note that the trigram index also supports <strong>case insensitive</strong> pattern matching with <code>ILIKE</code>. More in this later answer:</p>\n\n<ul>\n<li><a href=\"http://stackoverflow.com/questions/28627951/postgresql-accent-case-insensitive-search/28636000#28636000\">PostgreSQL accent + case insensitive search</a></li>\n</ul>\n    "},{"t":"Most efficient way to store IP Address in MySQL","l":"http://stackoverflow.com/questions/2542011/most-efficient-way-to-store-ip-address-in-mysql","q":"\n\n<p>What is the most efficient way to store and retrieve IP addresses in MySQL?  Right now I'm doing:</p>\n\n<pre><code>SELECT * FROM logins WHERE ip = '1.2.3.4'\n</code></pre>\n\n<p>Where ip is a <code>VARCHAR(15)</code> field.</p>\n\n<p>Is there a better way to do this?</p>\n    ","a":"\n<p>For <a href=\"http://en.wikipedia.org/wiki/IPv4\">IPv4 addresses</a>, you may want to store them as an <code>int unsigned</code> and use the <a href=\"http://dev.mysql.com/doc/refman/5.1/en/miscellaneous-functions.html#function_inet-aton\"><code>INET_ATON()</code></a> and <a href=\"http://dev.mysql.com/doc/refman/5.1/en/miscellaneous-functions.html#function_inet-ntoa\"><code>INET_NTOA()</code></a> functions to return the IP address from its numeric value, and vice versa. </p>\n\n<p>Example:</p>\n\n<pre><code>SELECT INET_ATON('127.0.0.1');\n\n+------------------------+\n| INET_ATON('127.0.0.1') |\n+------------------------+\n|             2130706433 | \n+------------------------+\n1 row in set (0.00 sec)\n\n\nSELECT INET_NTOA('2130706433');\n\n+-------------------------+\n| INET_NTOA('2130706433') |\n+-------------------------+\n| 127.0.0.1               | \n+-------------------------+\n1 row in set (0.02 sec)\n</code></pre>\n    "},{"t":"Is it possible to GROUP BY multiple columns using MySQL?","l":"http://stackoverflow.com/questions/1841426/is-it-possible-to-group-by-multiple-columns-using-mysql","q":"\n\n<p>Is it possible to <code>GROUP BY</code> more than one column in a MySQL <code>SELECT</code> query? For example:  </p>\n\n<pre><code>GROUP BY fV.tier_id AND 'f.form_template_id'\n</code></pre>\n    ","a":"\n<pre><code>GROUP BY col1, col2, col3\n</code></pre>\n    "},{"t":"What is the difference between a stored procedure and a view?","l":"http://stackoverflow.com/questions/5194995/what-is-the-difference-between-a-stored-procedure-and-a-view","q":"\n\n<p>I am confused about a few points:</p>\n\n<ol>\n<li><p>What is the difference between a stored procedure and a view?</p></li>\n<li><p>When should I use stored procedures, and when should I use views, in SQL Server?</p></li>\n<li><p>Do views allow the creation of dynamic queries where we can pass parameters? </p></li>\n<li><p>Which one is the fastest, and on what basis is one faster than the other?</p></li>\n<li><p>Do views or stored procedures allocate memory permanently?</p></li>\n<li><p>What does it mean if someone says that views create a virtual table, while procedures create a materials table?</p></li>\n</ol>\n\n<p>Please let me know about more points, if there are any.</p>\n    ","a":"\n<p>A view represents a <strong>virtual</strong> table.  You can join multiple tables in a view and use the view to present the data as if the data were coming from a single table.</p>\n\n<p>A stored procedure uses parameters to do a function... whether it is updating and inserting data, or returning single values or data sets.</p>\n\n<p><a href=\"https://msdn.microsoft.com/en-us/library/ms365311.aspx\" rel=\"nofollow\">Creating Views and Stored Procedures</a> - has some information from Microsoft as to when and why to use each.</p>\n\n<p>Say I have two tables:</p>\n\n<p>tbl_user\n Columns:\n   .user_id,\n   .user_name,\n   .user_pw</p>\n\n<p>tbl_profile\n Columns:\n   .profile_id,\n   .user_id\n   .profile_description</p>\n\n<p>So if i find myself querying from those tables ALOT... instead of doing the join in EVERY peice of sql i would define a view like:</p>\n\n<pre><code>CREATE View vw_user_profile\nAS\n  Select A.user_id, B.profile_description\n  FROM tbl_user A left join tbl_profile B on A.user_id = b.user_id\nGO\n</code></pre>\n\n<p>So in the future if i want to query profile_description by user id... all i have to do is</p>\n\n<pre><code>SELECT profile_description FROM vw_user_profile WHERE user_id = @ID\n</code></pre>\n\n<p>THAT code could be used in a stored procedure like:</p>\n\n<pre><code>create procedure dbo.getDesc\n @ID int\nAS\nbegin\nSELECT profile_description FROM vw_user_profile WHERE user_id = @ID\nEND\nGO\n</code></pre>\n\n<p>So later on i can call </p>\n\n<pre><code>dbo.getDesc 25\n</code></pre>\n\n<p>and I will get the description for user id 25. where the 25 is your parameter.</p>\n\n<p>There is obviously A LOT more detail, but, this is just the basic idea.</p>\n    "},{"t":"The maximum recursion 100 has been exhausted before statement completion","l":"http://stackoverflow.com/questions/9650045/the-maximum-recursion-100-has-been-exhausted-before-statement-completion","q":"\n\n<p>I keep getting a max recursion error with this query.</p>\n\n<p>At first I thought it was because a null was being returned and then it would try and match the null values causing the error however, I rewrote my query so nulls aren't returned and the error still occurs.</p>\n\n<p>What would be the best way to rewrite this function, so that the error will not occur</p>\n\n<pre><code>WITH EmployeeTree AS\n(\n    SELECT \n        EMP_SRC_ID_NR Id, USR_ACV_DIR_ID_TE Uuid, \n        CASE Employees.APV_MGR_EMP_ID \n           WHEN Null THEN '0' \n           ELSE Employees.APV_MGR_EMP_ID \n        END as  ApprovalManagerId \n    FROM \n        dbo.[tEmployees] as Employees WITH (NOLOCK)\n    WHERE \n        APV_MGR_EMP_ID = @Id \n        and Employees.APV_MGR_EMP_ID is not null \n        and Employees.EMP_SRC_ID_NR is not null  \n\n    UNION ALL\n\n    SELECT \n        EMP_SRC_ID_NR Id, USR_ACV_DIR_ID_TE Uuid, \n        CASE Employees.UPS_ACP_EMP_NR \n           WHEN Null THEN '1' \n           ELSE Employees.UPS_ACP_EMP_NR \n        END as ApprovalManagerId \n    FROM \n        dbo.[tEmployees] as Employees WITH (NOLOCK)\n    WHERE \n        UPS_ACP_EMP_NR = @Id \n        and Employees.APV_MGR_EMP_ID is not null \n        and Employees.EMP_SRC_ID_NR is not null  \n\n    UNION ALL\n\n    SELECT \n        Employees.EMP_SRC_ID_NR, Employees.USR_ACV_DIR_ID_TE, \n        CASE Employees.APV_MGR_EMP_ID \n            WHEN Null THEN '2' \n            ELSE Employees.APV_MGR_EMP_ID \n        END  \n    FROM \n        dbo.[tEmployees] as Employees WITH (NOLOCK)\n    JOIN \n        EmployeeTree ON Employees.APV_MGR_EMP_ID = EmployeeTree.Id \n    where  \n        Employees.APV_MGR_EMP_ID is not null \n        and Employees.EMP_SRC_ID_NR is not null             \n)\nSELECT \n    Id AS [EmployeeId], \n    Uuid AS [EmployeeUuid], \n    ApprovalManagerId AS [ManagerId] \nFROM EmployeeTree        \n</code></pre>\n    ","a":"\n<p>Specify the <a href=\"http://msdn.microsoft.com/en-us/library/ms175972.aspx\">maxrecursion option</a> at the end of the query:</p>\n\n<pre><code>...\nfrom EmployeeTree\noption (maxrecursion 0)\n</code></pre>\n\n<p>That allows you to specify how often the CTE can recurse before generating an error.  Maxrecursion 0 allows infinite recursion.</p>\n    "},{"t":"What should I name a table that maps two tables together?","l":"http://stackoverflow.com/questions/1813321/what-should-i-name-a-table-that-maps-two-tables-together","q":"\n\n<p><strong>Let's say I have two tables:</strong></p>\n\n<pre><code>Table: Color\nColumns: Id, ColorName, ColorCode\n\nTable: Shape\nColumns: Id, ShapeName, VertexList\n</code></pre>\n\n<p><strong>What should I call the table that maps color to shape?</strong></p>\n\n<pre><code>Table: ???\nColumns: ColorId, ShapeId\n</code></pre>\n    ","a":"\n<blockquote>\n  <p>There are only two hard things in\n  Computer Science: cache invalidation\n  and naming things<br>-- <a href=\"http://www.tbray.org/ongoing/When/200x/2005/12/23/UPI\">Phil Karlton</a></p>\n</blockquote>\n\n<p>Coming up with a good name for a table that represents a <code>many-to-many</code> relationship makes the relationship easier to read and understand. Sometimes finding a great name is not trivial but usually it is worth to spend some time thinking about.</p>\n\n<p>An example: <code>Reader</code> and <code>Newspaper</code>.</p>\n\n<p>A <code>Newspaper</code> has many <code>Readers</code> and a <code>Reader</code> has many <code>Newspapers</code></p>\n\n<p>You could call the relationship <code>NewspaperReader</code> but a name like <code>Subscription</code> might convey better what the table is about.</p>\n\n<p>The name <code>Subscription</code> also is more idiomatic in case you want to map the table to objects later on.</p>\n\n<p>The convention for naming <code>many-to-many</code> tables is a concatenation of the names of both tables that are involved in the relation. <code>ColourShape</code> would be a sensible default in your case. That said, I think Nick D <a href=\"http://stackoverflow.com/questions/1813321/what-should-i-call-a-table-that-maps-two-tables-together/1813377#1813377\">came up with</a> two great suggestions: <code>Style</code> and <code>Texture</code>.</p>\n    "},{"t":"how to rethrow same exception in sql server","l":"http://stackoverflow.com/questions/2481273/how-to-rethrow-same-exception-in-sql-server","q":"\n\n<p>I want to rethrow same exception in sql server that has been occured in my try block. \nI am able to throw same message but i want to throw same error.</p>\n\n<pre><code>BEGIN TRANSACTION\n    BEGIN TRY\n            INSERT INTO Tags.tblDomain \n            (DomainName, SubDomainId, DomainCode, Description)\n            VALUES(@DomainName, @SubDomainId, @DomainCode, @Description)\n            COMMIT TRANSACTION\n    END TRY\n\n    BEGIN CATCH\n            declare @severity int; \n            declare @state int;\n\n            select @severity=error_severity(), @state=error_state();\n\n            RAISERROR(@@Error,@ErrorSeverity,@state);\n            ROLLBACK TRANSACTION\n    END CATCH\n</code></pre>\n\n<blockquote>\n  <p><code>RAISERROR(@@Error, @ErrorSeverity, @state);</code></p>\n</blockquote>\n\n<p>This line will show error, but i want functionality something like that.\nThis raises error with error number 50000, but i want erron number to be thrown that i am passing <code>@@error</code>, </p>\n\n<p>I want to capture this error no at frontend</p>\n\n<p>i.e. </p>\n\n<pre><code>catch (SqlException ex)\n{\nif ex.number==2627\nMessageBox.show(\"Duplicate value cannot be inserted\");\n}\n</code></pre>\n\n<p>I want this functionality. which can't be achieved using raiseerror. I dont want to give custom error message at back end.</p>\n\n<p>RAISEERROR should return below mentioned error when i pass ErrorNo to be thrown in catch</p>\n\n<blockquote>\n<pre><code>Msg 2627, Level 14, State 1, Procedure spOTest_DomainInsert,\n</code></pre>\n  \n  <p>Line 14\n      Violation of UNIQUE KEY constraint 'UK_DomainCode'. Cannot insert\n  duplicate key in object\n  'Tags.tblDomain'.\n      The statement has been terminated.</p>\n</blockquote>\n\n<p><strong>EDIT:</strong></p>\n\n<p>What can be the drawback of not using try catch block if i want exception to be handled at frontend considering stored procedure contains multiple queries that need to be executed</p>\n    ","a":"\n<p>Here is a fully functional clean code sample to rollback a series of statements if an error occurs and report the error message.</p>\n\n<pre><code>begin try\n    begin transaction;\n\n    ...\n\n    commit transaction;\nend try\nbegin catch\n    declare @ErrorMessage nvarchar(max), @ErrorSeverity int, @ErrorState int;\n    select @ErrorMessage = ERROR_MESSAGE() + ' Line ' + cast(ERROR_LINE() as nvarchar(5)), @ErrorSeverity = ERROR_SEVERITY(), @ErrorState = ERROR_STATE();\n    rollback transaction;\n    raiserror (@ErrorMessage, @ErrorSeverity, @ErrorState);\nend catch\n</code></pre>\n    "},{"t":"Oracle DateTime in Where Clause?","l":"http://stackoverflow.com/questions/6749369/oracle-datetime-in-where-clause","q":"\n\n<p>I have sql something like this:</p>\n\n<pre><code>SELECT EMP_NAME, DEPT\nFROM EMPLOYEE\nWHERE TIME_CREATED &gt;= TO_DATE('26/JAN/2011','dd/mon/yyyy')\n</code></pre>\n\n<p>-&gt; This returns 10 rows and TIME_CREATED = '26-JAN-2011'</p>\n\n<p>Now when i do this i don't get any rows back,</p>\n\n<pre><code>SELECT EMP_NAME, DEPT\n    FROM EMPLOYEE\n    WHERE TIME_CREATED = TO_DATE('26/JAN/2011','dd/mon/yyyy')\n</code></pre>\n\n<p>-&gt; Took the greater than out</p>\n\n<p>Any reason why?</p>\n    ","a":"\n<p>Yes: TIME_CREATED contains a date and a <strong>time</strong>. Use <code>TRUNC</code> to strip the time:</p>\n\n<pre><code>SELECT EMP_NAME, DEPT\nFROM EMPLOYEE\nWHERE TRUNC(TIME_CREATED) = TO_DATE('26/JAN/2011','dd/mon/yyyy')\n</code></pre>\n\n<p><strong>UPDATE:</strong><br>\nAs Dave Costa points out in the comment below, this will prevent Oracle from using the index of the column <code>TIME_CREATED</code> if it exists. An alternative approach without this problem is this:</p>\n\n<pre><code>SELECT EMP_NAME, DEPT\nFROM EMPLOYEE\nWHERE TIME_CREATED &gt;= TO_DATE('26/JAN/2011','dd/mon/yyyy') \n      AND TIME_CREATED &lt; TO_DATE('26/JAN/2011','dd/mon/yyyy') + 1\n</code></pre>\n    "},{"t":"When to Denormalize a Database Design","l":"http://stackoverflow.com/questions/4301089/when-to-denormalize-a-database-design","q":"\n\n<p>I know that normalis(z)ation has been extensively discussed on Stack Overflow. I've read many of the previous discussions. I've got some additional questions though.</p>\n\n<p>I'm working on a legacy system with at least 100 tables. The database is has some un-normalized structure, tables that contain a variety of disparate data, and other problems. I've been given the task of trying to improve it. I can't just start again but need to modify the existing schema.</p>\n\n<p>In the past I have always tried to design normalized databases. Now the questions. A senior developer has suggested that in some cases we can't normalize:</p>\n\n<p>1) With temporal data. For example an invoice is created that links to a product. If a customer asks for a copy of this invoice a year later we must be able to produce an exact copy of the original. What if the product price, name or description have been updated? The senior guy suggested that the price and other product information should be copied to the invoice table. I'm thinking maybe we should have another table such as productPrice that has a date field so we can track changes in price over time. We would need the same thing for the product description and name I guess? Seems complicated. What do you think?</p>\n\n<p>2) The database is an accounting system. I'm not very familiar with accounting. At the moment some summary data is derived and stored in the database. For example total sales for the year. My senior associate has said that accountants like to check things are correct by comparing this value with data that is actually calculated from invoices etc to give them confidence that the application is working correctly. He said that at the moment for example we can tell if someone deleted an invoice from last year mistakenly because the totals will not be the same. He also pointed out that it could be quite slow to calculate these totals on the fly. Of course I said that data should not be duplicated and should always be calculated when needed. I suggested that we could use SQL Reporting Services or some other solution that will generate these reports overnight and cache them. Anyway he's not convinced. Any comments on this?</p>\n\n<p>Thanks very much :)<br>\nCheers<br>\nMark</p>\n\n<h2>EDIT</h2>\n\n<p>Thanks for the excellent responses. It's a pity I can only flag one as the answer because there's lots of good suggestions here.</p>\n    ","a":"\n<p>Your senior colleague is a developer, not a data modeller. You are better off starting from scratch, without them. Normalisation is complicated only to those who will not read books, and get their 'knowledge' from the amateurs at wiki.  It is fair enough that he makes you think, but some of the issues are absurd.</p>\n\n<p>Your numbers:</p>\n\n<ol>\n<li><p>You need to appreciate the differences between actual online data, and historic data; then the difference between merely historic and archival needs.  All of them are right for the specific business requirement, and wrong for all others, there is no universal right and wrong.</p>\n\n<ul>\n<li>why is there no paper-based copy of the invoice ?  In most countries that would be a legal and tax requirement, what exactly is the difficulty of fishing out the old invoice ?</li>\n<li>where the database has the <em>requirement</em> of storing the closed invoices, then sure, as soon as the invoice is closed, you need a method of capturing that information.</li>\n<li><code>ProductPrice</code> (actually, I would call it <code>ProductDate</code>) is a good idea, but may not be necessary. But you are right, you need to evaluate the currency of data, in the full context of the whole database.</li>\n<li>I cannot see how copying the product price to the invoice table would help (are not there many line items ?)</li>\n<li>in modern databases, where the <em>copy</em> of the invoice is required to be regurgitated, the closed Invoice is additionally stored in a different form, eg XML. One customer saves the PDFs as BLOBs. So there is no messing around with what the product price was five years ago.  But the basic invoice data is online and current, even for closed invoices; you just cannot recalculate ancient invoice using current prices.</li>\n<li>some people use an archive_invoice table, but that has problems because now every code segment or user report tool has to look in two places (note that these days some users understand databases better than most developers)</li>\n<li>Anyway, that is all discussion, for your understanding. None of the databases I have written in 30 years has ever had that sort of problem, and all of them comply with the legal and tax requirements.<br>\n<ul>\n<li>The database serves current and archival purposes from the one set of tables (no \"archive\" tables</li>\n<li>Once an Invoice is created, it is a legal document, and cannot be changed or deleted (it can be reversed or partially credited by a new Invoice, with negative values).  They are marked <code>IsIssued/IsPaid/Etc</code></li>\n<li><code>Products</code> cannot be deleted, they can be marked <code>IsObsolete</code></li>\n<li>There are separate tables for InvoiceHeader and InvoiceItem</li>\n<li><code>InvoiceItem</code> has FKs to both <code>InvoiceHeader</code> and <code>Product</code></li>\n<li>for many reasons (not only those you mention), the InvoiceItem row contains the <code>NumUnits; ProductPrice; TaxAmount; ExtendedPrice</code>.  Sure, this looks like a \"denormalisation\" but it is not, because prices, taxation rates, etc, are subject to change.  But more important, the legal requirement is that we can reproduce the old invoice on demand.</li>\n<li>(where it can be reproduced from paper files, this is not required)</li>\n<li>the <code>InvoiceTotalAmount</code> is a derived column, just <code>SUM()</code> of the InvoiceItems<br>\n.  </li>\n</ul></li>\n</ul></li>\n<li><p>That is rubbish.  Accounting systems, and accountants do not \"work\" like that.  </p>\n\n<ul>\n<li><p>If it is a true accounting system, then it will have JournalEntries, or \"double entry\"; that is what a qualified account is required to use (by law).</p>\n\n<ul>\n<li>Double Entry does not mean duplicate entry; it means every financial transaction (one amount) shall have a source account and target account that it is applied to; so there is no \"denormalisation\" or duplication.  In a banking database, because the financial transactions are against single accounts, that is commonly rendered as two separate financial transactions (rows) within one Db Transaction.  Ordinary commercial database constraints are used to ensure that there are two \"sides\" to every financial transaction.<br>\n.</li>\n</ul></li>\n<li><p>Ensuring that Invoices are not deleteable is a separate issue, to do with security, etc.  if anyone is paranoid about things being deleted from their database, <strong>and</strong> their database was not secured by a qualified person, then they have more and different problems that have nothing to do with this question.  Obtain a security audit, and do whatever they tell you.</p></li>\n<li><p><em>There are a few people on this site who think wiki is a place that you can learn something.  It isn't.  It is a cesspool of \"definitions\" written by amateurs, and the \"definitions\" are constantly changed by other amateurs.  No fixed definition that you can rely on.  So don't worry about what wiki says or what people say wiki says, the moment they mention wiki, you know their \"knowledge\" come from reading not qualification; and what they are reading is an ever-changing cesspit. They will predictably argue about \"definitions\" because they have no actual experience; the experienced will just get on with the job</em></p></li>\n<li><p>A Normalised database is always much faster than Unnormalised database.  So it is very important to understand what Normalisation and Denormalisaion is, and what it isn't.  The process is greatly hindered when people have fluid and amateur \"definitions\", it just leads to confusion and time-wasting \"discussions\".  When you have fixed definitions, you can avoid all that, and just get on with the job.</p></li>\n<li><p>Summary tables are quite normal, to save the time and processing power, of recalculating info that does not change, eg: YTD totals for every year but this year; MTD totals for every month in this year but not this month. \"Always recalculating\" data is a bit silly when (a) the info is very large and (b) does not change.  Calculate for the current month only</p>\n\n<ul>\n<li>In banking systems (millions of Trades per day), at EndOfDay, we calculate and store Daily Total as well.  These are overwritten for the last five days, because Audiitors are making changes, and JournalEntries against financial transactions for the last 5 days are allowed.</li>\n<li>non-banking systems generally do not need daily totals<br>\n.  </li>\n</ul></li>\n<li><p>Summary tables are not a \"denormalisation\" (except in the eyes of those who have just learned about \"normalisation\" from their magical, ever-changing fluid \"source\"; or as non-practitioners, who apply simple black-or-white rules to everything).  Again, the definition is not being argued here; it simply <em>does not apply</em> to Summary tables.</p></li>\n<li><p>Summary tables do not affect data integrity (assuming of course that the data that they were sourced from was integral).</p></li>\n<li><p>Summary tables are an <strong>addition</strong> to the database, which are not required to have the same constraints as the database.  There are essentially reporting tables or data warehouse tables, as opposed to database tables.</p></li>\n<li><p>There are no Update Anomalies (which is a strict definition) related to Summary tables.  You cannot change or delete an invoice from last year.  Update Anomalies apply to true Denormalised or Unnormalised current data.</p></li>\n</ul></li>\n</ol>\n    "},{"t":"MySQL Curdate() vs now()","l":"http://stackoverflow.com/questions/4397755/mysql-curdate-vs-now","q":"\n\n<p>What is difference between MySQL Curdate() and Now() ?</p>\n    ","a":"\n<p>For questions like this, it is always worth taking a look in the manual first. <a href=\"http://dev.mysql.com/doc/refman/5.0/en/date-and-time-functions.html\">Date and time functions in the mySQL manual</a></p>\n\n<p><code>CURDATE()</code> returns the DATE part of the current time. <a href=\"http://dev.mysql.com/doc/refman/5.0/en/date-and-time-functions.html#function_curdate\">Manual on CURDATE()</a></p>\n\n<p><code>NOW()</code> returns the date and time portions as a timestamp in various formats, depending on how it was requested. <a href=\"http://dev.mysql.com/doc/refman/5.0/en/date-and-time-functions.html#function_now\">Manual on NOW()</a>.</p>\n    "},{"t":"Execute raw SQL using Doctrine 2","l":"http://stackoverflow.com/questions/3325012/execute-raw-sql-using-doctrine-2","q":"\n\n<p>I want to execute raw SQL using Doctrine 2</p>\n\n<p>I need to truncate the database tables and initialize tables with default test data.</p>\n    ","a":"\n<p>I found out the answer is probably:</p>\n\n<blockquote>\n  <p>A NativeQuery lets you execute native\n  SQL, mapping the results according to\n  your specifications. Such a\n  specification that describes how an\n  SQL result set is mapped to a Doctrine\n  result is represented by a\n  ResultSetMapping.</p>\n</blockquote>\n\n<p>Source: <a href=\"https://doctrine-orm.readthedocs.org/en/latest/reference/native-sql.html\" rel=\"nofollow\">Native SQL</a>.</p>\n    "},{"t":"SQL NOT IN not working","l":"http://stackoverflow.com/questions/5231712/sql-not-in-not-working","q":"\n\n<p>I have two databases, one which holds the inventory, and another which contains a subset of the records of the primary database.</p>\n\n<p>The following SQL statement is not working:</p>\n\n<pre><code>SELECT  stock.IdStock\n        ,stock.Descr       \nFROM    [Inventory].[dbo].[Stock] stock\nWHERE   stock.IdStock NOT IN\n        (SELECT foreignStockId FROM\n         [Subset].[dbo].[Products])\n</code></pre>\n\n<p>The not in does not work. Removing the NOT gives the correct results, i.e. products that are in both databases. However, using the NOT IN is not returning ANY results at all.</p>\n\n<p>What am I doing wrong, any ideas?</p>\n    ","a":"\n<pre><code>SELECT foreignStockId\nFROM   [Subset].[dbo].[Products]  \n</code></pre>\n\n<p>Probably returns a <code>NULL</code>. </p>\n\n<p>A <code>NOT IN</code> query will not return any rows if any <code>NULL</code>s exists in the list of <code>NOT IN</code> values. You can explicitly exclude them using <code>IS NOT NULL</code> as below.</p>\n\n<pre><code>SELECT stock.IdStock,\n       stock.Descr\nFROM   [Inventory].[dbo].[Stock] stock\nWHERE  stock.IdStock NOT IN (SELECT foreignStockId\n                             FROM   [Subset].[dbo].[Products]\n                             WHERE  foreignStockId IS NOT NULL) \n</code></pre>\n\n<p>Or rewrite using <code>NOT EXISTS</code> instead.</p>\n\n<pre><code>SELECT stock.idstock,\n       stock.descr\nFROM   [Inventory].[dbo].[Stock] stock\nWHERE  NOT EXISTS (SELECT *\n                   FROM   [Subset].[dbo].[Products] p\n                   WHERE  p.foreignstockid = stock.idstock) \n</code></pre>\n\n<p>As well as having the semantics that you want the execution plan for <code>NOT EXISTS</code> is often simpler <a href=\"http://stackoverflow.com/a/11074428/73226\">as looked at here</a>.</p>\n\n<p>The reason for the difference in behaviour is down to the  <a href=\"http://www.simple-talk.com/sql/learn-sql-server/sql-and-the-snare-of-three-valued-logic/\">three valued logic</a> used in SQL. Predicates can evaluate to <code>True</code>, <code>False</code>, or <code>Unknown</code>. </p>\n\n<p>A <code>WHERE</code> clause must evaluate to <code>True</code> in order for the row to be returned but this is not possible with <code>NOT IN</code> when <code>NULL</code> is present as explained below.</p>\n\n<p><code>'A' NOT IN ('X','Y',NULL)</code> is equivalent to <code>'A' &lt;&gt; 'X' AND 'A' &lt;&gt; 'Y' AND 'A' &lt;&gt; NULL)</code></p>\n\n<ul>\n<li>'A' &lt;&gt; 'X'  = <code>True</code></li>\n<li>'A' &lt;&gt; 'Y'  = <code>True</code></li>\n<li>'A' &lt;&gt; NULL = <code>Unknown</code></li>\n</ul>\n\n<p><code>True AND True AND Unknown</code> evaluates to <code>Unknown</code> per the <a href=\"http://en.wikipedia.org/wiki/Three-valued_logic#Kleene_logic\">truth tables for three valued logic</a>.</p>\n\n<p>The following links have some additional discussion about performance of the various options.</p>\n\n<ul>\n<li><a href=\"http://www.sqlperformance.com/2012/12/t-sql-queries/left-anti-semi-join\">Should I use <code>NOT IN</code>, <code>OUTER APPLY</code>, <code>LEFT OUTER JOIN</code>, <code>EXCEPT</code>, or <code>NOT EXISTS</code>?</a></li>\n<li><a href=\"http://explainextended.com/2009/09/15/not-in-vs-not-exists-vs-left-join-is-null-sql-server/\"><code>NOT IN</code> vs. <code>NOT EXISTS</code> vs. <code>LEFT JOIN / IS NULL</code>: SQL Server</a></li>\n<li><a href=\"http://sqlinthewild.co.za/index.php/2010/03/23/left-outer-join-vs-not-exists/\"><code>Left outer join</code> vs <code>NOT EXISTS</code></a></li>\n<li><a href=\"http://sqlinthewild.co.za/index.php/2010/02/18/not-exists-vs-not-in/\"><code>NOT EXISTS</code> vs <code>NOT IN</code></a></li>\n</ul>\n    "},{"t":"Why can't I use an alias in a DELETE statement?","l":"http://stackoverflow.com/questions/11005209/why-cant-i-use-an-alias-in-a-delete-statement","q":"\n\n<p>In SQL Server Compact Edition in Visual Studio 2010 (maybe SQL Server and SQL in general, I don't know), this command works:</p>\n\n<pre><code>DELETE FROM foods WHERE (name IN ('chickens', 'rabbits'))\n</code></pre>\n\n<p>but this command produces an error of: <code>Error near identifier f. Expecting OUTPUT.</code></p>\n\n<pre><code>DELETE FROM foods f WHERE (f.name IN ('chickens', 'rabbits'))\n</code></pre>\n    ","a":"\n<p>To alias the table you'd have to say:</p>\n\n<pre><code>DELETE f FROM dbo.foods AS f WHERE (f.name IN ...);\n</code></pre>\n\n<p>But I fail to see the point of aliasing for this <code>DELETE</code> statement, especially since (at least IIRC) this no longer conforms to strict ANSI.</p>\n    "},{"t":"What is the linq equivalent to the SQL IN operator","l":"http://stackoverflow.com/questions/2334327/what-is-the-linq-equivalent-to-the-sql-in-operator","q":"\n\n<p>With linq i have to check if a value of a row is present in a array.<br>\nThe equivalent of the sql query:</p>\n\n<pre><code>WHERE ID IN (2,3,4,5)\n</code></pre>\n\n<p>How can i do?</p>\n\n<p>thanks</p>\n    ","a":"\n<p>.Contains</p>\n\n<pre><code>var resultset = from x in collection where new[] {2,3,4,5}.Contains(x) select x\n</code></pre>\n\n<p>Of course, with your simple problem, you could have something like:</p>\n\n<pre><code>var resultset = from x in collection where x &gt;= 2 &amp;&amp; x &lt;= 5 select x\n</code></pre>\n    "},{"t":"Could somebody explain SOLR requestHandlers and responseWriters in detail?","l":"http://stackoverflow.com/questions/2147346/could-somebody-explain-solr-requesthandlers-and-responsewriters-in-detail","q":"\n\n<p>Firstly, many parts of the solr wiki is not very useful for somebody who just learned how to index and search fields. It seems it is written for experts! It uses terms that is RELATIVE to solr, so it's very difficult to understand it without reading it several times over.</p>\n\n<p><strong>NOTE</strong>: I have a classifieds website where the most recent ads always shows up first, so sorting is not relevant for me, except for sorting on price and date no other options are available for the users, and also how many results per page.</p>\n\n<p>I know a <code>requestHandler</code> is a way to \"do some stuff to the query\" right?\nBut how to know which handler to use is hard for me. And how to configure one also.\nAll I know is the handler is specified in the query-string like \"<code>qt=my_handler</code>\".</p>\n\n<p>Also, the same questions apply to <code>responseWriters</code>, which to use? How to configure?</p>\n\n<p>What else should I know about these handlers?</p>\n\n<p>How is a good and effective way to use them?</p>\n\n<p>I really should write something up about getting solr implemented into a PHP website after I learned all these things.</p>\n\n<p>Thanks for all your help!</p>\n    ","a":"\n<p>In Solr, a RequestHandler is essentially a plugin (module of logic) that handles incoming requests in a particular way.</p>\n\n<p>Rather than \"doing\" some stuff to the actually search query, request handlers can provide functionality beyond queries, like for example data import.</p>\n\n<p>Normally request handlers in Solr are configured to be specific endpoints (i.e. URL's), and not selected through the <strong>qt</strong> parameter. However, search specific handlers may use the query type parameter to handle a query in a specific way (i.e. one handler may be able to deal with various query types).</p>\n\n<p>What handler to use, will normally depend on what you want to achieve. I would suggest that you check out the list of provided handlers, and match their descriptions (many have Wiki pages) to what you want to do.</p>\n\n<p>For queries, other than the default SearchHandler, the most commonly used request handler is the DisMaxRequestHandler (<em>qt=dismax</em>), that will essentially provide a search across several fields using different weighting based on field significance. This is often referred to by people as \"Google like\" searching. </p>\n\n<p>Also, you may be interested in looking at the MoreLikeThisHandler, that was designed to provide hits that are similar to a specific document (for example from a previous search result).</p>\n\n<p>Note that as a source of confusion, the DisMaxRequestHandler in newer versions of Solr is actually provided by the default SearchHandler with a query type of <em>dismax</em>.</p>\n\n<p>Handlers are configured in <em>solrconfig.xml</em>:</p>\n\n<pre><code>&lt;requestHandler name=\"dismax\" class=\"solr.SearchHandler\" &gt;\n&lt;lst name=\"defaults\"&gt;\n &lt;str name=\"defType\"&gt;dismax&lt;/str&gt;\n &lt;str name=\"echoParams\"&gt;explicit&lt;/str&gt;\n &lt;float name=\"tie\"&gt;0.01&lt;/float&gt;\n &lt;str name=\"qf\"&gt;\n    id^10.0 keyword^1.5 title^1.0 region^0.5 country^0.5 city^0.5\n &lt;/str&gt;\n &lt;str name=\"pf\"&gt;\n    keyword^1.5 title^1.0 region^0.5 country^0.5 city^0.5\n &lt;/str&gt;\n &lt;str name=\"bf\"&gt;\n &lt;/str&gt;\n &lt;str name=\"mm\"&gt;\n    2&amp;lt;-1 5&amp;lt;-2 6&amp;lt;90%\n &lt;/str&gt;\n &lt;int name=\"ps\"&gt;100&lt;/int&gt;\n &lt;str name=\"q.alt\"&gt;*:*&lt;/str&gt;\n\n &lt;!-- example highlighter config, enable per-query with hl=true --&gt;\n &lt;str name=\"hl.fl\"&gt;text features name&lt;/str&gt;\n &lt;!-- for this field, we want no fragmenting, just highlighting --&gt;\n &lt;str name=\"f.name.hl.fragsize\"&gt;0&lt;/str&gt;\n &lt;!-- instructs Solr to return the field itself if no query terms are\n      found --&gt;\n &lt;str name=\"f.name.hl.alternateField\"&gt;name&lt;/str&gt;\n &lt;str name=\"f.text.hl.fragmenter\"&gt;regex&lt;/str&gt; &lt;!-- defined below --&gt;\n&lt;/lst&gt;\n</code></pre>\n\n<p></p>\n\n<p>In this case, <em>qf</em> are the fields and boosts to apply for each field. The above configuration will search across id, keyword, title, region, country and city. Check out the corresponding Wiki page for more info (DisMaxRequestHandler applies).</p>\n\n<p>The most effective way to use them is certainly to first know what exactly you want to achieve, then find the best match in terms of the handler, and then subsequently tune the configuration to provide the results you and your community would expect.</p>\n\n<p>Response writers are plugins (modules of logic) that will provide the ways and means to write responses in specific formats. Currently this concept applies mainly to searches, where you will be dealing with derivatives of the QueryResponseWriter, which in turn will be selected by the response format parameter <strong>wt</strong> (in the query).</p>\n\n<p>If you are working with PHP, then you will certainly be interested in generating PHP friendly responses to your requests, using <em>wt=php</em> or <em>wt=phps</em>.</p>\n\n<p>The <em>php</em> response can be evaled:</p>\n\n<pre><code>$code = file_get_contents('http://localhost:8983/solr/select?q=iPod&amp;wt=php');\neval(\"\\$result = \" . $code . \";\");\nprint_r($result);\n</code></pre>\n\n<p>and the <em>phps</em> response can be read with PHP's serialization mechanism:</p>\n\n<pre><code>$serializedResult = file_get_contents('http://localhost:8983/solr/select?q=iPod&amp;wt=phps');\n$result = unserialize($serializedResult);\nprint_r($result);\n</code></pre>\n\n<p>There is support for others (like Ruby, Python, Java Binary, etc), which essentially have been build to make it easier for developers to integrate SOLR into their web applications using mechanisms that are faster than parsing XML or JSON.</p>\n\n<p>However, there are are also other types of ResponseWriter's that actually <em>transform</em> the response based on a template (e.g. Velocity) or a transform (e.g. XSLT). This can be useful in certain situations, where you don't want to depend on another application to process the query results (e.g. XSLT directly into XHTML).</p>\n\n<p>Response Writers are also configured in the <em>solrconfig.xml</em>, normally you will enable those that you are interested in e.g.:</p>\n\n<pre><code>&lt;queryResponseWriter name=\"xml\" class=\"org.apache.solr.request.XMLResponseWriter\" default=\"true\"/&gt;\n&lt;queryResponseWriter name=\"json\" class=\"org.apache.solr.request.JSONResponseWriter\"/&gt;\n&lt;queryResponseWriter name=\"php\" class=\"org.apache.solr.request.PHPResponseWriter\"/&gt;\n&lt;queryResponseWriter name=\"phps\" class=\"org.apache.solr.request.PHPSerializedResponseWriter\"/&gt;\n</code></pre>\n\n<p>The most effective way to use them depends on your environment and what you want to achieve. Obviously if you are in PHP, a <em>phps</em> may give you better (easy access through the language) and faster (built-in serialization mechanism, less verbose) results. If in Javascript, <em>json</em> may just be the way to go etc.</p>\n\n<p>You see, SOLR is a powerful and versatile plattform :)\nIf you want to figure a way through the jungle you may want to resort to some book, like <a href=\"http://www.packtpub.com/solr-1-4-enterprise-search-server\">\"Solr 1.4 Enterprise Search Server\"</a> (although I am not sure it really does the best possible job as an introduction). Many things you can best figure out by trial-and-error as well as patience and some online help.</p>\n\n<p>Hope this helps to get you going.</p>\n    "},{"t":"Convert Rows to columns using 'Pivot' in SQL Server","l":"http://stackoverflow.com/questions/15931607/convert-rows-to-columns-using-pivot-in-sql-server","q":"\n\n<p>Well I guess I am really dense. I have read the stuff on MS pivot tables and I am still having problems getting this correct. I have seen some of you that seem to eat and sleep this stuff, so I just decided to sign-up and ask the question.</p>\n\n<p>I have a temp table that is being created, we will say that column 1 is a Store number, and column 2 is a week number and lastly column 3 is a total of some type. Also the Week numbers are dynamic, the store numbers are static.</p>\n\n<pre><code>Store      Week     xCount\n-------    ----     ------\n102        1        96\n101        1        138\n105        1        37\n109        1        59\n101        2        282\n102        2        212\n105        2        78\n109        2        97\n105        3        60\n102        3        123\n101        3        220\n109        3        87\n</code></pre>\n\n<p>I would like it to come out as a pivot table, like this:</p>\n\n<pre><code>Store        1          2          3        4        5        6....\n----- \n101        138        282        220\n102         96        212        123\n105         37        \n109\n</code></pre>\n\n<p>Store numbers down the side and weeks across the top.</p>\n\n<p>Thanks for the help.</p>\n    ","a":"\n<p>If you are using SQL Server 2005+, then you can use the <code>PIVOT</code> function to transform the data from rows into columns.</p>\n\n<p>It sounds like you will need to use dynamic sql if the weeks are unknown but it is easier to see the correct code using a hard-cded version initially.</p>\n\n<p>If your values, then you will hard-code the query:</p>\n\n<pre><code>select *\nfrom \n(\n  select store, week, xCount\n  from yt\n) src\npivot\n(\n  sum(xcount)\n  for week in ([1], [2], [3])\n) piv;\n</code></pre>\n\n<p>See <a href=\"http://sqlfiddle.com/#!3/7d09c/1\">SQL Fiddle with Demo</a></p>\n\n<p>Then if you need to generate the week number dynamically, your code will be:</p>\n\n<pre><code>DECLARE @cols AS NVARCHAR(MAX),\n    @query  AS NVARCHAR(MAX)\n\nselect @cols = STUFF((SELECT ',' + QUOTENAME(Week) \n                    from yt\n                    group by Week\n                    order by Week\n            FOR XML PATH(''), TYPE\n            ).value('.', 'NVARCHAR(MAX)') \n        ,1,1,'')\n\nset @query = 'SELECT store,' + @cols + ' from \n             (\n                select store, week, xCount\n                from yt\n            ) x\n            pivot \n            (\n                sum(xCount)\n                for week in (' + @cols + ')\n            ) p '\n\nexecute(@query);\n</code></pre>\n\n<p>See <a href=\"http://sqlfiddle.com/#!3/7d09c/3\">SQL Fiddle with Demo</a>.</p>\n\n<p>The dynamic version, generates the list of <code>week</code> numbers that should be converted to columns. Both give the same result:</p>\n\n<pre><code>| STORE |   1 |   2 |   3 |\n---------------------------\n|   101 | 138 | 282 | 220 |\n|   102 |  96 | 212 | 123 |\n|   105 |  37 |  78 |  60 |\n|   109 |  59 |  97 |  87 |\n</code></pre>\n    "},{"t":"SQL Server 2008: The columns in table do not match an existing primary key or unique constraint","l":"http://stackoverflow.com/questions/4667818/sql-server-2008-the-columns-in-table-do-not-match-an-existing-primary-key-or-un","q":"\n\n<p>I need to make some changes to a SQL Server 2008 database. </p>\n\n<p>This requires the creation of a new table, and inserting a foreign key in the new table that references the Primary key of an already existing table. So I want to set up a relationship between my new tblTwo, which references the primary key of tblOne. </p>\n\n<p>However when I tried to do this (through SQL Server Management Studio) I got the following error:</p>\n\n<blockquote>\n  <p>The columns in table 'tblOne' do not\n  match an existing primary key or\n  UNIQUE constraint</p>\n</blockquote>\n\n<p>I'm not really sure what this means, and I was wondering if there was any way around it?</p>\n    ","a":"\n<p>It means that the primary key in tblOne hasn't been properly declared - you need to go to tblOne and add the PRIMARY KEY constraint back onto it.</p>\n\n<p>If you're sure that tblOne does have a PRIMARY KEY constraint, then maybe there are multiple tblOne tables in your DB, belonging to different schemas, and your references clause in your FK constraint is picking the wrong one.</p>\n\n<p>If there's a composite key (which your comment would indicate), then you have to include both columns in your foreign key reference also. Note that a table can't have multiple primary keys - but if it has a composite key, you'll see a key symbol next to each column that is part of the primary key.</p>\n    "},{"t":"The parameterized query expects the parameter which was not supplied","l":"http://stackoverflow.com/questions/3865982/the-parameterized-query-expects-the-parameter-which-was-not-supplied","q":"\n\n<p>I'm having a problem with my code:</p>\n\n<pre><code>Private Sub TextBox2_TextChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles TextBox2.TextChanged\n    list.Items.Clear()\n\n    cmd.CommandText = \"SELECT * FROM borrow where (Department LIKE '%\" &amp; TextBox2.Text &amp; \"%')\"\n    cmd.Connection = con\n    cmd.CommandType = CommandType.Text\n    con.Open()\n\n\n    rd = cmd.ExecuteReader()\n    If rd.HasRows = True Then\n        While rd.Read()\n\n            Dim listview As New ListViewItem\n\n            listview.Text = rd(\"ID\").ToString\n            listview.SubItems.Add(rd(\"Department\").ToString)\n            listview.SubItems.Add(rd(\"Purpose\").ToString)\n            listview.SubItems.Add(rd(\"Items_Details\").ToString)\n            listview.SubItems.Add(rd(\"Requested_by\").ToString)\n            listview.SubItems.Add(rd(\"Approved_by\").ToString)\n            listview.SubItems.Add(rd(\"Date\").ToString)\n            listview.SubItems.Add(rd(\"Status\").ToString)\n            listview.SubItems.Add(rd(\"Date_Returned\").ToString)\n\n            list.Items.Add(listview)\n\n        End While\n    End If\n    con.Close()\n</code></pre>\n\n<p>Once I typed in the string in the textbox to search for an item I get this error: </p>\n\n<blockquote>\n  <p>The parameterized query '(@Parameter1 nvarchar(4000))SELECT * FROM\n  borrow where (Departme' expects the parameter '@Parameter1', which was\n  not supplied.</p>\n</blockquote>\n\n<p>Can anyone help me?</p>\n    ","a":"\n<p>If you pass null value to parameter,you will get this error even after you add the parameter\nso try to check the value and if it null then use DBNull.Value </p>\n\n<p>This will work</p>\n\n<pre><code>cmd.Parameters.Add(\"@Department\", SqlDbType.VarChar)\n\nif (TextBox2.Text==null) {\n    cmd.Parameters(\"@Department\").Value = DBNull.Value;\n} else {\n    cmd.Parameters(\"@Department\").Value = TextBox2.Text;\n}\n</code></pre>\n\n<p>This will convert the null values from the object layer to DBNull values that are acceptable to the database.</p>\n    "},{"t":"MySQL combine two columns and add into a new column","l":"http://stackoverflow.com/questions/5774532/mysql-combine-two-columns-and-add-into-a-new-column","q":"\n\n<p>I have the following structure with a MySQL table:</p>\n\n<pre><code>+----------------+----------------+----------+\n|    zipcode     |      city      |   state  |\n+----------------+----------------+----------+\n|     10954      |     Nanuet     |    NY    |\n+----------------+----------------+----------+\n</code></pre>\n\n<p>I want to combine the above 3 columns into one column like this:</p>\n\n<pre><code>+---------------------+\n|      combined       |\n+---------------------+\n| 10954 - Nanuet, NY  |\n+---------------------+\n</code></pre>\n\n<p>And I want to add this \"combined\" column to the end of the table without destroying the original 3 fields.</p>\n    ","a":"\n<p>Create the column:</p>\n\n<pre><code>alter table add column combined varchar(50);\n</code></pre>\n\n<p>Update the current values:</p>\n\n<pre><code>update table set combined = concat(zipcode, ' - ', city, ', ', state);\n</code></pre>\n\n<p>Update all future values automatically:</p>\n\n<pre><code>create trigger insert_trigger\nbefore insert on table\nfor each row\nset new.combined = concat(new.zipcode, ' - ', new.city, ', ', new.state);\n\ncreate trigger update_trigger\nbefore update on table\nfor each row\nset new.combined = concat(new.zipcode, ' - ', new.city, ', ', new.state);\n</code></pre>\n    "},{"t":"MySQL, Concatenate two columns","l":"http://stackoverflow.com/questions/10346302/mysql-concatenate-two-columns","q":"\n\n<p>There are two columns in a MySQL table: <code>SUBJECT</code> and <code>YEAR</code>. </p>\n\n<p>I want to generate an alphanumeric unique number which holds the concatenated data from SUBJECT and YEAR.</p>\n\n<p>How can I do this?  Is it possible to use a simple operator like <code>+</code>?</p>\n    ","a":"\n<p>You can use the <a href=\"http://dev.mysql.com/doc/refman/5.5/en/string-functions.html#function_concat\"><code>CONCAT</code></a> function like this:</p>\n\n<pre><code>SELECT CONCAT(`SUBJECT`, ' ', `YEAR`) FROM `table`\n</code></pre>\n\n<p>Update:</p>\n\n<p>To get that result you can try this:</p>\n\n<pre><code>SET @rn := 0;\n\nSELECT CONCAT(`SUBJECT`,'-',`YEAR`,'-',LPAD(@rn := @rn+1,3,'0'))\nFROM `table`\n</code></pre>\n    "},{"t":"Select values that meet different conditions on different rows?","l":"http://stackoverflow.com/questions/477006/select-values-that-meet-different-conditions-on-different-rows","q":"\n\n<p>This is a very basic query I can't figure out....</p>\n\n<p>Let's say I have a two column table like this:</p>\n\n<pre><code>userid  |  roleid\n--------|--------\n   1    |    1\n   1    |    2\n   1    |    3\n   2    |    1\n</code></pre>\n\n<p>I want to get all distinct userids that have <code>roleids</code> 1, 2 AND 3.  Using the above example, the only result I want returned is <code>userid</code> 1.  How do I do this?</p>\n    ","a":"\n<pre><code>SELECT userid\nFROM UserRole\nWHERE roleid IN (1, 2, 3)\nGROUP BY userid\nHAVING COUNT(DISTINCT roleid) = 3;\n</code></pre>\n\n<hr>\n\n<p>To anyone reading this:  my answer is simple and straightforward, and got the 'accepted' status, but please do go read the <a href=\"http://stackoverflow.com/questions/477006/sql-statement-join-vs-group-by-and-having/477013#477013\">answer</a> given by @cletus.  It has much better performance.</p>\n\n<hr>\n\n<p>Justing thinking out loud, another way to write the self-join described by @cletus is:</p>\n\n<pre><code>SELECT t1.userid\nFROM userrole t1\nJOIN userrole t2 ON t1.userid = t2.userid\nJOIN userrole t3 ON t2.userid = t3.userid\nWHERE (t1.roleid, t2.roleid, t3.roleid) = (1, 2, 3);\n</code></pre>\n\n<p>This might be easier to read for you, and MySQL supports comparisons of tuples like that.  MySQL also knows how to utilize covering indexes intelligently for this query.  Just run it through <code>EXPLAIN</code> and see \"Using index\" in the notes for all three tables, which means it's reading the index and doesn't even have to touch the data rows.  </p>\n\n<p>I ran this query over 2.1 million rows (the Stack Overflow July data dump for PostTags) using MySQL 5.1.48 on my Macbook, and it returned the result in 1.08 sec.  On a decent server with enough memory allocated to <code>innodb_buffer_pool_size</code>, it should be even faster.</p>\n    "},{"t":"Find duplicate rows with PostgreSQL","l":"http://stackoverflow.com/questions/14471179/find-duplicate-rows-with-postgresql","q":"\n\n<p>We have a table of photos with the following columns. </p>\n\n<pre><code>id, merchant_id, url \n</code></pre>\n\n<p>this table contains duplicate values for the combination merchant_id, url. so it's possible that one row  appears more several times. </p>\n\n<pre><code>234 some_merchant  http://www.some-image-url.com/abscde1213\n235 some_merchant  http://www.some-image-url.com/abscde1213\n236 some_merchant  http://www.some-image-url.com/abscde1213\n</code></pre>\n\n<p>What is the best way to delete those duplications?\n(I use PostgreSQL 9.2 and Rails 3.)</p>\n    ","a":"\n<p>Here is my take on it.  </p>\n\n<pre><code>select * from (\n  SELECT id,\n  ROW_NUMBER() OVER(PARTITION BY merchant_Id, url ORDER BY id asc) AS Row\n  FROM Photos\n) dups\nwhere \ndups.Row &gt; 1\n</code></pre>\n\n<p>Feel free to play with the order by to tailor the records you want to delete to your specification.</p>\n\n<p>Hope this helps,\nMatt</p>\n\n<p>SQL Fiddle =&gt; <a href=\"http://sqlfiddle.com/#!12/796d6/10\">http://sqlfiddle.com/#!12/796d6/10</a></p>\n    "},{"t":"How to part DATE and TIME from DATETIME in MySQL","l":"http://stackoverflow.com/questions/12337195/how-to-part-date-and-time-from-datetime-in-mysql","q":"\n\n<p>I am storing a  <strong>DATETIME</strong> field in a Table. After Storing the value its come like \n<strong>2012-09-09 06:57:12</strong> . </p>\n\n<p>For storing I am using the syntax:</p>\n\n<pre><code>   date(\"Y-m-d H:i:s\");\n</code></pre>\n\n<p>Now My Question is, While Fetching the data, How can get both <strong>date and time separate</strong>, using the single MySQL query.</p>\n\n<p>Date like <strong>2012-09-09</strong> and time like <strong>06:57:12</strong>. </p>\n    ","a":"\n<p>You can achieve that using <strong><a href=\"http://davidwalsh.name/format-date-mysql-date_format\">DATE_FORMAT()</a></strong> (<em>click the link for more other formats</em>)</p>\n\n<pre><code>SELECT DATE_FORMAT(colName, '%Y-%m-%d') DATEONLY, \n       DATE_FORMAT(colName,'%H:%i:%s') TIMEONLY\n</code></pre>\n\n<h1><a href=\"http://sqlfiddle.com/#!2/d41d8/1842\">SQLFiddle Demo</a></h1>\n    "},{"t":"How do I use on delete cascade in mysql?","l":"http://stackoverflow.com/questions/511361/how-do-i-use-on-delete-cascade-in-mysql","q":"\n\n<p>I have a database of components. Each component is of a specific type. That means there is a many-to-one relationship between a component and a type. When I delete a type, I would like to delete all the components which has a foreign key of that type. But if I'm not mistaken, cascade delete will delete the type when the component is deleted. Is there any way to do what I described?</p>\n    ","a":"\n<p>Here's what you'd include in your components table.</p>\n\n<pre><code>CREATE TABLE `components` (\n    `id` int(10) unsigned NOT NULL auto_increment,\n    `typeId` int(10) unsigned NOT NULL,\n    `moreInfo` VARCHAR(32), \n    -- etc\n    PRIMARY KEY (`id`),\n    KEY `type` (`typeId`)\n    CONSTRAINT `myForeignKey` FOREIGN KEY (`typeId`)\n      REFERENCES `types` (`id`) ON DELETE CASCADE ON UPDATE CASCADE\n)\n</code></pre>\n\n<p>Just remember that you need to use the InnoDB storage engine: the default MyISAM storage engine doesn't support foreign keys.</p>\n    "},{"t":"Synchronizing client-server databases","l":"http://stackoverflow.com/questions/3406891/synchronizing-client-server-databases","q":"\n\n<p>I'm looking for some general strategies for synchronizing data on a central server with client applications that are not always online.</p>\n\n<p>In my particular case, I have an android phone application with an sqlite database and a PHP web application with a MySQL database. </p>\n\n<p>Users will be able to add and edit information on the phone application and on the web application. I need to make sure that changes made one place are reflected everywhere even when the phone is not able to immediately communicate with the server.</p>\n\n<p>I am not concerned with how to transfer data from the phone to the server or vice versa. I'm mentioning my particular technologies only because I cannot use, for example, the replication features available to MySQL.</p>\n\n<p>I know that the client-server data synchronization problem has been around for a long, long time and would like information - articles, books, advice, etc - about patterns for handling the problem. I'd like to know about general strategies for dealing with synchronization to compare strengths, weaknesses and trade-offs.</p>\n    ","a":"\n<p>The first thing you have to decide is a general policy about which side is considered \"authoritative\" in case of conflicting changes.</p>\n\n<p>I.e.: suppose Record #125 is changed on the server on January 5th at 10pm and the same record is changed on one of the phones (let's call it Client A) on January 5th at 11pm. \nLast synch was on Jan 3rd. Then the user reconnects on, say, January 8th.</p>\n\n<p>Identifying what needs to be changed is \"easy\" in the sense that both the client and the server know the date of the last synch, so anything <em>created or updated</em> (see below for more on this) since the last synch needs to be reconciled.</p>\n\n<p>So, suppose that the only changed record is #125.\nYou either decide that one of the two automatically \"wins\" and overwrites the other, or you need to support a reconcile phase where a user can decide which version (server or client) is the correct one, overwriting the other.</p>\n\n<p>This decision is extremely important and you must weight the \"role\" of the clients. Especially if there is a potential conflict not only between client and server, but in case different clients can change the same record(s).</p>\n\n<p>[Assuming that #125 can be modified by a second client (Client B) there is a chance that Client B, which hasn't synched yet, will provide yet another version of the same record, making the previous conflict resolution moot]</p>\n\n<p>Regarding the \"<em>created or updated</em>\" point above... how can you properly identify a record if it has been originated on one of the clients (assuming this makes sense in your problem domain)?\nLet's suppose your app manages a list of business contacts. If Client A says you have to add a newly created John Smith, and the server has a John Smith created yesterday by Client D... do you create two records because you cannot be certain that they aren't different persons? Will you ask the user to reconcile this conflict too?</p>\n\n<p>Do clients have \"ownership\" of a subset of data? I.e. if Client B is setup to be the \"authority\" on data for Area #5 can Client A modify/create records for Area #5 or not? (This would make some conflict resolution easier, but may prove unfeasible for your situation).</p>\n\n<p>To sum it up the main problems are:</p>\n\n<ul>\n<li>How to define \"identity\" considering that detached clients may not have accessed the server before creating a new record.</li>\n<li>The previous situation, no matter how sophisticated the solution, may result in data duplication, so you must foresee how to periodically solve these and how to inform the clients that what they considered as \"Record #675\" has actually been merged with/superseded by Record #543</li>\n<li>Decide if conflicts will be resolved by <em>fiat</em> (e.g. \"The server version always trumps the client's if the former has been updated since the last synch\") or by manual intervention</li>\n<li>In case of <em>fiat</em>, especially if you decide that the client takes precedence, you must also take care of how to deal with other, not-yet-synched clients that may have some more changes coming.</li>\n<li>The previous items don't take in account the granularity of your data (in order to make things simpler to describe). Suffice to say that instead of reasoing at the \"Record\" level, as in my example, you may find more appropriate to record change at the field level, instead. Or to work on a set of records (e.g. Person record + Address record + Contacts record) at a time treating their aggregate as a sort of \"Meta Record\".</li>\n</ul>\n\n<p>Bibliography:</p>\n\n<ul>\n<li><p>More on this, of course, on <a href=\"http://en.wikipedia.org/wiki/Data_synchronization\" rel=\"nofollow\">Wikipedia</a>.</p></li>\n<li><p><a href=\"http://www.objc.io/issue-10/data-synchronization.html\" rel=\"nofollow\">OBJC article on data synch</a></p></li>\n<li><p><a href=\"http://my.safaribooksonline.com/0130093696\" rel=\"nofollow\">SyncML®: Synchronizing and Managing Your Mobile Data</a> (Book on O'Reilly Safari)</p></li>\n<li><p><a href=\"http://hal.inria.fr/docs/00/61/73/41/PDF/RR-7687.pdf\" rel=\"nofollow\">Conﬂict-free Replicated Data Types</a></p></li>\n<li><p><a href=\"http://pagesperso-systeme.lip6.fr/Marc.Shapiro/papers/Optimistic_Replication_Computing_Surveys_2005-03_cameraready.pdf\" rel=\"nofollow\">Optimistic Replication</a> YASUSHI SAITO (HP Laboratories) and MARC SHAPIRO (Microsoft Research Ltd.) - <em>ACM Computing Surveys, Vol. V, No. N, 3 2005.</em></p></li>\n<li><p>Alexander Traud, J\\&amp;#252;rgen Nagler-Ihlein, Frank Kargl, and Michael Weber. 2008. Cyclic Data Synchronization through Reusing SyncML. In Proceedings of the The Ninth International Conference on Mobile Data Management (MDM '08). IEEE Computer Society, Washington, DC, USA, 165-172. DOI=10.1109/MDM.2008.10 <a href=\"http://dx.doi.org/10.1109/MDM.2008.10\" rel=\"nofollow\">http://dx.doi.org/10.1109/MDM.2008.10</a> </p></li>\n<li><p>Lam, F., Lam, N., and Wong, R. 2002. Efficient synchronization for mobile XML data. In Proceedings of the Eleventh international Conference on information and Knowledge Management (McLean, Virginia, USA, November 04 - 09, 2002). CIKM '02. ACM, New York, NY, 153-160. DOI= <a href=\"http://doi.acm.org/10.1145/584792.584820\" rel=\"nofollow\">http://doi.acm.org/10.1145/584792.584820</a></p></li>\n<li><p>Cunha, P. R. and Maibaum, T. S. 1981. Resource &amp;equil; abstract data type + synchronization - A methodology for message oriented programming -. In Proceedings of the 5th international Conference on Software Engineering (San Diego, California, United States, March 09 - 12, 1981). International Conference on Software Engineering. IEEE Press, Piscataway, NJ, 263-272.</p></li>\n</ul>\n\n<p>(The last three are from the ACM digital library, no idea if you are a member or if you can get those through other channels).</p>\n\n<p>From the <a href=\"http://www.ddj.com\" rel=\"nofollow\">Dr.Dobbs</a> site:</p>\n\n<ul>\n<li>Creating Apps with SQL Server CE and SQL RDA by Bill Wagner May 19, 2004 (Best practices for designing an application for both the desktop and mobile PC - Windows/.NET)</li>\n</ul>\n    "},{"t":"How do i extract data from a DataTable?","l":"http://stackoverflow.com/questions/1346132/how-do-i-extract-data-from-a-datatable","q":"\n\n<p>I have a <code>DataTable</code> that is filled in from an SQL query to a local database, but I don't know how to extract data from it.\nMain method (in test program):</p>\n\n<pre class=\"lang-cs prettyprint-override\"><code>static void Main(string[] args)\n{\n    const string connectionString = \"server=localhost\\\\SQLExpress;database=master;integrated Security=SSPI;\";\n    DataTable table = new DataTable(\"allPrograms\");\n\n    using (var conn = new SqlConnection(connectionString))\n    {\n        Console.WriteLine(\"connection created successfuly\");\n\n        string command = \"SELECT * FROM Programs\";\n\n        using (var cmd = new SqlCommand(command, conn))\n        {\n            Console.WriteLine(\"command created successfuly\");\n\n            SqlDataAdapter adapt = new SqlDataAdapter(cmd);\n\n            conn.Open(); \n            Console.WriteLine(\"connection opened successfuly\");\n            adapt.Fill(table);\n            conn.Close();\n            Console.WriteLine(\"connection closed successfuly\");\n        }\n    }\n\n    Console.Read();\n}\n</code></pre>\n\n<p>The command I used to create the tables in my database:</p>\n\n<pre class=\"lang-sql prettyprint-override\"><code>create table programs\n(\n    progid int primary key identity(1,1),\n    name nvarchar(255),\n    description nvarchar(500),\n    iconFile nvarchar(255),\n    installScript nvarchar(255)\n)\n</code></pre>\n\n<p>How can I extract data from the <code>DataTable</code> into a form meaningful to use?</p>\n    ","a":"\n<p>The DataTable has a collection <code>.Rows</code> of DataRow elements.</p>\n\n<p>Each DataRow corresponds to one row in your database, and contains a collection of columns.</p>\n\n<p>In order to access a single value, do something like this:</p>\n\n<pre><code> foreach(DataRow row in YourDataTable.Rows)\n { \n     string name = row[\"name\"].ToString();\n     string description = row[\"description\"].ToString();\n     string icoFileName = row[\"iconFile\"].ToString();\n     string installScript = row[\"installScript\"].ToString();\n\n }\n</code></pre>\n\n<p>Marc</p>\n    "},{"t":"SQL query to find record with ID not in another table","l":"http://stackoverflow.com/questions/12048633/sql-query-to-find-record-with-id-not-in-another-table","q":"\n\n<p>I have two tables with binding primary key in database and I desire to find a disjoint set between them. For example,</p>\n\n<ul>\n<li><code>Table1</code> has columns (<code>ID, Name</code>) and sample data: <code>(1 ,John), (2, Peter), (3, Mary)</code> </li>\n<li><code>Table2</code> has columns (<code>ID, Address</code>) and sample data: <code>(1, address2), (2, address2)</code></li>\n</ul>\n\n<p>So how do I create a SQL query so I can fetch the row with ID from <code>table1</code> that is not in <code>table2</code>. In this case, <code>(3, Mary)</code> should be returned? </p>\n\n<p><strong>Ps.</strong> The ID is the primary key for those two tables. </p>\n\n<p>Thanks in advance.</p>\n    ","a":"\n<p>Try this </p>\n\n<pre><code>SELECT ID, Name \nFROM   Table1 \nWHERE  ID NOT IN (SELECT ID FROM Table2)\n</code></pre>\n    "},{"t":"In SQL, is UPDATE always faster than DELETE+INSERT?","l":"http://stackoverflow.com/questions/1271641/in-sql-is-update-always-faster-than-deleteinsert","q":"\n\n<p>Say I have a simple table that has the following fields:</p>\n\n<ol>\n<li>ID: int, autoincremental (identity), primary key</li>\n<li>Name: varchar(50), unique, has unique index</li>\n<li>Tag: int</li>\n</ol>\n\n<p>I never use the ID field for lookup, because my application is always based on working with the Name field. </p>\n\n<p>I need to change the Tag value from time to time. I'm using the following trivial SQL code: </p>\n\n<pre><code>UPDATE Table SET Tag = XX WHERE Name = YY;\n</code></pre>\n\n<p>I wondered if anyone knows whether the above is always faster than:</p>\n\n<pre><code>DELETE FROM Table WHERE Name = YY;\nINSERT INTO Table (Name, Tag) VALUES (YY, XX);\n</code></pre>\n\n<p>Again - I know that in the second example the ID is changed, but it does not matter for my application.</p>\n    ","a":"\n<p>Anecdotally the update should be faster since it is a single command, but as a thought exercise, I suspect I could construct a convoluted scenario in SQL Server where it turned out to be closer than might be thought. Would need to be instrumented and tested to see.</p>\n\n<p>...</p>\n\n<p>I've had to edit this, I had written that if the heap page split it would ripple updates etc, and it does not.</p>\n\n<p>The row would be edited, inserted on the end page, and a forwarding pointer used in the original page, as a result the NC indexes would not be updated, since they are not using a volatile RID due to the forwarding pointer being on the data page.</p>\n\n<p>I can't think of a convoluted scenario in this case, there can be very expensive single row updates / inserts that do cause an immense amount of page splits (I'm told 17 earlier this week has been demonstrated.)</p>\n\n<p>If you have a trigger on the table, you are already deleting / inserting anyway, you just do not see it but you have versioned the row and are performing two operations without realising it.</p>\n\n<p>A.</p>\n    "},{"t":"SQL (ORACLE): ORDER BY and LIMIT","l":"http://stackoverflow.com/questions/7480243/sql-oracle-order-by-and-limit","q":"\n\n<p>I want do sorting by property ALL data in my db and ONLY AFTER that use LIMIT and OFFSET.</p>\n\n<p>Query like this:</p>\n\n<pre><code>SELECT select_list\n    FROM table_expression\n    [ ORDER BY ... ]\n    [ LIMIT { number | ALL } ] [ OFFSET number ] \n</code></pre>\n\n<p>I know the sorting ends as soon as it has found the first row_count rows of the sorted result. Can I do sorting all data before calling LIMIT and OFFSET?</p>\n    ","a":"\n<p>Prior to 12.1, Oracle does not support the <code>LIMIT</code> or <code>OFFSET</code> keywords.  If you want to retrieve rows N through M of a result set, you'd need something like</p>\n\n<pre><code>SELECT a.*\n  FROM (SELECT b.*,\n               rownum b_rownum\n          FROM (SELECT c.*\n                  FROM some_table c\n                 ORDER BY some_column) b\n         WHERE rownum &lt;= &lt;&lt;upper limit&gt;&gt;) a\n WHERE b_rownum &gt;= &lt;&lt;lower limit&gt;&gt;\n</code></pre>\n\n<p>or using analytic functions</p>\n\n<pre><code>SELECT a.*\n  FROM (SELECT b.*,\n               rank() over (order by some_column) rnk\n          FROM some_table)\n WHERE rnk BETWEEN &lt;&lt;lower limit&gt;&gt; AND &lt;&lt;upper limit&gt;&gt;\n ORDER BY some_column\n</code></pre>\n\n<p>Either of these approaches will sort give you rows N through M of the sorted result.</p>\n\n<p>In 12.1 and later, you can use the <code>OFFSET</code> and/or <code>FETCH [FIRST | NEXT]</code> operators</p>\n\n<pre><code>SELECT *\n  FROM some_table\n ORDER BY some_column\n OFFSET &lt;&lt;lower limit&gt;&gt;\n  FETCH NEXT &lt;&lt;page size&gt;&gt; ROWS ONLY\n</code></pre>\n    "},{"t":"How do we implement an IS-A Relationship?","l":"http://stackoverflow.com/questions/4361381/how-do-we-implement-an-is-a-relationship","q":"\n\n<p>We implement an One-to-Many relationship by adding one Table's PK, as FK to the other Table.\nWe implement a Many-to-Many relationship by adding 2 Table's PKs to a third Table.</p>\n\n<p>How do we implement an IS-A Relationship ?</p>\n\n<p>The Entities are TECHNICIAN and ADMINISTRATIVE which both are EMPLOYEE.\nI could just use an extra field in the Table \nEMPLOYEE(id, name, surname, <strong>role</strong>, ...AdminFields..., ...TechFields...)</p>\n\n<p>but i would like to explore the IS-A option.  </p>\n\n<p>EDIT: I did as Donnie suggested, but without the role field.</p>\n    ","a":"\n<p>I did as Donnie suggested, but without the <strong>role</strong> field, because it complicates things. This is the final implementation:  </p>\n\n<p><strong>DDL:</strong></p>\n\n<pre><code>CREATE TABLE Employee (\nast VARCHAR(20) not null,\nfirstname VARCHAR(200) not null,\nsurname VARCHAR(200) not null,\n...\nPRIMARY KEY(ast)\n);\n\nCREATE TABLE Administrative (\nemployee_ast VARCHAR(20) not null REFERENCES Employee(ast),\nPRIMARY KEY(employee_ast)\n);\n\nCREATE TABLE Technical (\nemployee_ast VARCHAR(20) not null REFERENCES Employee(ast),\n...\nPRIMARY KEY(employee_ast)\n);\n</code></pre>\n\n<p><strong>ER Diagram:</strong></p>\n\n<p><img src=\"http://i.stack.imgur.com/4KsMq.png\" alt=\"ERD\"></p>\n\n<p>In this model there are no Employees of Generic Type. Here, an Employee can only be Administrative or Technical.</p>\n    "},{"t":"How do I get a raw, compiled SQL query from a SQLAlchemy expression?","l":"http://stackoverflow.com/questions/4617291/how-do-i-get-a-raw-compiled-sql-query-from-a-sqlalchemy-expression","q":"\n\n<p>I have a SQLAlchemy query object and want to get the text of the compiled SQL statement, with all its parameters bound (e.g. no <code>%s</code> or other variables waiting to be bound by the statement compiler or MySQLdb dialect engine, etc).</p>\n\n<p>Calling <code>str()</code> on the query reveals something like this:</p>\n\n<pre><code>SELECT id WHERE date_added &lt;= %s AND date_added &gt;= %s ORDER BY count DESC\n</code></pre>\n\n<p>I've tried looking in query._params but it's an empty dict.  I wrote my own compiler using <a href=\"http://groups.google.com/group/sqlalchemy/browse_thread/thread/0c20a4f380e277af\">this example of the <code>sqlalchemy.ext.compiler.compiles</code> decorator</a> but even the statement there still has <code>%s</code> where I want data.</p>\n\n<p>I can't quite figure out when my parameters get mixed in to create the query; when examining the query object they're always an empty dictionary (though the query executes fine and the engine prints it out when you turn echo logging on).</p>\n\n<p>I'm starting to get the message that SQLAlchemy doesn't want me to know the underlying query, as it breaks the general nature of the expression API's interface all the different DB-APIs.  I don't mind if the query gets executed before I found out what it was; I just want to know!</p>\n    ","a":"\n<p>This should work with Sqlalchemy &gt;= 0.6</p>\n\n<pre><code>from sqlalchemy.sql import compiler\n\nfrom psycopg2.extensions import adapt as sqlescape\n# or use the appropiate escape function from your db driver\n\ndef compile_query(query):\n    dialect = query.session.bind.dialect\n    statement = query.statement\n    comp = compiler.SQLCompiler(dialect, statement)\n    comp.compile()\n    enc = dialect.encoding\n    params = {}\n    for k,v in comp.params.iteritems():\n        if isinstance(v, unicode):\n            v = v.encode(enc)\n        params[k] = sqlescape(v)\n    return (comp.string.encode(enc) % params).decode(enc)\n</code></pre>\n    "},{"t":"SQL JOIN: is there a difference between USING, ON or WHERE?","l":"http://stackoverflow.com/questions/5654278/sql-join-is-there-a-difference-between-using-on-or-where","q":"\n\n<p>I was wondering if there is any difference in the way SQL performs on these join statements:</p>\n\n<pre><code>SELECT * FROM a,b WHERE a.ID = b.ID\n\nSELECT * FROM a JOIN b ON a.ID = b.ID\n\nSELECT * FROM a JOIN b USING(ID)\n</code></pre>\n\n<p>Is there a performance difference? Or algorithmic difference?</p>\n\n<p>Or is it just syntactic sugar?</p>\n    ","a":"\n<p>There is no difference in performance.</p>\n\n<p>However, the first style is ANSI-89 and will get your legs broken in some shops. Including mine. The second style is ANSI-92 and is much clearer.</p>\n\n<p>Examples:</p>\n\n<p>Which is the JOIN, which is the filter?</p>\n\n<pre><code>FROM T1,T2,T3....\nWHERE T1.ID = T2.ID AND\n     T1.foo = 'bar' AND T2.fish = 42 AND\n     T1.ID = T3.ID\n\nFROM T1 \n   INNER JOIN T2 ON T1.ID = T2.ID\n   INNER JOIN T3 ON T1.ID = T3.ID\nWHERE\n   T1.foo = 'bar' AND T2.fish = 42\n</code></pre>\n\n<p>If you have OUTER JOINs (<code>=*</code>, <code>*=</code>) then the 2nd style will work as advertised. The first most likely won't and is also deprecated in SQL Server 2005+</p>\n\n<p>The ANSI-92 style is harder to bollix too. With the older style you can easily end up with a Cartesian product (cross join) if you miss a condition. You'll get a syntax error with ANSI-92. </p>\n\n<p>Edit: Some more clarification</p>\n\n<ul>\n<li>The reason for not using \"join the where\" (implicit) is the  dodgy results with outer joins.</li>\n<li>If you use explicit OUTER JOINs + implicit INNER JOINs you'll still get dodgy results + you have inconsistency in usage</li>\n</ul>\n\n<p>It isn't just <em>syntax</em>: it's about having a <em>semantically correct</em> query</p>\n\n<p>Edit, Dec 2011</p>\n\n<p><a href=\"http://msdn.microsoft.com/en-us/library/ms189499.aspx\">SQL Server <em>logical</em> query processing order</a> is FROM, ON, JOIN, WHERE...</p>\n\n<p>So if you mix \"implicit WHERE inner joins\" and \"explicit FROM outer joins\" you most likely won't get expected results because the query is ambiguous...</p>\n    "},{"t":"SQL query to look for a Kevin Bacon number of 2","l":"http://stackoverflow.com/questions/9136282/sql-query-to-look-for-a-kevin-bacon-number-of-2","q":"\n\n<p>Using the IMDB database, I have tables <code>actor</code>, <code>casts</code>, and <code>movie</code>, and I need to select actors with a Kevin Bacon number of 2. I thought this should do it, but I'm getting 0 rows returned. What is my error? </p>\n\n<pre><code>select fname, lname\nfrom actor join casts on pid=actor.id\nwhere actor.id in (\n    select a3.id  --actors who have a kb number of 2\n    from casts c3 join actor a3 on c3.pid=a3.id,\n    (\n     (select c1.mid --actors who have a kb number of 1\n     from (casts c1 join actor a1 on c1.pid=a1.id), (casts c2 join actor a2 on c2.pid=a2.id)\n     where c1.mid=c2.mid and a2.fname='Kevin' and a2.lname='Bacon')\n    )Level1 where c3.mid=Level1.mid\n)\nand actor.id not in (select a4.id --and only a kb number of 2\n     from (casts c4 join actor a4 on c4.pid=a4.id), (casts c5 join actor a5 on c5.pid=a5.id)\n     where c4.mid=c5.mid and a5.fname='Kevin' and a5.lname='Bacon');\n</code></pre>\n\n<p>Here are the table schemas:</p>\n\n<pre><code>ACTOR (id, fname, lname, gender)\nMOVIE (id, name, year)\nCASTS (pid, mid, role)\n</code></pre>\n\n<p><code>mid</code> is a foreign key to a movie id and <code>pid</code> is a foreign key to actor id.</p>\n\n<p>Note that restrictions on the question prohibit me from using temp tables or recursion: the query should be done with subselects.</p>\n\n<hr>\n\n<p>I also tried</p>\n\n<pre><code>select count(distinct pid) from casts join actor on pid=actor.id where mid in (\n    select mid from casts where pid in (\n        select distinct pid from casts where mid in (\n            select mid from casts join actor on pid=actor.id where fname='Kevin' and lname='Bacon')))\n\nand pid not in  \n    (select distinct pid from casts where mid in (\n        select mid from casts join actor on pid=actor.id where fname='Kevin' and lname='Bacon'));\n</code></pre>\n\n<p>which also seems like it should work, but it's not finishing.</p>\n\n<hr>\n\n<p>I finally managed to get some working code:</p>\n\n<pre><code>select count(distinct pid) from casts where mid in (\n    select mid from casts where pid in (\n        select distinct pid from casts where mid in (\n            select mid from casts join actor on pid=actor.id where fname='Kevin' and lname='Bacon')))\n\nand pid not in  \n    (select distinct pid from casts where mid in (\n        select mid from casts join actor on pid=actor.id where fname='Kevin' and lname='Bacon'));\n</code></pre>\n\n<p>The subqueries return sensible answers, at least. But it's taking forever. Each subquery took under 30 seconds, but together they're taking 6 minutes and counting. Why?</p>\n\n<hr>\n\n<p>Note: This was given to me as homework. To avoid any semblence of academic misconduct on my part, I'd prefer if people didn't post complete/exact solutions, but rather pointed out general things that I'm doing wrong/make general suggestions as to how I should go about this.</p>\n    ","a":"\n<p>To give a sketch of a solution rather than an exact solution I would use this general  approach</p>\n\n<pre><code>SELECT *\nFROM   ACTOR\nWHERE  id IN (\nSELECT id \n       /* ... of actors that have worked on a film worked \n         on by actors that have worked on a KB film*/\nEXCEPT\nSELECT id\n /* ... of all actors that have worked on a KB film\n         including KB himself*/ )\n</code></pre>\n\n<p>Also as you are not allowed to use recursive CTEs anyway here's an answer using those.</p>\n\n<pre><code>WITH RecursiveCTE\n     AS (SELECT C.pid,\n                C.mid,\n                0 as Level\n         FROM   CASTS C\n                JOIN ACTOR A\n                  ON A.id = C.pid\n         WHERE  A.fname = 'Kevin'\n                and A.lname = 'Bacon'\n         UNION ALL\n         SELECT c1.pid,\n                c2.mid,\n                R.Level + 1\n         FROM   RecursiveCTE R\n                JOIN CASTS c1\n                  ON c1.mid = R.mid\n                     AND R.Level &lt; 2\n                JOIN CASTS c2\n                  ON c1.pid = c2.pid)\nSELECT *\nFROM   ACTOR\nWHERE  id IN (SELECT pid\n              FROM   RecursiveCTE\n              GROUP  BY pid\n              HAVING MIN(Level) = 2)  \n</code></pre>\n    "},{"t":"Update function in TSQL trigger","l":"http://stackoverflow.com/questions/1249061/update-function-in-tsql-trigger","q":"\n\n<p>I have a question about TSQL function Update. For example, I have a table with a field Name. If I check if the field Name is changed or not in a After Update trigger likes this:</p>\n\n<pre><code>  if Update(Name)\n  Begin\n    -- process\n  End\n</code></pre>\n\n<p>Will the Update still return TRUE even if Name is not changed? The following update statement will update it with the same value:</p>\n\n<pre><code>  SELECT @v_Name = Name From MyTable Where Id = 1;\n  Update MyTable Set Name = @v_Name where Id = 1;\n</code></pre>\n\n<p>If the Update() returns TRUE even the value of Name is not changed, do I have to compare the value in the inserted and deleted virtual tables to find out if the value is really changed? </p>\n\n<p>By the way, the inserted and deleted are virtual tables and they may contain more than one rows of data if more than one rows of data are changed by one TSQL INSERT or UPDATE statement. In case of more than one records, are the count numbers of rows in inserted and deleted virtual tables the same and what is the real meaning of Update(Name) as TRUE? Does it mean that at least one is changed? Or does Update(Name) mean that the field of Name has been set by Update statement regardless if the value is changed?</p>\n\n<p>The SQL server I use is Microsoft SQL 2005.</p>\n    ","a":"\n<p><code>UPDATE()</code> can be true, even if it's the same value. I would not rely on it personally and would compare values.</p>\n\n<p>Second, <code>DELETED</code> and <code>INSERTED</code> have the same number of rows.</p>\n\n<p>The Update() function is not per row, but across all rows. Another reason not to use it.</p>\n\n<p><a href=\"http://msdn.microsoft.com/en-us/library/ms187326%28SQL.90%29.aspx\">More here in MSDN</a>, however it's a bit sparse, really.</p>\n\n<p>After comment:</p>\n\n<pre><code>IF EXISTS (\n    SELECT\n        *\n    FROM\n        INSERTED I\n        JOIN\n        DELETED D ON I.key = D.key\n    WHERE\n        D.valuecol &lt;&gt; I.valuecol --watch for NULLs!\n    )\n   blah\n</code></pre>\n    "},{"t":"How to select the last record from MySQL table using SQL syntax","l":"http://stackoverflow.com/questions/2659253/how-to-select-the-last-record-from-mysql-table-using-sql-syntax","q":"\n\n<p>I have a table with several records. There is an id field. I would like to select the record with the most recent id (i.e. the highest id).</p>\n\n<p>Any ideas?</p>\n    ","a":"\n<pre><code>SELECT * \nFROM table_name\nORDER BY id DESC\nLIMIT 1\n</code></pre>\n    "},{"t":"can we have a foreign key which is not a primary key in any other table?","l":"http://stackoverflow.com/questions/2895219/can-we-have-a-foreign-key-which-is-not-a-primary-key-in-any-other-table","q":"\n\n<p>it is written in every book that foreign keys are actually primary key in some other table but can we have a foreign key which is not primary key in any other table </p>\n    ","a":"\n<p>Yes - you can have a foreign key that references a unique index in another table.</p>\n\n<pre><code>CREATE UNIQUE INDEX UX01_YourTable ON dbo.YourTable(SomeUniqueColumn)\n\nALTER TABLE dbo.YourChildTable\n   ADD CONSTRAINT FK_ChildTable_Table\n   FOREIGN KEY(YourFKColumn) REFERENCES dbo.YourTable(SomeUniqueColumn)\n</code></pre>\n    "},{"t":"how to execute a .sql script on heroku?","l":"http://stackoverflow.com/questions/15237366/how-to-execute-a-sql-script-on-heroku","q":"\n\n<p>I have a .sql file with a bunch of insert commands that I want to execute on my postgres database on heroku. But I don't know how to do it:-</p>\n\n<p>If I had access to postgres console I'd type the following:</p>\n\n<pre><code>psql -h localhost -d database -U username -f datafile.sql\n</code></pre>\n\n<p>but it seems that heroku doesn't support this command. I've tried with</p>\n\n<pre><code>heroku pg:psql\n</code></pre>\n\n<p>but that doesn't let me input a file.</p>\n\n<p>Are there any other options?</p>\n    ","a":"\n<p>For things like seeding a database, I recommend Richard Brown's answer:  you're arguably better off using something like Rails seeds mechanism, or something scripted like a rake task. </p>\n\n<p>That said, being able to pipe sql (raw, or a file) is a useful feature, especially for idempotent things like simple look ups or routine queries. In which case you can execute your local sql with any of the following:</p>\n\n<pre><code>$ cat file.sql | heroku pg:psql --app app_name\n$ echo \"select * from table;\" | heroku pg:psql --app app_name\n$ heroku pg:psql --app app_name &lt; file.sql\n</code></pre>\n    "},{"t":"Order by descending date - month, day and year","l":"http://stackoverflow.com/questions/4676139/order-by-descending-date-month-day-and-year","q":"\n\n<p>This seems stupid but, I simply need a list of dates to be ordered with the most recent date at top. Using <code>order by DESC</code> doesn't seem to be working the way I want it to.</p>\n\n<pre><code>SELECT     *\nFROM         vw_view\nORDER BY EventDate DESC\n</code></pre>\n\n<p>It gives me the date ordered by month and day, but doesn't take year into consideration.\nfor example:</p>\n\n<pre><code>12/31/2009 \n\n12/31/2008\n\n12/30/2009\n\n12/29/2009\n</code></pre>\n\n<p>Needs to be more like:</p>\n\n<pre><code>12/31/2009\n\n12/30/2009\n\n12/29/2009\n\n12/28/2009\n</code></pre>\n\n<p>and so on.</p>\n    ","a":"\n<p>I'm guessing <code>EventDate</code> is a char or varchar and not a date otherwise your order by clause would be fine.</p>\n\n<p>You can use CONVERT to change the values to a date and sort by that</p>\n\n<pre><code>SELECT * \nFROM \n     vw_view \nORDER BY \n   CONVERT(DateTime, EventDate,101)  DESC\n</code></pre>\n\n<p>The problem with that is, as Sparky points out in the comments, if EventDate has a value that cant' be converted to a date the query won't execute. </p>\n\n<p>This means you should either exclude the bad rows or let the bad rows go to the bottom of the results</p>\n\n<p>To exclude the rows add <code>WHERE IsDate(EventDate) = 1</code></p>\n\n<p>To let let the bad dates go to the bottom you need to use CASE</p>\n\n<p>e.g.</p>\n\n<pre><code>ORDER BY \n    CASE\n       WHEN IsDate(EventDate) = 1 THEN CONVERT(DateTime, EventDate,101)\n       ELSE null\n    END DESC\n</code></pre>\n    "},{"t":"How to select an empty result set?","l":"http://stackoverflow.com/questions/1456106/how-to-select-an-empty-result-set","q":"\n\n<p>I'm using a stored procedure in MySQL, with a CASE statement.</p>\n\n<p>In the ELSE clause of the CASE ( equivalent to default: ) I want to select and return an empty result set, thus avoiding to throw an SQL error by not handling the ELSE case, and instead return an empty result set as if a regular query would have returned no rows.</p>\n\n<p>So far I've managed to do so using something like:<br>\n<code>Select NULL From users Where False</code></p>\n\n<p>But I have to name an existing table, like 'users' in this example.\nIt works, but I would prefer a more elegant way that doesn't break if eventually the table name used is renamed or dropped.</p>\n\n<p>I've tried <code>Select NULL Where False</code> but it doesn't work.</p>\n\n<p>Using <code>Select NULL</code> does not return an empty set, but one row with a column named NULL and with a NULL value.</p>\n    ","a":"\n<p>There's a dummy-table in MySQL called 'dual', which you should be able to use.</p>\n\n<pre><code>select\n    1\nfrom\n    dual\nwhere\n    false\n</code></pre>\n\n<p>This will always give you an empty result.</p>\n    "},{"t":"MySQL Select Query - Get only first 10 characters of a value","l":"http://stackoverflow.com/questions/14959166/mysql-select-query-get-only-first-10-characters-of-a-value","q":"\n\n<p>Ok, so here is the issue.</p>\n\n<p>I have a table with some columns and 'subject' is one of the columns.\nI need to get the first 10 letters from the 'subject' field no matter the 'subject' field contains a string with 100 letters.</p>\n\n<p>For example,</p>\n\n<p>Table - <strong><code>tbl</code></strong>.\nColumns - <code>id</code>, <code>subject</code>, <code>value</code>.</p>\n\n<p>SQL Query: </p>\n\n<pre><code>SELECT subject FROM tbl WHERE id ='$id';\n</code></pre>\n\n<p>The result I am getting is, for example </p>\n\n<blockquote>\n  <p>Hello, this is my subject and how are you</p>\n</blockquote>\n\n<p>I only require the first 10 characters</p>\n\n<blockquote>\n  <p>Hello, thi</p>\n</blockquote>\n\n<p>I can understand that I can remove the rest of the characters using php substr() but that's not possible in my case. I need to get the excess characters removed by MySQL. How this can be done ?</p>\n    ","a":"\n<p>Using the below line</p>\n\n<pre><code>SELECT LEFT(subject , 10) FROM tbl \n</code></pre>\n\n<p><a href=\"http://dev.mysql.com/doc/refman/5.0/en/string-functions.html#function_left\">MySQL Doc.</a></p>\n    "},{"t":"How can you find the number of occurrences of a particular character in a string using sql?","l":"http://stackoverflow.com/questions/287373/how-can-you-find-the-number-of-occurrences-of-a-particular-character-in-a-string","q":"\n\n<p>How can you find the number of occurrences of a particular character in a string using sql?</p>\n\n<p>Example: I want to find the number of times the letter ‘d’ appears in this string.</p>\n\n<pre><code>declare @string varchar(100)\nselect @string = 'sfdasadhfasjfdlsajflsadsadsdadsa'\n</code></pre>\n    ","a":"\n<p>Here you go:</p>\n\n<pre><code>declare @string varchar(100)\nselect @string = 'sfdasadhfasjfdlsajflsadsadsdadsa'\nSELECT LEN(@string) - LEN(REPLACE(@string, 'd', '')) AS D_Count\n</code></pre>\n    "}]